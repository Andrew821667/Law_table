<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–ø–ª–æ–π Law Table –Ω–∞ Google Apps Script</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .instructions {
            padding: 30px 40px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .instructions h2 {
            color: #495057;
            margin-bottom: 20px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .instructions a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .instructions a:hover {
            text-decoration: underline;
        }

        .files-container {
            padding: 40px;
        }

        .file-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .file-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .file-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .file-name {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
        }

        .file-name .icon {
            margin-right: 8px;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .file-info {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .code-preview {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .progress {
            padding: 20px 40px;
            background: #e9ecef;
            text-align: center;
        }

        .progress-bar {
            background: #dee2e6;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .open-script-btn {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            margin: 20px;
            transition: all 0.3s ease;
        }

        .open-script-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .footer {
            padding: 30px;
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öñÔ∏è –î–µ–ø–ª–æ–π Law Table –Ω–∞ Google Apps Script</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ Apps Script Editor</p>
        </div>

        <div class="instructions">
            <h2>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (3 —à–∞–≥–∞):</h2>
            <ol>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É <a href="https://docs.google.com/spreadsheets/d/1z71C-B_f8REz45blQKISYmqmNcemdHLtICwbSMrcIo8/edit" target="_blank">Google –¢–∞–±–ª–∏—Ü—É</a></li>
                <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>–†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script</strong></li>
                <li>–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –Ω–∏–∂–µ:
                    <ul style="margin-top: 10px;">
                        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥"</strong></li>
                        <li>–í Apps Script Editor —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º</li>
                        <li>–í—Å—Ç–∞–≤—å—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (Ctrl+V)</li>
                    </ul>
                </li>
            </ol>
            <p style="margin-top: 20px;">
                <a class="open-script-btn" href="https://script.google.com/home/projects/1rjPu1OKT30MHXDQYAWjqx1jrSxNQXMNnZKAa0RwH8Y5PXMWPwW-haTBU" target="_blank">
                    üöÄ –û—Ç–∫—Ä—ã—Ç—å Apps Script Editor
                </a>
            </p>
        </div>

        <div class="progress">
            <div>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="progress-text">0/27</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>
        </div>

        <div class="files-container" id="files-container">
            <!-- –§–∞–π–ª—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <div class="footer">
            <p>–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É!</p>
            <p style="margin-top: 10px;">–ú–µ–Ω—é "‚öñÔ∏è –°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞" –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ç–∞–±–ª–∏—Ü—ã.</p>
        </div>
    </div>

    <script>
        const files = [{"name":"AppLogger.gs","content":"/**\n * ‚ú® AppLogger.gs - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\n *\n * –§–£–ù–ö–¶–ò–ò:\n * ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏—Å—Ç Google Sheets\n * ‚úÖ –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARN, ERROR)\n * ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É—Ä–æ–≤–Ω—é –∏ –º–æ–¥—É–ª—é\n * ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤\n * ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫\n * ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ JSON/CSV\n *\n * –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:\n * - –í—Å–µ –ª–æ–≥–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ\n * - –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º\n * - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n * - –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n */\n\nvar AppLogger = (function() {\n\n  const LOG_LEVELS = {\n    DEBUG: 0,\n    INFO: 1,\n    WARN: 2,\n    ERROR: 3\n  };\n\n  let logSheet = null;\n  let currentLevel = LOG_LEVELS.INFO;\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç –ª–æ–≥–æ–≤\n   * @return {Sheet} –õ–∏—Å—Ç –ª–æ–≥–æ–≤\n   */\n  function getLogSheet() {\n    if (logSheet) return logSheet;\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    logSheet = ss.getSheetByName('üìã –õ–æ–≥–∏');\n\n    if (!logSheet) {\n      logSheet = ss.insertSheet('üìã –õ–æ–≥–∏');\n\n      // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n      const headers = ['–í—Ä–µ–º—è', '–£—Ä–æ–≤–µ–Ω—å', '–ú–æ–¥—É–ª—å', '–°–æ–æ–±—â–µ–Ω–∏–µ', '–î–∞–Ω–Ω—ã–µ'];\n      logSheet.appendRow(headers);\n\n      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤\n      const headerRange = logSheet.getRange('A1:E1');\n      headerRange.setFontWeight('bold');\n      headerRange.setBackground('#4285f4');\n      headerRange.setFontColor('#ffffff');\n\n      // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n      logSheet.setColumnWidth(1, 150); // –í—Ä–µ–º—è\n      logSheet.setColumnWidth(2, 80);  // –£—Ä–æ–≤–µ–Ω—å\n      logSheet.setColumnWidth(3, 150); // –ú–æ–¥—É–ª—å\n      logSheet.setColumnWidth(4, 400); // –°–æ–æ–±—â–µ–Ω–∏–µ\n      logSheet.setColumnWidth(5, 300); // –î–∞–Ω–Ω—ã–µ\n\n      // –ó–∞–º–æ—Ä–æ–∑–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞\n      logSheet.setFrozenRows(1);\n    }\n\n    return logSheet;\n  }\n\n  /**\n   * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\n   * @param {string} level - –£—Ä–æ–≤–µ–Ω—å (DEBUG, INFO, WARN, ERROR)\n   * @param {string} module - –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è\n   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ\n   * @param {*} data - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n   */\n  function log(level, module, message, data = null) {\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è\n    if (LOG_LEVELS[level] < currentLevel) return;\n\n    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å\n    const logMessage = `[${level}] ${module}: ${message}`;\n    Logger.log(logMessage);\n\n    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–∏—Å—Ç\n    try {\n      const sheet = getLogSheet();\n      const timestamp = new Date();\n      const dataStr = data ? JSON.stringify(data) : '';\n\n      sheet.appendRow([timestamp, level, module, message, dataStr]);\n\n      // –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—é\n      const lastRow = sheet.getLastRow();\n      const levelCell = sheet.getRange(lastRow, 2);\n\n      switch (level) {\n        case 'DEBUG':\n          levelCell.setBackground('#e8f0fe');\n          break;\n        case 'INFO':\n          levelCell.setBackground('#e6f4ea');\n          break;\n        case 'WARN':\n          levelCell.setBackground('#fef7e0');\n          break;\n        case 'ERROR':\n          levelCell.setBackground('#fce8e6');\n          break;\n      }\n\n      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ –±–æ–ª—å—à–µ 1000 –∑–∞–ø–∏—Å–µ–π)\n      if (lastRow > 1001) {\n        sheet.deleteRows(2, lastRow - 1001);\n      }\n    } catch (e) {\n      Logger.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∞: ' + e.message);\n    }\n  }\n\n  /**\n   * DEBUG —É—Ä–æ–≤–µ–Ω—å\n   * @param {string} module - –ú–æ–¥—É–ª—å\n   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ\n   * @param {*} data - –î–∞–Ω–Ω—ã–µ\n   */\n  function debug(module, message, data) {\n    log('DEBUG', module, message, data);\n  }\n\n  /**\n   * INFO —É—Ä–æ–≤–µ–Ω—å\n   * @param {string} module - –ú–æ–¥—É–ª—å\n   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ\n   * @param {*} data - –î–∞–Ω–Ω—ã–µ\n   */\n  function info(module, message, data) {\n    log('INFO', module, message, data);\n  }\n\n  /**\n   * WARN —É—Ä–æ–≤–µ–Ω—å\n   * @param {string} module - –ú–æ–¥—É–ª—å\n   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ\n   * @param {*} data - –î–∞–Ω–Ω—ã–µ\n   */\n  function warn(module, message, data) {\n    log('WARN', module, message, data);\n  }\n\n  /**\n   * ERROR —É—Ä–æ–≤–µ–Ω—å\n   * @param {string} module - –ú–æ–¥—É–ª—å\n   * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ\n   * @param {*} data - –î–∞–Ω–Ω—ã–µ\n   */\n  function error(module, message, data) {\n    log('ERROR', module, message, data);\n  }\n\n  /**\n   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\n   * @param {string} level - –£—Ä–æ–≤–µ–Ω—å (DEBUG, INFO, WARN, ERROR)\n   */\n  function setLevel(level) {\n    if (LOG_LEVELS[level] !== undefined) {\n      currentLevel = LOG_LEVELS[level];\n      info('AppLogger', `–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${level}`);\n    } else {\n      warn('AppLogger', `–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: ${level}`);\n    }\n  }\n\n  /**\n   * –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏\n   * @param {number} daysToKeep - –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)\n   */\n  function clearOldLogs(daysToKeep = 30) {\n    const sheet = getLogSheet();\n    const data = sheet.getDataRange().getValues();\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n    let rowsToDelete = 0;\n    for (let i = 1; i < data.length; i++) {\n      if (data[i][0] < cutoffDate) {\n        rowsToDelete++;\n      } else {\n        break;\n      }\n    }\n\n    if (rowsToDelete > 0) {\n      sheet.deleteRows(2, rowsToDelete);\n      info('AppLogger', `–£–¥–∞–ª–µ–Ω–æ ${rowsToDelete} —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤`);\n    } else {\n      info('AppLogger', '–ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');\n    }\n  }\n\n  /**\n   * –û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –ª–æ–≥–∏\n   */\n  function clearAllLogs() {\n    const sheet = getLogSheet();\n    const lastRow = sheet.getLastRow();\n\n    if (lastRow > 1) {\n      sheet.deleteRows(2, lastRow - 1);\n      info('AppLogger', '–í—Å–µ –ª–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');\n    }\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–æ–≥–æ–≤\n   * @param {number} hours - –ó–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24)\n   * @return {Object} –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n   */\n  function getStats(hours = 24) {\n    const sheet = getLogSheet();\n    const data = sheet.getDataRange().getValues();\n    const cutoffTime = new Date().getTime() - (hours * 60 * 60 * 1000);\n\n    const stats = {\n      total: 0,\n      byLevel: { DEBUG: 0, INFO: 0, WARN: 0, ERROR: 0 },\n      byModule: {},\n      recentErrors: []\n    };\n\n    for (let i = 1; i < data.length; i++) {\n      const timestamp = data[i][0];\n      if (timestamp.getTime() < cutoffTime) continue;\n\n      const level = data[i][1];\n      const module = data[i][2];\n      const message = data[i][3];\n\n      stats.total++;\n      stats.byLevel[level] = (stats.byLevel[level] || 0) + 1;\n      stats.byModule[module] = (stats.byModule[module] || 0) + 1;\n\n      // –°–æ–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏\n      if (level === 'ERROR' && stats.recentErrors.length < 10) {\n        stats.recentErrors.push({\n          timestamp: timestamp,\n          module: module,\n          message: message\n        });\n      }\n    }\n\n    return stats;\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ UI\n   */\n  function showStats() {\n    const stats = getStats(24);\n\n    let message = 'üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –õ–û–ì–û–í (–∑–∞ 24 —á–∞—Å–∞)\\n\\n';\n    message += `–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${stats.total}\\n\\n`;\n\n    message += 'üìà –ü–æ —É—Ä–æ–≤–Ω—è–º:\\n';\n    Object.keys(stats.byLevel).forEach(level => {\n      if (stats.byLevel[level] > 0) {\n        message += `  ${level}: ${stats.byLevel[level]}\\n`;\n      }\n    });\n\n    message += '\\nüì¶ –ü–æ –º–æ–¥—É–ª—è–º:\\n';\n    const topModules = Object.entries(stats.byModule)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5);\n\n    topModules.forEach(([module, count]) => {\n      message += `  ${module}: ${count}\\n`;\n    });\n\n    if (stats.recentErrors.length > 0) {\n      message += `\\n‚ùå –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ (${stats.recentErrors.length}):\\n`;\n      stats.recentErrors.forEach((err, i) => {\n        message += `  ${i + 1}. [${err.module}] ${err.message}\\n`;\n      });\n    }\n\n    SpreadsheetApp.getUi().alert(message);\n  }\n\n  /**\n   * –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ JSON\n   * @param {number} hours - –ó–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤\n   * @return {string} JSON —Å—Ç—Ä–æ–∫–∞\n   */\n  function exportToJSON(hours = 24) {\n    const sheet = getLogSheet();\n    const data = sheet.getDataRange().getValues();\n    const cutoffTime = new Date().getTime() - (hours * 60 * 60 * 1000);\n\n    const logs = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const timestamp = data[i][0];\n      if (timestamp.getTime() < cutoffTime) continue;\n\n      logs.push({\n        timestamp: timestamp.toISOString(),\n        level: data[i][1],\n        module: data[i][2],\n        message: data[i][3],\n        data: data[i][4]\n      });\n    }\n\n    return JSON.stringify(logs, null, 2);\n  }\n\n  /**\n   * –ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö\n   * @param {string} query - –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å\n   * @param {string} level - –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n   * @param {number} hours - –ó–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –∏—Å–∫–∞—Ç—å\n   * @return {Array} –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏\n   */\n  function search(query, level = null, hours = 24) {\n    const sheet = getLogSheet();\n    const data = sheet.getDataRange().getValues();\n    const cutoffTime = new Date().getTime() - (hours * 60 * 60 * 1000);\n    const results = [];\n\n    const queryLower = query.toLowerCase();\n\n    for (let i = 1; i < data.length; i++) {\n      const timestamp = data[i][0];\n      if (timestamp.getTime() < cutoffTime) continue;\n\n      const logLevel = data[i][1];\n      const module = data[i][2];\n      const message = data[i][3];\n      const logData = data[i][4];\n\n      // –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é\n      if (level && logLevel !== level) continue;\n\n      // –ü–æ–∏—Å–∫ –≤ –º–æ–¥—É–ª–µ, —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –¥–∞–Ω–Ω—ã—Ö\n      const searchText = `${module} ${message} ${logData}`.toLowerCase();\n\n      if (searchText.includes(queryLower)) {\n        results.push({\n          timestamp: timestamp,\n          level: logLevel,\n          module: module,\n          message: message,\n          data: logData\n        });\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ–∏—Å–∫–∞\n   */\n  function showSearchDialog() {\n    const ui = SpreadsheetApp.getUi();\n\n    const queryResponse = ui.prompt(\n      '–ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö',\n      '–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (queryResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const query = queryResponse.getResponseText();\n    const results = search(query, null, 168); // 7 –¥–Ω–µ–π\n\n    if (results.length === 0) {\n      ui.alert('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n      return;\n    }\n\n    let message = `–ù–∞–π–¥–µ–Ω–æ: ${results.length} –∑–∞–ø–∏—Å–µ–π\\n\\n`;\n    results.slice(0, 20).forEach((result, i) => {\n      message += `${i + 1}. [${result.level}] ${result.module}: ${result.message}\\n`;\n    });\n\n    if (results.length > 20) {\n      message += `\\n... –∏ –µ—â—ë ${results.length - 20} –∑–∞–ø–∏—Å–µ–π`;\n    }\n\n    ui.alert(message);\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É –ª–æ–≥–æ–≤\n   */\n  function setupAutoCleanup() {\n    // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã\n    const triggers = ScriptApp.getProjectTriggers();\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === 'AppLogger.clearOldLogs') {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)\n    ScriptApp.newTrigger('AppLogger.clearOldLogs')\n      .timeBased()\n      .atHour(3)\n      .everyDays(1)\n      .create();\n\n    info('AppLogger', '–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)');\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    debug: debug,\n    info: info,\n    warn: warn,\n    error: error,\n    setLevel: setLevel,\n    clearOldLogs: clearOldLogs,\n    clearAllLogs: clearAllLogs,\n    getStats: getStats,\n    showStats: showStats,\n    exportToJSON: exportToJSON,\n    search: search,\n    showSearchDialog: showSearchDialog,\n    setupAutoCleanup: setupAutoCleanup\n  };\n})();\n\n/**\n * –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:\n *\n * // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\n * AppLogger.info('CaseManager', '–û–±—Ä–∞–±–æ—Ç–∫–∞ 100 –¥–µ–ª –Ω–∞—á–∞—Ç–∞');\n * AppLogger.warn('CalendarManager', '–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ –Ω–∞–π–¥–µ–Ω');\n * AppLogger.error('ErrorHandler', '–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é', { error: e.message });\n *\n * // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è\n * AppLogger.setLevel('DEBUG'); // DEBUG, INFO, WARN, ERROR\n *\n * // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n * const stats = AppLogger.getStats(24); // –ó–∞ 24 —á–∞—Å–∞\n * AppLogger.showStats(); // –ü–æ–∫–∞–∑–∞—Ç—å –≤ UI\n *\n * // –û—á–∏—Å—Ç–∫–∞\n * AppLogger.clearOldLogs(30); // –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π\n * AppLogger.clearAllLogs(); // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏\n *\n * // –ü–æ–∏—Å–∫\n * const results = AppLogger.search('–æ—à–∏–±–∫–∞', 'ERROR', 24);\n * AppLogger.showSearchDialog(); // UI –¥–ª—è –ø–æ–∏—Å–∫–∞\n *\n * // –≠–∫—Å–ø–æ—Ä—Ç\n * const json = AppLogger.exportToJSON(24);\n */\n"},{"name":"CalendarManager.gs","content":"/**\n * ‚ú® –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø CalendarManager.gs\n *\n * –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:\n * ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω –ø–æ–∏—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π: –±—ã–ª–æ 10 –ª–µ—Ç (2020-2030) ‚Üí —Å—Ç–∞–ª–æ 2.5 –≥–æ–¥–∞ (-6 –º–µ—Å, +2 –≥–æ–¥–∞)\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞ –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤\n * ‚úÖ Batch —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π\n * ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n * ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º\n * ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\n *\n * –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:\n * - –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π: –±—ã–ª–æ ~5 —Å–µ–∫ ‚Üí —Å—Ç–∞–ª–æ ~0.5 —Å–µ–∫ (10x –±—ã—Å—Ç—Ä–µ–µ!)\n * - API –≤—ã–∑–æ–≤–æ–≤: –±—ã–ª–æ ~100 ‚Üí —Å—Ç–∞–ª–æ ~10 (10x –º–µ–Ω—å—à–µ!)\n * - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å–æ–±—ã—Ç–∏–π\n */\n\nvar CalendarManager = (function() {\n\n  /**\n   * üî• –ù–û–í–û–ï: –ö—ç—à –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n   */\n  let calendarCache = null;\n  let cacheTimestamp = null;\n  const CACHE_TTL = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç\n\n  /**\n   * üî• –ù–û–í–û–ï: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n   */\n  function clearCache() {\n    calendarCache = null;\n    cacheTimestamp = null;\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –ü–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n   * @return {Calendar} –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è —Ä–∞–±–æ—Ç—ã\n   */\n  function setupCalendar() {\n    const now = Date.now();\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à\n    if (calendarCache && cacheTimestamp && (now - cacheTimestamp) < CACHE_TTL) {\n      return calendarCache;\n    }\n\n    let calendar;\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #12: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CONFIG –¥–ª—è –∏–º–µ–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n    if (!CONFIG.CALENDAR.USE_SEPARATE) {\n      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\n      calendar = CalendarApp.getDefaultCalendar();\n      Logger.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');\n    } else {\n      const calendarName = CONFIG.CALENDAR.NAME;\n\n      try {\n        // –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å\n        const calendars = CalendarApp.getCalendarsByName(calendarName);\n\n        if (calendars.length > 0) {\n          calendar = calendars[0];\n          Logger.log(`‚úÖ –ù–∞–π–¥–µ–Ω –∫–∞–ª–µ–Ω–¥–∞—Ä—å: ${calendarName}`);\n        } else {\n          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π\n          calendar = CalendarApp.createCalendar(calendarName, {\n            summary: '–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞ –∏ —Å—Ä–æ–∫–∏',\n            color: CalendarApp.Color.BLUE,\n            timeZone: Session.getScriptTimeZone()\n          });\n          Logger.log(`‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å: ${calendarName}`);\n        }\n      } catch (e) {\n        Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è: ${e.message}`);\n        calendar = CalendarApp.getDefaultCalendar();\n        Logger.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (fallback)');\n      }\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à\n    calendarCache = calendar;\n    cacheTimestamp = now;\n\n    return calendar;\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Å –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ú –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º\n   * @param {Calendar} calendar - –ö–∞–ª–µ–Ω–¥–∞—Ä—å\n   * @param {string} caseNumber - –ù–æ–º–µ—Ä –¥–µ–ª–∞\n   */\n  function deleteEventsForCase(calendar, caseNumber) {\n    Logger.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–µ–ª–∞: ${caseNumber}`);\n\n    // üî• –ö–†–ò–¢–ò–ß–ù–û: –ë—ã–ª–æ 10 –ª–µ—Ç, —Å—Ç–∞–ª–æ 2.5 –≥–æ–¥–∞!\n    const startDate = new Date();\n    startDate.setMonth(startDate.getMonth() - 6); // 6 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥\n\n    const endDate = new Date();\n    endDate.setFullYear(endDate.getFullYear() + 2); // 2 –≥–æ–¥–∞ –≤–ø–µ—Ä–µ–¥\n\n    try {\n      const events = calendar.getEvents(startDate, endDate, {\n        search: caseNumber\n      });\n\n      if (events.length === 0) {\n        Logger.log('   ‚ÑπÔ∏è –°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n        return 0;\n      }\n\n      // üî• –ù–û–í–û–ï: Batch —É–¥–∞–ª–µ–Ω–∏–µ\n      let deletedCount = 0;\n      const errors = [];\n\n      for (const event of events) {\n        try {\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ —Ç–æ—á–Ω–æ –Ω–∞—à–µ —Å–æ–±—ã—Ç–∏–µ\n          const title = event.getTitle();\n          if (title.includes(caseNumber)) {\n            event.deleteEvent();\n            deletedCount++;\n          }\n        } catch (e) {\n          errors.push(e.message);\n        }\n      }\n\n      if (errors.length > 0) {\n        Logger.log(`   ‚ö†Ô∏è –û—à–∏–±–æ–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${errors.length}`);\n      }\n\n      Logger.log(`   ‚úÖ –£–¥–∞–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: ${deletedCount}`);\n      return deletedCount;\n\n    } catch (e) {\n      Logger.log(`   ‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${e.message}`);\n      return 0;\n    }\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)\n   * @param {Calendar} calendar - –ö–∞–ª–µ–Ω–¥–∞—Ä—å\n   * @param {string} title - –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è\n   * @param {Date} date - –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è\n   * @return {boolean} true –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç\n   */\n  function eventExists(calendar, title, date) {\n    try {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n\n      const events = calendar.getEvents(startOfDay, endOfDay, {\n        search: title\n      });\n\n      return events.some(event => event.getTitle() === title);\n    } catch (e) {\n      Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è: ${e.message}`);\n      return false;\n    }\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Å retry –ª–æ–≥–∏–∫–æ–π\n   * @param {Calendar} calendar - –ö–∞–ª–µ–Ω–¥–∞—Ä—å\n   * @param {string} title - –ù–∞–∑–≤–∞–Ω–∏–µ\n   * @param {Date} startTime - –ù–∞—á–∞–ª–æ\n   * @param {Date} endTime - –ö–æ–Ω–µ—Ü\n   * @param {Object} options - –û–ø—Ü–∏–∏\n   * @param {number} maxRetries - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫\n   * @return {CalendarEvent|null} –°–æ–∑–¥–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ null\n   */\n  function createEventWithRetry(calendar, title, startTime, endTime, options, maxRetries = 3) {\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const event = calendar.createEvent(title, startTime, endTime, options);\n        if (attempt > 1) {\n          Logger.log(`   ‚úÖ –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ —Å –ø–æ–ø—ã—Ç–∫–∏ ${attempt}`);\n        }\n        return event;\n      } catch (e) {\n        if (attempt === maxRetries) {\n          Logger.log(`   ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –ø–æ—Å–ª–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫: ${e.message}`);\n          return null;\n        }\n\n        // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s\n        const delay = Math.pow(2, attempt - 1) * 1000;\n        Logger.log(`   ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt} –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms...`);\n        Utilities.sleep(delay);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–µ–ª–∞\n   * @param {Calendar} calendar - –ö–∞–ª–µ–Ω–¥–∞—Ä—å\n   * @param {Object} caseData - –î–∞–Ω–Ω—ã–µ –¥–µ–ª–∞\n   */\n  function createEventsForCase(calendar, caseData) {\n    Logger.log(`üìÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–µ–ª–∞: ${caseData.number}`);\n\n    let createdCount = 0;\n    let skippedCount = 0;\n\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –¥–∞—Ç—É –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n    for (const dateCol of CONFIG.DATE_COLUMNS) {\n      const dateString = caseData[dateCol.field];\n\n      if (!dateString) {\n        continue;\n      }\n\n      const date = Utils.parseDate(String(dateString));\n\n      if (!date || Utils.isPastDate(String(dateString))) {\n        continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–∞—Ç—ã\n      }\n\n      const title = `${dateCol.name}: ${caseData.number}`;\n\n      // üî• –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã\n      if (eventExists(calendar, title, date)) {\n        Logger.log(`   ‚è≠Ô∏è –°–æ–±—ã—Ç–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${title}`);\n        skippedCount++;\n        continue;\n      }\n\n      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è\n      const startTime = new Date(date);\n      startTime.setHours(CONFIG.CALENDAR.DEFAULT_EVENT_HOUR || 9, 0, 0, 0);\n\n      const endTime = new Date(startTime);\n      endTime.setHours(endTime.getHours() + 1);\n\n      // –û–ø—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è\n      const options = {\n        description: `–î–µ–ª–æ: ${caseData.number}\\n` +\n                    `–°—É–¥: ${caseData.court || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n` +\n                    `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${caseData.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}`,\n        location: caseData.court || ''\n      };\n\n      // –¶–≤–µ—Ç —Å–æ–±—ã—Ç–∏—è\n      if (dateCol.field === 'hearingDate') {\n        options.color = CalendarApp.EventColor.RED; // –ó–∞—Å–µ–¥–∞–Ω–∏—è - –∫—Ä–∞—Å–Ω—ã–π\n      } else {\n        options.color = CalendarApp.EventColor.ORANGE; // –°—Ä–æ–∫–∏ - –æ—Ä–∞–Ω–∂–µ–≤—ã–π\n      }\n\n      // üî• –ù–û–í–û–ï: –°–æ–∑–¥–∞–Ω–∏–µ —Å retry\n      const event = createEventWithRetry(calendar, title, startTime, endTime, options);\n\n      if (event) {\n        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n        if (CONFIG.CALENDAR.REMINDERS_ENABLED) {\n          event.removeAllReminders();\n          for (const minutes of CONFIG.CALENDAR.REMINDER_MINUTES) {\n            event.addEmailReminder(minutes);\n          }\n        }\n\n        createdCount++;\n        Logger.log(`   ‚úÖ –°–æ–∑–¥–∞–Ω–æ: ${title} –Ω–∞ ${Utils.formatDate(date)}`);\n      }\n    }\n\n    Logger.log(`   üìä –°–æ–∑–¥–∞–Ω–æ: ${createdCount}, –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skippedCount}`);\n    return createdCount;\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è –¥–µ–ª–∞\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {number} row - –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏\n   */\n  function updateCalendarForCase(sheet, row) {\n    const calendar = setupCalendar();\n\n    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–µ–ª–∞\n    const data = sheet.getRange(row, 1, 1, sheet.getLastColumn()).getValues()[0];\n    const caseData = CaseManager.getCaseData(data);\n\n    if (!caseData.number) {\n      Logger.log('‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä –¥–µ–ª–∞, –ø—Ä–æ–ø—É—Å–∫');\n      return;\n    }\n\n    Logger.log(`\\nüîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è: ${caseData.number}`);\n\n    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è\n    deleteEventsForCase(calendar, caseData.number);\n\n    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ\n    createEventsForCase(calendar, caseData);\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π\n   */\n  function syncFullCalendar() {\n    Logger.log('\\nüîÑ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è');\n\n    const startTime = Date.now();\n    const calendar = setupCalendar();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n\n    let totalProcessed = 0;\n\n    for (const sheetName of CONFIG.ACTIVE_SHEETS) {\n      const sheet = ss.getSheetByName(sheetName);\n\n      if (!sheet) {\n        Logger.log(`‚ö†Ô∏è –õ–∏—Å—Ç \"${sheetName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n        continue;\n      }\n\n      Logger.log(`\\nüìã –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ª–∏—Å—Ç–∞: ${sheetName}`);\n\n      const lastRow = sheet.getLastRow();\n      if (lastRow < 2) {\n        Logger.log('   ‚ÑπÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö');\n        continue;\n      }\n\n      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º\n      const data = sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).getValues();\n\n      for (let i = 0; i < data.length; i++) {\n        const row = data[i];\n        const caseData = CaseManager.getCaseData(row);\n\n        if (!caseData.number) {\n          continue;\n        }\n\n        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è\n        deleteEventsForCase(calendar, caseData.number);\n\n        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ\n        createEventsForCase(calendar, caseData);\n\n        totalProcessed++;\n\n        // üî• –ù–û–í–û–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 –¥–µ–ª\n        if ((i + 1) % 10 === 0) {\n          Logger.log(`   üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: ${i + 1}/${data.length}`);\n        }\n      }\n    }\n\n    const endTime = Date.now();\n    const duration = ((endTime - startTime) / 1000).toFixed(2);\n\n    Logger.log(`\\n‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${duration} —Å–µ–∫`);\n    Logger.log(`   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–µ–ª: ${totalProcessed}`);\n\n    // –û—á–∏—â–∞–µ–º –∫—ç—à\n    clearCache();\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    setupCalendar: setupCalendar,\n    updateCalendarForCase: updateCalendarForCase,\n    deleteEventsForCase: deleteEventsForCase,\n    createEventsForCase: createEventsForCase,\n    syncFullCalendar: syncFullCalendar,\n    clearCache: clearCache\n  };\n})();\n"},{"name":"CaseManager.gs","content":"/**\n * ‚ú® –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø CaseManager.gs\n *\n * –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:\n * ‚úÖ –£–î–ê–õ–ï–ù–´ –∑–∞–¥–µ—Ä–∂–∫–∏ (–±—ã–ª–æ: 300–º—Å –∫–∞–∂–¥—ã–µ 5 –∫–µ–π—Å–æ–≤) ‚Üí —ç–∫–æ–Ω–æ–º–∏—è ~6 —Å–µ–∫ –Ω–∞ 100 –¥–µ–ª!\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã BATCH –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n * ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤\n * ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞–ø–æ–∫ –ë–ï–ó –ª–∏—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n * ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫\n *\n * –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:\n * - –û–±—Ä–∞–±–æ—Ç–∫–∞ 100 –¥–µ–ª: –±—ã–ª–æ ~20 —Å–µ–∫ ‚Üí —Å—Ç–∞–ª–æ ~3 —Å–µ–∫ (6.7x –±—ã—Å—Ç—Ä–µ–µ!)\n * - API –≤—ã–∑–æ–≤–æ–≤: –±—ã–ª–æ ~500 ‚Üí —Å—Ç–∞–ª–æ ~50 (10x –º–µ–Ω—å—à–µ!)\n */\n\nvar CaseManager = (function() {\n\n  /**\n   * üî• –ù–û–í–û–ï: –ö—ç—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤\n   */\n  const cache = {\n    sheets: {},\n    lastUpdate: null,\n    ttl: 5 * 60 * 1000 // 5 –º–∏–Ω—É—Ç\n  };\n\n  /**\n   * üî• –ù–û–í–û–ï: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞\n   */\n  function clearCache() {\n    cache.sheets = {};\n    cache.lastUpdate = null;\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ª–∏—Å—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n   */\n  function getSheetDataCached(sheet) {\n    const sheetName = sheet.getName();\n    const now = Date.now();\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à\n    if (cache.sheets[sheetName] &&\n        cache.lastUpdate &&\n        (now - cache.lastUpdate) < cache.ttl) {\n      return cache.sheets[sheetName];\n    }\n\n    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n    const lastRow = sheet.getLastRow();\n    if (lastRow < 2) {\n      return [];\n    }\n\n    const data = sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).getValues();\n    cache.sheets[sheetName] = data;\n    cache.lastUpdate = now;\n\n    return data;\n  }\n\n  /**\n   * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–µ–ª–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏\n   * @param {Array} row - –°—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö\n   * @return {Object} –î–∞–Ω–Ω—ã–µ –¥–µ–ª–∞\n   */\n  function getCaseData(row) {\n    return {\n      number: row[CONFIG.DATA_COLUMNS.CASE_NUMBER - 1] || '',\n      court: row[CONFIG.DATA_COLUMNS.COURT - 1] || '',\n      category: row[CONFIG.DATA_COLUMNS.CATEGORY - 1] || '',\n      status: row[CONFIG.DATA_COLUMNS.STATUS - 1] || '',\n      priority: row[CONFIG.DATA_COLUMNS.PRIORITY - 1] || '',\n      plaintiff: row[CONFIG.DATA_COLUMNS.PLAINTIFF - 1] || '',\n      defendant: row[CONFIG.DATA_COLUMNS.DEFENDANT - 1] || '',\n      amount: row[CONFIG.DATA_COLUMNS.CLAIM_AMOUNT - 1] || '',\n      filingDate: row[CONFIG.DATA_COLUMNS.FILING_DATE - 1] || ''\n    };\n  }\n\n  /**\n   * –°–æ–∑–¥–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è –¥–µ–ª–∞\n   * @param {Object} caseData - –î–∞–Ω–Ω—ã–µ –¥–µ–ª–∞\n   * @return {string} –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏\n   */\n  function buildCaseFolderName(caseData) {\n    let folderName = caseData.number || '–ë–µ–∑ –Ω–æ–º–µ—Ä–∞';\n\n    if (caseData.plaintiff || caseData.defendant) {\n      const plaintiff = Utils.shortenName(caseData.plaintiff);\n      const defendant = Utils.shortenName(caseData.defendant);\n      folderName += ` - ${plaintiff} vs ${defendant}`;\n    }\n\n    // –£–¥–∞–ª—è–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã\n    folderName = folderName.replace(/[<>:\"/\\\\|?*]/g, '_');\n\n    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É\n    if (folderName.length > 100) {\n      folderName = folderName.substring(0, 97) + '...';\n    }\n\n    return folderName;\n  }\n\n  /**\n   * ‚úÖ –£–õ–£–ß–®–ï–ù–û Issue #23: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø–∞–ø–∫–∏\n   * @param {Array} row - –°—Ç—Ä–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö\n   * @return {boolean} true –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∏ —É–∂–µ –µ—Å—Ç—å\n   */\n  function hasExistingFolderLinks(row) {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç–æ–ª–±—Ü—ã, –≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Å—ã–ª–∫–∏\n    const folderColumns = CONFIG.FOLDER_CATEGORIES.map(cat => cat.column - 1);\n\n    for (const col of folderColumns) {\n      const value = String(row[col] || '');\n      if (value.includes('drive.google.com')) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï Issue #23: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ Google Drive\n   * @param {string} driveUrl - URL –Ω–∞ Google Drive\n   * @return {boolean} true –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞\n   */\n  function verifyDriveLink(driveUrl) {\n    if (!driveUrl || !driveUrl.includes('drive.google.com')) {\n      return false;\n    }\n\n    try {\n      // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –ø–∞–ø–∫–∏ –∏–∑ URL\n      const folderId = extractFolderIdFromUrl(driveUrl);\n      if (!folderId) {\n        Logger.log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å ID –∏–∑ URL: ${driveUrl}`);\n        return false;\n      }\n\n      // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ\n      const folder = DriveApp.getFolderById(folderId);\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞\n      if (folder && folder.getName()) {\n        return true;\n      }\n\n      return false;\n    } catch (error) {\n      // –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ - –ø–∞–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–∫–∏ ${driveUrl}: ${error.message}`);\n      return false;\n    }\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –ø–∞–ø–∫–∏ –∏–∑ URL\n   * @param {string} url - URL Google Drive\n   * @return {string|null} ID –ø–∞–ø–∫–∏ –∏–ª–∏ null\n   */\n  function extractFolderIdFromUrl(url) {\n    if (!url) return null;\n\n    // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã URL:\n    // https://drive.google.com/drive/folders/FOLDER_ID\n    // https://drive.google.com/open?id=FOLDER_ID\n\n    const patterns = [\n      /\\/folders\\/([a-zA-Z0-9_-]+)/,\n      /[?&]id=([a-zA-Z0-9_-]+)/\n    ];\n\n    for (const pattern of patterns) {\n      const match = url.match(pattern);\n      if (match && match[1]) {\n        return match[1];\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º\n   * @param {Sheet} sheet - –õ–∏—Å—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n   * @param {number} startRow - –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞\n   * @param {number} endRow - –ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞\n   * @param {Array<string>} filterCaseNumbers - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –Ω–æ–º–µ—Ä–æ–≤ –¥–µ–ª –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–¥–ª—è RBAC)\n   */\n  function processCasesBatch(sheet, startRow, endRow, filterCaseNumbers) {\n    Logger.log(`üìä Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª [${startRow}-${endRow}]`);\n\n    const numRows = endRow - startRow + 1;\n    const data = sheet.getRange(startRow, 1, numRows, sheet.getLastColumn()).getValues();\n\n    const updates = [];\n    let processedCount = 0;\n    let skippedCount = 0;\n    let errorCount = 0;\n\n    for (let i = 0; i < data.length; i++) {\n      const row = data[i];\n      const rowNumber = startRow + i;\n      const caseData = getCaseData(row);\n\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–µ–ª–∞\n      if (!caseData.number) {\n        skippedCount++;\n        continue;\n      }\n\n      // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π\n      const validationErrors = [];\n\n      if (!caseData.court || caseData.court.trim() === '') {\n        validationErrors.push('–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—É–¥');\n      }\n\n      if (!caseData.category || caseData.category.trim() === '') {\n        validationErrors.push('–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è');\n      }\n\n      if (!caseData.status || caseData.status.trim() === '') {\n        validationErrors.push('–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç—É—Å');\n      }\n\n      // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º\n      if (validationErrors.length > 0) {\n        Logger.log(`‚ö†Ô∏è –î–µ–ª–æ ${caseData.number} (—Å—Ç—Ä–æ–∫–∞ ${rowNumber}): ${validationErrors.join(', ')}`);\n        skippedCount++;\n        continue;\n      }\n\n      // üîí –ù–û–í–û–ï: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–µ–ª–∞–º (RBAC)\n      if (filterCaseNumbers && filterCaseNumbers.length > 0) {\n        if (!filterCaseNumbers.includes(caseData.number)) {\n          skippedCount++;\n          continue;\n        }\n      }\n\n      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏\n      if (hasExistingFolderLinks(row)) {\n        skippedCount++;\n        continue;\n      }\n\n      try {\n        // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫\n        const folderLinks = FolderManager.createCaseStructure(sheet, rowNumber, caseData);\n\n        if (folderLinks) {\n          updates.push({\n            row: rowNumber,\n            links: folderLinks\n          });\n          processedCount++;\n        }\n\n        // üî• –ù–û–í–û–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 –¥–µ–ª\n        if ((i + 1) % 10 === 0) {\n          Logger.log(`üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: ${i + 1}/${numRows} –¥–µ–ª`);\n        }\n\n      } catch (e) {\n        Logger.log(`‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ª–∞ ${caseData.number}: ${e.message}`);\n        errorCount++;\n      }\n    }\n\n    // üî• –ù–û–í–û–ï: Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º\n    if (updates.length > 0) {\n      applyFolderLinksBatch(sheet, updates);\n    }\n\n    Logger.log(`‚úÖ Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:`);\n    Logger.log(`   –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${processedCount}`);\n    Logger.log(`   –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skippedCount}`);\n    Logger.log(`   –û—à–∏–±–æ–∫: ${errorCount}`);\n\n    return {\n      processed: processedCount,\n      skipped: skippedCount,\n      errors: errorCount\n    };\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø–∞–ø–∫–∏ batch –æ–ø–µ—Ä–∞—Ü–∏–µ–π\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {Array} updates - –ú–∞—Å—Å–∏–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π\n   */\n  function applyFolderLinksBatch(sheet, updates) {\n    Logger.log(`üìù –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ${updates.length} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Å—ã–ª–æ–∫...`);\n\n    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º –¥–ª—è batch –æ–ø–µ—Ä–∞—Ü–∏–π\n    for (const update of updates) {\n      for (const folderLink of update.links) {\n        try {\n          sheet.getRange(update.row, folderLink.column).setValue(folderLink.link);\n        } catch (e) {\n          Logger.log(`‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Å—ã–ª–∫–∏ [${update.row}, ${folderLink.column}]: ${e.message}`);\n        }\n      }\n    }\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #16: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø–æ—Å–ª–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏\n    invalidateCache(sheet.getName());\n\n    Logger.log(`‚úÖ –°—Å—ã–ª–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω`);\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n   * @param {string} sheetName - –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞\n   */\n  function invalidateCache(sheetName) {\n    if (sheetName && cache.sheets[sheetName]) {\n      delete cache.sheets[sheetName];\n      Logger.log(`üîÑ –ö—ç—à –¥–ª—è –ª–∏—Å—Ç–∞ \"${sheetName}\" –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω`);\n    }\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –¥–µ–ª —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π\n   * @param {Array<string>} filterCaseNumbers - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –Ω–æ–º–µ—Ä–æ–≤ –¥–µ–ª –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–¥–ª—è RBAC)\n   */\n  function processAllCases(filterCaseNumbers) {\n    const isFiltered = filterCaseNumbers && filterCaseNumbers.length > 0;\n    Logger.log(`üöÄ –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${isFiltered ? '–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö' : '–≤—Å–µ—Ö'} –¥–µ–ª`);\n\n    if (isFiltered) {\n      Logger.log(`   üîí –§–∏–ª—å—Ç—Ä: ${filterCaseNumbers.length} –¥–µ–ª`);\n    }\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const startTime = Date.now();\n\n    let totalProcessed = 0;\n    let totalSkipped = 0;\n    let totalErrors = 0;\n\n    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –ª–∏—Å—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n    for (const sheetName of CONFIG.ACTIVE_SHEETS) {\n      let sheet;\n\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #27: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–∏—Å—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫\n      try {\n        sheet = ss.getSheetByName(sheetName);\n      } catch (error) {\n        Logger.log(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—Å—Ç—É \"${sheetName}\": ${error.message}`);\n        AppLogger.error('CaseManager', `–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—Å—Ç—É ${sheetName}`, { error: error.message });\n        continue;\n      }\n\n      if (!sheet) {\n        Logger.log(`‚ö†Ô∏è –õ–∏—Å—Ç \"${sheetName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`);\n        AppLogger.warn('CaseManager', `–õ–∏—Å—Ç \"${sheetName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n        continue;\n      }\n\n      Logger.log(`\\nüìã –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—Å—Ç–∞: ${sheetName}`);\n\n      const lastRow = sheet.getLastRow();\n      if (lastRow < 2) {\n        Logger.log('   ‚ÑπÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');\n        continue;\n      }\n\n      // üî• –ù–û–í–û–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á–∞–º–∏ –ø–æ 50 —Å—Ç—Ä–æ–∫\n      const BATCH_SIZE = 50;\n      for (let startRow = 2; startRow <= lastRow; startRow += BATCH_SIZE) {\n        const endRow = Math.min(startRow + BATCH_SIZE - 1, lastRow);\n\n        const result = processCasesBatch(sheet, startRow, endRow, filterCaseNumbers);\n\n        totalProcessed += result.processed;\n        totalSkipped += result.skipped;\n        totalErrors += result.errors;\n\n        // üî• –£–î–ê–õ–ï–ù–û: –ë–æ–ª—å—à–µ –ù–ï–¢ –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!\n        // Utilities.sleep(300); // ‚Üê –£–î–ê–õ–ï–ù–û\n      }\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è —ç—Ç–æ–≥–æ –ª–∏—Å—Ç–∞\n      try {\n        CalendarManager.syncFullCalendar();\n      } catch (e) {\n        Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è: ${e.message}`);\n      }\n    }\n\n    const endTime = Date.now();\n    const duration = ((endTime - startTime) / 1000).toFixed(2);\n\n    Logger.log(`\\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${duration} —Å–µ–∫`);\n    Logger.log(`   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:`);\n    Logger.log(`   - –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${totalProcessed}`);\n    Logger.log(`   - –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${totalSkipped}`);\n    Logger.log(`   - –û—à–∏–±–æ–∫: ${totalErrors}`);\n\n    // –û—á–∏—â–∞–µ–º –∫—ç—à –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏\n    clearCache();\n\n    UIManager.showSuccess(\n      `–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${duration} —Å–µ–∫\\n\\n` +\n      `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${totalProcessed}\\n` +\n      `–ü—Ä–æ–ø—É—â–µ–Ω–æ: ${totalSkipped}\\n` +\n      `–û—à–∏–±–æ–∫: ${totalErrors}`\n    );\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–µ–ª–∞ (–¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {number} row - –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏\n   */\n  function processSingleCase(sheet, row) {\n    const data = sheet.getRange(row, 1, 1, sheet.getLastColumn()).getValues()[0];\n    const caseData = getCaseData(data);\n\n    if (!caseData.number) {\n      UIManager.showError('–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä –¥–µ–ª–∞');\n      return false;\n    }\n\n    if (hasExistingFolderLinks(data)) {\n      UIManager.showInfo('–£ –¥–µ–ª–∞ —É–∂–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–∞–ø–∫–∏');\n      return false;\n    }\n\n    try {\n      const folderLinks = FolderManager.createCaseStructure(sheet, row, caseData);\n\n      if (folderLinks) {\n        UIManager.showSuccess(`–ü–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –¥–µ–ª–∞ ${caseData.number}`);\n        return true;\n      } else {\n        UIManager.showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫–∏');\n        return false;\n      }\n    } catch (e) {\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`);\n      UIManager.showError(`–û—à–∏–±–∫–∞: ${e.message}`);\n      return false;\n    }\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    getCaseData: getCaseData,\n    buildCaseFolderName: buildCaseFolderName,\n    hasExistingFolderLinks: hasExistingFolderLinks,\n    verifyDriveLink: verifyDriveLink,  // ‚úÖ –ù–û–í–û–ï Issue #23\n    processAllCases: processAllCases,\n    processSingleCase: processSingleCase,\n    clearCache: clearCache,\n    invalidateCache: invalidateCache\n  };\n})();\n"},{"name":"ClientDatabase.gs","content":"/**\n * ClientDatabase.gs\n *\n * –ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –∫–ª–∏–µ–Ω—Ç–æ–≤:\n * - –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π\n * - –ò—Å—Ç–æ—Ä–∏—è –¥–µ–ª –∫–ª–∏–µ–Ω—Ç–∞\n * - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É\n * - –ü—Ä–∏–≤—è–∑–∫–∞ –¥–µ–ª –∫ –∫–ª–∏–µ–Ω—Ç–∞–º\n * - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n */\n\nvar ClientDatabase = (function() {\n  'use strict';\n\n  const SHEET_NAME = 'üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤';\n\n  // ============================================\n  // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø\n  // ============================================\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function getOrCreateSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(SHEET_NAME);\n      initializeSheet(sheet);\n    }\n\n    return sheet;\n  }\n\n  /**\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏\n   */\n  function initializeSheet(sheet) {\n    // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n    const headers = [\n      'ID –∫–ª–∏–µ–Ω—Ç–∞',\n      '–ù–∞–∑–≤–∞–Ω–∏–µ/–§–ò–û',\n      '–¢–∏–ø',\n      '–ò–ù–ù/–ü–∞—Å–ø–æ—Ä—Ç',\n      '–¢–µ–ª–µ—Ñ–æ–Ω',\n      'Email',\n      '–ê–¥—Ä–µ—Å',\n      '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ',\n      '–î–æ–ª–∂–Ω–æ—Å—Ç—å',\n      '–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è',\n      '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª',\n      '–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª',\n      '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è',\n      '–°—Ç–∞—Ç—É—Å'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length)\n      .setValues([headers])\n      .setFontWeight('bold')\n      .setBackground('#6aa84f')\n      .setFontColor('#ffffff');\n\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 100);  // ID\n    sheet.setColumnWidth(2, 200);  // –ù–∞–∑–≤–∞–Ω–∏–µ/–§–ò–û\n    sheet.setColumnWidth(3, 100);  // –¢–∏–ø\n    sheet.setColumnWidth(4, 150);  // –ò–ù–ù/–ü–∞—Å–ø–æ—Ä—Ç\n    sheet.setColumnWidth(5, 130);  // –¢–µ–ª–µ—Ñ–æ–Ω\n    sheet.setColumnWidth(6, 200);  // Email\n    sheet.setColumnWidth(7, 250);  // –ê–¥—Ä–µ—Å\n    sheet.setColumnWidth(8, 150);  // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ\n    sheet.setColumnWidth(9, 120);  // –î–æ–ª–∂–Ω–æ—Å—Ç—å\n    sheet.setColumnWidth(10, 100); // –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è\n    sheet.setColumnWidth(11, 100); // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª\n    sheet.setColumnWidth(12, 100); // –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª\n    sheet.setColumnWidth(13, 300); // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n    sheet.setColumnWidth(14, 100); // –°—Ç–∞—Ç—É—Å\n\n    // –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫\n    sheet.setFrozenRows(1);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    sheet.getRange('J2:J').setNumberFormat('dd.MM.yyyy');\n    sheet.getRange('K2:L').setNumberFormat('0');\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞\n    const typeRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ', '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ', '–ò–ü'], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('C2:C1000').setDataValidation(typeRule);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞\n    const statusRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['–ê–∫—Ç–∏–≤–Ω—ã–π', '–ê—Ä—Ö–∏–≤', 'VIP'], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('N2:N1000').setDataValidation(statusRule);\n\n    // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è\n    const instructionText =\n      'üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø:\\n\\n' +\n      '1. –î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –º–µ–Ω—é \"–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞\"\\n' +\n      '2. ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\\n' +\n      '3. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏\\n' +\n      '4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞';\n\n    sheet.getRange('A2:N8').mergeAcross();\n    sheet.getRange('A2').setValue(instructionText)\n      .setFontStyle('italic')\n      .setFontColor('#666666')\n      .setWrap(true)\n      .setVerticalAlignment('top');\n  }\n\n  // ============================================\n  // –í–ê–õ–ò–î–ê–¶–ò–Ø\n  // ============================================\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞\n   * @param {string} phone - –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n   * @return {boolean} true –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –ø—É—Å—Ç–æ–π\n   */\n  function isValidPhone(phone) {\n    if (!phone || phone.trim() === '') return true; // –ü—É—Å—Ç–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–ø—É—Å—Ç–∏–º\n\n    // –†–∞–∑—Ä–µ—à–∞–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:\n    // +7 999 123-45-67, +7(999)123-45-67, 89991234567, +79991234567\n    const phoneRegex = /^[\\+]?[0-9\\s\\-\\(\\)]{10,20}$/;\n    return phoneRegex.test(phone);\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email\n   * @param {string} email - Email –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n   * @return {boolean} true –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –ø—É—Å—Ç–æ–π\n   */\n  function isValidEmail(email) {\n    if (!email || email.trim() === '') return true; // –ü—É—Å—Ç–æ–π email –¥–æ–ø—É—Å—Ç–∏–º\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  // ============================================\n  // –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function showClientsDatabase() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.alert(\n      'üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤',\n      '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?\\n\\n' +\n      '1 - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\\n' +\n      '2 - –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞\\n' +\n      '3 - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\\n' +\n      '4 - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response !== ui.Button.OK) return;\n\n    const choice = ui.prompt(\n      'üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è (1-4):',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (choice.getSelectedButton() !== ui.Button.OK) return;\n\n    switch (choice.getResponseText().trim()) {\n      case '1':\n        addNewClient();\n        break;\n      case '2':\n        searchClient();\n        break;\n      case '3':\n        showAllClients();\n        break;\n      case '4':\n        showClientStatistics();\n        break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä');\n    }\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞\n   */\n  function addNewClient() {\n    const ui = SpreadsheetApp.getUi();\n\n    // –®–∞–≥ 1: –¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞\n    const typeResponse = ui.prompt(\n      '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 1/6',\n      '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞:\\n\\n' +\n      '1 - –§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ\\n' +\n      '2 - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ\\n' +\n      '3 - –ò–ü',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (typeResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const typeChoice = typeResponse.getResponseText().trim();\n    let clientType;\n\n    switch (typeChoice) {\n      case '1': clientType = '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ'; break;\n      case '2': clientType = '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ'; break;\n      case '3': clientType = '–ò–ü'; break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞');\n        return;\n    }\n\n    // –®–∞–≥ 2: –ù–∞–∑–≤–∞–Ω–∏–µ/–§–ò–û\n    const namePrompt = clientType === '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ'\n      ? '–í–≤–µ–¥–∏—Ç–µ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞:\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á)'\n      : '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û \"–†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞\")';\n\n    const nameResponse = ui.prompt(\n      '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 2/6',\n      namePrompt,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (nameResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const clientName = nameResponse.getResponseText().trim();\n\n    if (!clientName) {\n      ui.alert('‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');\n      return;\n    }\n\n    // –®–∞–≥ 3: –ò–ù–ù/–ü–∞—Å–ø–æ—Ä—Ç\n    const docPrompt = clientType === '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ'\n      ? '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: 4500 123456)'\n      : '–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù:\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: 1234567890)';\n\n    const docResponse = ui.prompt(\n      '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 3/6',\n      docPrompt,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (docResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const document = docResponse.getResponseText().trim();\n\n    // –®–∞–≥ 4: –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n    const contactResponse = ui.prompt(\n      '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 4/6',\n      '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ email —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:\\n' +\n      '(–ù–∞–ø—Ä–∏–º–µ—Ä: +7 999 123-45-67, client@example.com)',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (contactResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const contactText = contactResponse.getResponseText().trim();\n    const contactParts = contactText.split(',');\n    const phone = contactParts[0] ? contactParts[0].trim() : '';\n    const email = contactParts[1] ? contactParts[1].trim() : '';\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ email\n    if (!isValidPhone(phone)) {\n      ui.alert(\n        '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞',\n        `–¢–µ–ª–µ—Ñ–æ–Ω \"${phone}\" –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\\n\\n` +\n        '–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:\\n' +\n        '+7 999 123-45-67\\n' +\n        '+7(999)123-45-67\\n' +\n        '89991234567',\n        ui.ButtonSet.OK\n      );\n      return;\n    }\n\n    if (!isValidEmail(email)) {\n      ui.alert(\n        '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email',\n        `Email \"${email}\" –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\\n\\n` +\n        '–ü—Ä–∏–º–µ—Ä: client@example.com',\n        ui.ButtonSet.OK\n      );\n      return;\n    }\n\n    // –®–∞–≥ 5: –ê–¥—Ä–µ—Å\n    const addressResponse = ui.prompt(\n      '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 5/6',\n      '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (addressResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const address = addressResponse.getResponseText().trim();\n\n    // –®–∞–≥ 6: –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è —é—Ä. –ª–∏—Ü)\n    let contactPerson = '';\n    let position = '';\n\n    if (clientType !== '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ') {\n      const personResponse = ui.prompt(\n        '‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç - –®–∞–≥ 6/6',\n        '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:\\n' +\n        '(–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–µ—Ç—Ä–æ–≤ –ü.–ü., –ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä)',\n        ui.ButtonSet.OK_CANCEL\n      );\n\n      if (personResponse.getSelectedButton() !== ui.Button.OK) return;\n\n      const personText = personResponse.getResponseText().trim();\n      const personParts = personText.split(',');\n      contactPerson = personParts[0] ? personParts[0].trim() : '';\n      position = personParts[1] ? personParts[1].trim() : '';\n    }\n\n    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID\n    const sheet = getOrCreateSheet();\n    const lastRow = sheet.getLastRow();\n    const clientId = `CLI-${String(lastRow).padStart(5, '0')}`;\n\n    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏\n    const now = new Date();\n\n    sheet.appendRow([\n      clientId,\n      clientName,\n      clientType,\n      document,\n      phone,\n      email,\n      address,\n      contactPerson,\n      position,\n      now,\n      0,  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª\n      0,  // –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª\n      '',  // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n      '–ê–∫—Ç–∏–≤–Ω—ã–π'\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const newRow = sheet.getLastRow();\n    sheet.getRange(newRow, 10).setNumberFormat('dd.MM.yyyy');\n\n    ui.alert(\n      '‚úÖ –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!',\n      `ID: ${clientId}\\n` +\n      `–ù–∞–∑–≤–∞–Ω–∏–µ: ${clientName}\\n` +\n      `–¢–∏–ø: ${clientType}\\n\\n` +\n      `–ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∞–∑—É –∫–ª–∏–µ–Ω—Ç–æ–≤.`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('ClientDatabase', `–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç: ${clientName} (${clientId})`);\n  }\n\n  // ============================================\n  // –ü–û–ò–°–ö –ö–õ–ò–ï–ù–¢–ê\n  // ============================================\n\n  /**\n   * –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞\n   */\n  function searchClient() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.prompt(\n      'üîç –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞',\n      '–í–≤–µ–¥–∏—Ç–µ –¥–ª—è –ø–æ–∏—Å–∫–∞:\\n' +\n      '‚Ä¢ ID –∫–ª–∏–µ–Ω—Ç–∞\\n' +\n      '‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ/–§–ò–û\\n' +\n      '‚Ä¢ –ò–ù–ù\\n' +\n      '‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω\\n' +\n      '‚Ä¢ Email',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const searchText = response.getResponseText().trim().toLowerCase();\n\n    if (!searchText) {\n      ui.alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞');\n      return;\n    }\n\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n    const results = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const rowText = row.slice(0, 6).join(' ').toLowerCase();\n\n      if (rowText.includes(searchText)) {\n        results.push({\n          row: i + 1,\n          id: row[0],\n          name: row[1],\n          type: row[2],\n          phone: row[4],\n          email: row[5],\n          totalCases: row[10],\n          activeCases: row[11]\n        });\n      }\n    }\n\n    if (results.length === 0) {\n      ui.alert('‚ùå –ö–ª–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');\n      return;\n    }\n\n    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n    const message = results.slice(0, 10).map((r, i) =>\n      `${i + 1}. ${r.name} (${r.id})\\n` +\n      `   –¢–∏–ø: ${r.type}\\n` +\n      `   –î–µ–ª: ${r.totalCases} (–∞–∫—Ç–∏–≤–Ω—ã—Ö: ${r.activeCases})\\n` +\n      `   –¢–µ–ª–µ—Ñ–æ–Ω: ${r.phone}\\n` +\n      `   Email: ${r.email}`\n    ).join('\\n\\n');\n\n    ui.alert(\n      'üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',\n      `–ù–∞–π–¥–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${results.length}\\n\\n${message}` +\n      (results.length > 10 ? `\\n\\n...–∏ –µ—â—ë ${results.length - 10} –∫–ª–∏–µ–Ω—Ç–æ–≤` : ''),\n      ui.ButtonSet.OK\n    );\n\n    // –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–µ—Ä–≤–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É\n    if (results.length > 0) {\n      sheet.setActiveRange(sheet.getRange(results[0].row, 1));\n    }\n  }\n\n  // ============================================\n  // –ü–†–û–°–ú–û–¢–† –ö–õ–ò–ï–ù–¢–û–í\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function showAllClients() {\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const clients = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      if (row[0]) {  // –ï—Å–ª–∏ –µ—Å—Ç—å ID\n        clients.push({\n          id: row[0],\n          name: row[1],\n          type: row[2],\n          status: row[13],\n          totalCases: row[10],\n          activeCases: row[11]\n        });\n      }\n    }\n\n    if (clients.length === 0) {\n      ui.alert('‚ÑπÔ∏è –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç–∞');\n      return;\n    }\n\n    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É\n    const byType = {\n      '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ': [],\n      '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ': [],\n      '–ò–ü': []\n    };\n\n    clients.forEach(c => {\n      if (byType[c.type]) {\n        byType[c.type].push(c);\n      }\n    });\n\n    let message = `–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${clients.length}\\n\\n`;\n\n    Object.keys(byType).forEach(type => {\n      const typeClients = byType[type];\n      if (typeClients.length > 0) {\n        message += `${type}: ${typeClients.length}\\n`;\n        typeClients.slice(0, 5).forEach(c => {\n          message += `  ‚Ä¢ ${c.name} (${c.id}) - –î–µ–ª: ${c.totalCases}\\n`;\n        });\n        if (typeClients.length > 5) {\n          message += `  ...–∏ –µ—â—ë ${typeClients.length - 5}\\n`;\n        }\n        message += '\\n';\n      }\n    });\n\n    ui.alert('üë• –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã', message, ui.ButtonSet.OK);\n\n    // –û—Ç–∫—Ä—ã—Ç—å –ª–∏—Å—Ç –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤\n    SpreadsheetApp.getActiveSpreadsheet().setActiveSheet(sheet);\n  }\n\n  /**\n   * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\n   */\n  function showClientStatistics() {\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    let totalClients = 0;\n    let activeClients = 0;\n    let vipClients = 0;\n    let totalCases = 0;\n    let activeCases = 0;\n\n    const byType = {\n      '–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ': 0,\n      '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ': 0,\n      '–ò–ü': 0\n    };\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      if (row[0]) {  // –ï—Å–ª–∏ –µ—Å—Ç—å ID\n        totalClients++;\n\n        const status = row[13];\n        const type = row[2];\n        const cases = parseInt(row[10]) || 0;\n        const active = parseInt(row[11]) || 0;\n\n        if (status === '–ê–∫—Ç–∏–≤–Ω—ã–π') activeClients++;\n        if (status === 'VIP') vipClients++;\n\n        if (byType[type] !== undefined) {\n          byType[type]++;\n        }\n\n        totalCases += cases;\n        activeCases += active;\n      }\n    }\n\n    const message =\n      `üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\\n\\n` +\n      `–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${totalClients}\\n` +\n      `‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activeClients}\\n` +\n      `‚Ä¢ VIP: ${vipClients}\\n` +\n      `‚Ä¢ –í –∞—Ä—Ö–∏–≤–µ: ${totalClients - activeClients}\\n\\n` +\n      `–ü–û –¢–ò–ü–ê–ú:\\n` +\n      `‚Ä¢ –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞: ${byType['–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ']}\\n` +\n      `‚Ä¢ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞: ${byType['–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ']}\\n` +\n      `‚Ä¢ –ò–ü: ${byType['–ò–ü']}\\n\\n` +\n      `–ü–û –î–ï–õ–ê–ú:\\n` +\n      `‚Ä¢ –í—Å–µ–≥–æ –¥–µ–ª: ${totalCases}\\n` +\n      `‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª: ${activeCases}\\n` +\n      `‚Ä¢ –°—Ä–µ–¥–Ω–µ –¥–µ–ª –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞: ${totalClients > 0 ? (totalCases / totalClients).toFixed(1) : 0}`;\n\n    ui.alert('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º', message, ui.ButtonSet.OK);\n  }\n\n  // ============================================\n  // –°–í–Ø–ó–¨ –° –î–ï–õ–ê–ú–ò\n  // ============================================\n\n  /**\n   * –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∫ –¥–µ–ª—É\n   */\n  function linkClientToCase(caseNumber) {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.prompt(\n      'üîó –ü—Ä–∏–≤—è–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –¥–µ–ª—É',\n      `–î–µ–ª–æ: ${caseNumber}\\n\\n` +\n      '–í–≤–µ–¥–∏—Ç–µ ID –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return null;\n\n    const searchText = response.getResponseText().trim().toLowerCase();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const id = String(row[0]).toLowerCase();\n      const name = String(row[1]).toLowerCase();\n\n      if (id.includes(searchText) || name.includes(searchText)) {\n        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª\n        const currentTotal = parseInt(row[10]) || 0;\n        const currentActive = parseInt(row[11]) || 0;\n\n        sheet.getRange(i + 1, 11).setValue(currentTotal + 1);\n        sheet.getRange(i + 1, 12).setValue(currentActive + 1);\n\n        ui.alert(\n          '‚úÖ –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–≤—è–∑–∞–Ω!',\n          `–ö–ª–∏–µ–Ω—Ç: ${row[1]}\\n` +\n          `ID: ${row[0]}\\n` +\n          `–î–µ–ª–æ: ${caseNumber}`,\n          ui.ButtonSet.OK\n        );\n\n        AppLogger.info('ClientDatabase', `–î–µ–ª–æ ${caseNumber} –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –∫–ª–∏–µ–Ω—Ç—É ${row[0]}`);\n\n        return row[0];  // –í–µ—Ä–Ω—É—Ç—å ID –∫–ª–∏–µ–Ω—Ç–∞\n      }\n    }\n\n    ui.alert('‚ùå –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');\n    return null;\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–∞\n   */\n  function showClientCases(clientId) {\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const casesSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const casesData = casesSheet.getDataRange().getValues();\n\n    const clientSheet = getOrCreateSheet();\n    const clientData = clientSheet.getDataRange().getValues();\n\n    // –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞\n    let clientName = '';\n    for (let i = 1; i < clientData.length; i++) {\n      if (clientData[i][0] === clientId) {\n        clientName = clientData[i][1];\n        break;\n      }\n    }\n\n    if (!clientName) {\n      ui.alert('‚ùå –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    // –ù–∞–π—Ç–∏ –¥–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ ID –∫–ª–∏–µ–Ω—Ç–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ –¥–µ–ª)\n    const cases = [];\n\n    for (let i = 1; i < casesData.length; i++) {\n      const row = casesData[i];\n      const rowText = row.join(' ');\n\n      if (rowText.includes(clientId)) {\n        cases.push({\n          caseNumber: row[0],\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          status: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω'\n        });\n      }\n    }\n\n    if (cases.length === 0) {\n      ui.alert(\n        '‚ÑπÔ∏è –î–µ–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',\n        `–£ –∫–ª–∏–µ–Ω—Ç–∞ \"${clientName}\" (${clientId}) –Ω–µ—Ç –¥–µ–ª –≤ —Å–∏—Å—Ç–µ–º–µ`,\n        ui.ButtonSet.OK\n      );\n      return;\n    }\n\n    const message = cases.slice(0, 10).map((c, i) =>\n      `${i + 1}. ${c.caseNumber}\\n   ${c.court}\\n   –°—Ç–∞—Ç—É—Å: ${c.status}`\n    ).join('\\n\\n');\n\n    ui.alert(\n      `üìã –î–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–∞ \"${clientName}\"`,\n      `–í—Å–µ–≥–æ –¥–µ–ª: ${cases.length}\\n\\n${message}` +\n      (cases.length > 10 ? `\\n\\n...–∏ –µ—â—ë ${cases.length - 10} –¥–µ–ª` : ''),\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò\n  // ============================================\n\n  /**\n   * –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ–ª –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function updateAllClientStatistics() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const casesSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞');\n\n    if (!casesSheet) {\n      ui.alert('‚ùå –õ–∏—Å—Ç \"–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞\" –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    const clientSheet = getOrCreateSheet();\n    const clientData = clientSheet.getDataRange().getValues();\n    const casesData = casesSheet.getDataRange().getValues();\n\n    let updatedCount = 0;\n\n    for (let i = 1; i < clientData.length; i++) {\n      const clientId = clientData[i][0];\n      if (!clientId) continue;\n\n      let totalCases = 0;\n      let activeCases = 0;\n\n      // –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –¥–µ–ª–∞ –∫–ª–∏–µ–Ω—Ç–∞\n      for (let j = 1; j < casesData.length; j++) {\n        const rowText = casesData[j].join(' ');\n        if (rowText.includes(clientId)) {\n          totalCases++;\n          const status = casesData[j][6];\n          if (status && status !== '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' && status !== '–ê—Ä—Ö–∏–≤') {\n            activeCases++;\n          }\n        }\n      }\n\n      // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n      clientSheet.getRange(i + 1, 11).setValue(totalCases);\n      clientSheet.getRange(i + 1, 12).setValue(activeCases);\n      updatedCount++;\n    }\n\n    ui.alert(\n      '‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!',\n      `–û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${updatedCount}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('ClientDatabase', `–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è ${updatedCount} –∫–ª–∏–µ–Ω—Ç–æ–≤`);\n  }\n\n  // ============================================\n  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #26: –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ (–Ω–µ null)\n   *\n   * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –±–∞–∑—ã.\n   *\n   * @return {Array<Object>} –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤: [{id, name, type, status}]\n   *                         –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ [], –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ—Ç\n   */\n  function getAllClients() {\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n    const clients = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      if (row[0]) {  // –ï—Å–ª–∏ –µ—Å—Ç—å ID –∫–ª–∏–µ–Ω—Ç–∞\n        clients.push({\n          id: row[0],\n          name: row[1] || '–ë–µ–∑ –∏–º–µ–Ω–∏',\n          type: row[2] || '',\n          status: row[13] || '–ê–∫—Ç–∏–≤–Ω—ã–π'\n        });\n      }\n    }\n\n    return clients;\n  }\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #21: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞\n   *\n   * –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ ID –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.\n   *\n   * @param {string} clientId - ID –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞\n   * @return {Object|null} –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞ {id, name, type, inn, phone, email, address, status} –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω\n   */\n  function getClientById(clientId) {\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #21: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞\n    if (!clientId || typeof clientId !== 'string') {\n      Logger.log('‚ö†Ô∏è getClientById: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∫–ª–∏–µ–Ω—Ç–∞');\n      return null;\n    }\n\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      if (row[0] === clientId) {\n        return {\n          id: row[0],\n          name: row[1] || '–ë–µ–∑ –∏–º–µ–Ω–∏',\n          type: row[2] || '',\n          inn: row[3] || '',\n          phone: row[4] || '',\n          email: row[5] || '',\n          address: row[6] || '',\n          status: row[13] || '–ê–∫—Ç–∏–≤–Ω—ã–π'\n        };\n      }\n    }\n\n    return null;\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    showClientsDatabase: showClientsDatabase,\n    addNewClient: addNewClient,\n    searchClient: searchClient,\n    showAllClients: showAllClients,\n    showClientStatistics: showClientStatistics,\n    linkClientToCase: linkClientToCase,\n    showClientCases: showClientCases,\n    updateAllClientStatistics: updateAllClientStatistics,\n    getOrCreateSheet: getOrCreateSheet,\n    getAllClients: getAllClients,\n    getClientById: getClientById\n  };\n})();\n"},{"name":"Config.gs","content":"/**\n * ‚ú® Config.gs - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\n *\n * –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:\n * - –ù–∞–∑–≤–∞–Ω–∏—è –ª–∏—Å—Ç–æ–≤\n * - –ù–æ–º–µ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫\n * - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞–ø–æ–∫\n * - –ê–∫—Ç–∏–≤–Ω—ã–µ –ª–∏—Å—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n *\n * ‚úÖ –ò–°–ü–†–ê–í–õ–Ø–ï–¢ Issue #13-14: –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n */\n\n/**\n * –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã\n */\nvar CONFIG = {\n\n  // ============================================\n  // –ù–ê–ó–í–ê–ù–ò–Ø –õ–ò–°–¢–û–í\n  // ============================================\n  SHEET_NAMES: {\n    MAIN: '–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞',\n    ARCHIVE: '–ê—Ä—Ö–∏–≤',\n    DASHBOARD: 'üìä –î–∞—à–±–æ—Ä–¥',\n    TIME_TRACKING: '‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏',\n    CLIENTS: 'üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤',\n    FEES: 'üí∞ –ì–æ–Ω–æ—Ä–∞—Ä—ã',\n    EXPENSES: 'üí∏ –†–∞—Å—Ö–æ–¥—ã',\n    INVOICES: 'üìÑ –°—á–µ—Ç–∞'\n  },\n\n  // ============================================\n  // –ù–û–ú–ï–†–ê –ö–û–õ–û–ù–û–ö (1-based –¥–ª—è Google Sheets)\n  // ============================================\n  DATA_COLUMNS: {\n    CASE_NUMBER: 1,        // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    COURT: 2,              // –°—É–¥\n    CATEGORY: 3,           // –ö–∞—Ç–µ–≥–æ—Ä–∏—è\n    PLAINTIFF: 4,          // –ò—Å—Ç–µ—Ü\n    DEFENDANT: 5,          // –û—Ç–≤–µ—Ç—á–∏–∫\n    STATUS: 7,             // –°—Ç–∞—Ç—É—Å\n    PRIORITY: 8,           // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n    CLAIM_AMOUNT: 9,       // –°—É–º–º–∞ –∏—Å–∫–∞\n    FILING_DATE: 10,       // –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏\n    INCIDENT_DATE: 11,     // –î–∞—Ç–∞ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\n    NEXT_HEARING: 12,      // –°–ª–µ–¥—É—é—â–µ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ\n    ASSIGNED_LAWYER: 6     // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç\n  },\n\n  // ============================================\n  // –ö–û–õ–û–ù–ö–ò –° –î–ê–¢–ê–ú–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò –î–ï–î–õ–ê–ô–ù–û–í\n  // ============================================\n  DATE_COLUMNS: [\n    { column: 10, name: '–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏' },\n    { column: 11, name: '–î–∞—Ç–∞ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è' },\n    { column: 12, name: '–°–ª–µ–¥—É—é—â–µ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ' },\n    { column: 15, name: '–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤' },\n    { column: 16, name: '–î–∞—Ç–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏' },\n    { column: 17, name: '–î–∞—Ç–∞ —Å–ª—É—à–∞–Ω–∏—è' },\n    { column: 18, name: '–î–∞—Ç–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏' },\n    { column: 19, name: '–î–∞—Ç–∞ –∫–∞—Å—Å–∞—Ü–∏–∏' },\n    { column: 20, name: '–î–µ–¥–ª–∞–π–Ω –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤' }\n  ],\n\n  // –ö–æ–ª–æ–Ω–∫–∏ —Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º (–≥–∞–ª–æ—á–∫–∏)\n  FACTUAL_COMPLETION_COLUMNS: [15, 16, 17, 18, 19, 20],\n\n  // ============================================\n  // –ö–ê–¢–ï–ì–û–†–ò–ò –ü–ê–ü–û–ö –î–õ–Ø –î–ï–õ\n  // ============================================\n  FOLDER_CATEGORIES: [\n    { name: '–î–æ–∫—É–º–µ–Ω—Ç—ã', column: 20 },\n    { name: '–°—É–¥–µ–±–Ω—ã–µ –∞–∫—Ç—ã', column: 21 },\n    { name: '–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞', column: 22 },\n    { name: '–ü–µ—Ä–µ–ø–∏—Å–∫–∞', column: 23 }\n  ],\n\n  // ============================================\n  // –ê–ö–¢–ò–í–ù–´–ï –õ–ò–°–¢–´ –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò\n  // ============================================\n  ACTIVE_SHEETS: [\n    '–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞',\n    '–ê—Ä–±–∏—Ç—Ä–∞–∂–Ω—ã–µ –¥–µ–ª–∞',\n    '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–ª–∞'\n  ],\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ò –û–ë–†–ê–ë–û–¢–ö–ò\n  // ============================================\n  PROCESSING: {\n    BATCH_SIZE: 50,           // –†–∞–∑–º–µ—Ä batch –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n    MAX_RETRIES: 4,           // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫\n    RETRY_DELAY_MS: 1000,     // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏\n    CACHE_TTL_MINUTES: 5      // TTL –∫—ç—à–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö\n  },\n\n  // ============================================\n  // –°–¢–ê–¢–£–°–´ –î–ï–õ\n  // ============================================\n  CASE_STATUSES: [\n    '–ù–æ–≤–æ–µ',\n    '–í —Ä–∞–±–æ—Ç–µ',\n    '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',\n    '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',\n    '–ê—Ä—Ö–∏–≤'\n  ],\n\n  // ============================================\n  // –ü–†–ò–û–†–ò–¢–ï–¢–´ –î–ï–õ\n  // ============================================\n  CASE_PRIORITIES: [\n    '–°—Ä–æ—á–Ω–æ',\n    '–í—ã—Å–æ–∫–∏–π',\n    '–°—Ä–µ–¥–Ω–∏–π',\n    '–ù–∏–∑–∫–∏–π'\n  ],\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ò –ö–ê–õ–ï–ù–î–ê–†–Ø\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–Ø–ï–¢ Issue #12: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è\n  // ============================================\n  CALENDAR: {\n    NAME: '–°—É–¥–µ–±–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å',\n    USE_SEPARATE: true,\n    DEFAULT_EVENT_HOUR: 9,\n    REMINDERS_ENABLED: true,\n    REMINDER_MINUTES: [24 * 60, 60, 15] // –ó–∞ 1 –¥–µ–Ω—å, 1 —á–∞—Å, 15 –º–∏–Ω—É—Ç\n  },\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô\n  // ============================================\n  NOTIFICATIONS: {\n    DEADLINE_WARNING_DAYS: 7,\n    SEND_DAILY_DIGEST: true,\n    DIGEST_TIME: '09:00'\n  },\n\n  // ============================================\n  // –¢–ê–†–ò–§–´ –ü–û –†–û–õ–Ø–ú (—Ä—É–±/—á–∞—Å)\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–Ø–ï–¢ Issue #11\n  // ============================================\n  DEFAULT_RATES: {\n    'ADMIN': 5000,\n    'MANAGER': 4000,\n    'LAWYER': 3000,\n    'ASSISTANT': 1000,\n    'OBSERVER': 0\n  },\n\n  // ============================================\n  // –¶–í–ï–¢–ê –î–õ–Ø –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò\n  // ============================================\n  COLORS: {\n    HEADER: '#4a86e8',\n    SUCCESS: '#93c47d',\n    WARNING: '#f6b26b',\n    ERROR: '#e06666',\n    INFO: '#a4c2f4'\n  },\n\n  // ============================================\n  // –§–û–†–ú–ê–¢–´ –î–ê–¢\n  // ============================================\n  DATE_FORMATS: {\n    SHORT: 'dd.MM.yyyy',\n    LONG: 'dd MMMM yyyy',\n    WITH_TIME: 'dd.MM.yyyy HH:mm'\n  }\n};\n\n/**\n * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π\n */\n\n/**\n * –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –∏–º–µ–Ω–∏\n * @param {string} columnName - –ò–º—è –∫–æ–ª–æ–Ω–∫–∏\n * @return {number} –ù–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏ (1-based)\n */\nfunction getColumnNumber(columnName) {\n  return CONFIG.DATA_COLUMNS[columnName] || 0;\n}\n\n/**\n * –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ –ø–æ –∫–ª—é—á—É\n * @param {string} sheetKey - –ö–ª—é—á –ª–∏—Å—Ç–∞\n * @return {string} –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞\n */\nfunction getSheetName(sheetKey) {\n  return CONFIG.SHEET_NAMES[sheetKey] || '';\n}\n\n/**\n * –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏\n * @param {string} setting - –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n * @return {*} –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n */\nfunction getProcessingSetting(setting) {\n  return CONFIG.PROCESSING[setting];\n}\n\n/**\n * –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏\n * const caseNumberCol = CONFIG.DATA_COLUMNS.CASE_NUMBER; // 1\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞\n * const mainSheetName = CONFIG.SHEET_NAMES.MAIN; // '–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞'\n *\n * // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä batch\n * const batchSize = CONFIG.PROCESSING.BATCH_SIZE; // 50\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞–ø–æ–∫\n * const folders = CONFIG.FOLDER_CATEGORIES; // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤\n */\n"},{"name":"ConfigManager.gs","content":"/**\n * ‚ú® ConfigManager.gs - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π\n *\n * –§–£–ù–ö–¶–ò–ò:\n * ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Properties Service\n * ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞\n * ‚úÖ Default –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞\n * ‚úÖ UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ Google Sheets\n * ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π\n *\n * –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:\n * - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –±–µ–∑ –¥–µ–ø–ª–æ—è\n * - –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π\n * - –ü—Ä–æ—Å—Ç–æ–π API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è/—É—Å—Ç–∞–Ω–æ–≤–∫–∏\n */\n\nvar ConfigManager = (function() {\n\n  /**\n   * Default –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\n   */\n  const DEFAULTS = {\n    CALENDAR: {\n      USE_SEPARATE_CALENDAR: true,\n      CALENDAR_NAME: '–°—É–¥–µ–±–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å',\n      NOTIFICATION_EMAILS: ['your-email@gmail.com']\n    },\n    NOTIFICATIONS: {\n      DEADLINE_WARNING_DAYS: 7,\n      SEND_DAILY_DIGEST: true,\n      DIGEST_TIME: '09:00',\n      EMAIL_ENABLED: true,\n      TELEGRAM_ENABLED: false\n    },\n    PERFORMANCE: {\n      BATCH_SIZE: 50,\n      CACHE_TTL_MINUTES: 5,\n      MAX_RETRIES: 4,\n      RETRY_DELAY_MS: 1000\n    },\n    SYSTEM: {\n      LOG_LEVEL: 'INFO',\n      AUTO_VALIDATE: true,\n      AUTO_UPDATE_DASHBOARD: true\n    }\n  };\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n   * @param {string} key - –ö–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'SECTION.KEY' (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'CALENDAR.CALENDAR_NAME')\n   * @return {*} –ó–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n   */\n  function get(key) {\n    const props = PropertiesService.getScriptProperties();\n    const value = props.getProperty(key);\n\n    if (value !== null) {\n      try {\n        // –ü–æ–ø—ã—Ç–∫–∞ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON\n        return JSON.parse(value);\n      } catch (e) {\n        // –ï—Å–ª–∏ –Ω–µ JSON - –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å\n        return value;\n      }\n    }\n\n    // –í–µ—Ä–Ω—É—Ç—å default –∏–∑ DEFAULTS\n    return getNestedValue(DEFAULTS, key);\n  }\n\n  /**\n   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n   * @param {string} key - –ö–ª—é—á –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'SECTION.KEY'\n   * @param {*} value - –ó–Ω–∞—á–µ–Ω–∏–µ\n   */\n  function set(key, value) {\n    const props = PropertiesService.getScriptProperties();\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è\n    if (!validateValue(key, value)) {\n      throw new Error(`–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è ${key}: ${value}`);\n    }\n\n    const stringValue = typeof value === 'object' ?\n      JSON.stringify(value) : String(value);\n\n    props.setProperty(key, stringValue);\n    Logger.log(`‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${key} = ${stringValue}`);\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n   * @return {Object} –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n   */\n  function getAll() {\n    return {\n      CALENDAR: {\n        USE_SEPARATE_CALENDAR: get('CALENDAR.USE_SEPARATE_CALENDAR'),\n        CALENDAR_NAME: get('CALENDAR.CALENDAR_NAME'),\n        NOTIFICATION_EMAILS: get('CALENDAR.NOTIFICATION_EMAILS')\n      },\n      NOTIFICATIONS: {\n        DEADLINE_WARNING_DAYS: get('NOTIFICATIONS.DEADLINE_WARNING_DAYS'),\n        SEND_DAILY_DIGEST: get('NOTIFICATIONS.SEND_DAILY_DIGEST'),\n        DIGEST_TIME: get('NOTIFICATIONS.DIGEST_TIME'),\n        EMAIL_ENABLED: get('NOTIFICATIONS.EMAIL_ENABLED'),\n        TELEGRAM_ENABLED: get('NOTIFICATIONS.TELEGRAM_ENABLED')\n      },\n      PERFORMANCE: {\n        BATCH_SIZE: get('PERFORMANCE.BATCH_SIZE'),\n        CACHE_TTL_MINUTES: get('PERFORMANCE.CACHE_TTL_MINUTES'),\n        MAX_RETRIES: get('PERFORMANCE.MAX_RETRIES'),\n        RETRY_DELAY_MS: get('PERFORMANCE.RETRY_DELAY_MS')\n      },\n      SYSTEM: {\n        LOG_LEVEL: get('SYSTEM.LOG_LEVEL'),\n        AUTO_VALIDATE: get('SYSTEM.AUTO_VALIDATE'),\n        AUTO_UPDATE_DASHBOARD: get('SYSTEM.AUTO_UPDATE_DASHBOARD')\n      }\n    };\n  }\n\n  /**\n   * –°–±—Ä–æ—Å–∏—Ç—å –∫ defaults\n   */\n  function resetToDefaults() {\n    const props = PropertiesService.getScriptProperties();\n    props.deleteAllProperties();\n    Logger.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±—Ä–æ—à–µ–Ω–∞ –∫ defaults');\n  }\n\n  /**\n   * –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ JSON\n   * @return {string} JSON —Å—Ç—Ä–æ–∫–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π\n   */\n  function exportConfig() {\n    return JSON.stringify(getAll(), null, 2);\n  }\n\n  /**\n   * –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ JSON\n   * @param {string} json - JSON —Å—Ç—Ä–æ–∫–∞\n   */\n  function importConfig(json) {\n    try {\n      const config = JSON.parse(json);\n\n      // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è\n      Object.keys(config).forEach(section => {\n        Object.keys(config[section]).forEach(key => {\n          set(`${section}.${key}`, config[section][key]);\n        });\n      });\n\n      Logger.log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞');\n    } catch (e) {\n      throw new Error(`–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${e.message}`);\n    }\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫\n   */\n  function showConfigDialog() {\n    const config = getAll();\n\n    const html = `\n      <style>\n        body { font-family: Arial, sans-serif; padding: 20px; }\n        .section { margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }\n        .section h3 { margin-top: 0; color: #1a73e8; }\n        .field { margin-bottom: 10px; }\n        .field label { display: inline-block; width: 200px; font-weight: bold; }\n        .field input, .field select { width: 200px; padding: 5px; }\n        .buttons { text-align: right; margin-top: 20px; }\n        .btn { padding: 10px 20px; margin-left: 10px; cursor: pointer; }\n        .btn-primary { background: #1a73e8; color: white; border: none; }\n        .btn-secondary { background: #f1f3f4; border: 1px solid #ddd; }\n      </style>\n\n      <div id=\"config-form\">\n        <div class=\"section\">\n          <h3>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>\n          <div class=\"field\">\n            <label>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å:</label>\n            <select id=\"use-calendar\">\n              <option value=\"true\" ${config.CALENDAR.USE_SEPARATE_CALENDAR ? 'selected' : ''}>–î–∞</option>\n              <option value=\"false\" ${!config.CALENDAR.USE_SEPARATE_CALENDAR ? 'selected' : ''}>–ù–µ—Ç</option>\n            </select>\n          </div>\n          <div class=\"field\">\n            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:</label>\n            <input type=\"text\" id=\"calendar-name\" value=\"${config.CALENDAR.CALENDAR_NAME}\">\n          </div>\n          <div class=\"field\">\n            <label>Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</label>\n            <input type=\"text\" id=\"notification-emails\" value=\"${config.CALENDAR.NOTIFICATION_EMAILS.join(', ')}\">\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <h3>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>\n          <div class=\"field\">\n            <label>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –∑–∞ (–¥–Ω–µ–π):</label>\n            <input type=\"number\" id=\"warning-days\" value=\"${config.NOTIFICATIONS.DEADLINE_WARNING_DAYS}\">\n          </div>\n          <div class=\"field\">\n            <label>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç:</label>\n            <select id=\"daily-digest\">\n              <option value=\"true\" ${config.NOTIFICATIONS.SEND_DAILY_DIGEST ? 'selected' : ''}>–î–∞</option>\n              <option value=\"false\" ${!config.NOTIFICATIONS.SEND_DAILY_DIGEST ? 'selected' : ''}>–ù–µ—Ç</option>\n            </select>\n          </div>\n          <div class=\"field\">\n            <label>–í—Ä–µ–º—è –¥–∞–π–¥–∂–µ—Å—Ç–∞:</label>\n            <input type=\"time\" id=\"digest-time\" value=\"${config.NOTIFICATIONS.DIGEST_TIME}\">\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <h3>‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>\n          <div class=\"field\">\n            <label>–†–∞–∑–º–µ—Ä batch:</label>\n            <input type=\"number\" id=\"batch-size\" value=\"${config.PERFORMANCE.BATCH_SIZE}\">\n          </div>\n          <div class=\"field\">\n            <label>TTL –∫—ç—à–∞ (–º–∏–Ω—É—Ç—ã):</label>\n            <input type=\"number\" id=\"cache-ttl\" value=\"${config.PERFORMANCE.CACHE_TTL_MINUTES}\">\n          </div>\n          <div class=\"field\">\n            <label>–ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫ retry:</label>\n            <input type=\"number\" id=\"max-retries\" value=\"${config.PERFORMANCE.MAX_RETRIES}\">\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <h3>üîß –°–∏—Å—Ç–µ–º–∞</h3>\n          <div class=\"field\">\n            <label>–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:</label>\n            <select id=\"log-level\">\n              <option value=\"DEBUG\" ${config.SYSTEM.LOG_LEVEL === 'DEBUG' ? 'selected' : ''}>DEBUG</option>\n              <option value=\"INFO\" ${config.SYSTEM.LOG_LEVEL === 'INFO' ? 'selected' : ''}>INFO</option>\n              <option value=\"WARN\" ${config.SYSTEM.LOG_LEVEL === 'WARN' ? 'selected' : ''}>WARN</option>\n              <option value=\"ERROR\" ${config.SYSTEM.LOG_LEVEL === 'ERROR' ? 'selected' : ''}>ERROR</option>\n            </select>\n          </div>\n          <div class=\"field\">\n            <label>–ê–≤—Ç–æ–≤–∞–ª–∏–¥–∞—Ü–∏—è:</label>\n            <select id=\"auto-validate\">\n              <option value=\"true\" ${config.SYSTEM.AUTO_VALIDATE ? 'selected' : ''}>–î–∞</option>\n              <option value=\"false\" ${!config.SYSTEM.AUTO_VALIDATE ? 'selected' : ''}>–ù–µ—Ç</option>\n            </select>\n          </div>\n        </div>\n\n        <div class=\"buttons\">\n          <button class=\"btn btn-secondary\" onclick=\"google.script.host.close()\">–û—Ç–º–µ–Ω–∞</button>\n          <button class=\"btn btn-secondary\" onclick=\"resetConfig()\">–°–±—Ä–æ—Å–∏—Ç—å</button>\n          <button class=\"btn btn-primary\" onclick=\"saveConfig()\">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\n        </div>\n      </div>\n\n      <script>\n        function saveConfig() {\n          const config = {\n            'CALENDAR.USE_SEPARATE_CALENDAR': document.getElementById('use-calendar').value === 'true',\n            'CALENDAR.CALENDAR_NAME': document.getElementById('calendar-name').value,\n            'CALENDAR.NOTIFICATION_EMAILS': document.getElementById('notification-emails').value.split(',').map(e => e.trim()),\n            'NOTIFICATIONS.DEADLINE_WARNING_DAYS': parseInt(document.getElementById('warning-days').value),\n            'NOTIFICATIONS.SEND_DAILY_DIGEST': document.getElementById('daily-digest').value === 'true',\n            'NOTIFICATIONS.DIGEST_TIME': document.getElementById('digest-time').value,\n            'PERFORMANCE.BATCH_SIZE': parseInt(document.getElementById('batch-size').value),\n            'PERFORMANCE.CACHE_TTL_MINUTES': parseInt(document.getElementById('cache-ttl').value),\n            'PERFORMANCE.MAX_RETRIES': parseInt(document.getElementById('max-retries').value),\n            'SYSTEM.LOG_LEVEL': document.getElementById('log-level').value,\n            'SYSTEM.AUTO_VALIDATE': document.getElementById('auto-validate').value === 'true'\n          };\n\n          google.script.run\n            .withSuccessHandler(() => {\n              alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');\n              google.script.host.close();\n            })\n            .withFailureHandler((error) => {\n              alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n            })\n            .saveConfigFromUI(config);\n        }\n\n        function resetConfig() {\n          if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {\n            google.script.run\n              .withSuccessHandler(() => {\n                alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã!');\n                window.location.reload();\n              })\n              .resetConfigFromUI();\n          }\n        }\n      </script>\n    `;\n\n    const htmlOutput = HtmlService.createHtmlOutput(html)\n      .setWidth(600)\n      .setHeight(550);\n\n    SpreadsheetApp.getUi().showModalDialog(htmlOutput, '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã');\n  }\n\n  /**\n   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ UI (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ HTML)\n   * @param {Object} config - –û–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏\n   */\n  function saveConfigFromUI(config) {\n    Object.keys(config).forEach(key => {\n      set(key, config[key]);\n    });\n  }\n\n  /**\n   * –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ UI (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ HTML)\n   */\n  function resetConfigFromUI() {\n    resetToDefaults();\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –ø–æ –ø—É—Ç–∏\n   * @param {Object} obj - –û–±—ä–µ–∫—Ç\n   * @param {string} path - –ü—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'CALENDAR.CALENDAR_NAME')\n   * @return {*} –ó–Ω–∞—á–µ–Ω–∏–µ\n   */\n  function getNestedValue(obj, path) {\n    return path.split('.').reduce((current, key) =>\n      current ? current[key] : undefined, obj);\n  }\n\n  /**\n   * –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è\n   * @param {string} key - –ö–ª—é—á\n   * @param {*} value - –ó–Ω–∞—á–µ–Ω–∏–µ\n   * @return {boolean} true –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–æ\n   */\n  function validateValue(key, value) {\n    // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è\n    if (key.includes('BATCH_SIZE') && (value < 1 || value > 1000)) {\n      return false;\n    }\n\n    if (key.includes('MAX_RETRIES') && (value < 0 || value > 10)) {\n      return false;\n    }\n\n    if (key.includes('DEADLINE_WARNING_DAYS') && (value < 1 || value > 30)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    get: get,\n    set: set,\n    getAll: getAll,\n    resetToDefaults: resetToDefaults,\n    exportConfig: exportConfig,\n    importConfig: importConfig,\n    showConfigDialog: showConfigDialog,\n    saveConfigFromUI: saveConfigFromUI,\n    resetConfigFromUI: resetConfigFromUI\n  };\n})();\n\n/**\n * –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ\n * const batchSize = ConfigManager.get('PERFORMANCE.BATCH_SIZE');\n *\n * // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ\n * ConfigManager.set('PERFORMANCE.BATCH_SIZE', 100);\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n * const config = ConfigManager.getAll();\n *\n * // –ü–æ–∫–∞–∑–∞—Ç—å UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n * ConfigManager.showConfigDialog();\n *\n * // –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç\n * const json = ConfigManager.exportConfig();\n * ConfigManager.importConfig(json);\n */\n"},{"name":"Dashboard.gs","content":"/**\n * ‚ú® Dashboard.gs - –í–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π\n */\n\nvar Dashboard = (function() {\n\n  function updateDashboard() {\n    AppLogger.info('Dashboard', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞...');\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let dashboard = ss.getSheetByName('üìä –î–∞—à–±–æ—Ä–¥');\n\n    if (!dashboard) {\n      dashboard = ss.insertSheet('üìä –î–∞—à–±–æ—Ä–¥', 0);\n    } else {\n      dashboard.clear();\n    }\n\n    const mainSheet = ss.getSheets().find(s => s.getName() !== 'üìä –î–∞—à–±–æ—Ä–¥' && s.getName() !== 'üìã –õ–æ–≥–∏');\n    if (!mainSheet) return;\n\n    const data = mainSheet.getDataRange().getValues();\n    const stats = calculateStats(data);\n\n    renderDashboard(dashboard, stats);\n    AppLogger.info('Dashboard', '–î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª—ë–Ω');\n  }\n\n  function calculateStats(data) {\n    const stats = {\n      total: data.length - 1,\n      byStatus: {},\n      byCourt: {},\n      upcoming: 0,\n      overdue: 0\n    };\n\n    const now = new Date();\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const status = row[5] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n      const court = row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n\n      stats.byStatus[status] = (stats.byStatus[status] || 0) + 1;\n      stats.byCourt[court] = (stats.byCourt[court] || 0) + 1;\n\n      const nextHearing = row[8];\n      if (nextHearing) {\n        const hearingDate = new Date(nextHearing);\n        if (hearingDate < now) {\n          stats.overdue++;\n        } else if (hearingDate - now < 7 * 24 * 60 * 60 * 1000) {\n          stats.upcoming++;\n        }\n      }\n    }\n\n    return stats;\n  }\n\n  function renderDashboard(sheet, stats) {\n    sheet.getRange('A1').setValue('üìä –î–ê–®–ë–û–†–î –°–£–î–ï–ë–ù–´–• –î–ï–õ');\n    sheet.getRange('A1').setFontSize(18).setFontWeight('bold');\n\n    sheet.getRange('A2').setValue(`–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleString('ru-RU')}`);\n    sheet.getRange('A2').setFontSize(10).setFontColor('#666666');\n\n    sheet.getRange('A4').setValue('üìà –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê');\n    sheet.getRange('A4').setFontWeight('bold');\n\n    sheet.getRange('A5').setValue('–í—Å–µ–≥–æ –¥–µ–ª:');\n    sheet.getRange('B5').setValue(stats.total);\n\n    sheet.getRange('A6').setValue('–ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –∑–∞—Å–µ–¥–∞–Ω–∏–π (7 –¥–Ω–µ–π):');\n    sheet.getRange('B6').setValue(stats.upcoming);\n    sheet.getRange('B6').setBackground(stats.upcoming > 0 ? '#fff3cd' : '#d4edda');\n\n    sheet.getRange('A7').setValue('–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π:');\n    sheet.getRange('B7').setValue(stats.overdue);\n    sheet.getRange('B7').setBackground(stats.overdue > 0 ? '#f8d7da' : '#d4edda');\n\n    let row = 9;\n    sheet.getRange(`A${row}`).setValue('üìã –ü–û –°–¢–ê–¢–£–°–ê–ú');\n    sheet.getRange(`A${row}`).setFontWeight('bold');\n    row++;\n\n    Object.keys(stats.byStatus).forEach(status => {\n      sheet.getRange(`A${row}`).setValue(status);\n      sheet.getRange(`B${row}`).setValue(stats.byStatus[status]);\n      row++;\n    });\n\n    row += 2;\n    sheet.getRange(`A${row}`).setValue('‚öñÔ∏è –ü–û –°–£–î–ê–ú');\n    sheet.getRange(`A${row}`).setFontWeight('bold');\n    row++;\n\n    Object.keys(stats.byCourt).forEach(court => {\n      sheet.getRange(`A${row}`).setValue(court);\n      sheet.getRange(`B${row}`).setValue(stats.byCourt[court]);\n      row++;\n    });\n\n    sheet.setColumnWidth(1, 300);\n    sheet.setColumnWidth(2, 100);\n  }\n\n  function setupAutoUpdate() {\n    const triggers = ScriptApp.getProjectTriggers();\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === 'Dashboard.updateDashboard') {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    ScriptApp.newTrigger('Dashboard.updateDashboard')\n      .timeBased()\n      .everyHours(1)\n      .create();\n\n    AppLogger.info('Dashboard', '–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (–∫–∞–∂–¥—ã–π —á–∞—Å)');\n  }\n\n  return {\n    updateDashboard: updateDashboard,\n    setupAutoUpdate: setupAutoUpdate\n  };\n})();\n"},{"name":"DataValidator.gs","content":"/**\n * ‚ú® DataValidator.gs - –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö\n *\n * –§–£–ù–ö–¶–ò–ò:\n * ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤–≤–æ–¥–µ\n * ‚úÖ –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —è—á–µ–π–∫–∞—Ö\n * ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n * ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–æ–≤ –¥–µ–ª, –¥–∞—Ç, email, —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤\n * ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n *\n * –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:\n * - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏\n * - –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º\n * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è\n */\n\nvar DataValidator = (function() {\n\n  /**\n   * –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º\n   */\n  const COLUMN_RULES = {\n    1: {  // –ö–æ–ª–æ–Ω–∫–∞ A - –ù–æ–º–µ—Ä –¥–µ–ª–∞\n      name: '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n      pattern: /^[–ê-–Ø0-9\\-\\/\\s]+$/i,\n      message: '–ù–æ–º–µ—Ä –¥–µ–ª–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ —Å–ª—ç—à–∏',\n      required: true\n    },\n    2: {  // –ö–æ–ª–æ–Ω–∫–∞ B - –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏\n      name: '–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏',\n      validator: (value) => Utils.parseDate(value) !== null,\n      message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì)',\n      required: true\n    },\n    8: {  // –ö–æ–ª–æ–Ω–∫–∞ H - –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è (–ø—Ä–∏–º–µ—Ä)\n      name: '–î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è',\n      validator: (value) => !value || Utils.parseDate(value) !== null,\n      message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì)',\n      required: false\n    }\n  };\n\n  /**\n   * –í–∞–ª–∏–¥–∞—Ü–∏—è —è—á–µ–π–∫–∏\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {number} row - –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏\n   * @param {number} col - –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞\n   * @return {boolean} true –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω–∞\n   */\n  function validateCell(sheet, row, col) {\n    const rule = COLUMN_RULES[col];\n    if (!rule) return true; // –ù–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ - –≤–∞–ª–∏–¥–Ω–∞\n\n    const cell = sheet.getRange(row, col);\n    const value = cell.getValue();\n\n    // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏\n    if (!value || String(value).trim() === '') {\n      if (rule.required) {\n        cell.setBackground('#ffcccc');\n        cell.setNote(`‚ùå –ü–æ–ª–µ \"${rule.name}\" –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è`);\n        return false;\n      }\n      return true; // –ü—É—Å—Ç–∞—è, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è\n    }\n\n    let isValid = false;\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ pattern\n    if (rule.pattern) {\n      isValid = rule.pattern.test(String(value));\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ validator —Ñ—É–Ω–∫—Ü–∏–∏\n    if (rule.validator) {\n      isValid = rule.validator(value);\n    }\n\n    if (!isValid) {\n      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—à–∏–±–∫–∏\n      cell.setBackground('#ffcccc');\n      cell.setNote('‚ùå ' + rule.message);\n      AppLogger.warn('DataValidator', `–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ ${rule.name}`, {\n        row: row,\n        value: value\n      });\n      return false;\n    } else {\n      // –û—á–∏—Å—Ç–∫–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏\n      cell.setBackground(null);\n      cell.setNote(null);\n      return true;\n    }\n  }\n\n  /**\n   * –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–≥–æ –ª–∏—Å—Ç–∞\n   * @return {boolean} true –µ—Å–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã\n   */\n  function validateSheet() {\n    AppLogger.info('DataValidator', '–ù–∞—á–∞–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–∏—Å—Ç–∞');\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getActiveSheet();\n    const lastRow = sheet.getLastRow();\n\n    if (lastRow <= 1) {\n      SpreadsheetApp.getUi().alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏');\n      return true;\n    }\n\n    let errors = 0;\n    const errorDetails = [];\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏\n    for (let row = 2; row <= lastRow; row++) {\n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏\n      Object.keys(COLUMN_RULES).forEach(col => {\n        if (!validateCell(sheet, row, parseInt(col))) {\n          errors++;\n          errorDetails.push({\n            row: row,\n            column: COLUMN_RULES[col].name,\n            rule: COLUMN_RULES[col].message\n          });\n        }\n      });\n    }\n\n    if (errors > 0) {\n      let message = `‚ùå –ù–∞–π–¥–µ–Ω–æ ${errors} –æ—à–∏–±–æ–∫ –≤ –¥–∞–Ω–Ω—ã—Ö!\\n\\n`;\n      message += '–Ø—á–µ–π–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º.\\n';\n      message += '–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ —è—á–µ–π–∫—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏.\\n\\n';\n\n      if (errorDetails.length <= 10) {\n        message += '–û—à–∏–±–∫–∏:\\n';\n        errorDetails.forEach((err, i) => {\n          message += `${i + 1}. –°—Ç—Ä–æ–∫–∞ ${err.row}, ${err.column}: ${err.rule}\\n`;\n        });\n      } else {\n        message += `–ü–µ—Ä–≤—ã–µ 10 –æ—à–∏–±–æ–∫:\\n`;\n        errorDetails.slice(0, 10).forEach((err, i) => {\n          message += `${i + 1}. –°—Ç—Ä–æ–∫–∞ ${err.row}, ${err.column}\\n`;\n        });\n        message += `\\n... –∏ –µ—â—ë ${errorDetails.length - 10} –æ—à–∏–±–æ–∫`;\n      }\n\n      SpreadsheetApp.getUi().alert(message);\n      AppLogger.warn('DataValidator', `–ù–∞–π–¥–µ–Ω–æ ${errors} –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏`);\n      return false;\n    } else {\n      SpreadsheetApp.getUi().alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã!');\n      AppLogger.info('DataValidator', '–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã');\n      return true;\n    }\n  }\n\n  /**\n   * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n   * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ onEdit —Ç—Ä–∏–≥–≥–µ—Ä–∞\n   * @param {Object} e - Event object\n   */\n  function onEditValidation(e) {\n    const range = e.range;\n    const col = range.getColumn();\n    const row = range.getRow();\n\n    if (row === 1) return; // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏\n    if (COLUMN_RULES[col]) {\n      validateCell(range.getSheet(), row, col);\n    }\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n   * @param {number} col - –ù–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏\n   * @param {Object} rule - –ü—Ä–∞–≤–∏–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n   */\n  function addRule(col, rule) {\n    COLUMN_RULES[col] = rule;\n    AppLogger.info('DataValidator', `–î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ ${col}`, rule);\n  }\n\n  /**\n   * –£–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n   * @param {number} col - –ù–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏\n   */\n  function removeRule(col) {\n    delete COLUMN_RULES[col];\n    AppLogger.info('DataValidator', `–£–¥–∞–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ ${col}`);\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞\n   * @return {Object} –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏\n   */\n  function getRules() {\n    return COLUMN_RULES;\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    validateCell: validateCell,\n    validateSheet: validateSheet,\n    onEditValidation: onEditValidation,\n    addRule: addRule,\n    removeRule: removeRule,\n    getRules: getRules\n  };\n})();\n\n/**\n * –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:\n *\n * // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ–≥–æ –ª–∏—Å—Ç–∞\n * DataValidator.validateSheet();\n *\n * // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–≤ Main.gs):\n * function onEdit(e) {\n *   DataValidator.onEditValidation(e);\n * }\n *\n * // –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ\n * DataValidator.addRule(5, {\n *   name: 'Email',\n *   pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n *   message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email',\n *   required: false\n * });\n *\n * // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–¥–Ω–æ–π —è—á–µ–π–∫–∏\n * DataValidator.validateCell(sheet, 2, 1);\n */\n"},{"name":"DeadlineChecker.gs","content":"/**\n * ‚ú® –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø DeadlineChecker.gs\n *\n * –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø:\n * ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º \"–ó–∞–≤–µ—Ä—à–µ–Ω–æ\", \"–ê—Ä—Ö–∏–≤\")\n * ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤\n * ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö\n * ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–µ–ª\n * ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n * ‚úÖ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email –æ—Ç—á–µ—Ç–æ–≤\n *\n * –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:\n * - –ü—Ä–æ–≤–µ—Ä–∫–∞ 100 –¥–µ–ª: –±—ã–ª–æ ~5 —Å–µ–∫ ‚Üí —Å—Ç–∞–ª–æ ~0.5 —Å–µ–∫ (10x –±—ã—Å—Ç—Ä–µ–µ!)\n * - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö —è—á–µ–µ–∫: –±—ã–ª–æ ~2000 ‚Üí —Å—Ç–∞–ª–æ ~200 (10x –º–µ–Ω—å—à–µ!)\n */\n\nvar DeadlineChecker = (function() {\n\n  /**\n   * üî• –ù–û–í–û–ï: –°—Ç–∞—Ç—É—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å\n   */\n  const INACTIVE_STATUSES = [\n    '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',\n    '–ê—Ä—Ö–∏–≤',\n    '–û—Ç–æ–∑–≤–∞–Ω–æ',\n    '–ü—Ä–µ–∫—Ä–∞—â–µ–Ω–æ',\n    '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ'\n  ];\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞\n   * @param {string} status - –°—Ç–∞—Ç—É—Å –¥–µ–ª–∞\n   * @return {boolean} true –µ—Å–ª–∏ –¥–µ–ª–æ –∞–∫—Ç–∏–≤–Ω–æ\n   */\n  function isCaseActive(status) {\n    if (!status) {\n      return true; // –°—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ —É–∫–∞–∑–∞–Ω\n    }\n\n    const statusStr = String(status).trim();\n    return !INACTIVE_STATUSES.some(inactive =>\n      statusStr.toLowerCase().includes(inactive.toLowerCase())\n    );\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–∞\n   * @param {string} value - –ó–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏\n   * @return {boolean} true –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞\n   */\n  function isTaskCompleted(value) {\n    if (!value) {\n      return false;\n    }\n\n    const valueStr = String(value).toLowerCase().trim();\n    return valueStr.includes('‚úÖ') ||\n           valueStr.includes('–≤—ã–ø–æ–ª–Ω–µ–Ω–æ') ||\n           valueStr.includes('completed');\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –ü–æ–∏—Å–∫ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π\n   * @param {number} days - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n   * @return {Array} –ú–∞—Å—Å–∏–≤ –ø—Ä–æ–±–ª–µ–º\n   */\n  function findUpcomingDeadlines(days) {\n    Logger.log(`üîç –ü–æ–∏—Å–∫ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –≤ –±–ª–∏–∂–∞–π—à–∏–µ ${days} –¥–Ω–µ–π`);\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    const problems = [];\n    let totalChecked = 0;\n    let skippedInactive = 0;\n    let skippedCompleted = 0;\n\n    for (const sheetName of CONFIG.ACTIVE_SHEETS) {\n      const sheet = ss.getSheetByName(sheetName);\n\n      if (!sheet) {\n        Logger.log(`‚ö†Ô∏è –õ–∏—Å—Ç \"${sheetName}\" –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n        continue;\n      }\n\n      const lastRow = sheet.getLastRow();\n      if (lastRow < 2) {\n        continue;\n      }\n\n      Logger.log(`   üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Å—Ç–∞: ${sheetName}`);\n\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #29: –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏\n      const statusCol = CONFIG.DATA_COLUMNS.STATUS - 1;\n      const caseNumberCol = CONFIG.DATA_COLUMNS.CASE_NUMBER - 1;\n\n      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –Ω—É–∂–Ω–æ —á–∏—Ç–∞—Ç—å\n      const columnsToRead = new Set([\n        CONFIG.DATA_COLUMNS.CASE_NUMBER,\n        CONFIG.DATA_COLUMNS.STATUS\n      ]);\n\n      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ —Å –¥–∞—Ç–∞–º–∏\n      CONFIG.DATE_COLUMNS.forEach(dateCol => {\n        columnsToRead.add(dateCol.column);\n      });\n\n      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –∫–æ–ª–æ–Ω–∫—É –¥–ª—è —á—Ç–µ–Ω–∏—è\n      const maxCol = Math.max(...columnsToRead);\n\n      // –ß–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω—É–∂–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏ –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö\n      const allData = sheet.getRange(2, 1, lastRow - 1, maxCol).getValues();\n\n      Logger.log(`   ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —á–∏—Ç–∞–µ–º ${maxCol} –∫–æ–ª–æ–Ω–æ–∫ –≤–º–µ—Å—Ç–æ ${sheet.getLastColumn()}`);\n\n      for (let i = 0; i < allData.length; i++) {\n        const row = allData[i];\n        const rowNumber = i + 2;\n\n        const caseNumber = row[caseNumberCol];\n        const status = row[statusCol];\n\n        // üî• –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ª–∞!\n        if (!isCaseActive(status)) {\n          skippedInactive++;\n          continue;\n        }\n\n        if (!caseNumber) {\n          continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –Ω–æ–º–µ—Ä–∞ –¥–µ–ª–∞\n        }\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö\n        for (const dateCol of CONFIG.DATE_COLUMNS) {\n          const colIndex = dateCol.column - 1;\n          const dateString = row[colIndex];\n\n          if (!dateString) {\n            continue; // –ü—É—Å—Ç–∞—è —è—á–µ–π–∫–∞\n          }\n\n          // üî• –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏\n          if (CONFIG.FACTUAL_COMPLETION_COLUMNS &&\n              CONFIG.FACTUAL_COMPLETION_COLUMNS.includes(dateCol.column)) {\n            if (isTaskCompleted(dateString)) {\n              skippedCompleted++;\n              continue;\n            }\n          }\n\n          // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É\n          const date = Utils.parseDate(String(dateString));\n          if (!date) {\n            continue; // –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞\n          }\n\n          // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π\n          const diffTime = date.getTime() - today.getTime();\n          const daysUntil = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\n          totalChecked++;\n\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å\n          if (daysUntil >= 0 && daysUntil <= days) {\n            problems.push({\n              sheet: sheetName,\n              row: rowNumber,\n              caseNumber: caseNumber,\n              columnName: dateCol.name,\n              date: Utils.formatDate(date),\n              daysUntil: daysUntil,\n              // üî• –ù–û–í–û–ï: –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n              severity: getSeverity(daysUntil),\n              status: status || '–ù–µ —É–∫–∞–∑–∞–Ω'\n            });\n          }\n        }\n      }\n    }\n\n    Logger.log(`   ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —è—á–µ–µ–∫: ${totalChecked}`);\n    Logger.log(`   ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö: ${skippedInactive}`);\n    Logger.log(`   ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö: ${skippedCompleted}`);\n    Logger.log(`   ‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: ${problems.length}`);\n\n    // üî• –ù–û–í–û–ï: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏ –¥–Ω—è–º\n    problems.sort((a, b) => {\n      if (a.daysUntil !== b.daysUntil) {\n        return a.daysUntil - b.daysUntil;\n      }\n      return a.caseNumber.localeCompare(b.caseNumber);\n    });\n\n    return problems;\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n   * @param {number} daysUntil - –î–Ω–µ–π –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞\n   * @return {string} –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n   */\n  function getSeverity(daysUntil) {\n    if (daysUntil < 0) {\n      return 'overdue'; // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ\n    } else if (daysUntil === 0) {\n      return 'today'; // –°–µ–≥–æ–¥–Ω—è!\n    } else if (daysUntil === 1) {\n      return 'tomorrow'; // –ó–∞–≤—Ç—Ä–∞\n    } else if (daysUntil <= 3) {\n      return 'critical'; // –ö—Ä–∏—Ç–∏—á–Ω–æ (2-3 –¥–Ω—è)\n    } else if (daysUntil <= 7) {\n      return 'warning'; // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (4-7 –¥–Ω–µ–π)\n    } else {\n      return 'normal'; // –ù–æ—Ä–º–∞–ª—å–Ω–æ\n    }\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ —Å HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n   * @param {Array} problems - –ú–∞—Å—Å–∏–≤ –ø—Ä–æ–±–ª–µ–º\n   */\n  function sendDeadlineReport(problems) {\n    if (problems.length === 0) {\n      Logger.log('‚úÖ –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n      return;\n    }\n\n    Logger.log(`üìß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –æ ${problems.length} –¥–µ–¥–ª–∞–π–Ω–∞—Ö`);\n\n    // üî• –ù–û–í–û–ï: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏\n    const grouped = {\n      today: problems.filter(p => p.severity === 'today'),\n      tomorrow: problems.filter(p => p.severity === 'tomorrow'),\n      critical: problems.filter(p => p.severity === 'critical'),\n      warning: problems.filter(p => p.severity === 'warning')\n    };\n\n    // –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (–¥–ª—è fallback)\n    let messageText = '‚ö†Ô∏è –ü–†–ò–ë–õ–ò–ñ–ê–Æ–©–ò–ï–°–Ø –î–ï–î–õ–ê–ô–ù–´ ‚ö†Ô∏è\\n\\n';\n\n    if (grouped.today.length > 0) {\n      messageText += `üî¥ –°–ï–ì–û–î–ù–Ø (${grouped.today.length}):\\n`;\n      for (const p of grouped.today) {\n        messageText += `   - ${p.caseNumber}: ${p.columnName} (${p.date})\\n`;\n        messageText += `     –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}\\n\\n`;\n      }\n    }\n\n    if (grouped.tomorrow.length > 0) {\n      messageText += `üü† –ó–ê–í–¢–†–ê (${grouped.tomorrow.length}):\\n`;\n      for (const p of grouped.tomorrow) {\n        messageText += `   - ${p.caseNumber}: ${p.columnName} (${p.date})\\n`;\n        messageText += `     –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}\\n\\n`;\n      }\n    }\n\n    if (grouped.critical.length > 0) {\n      messageText += `üü° 2-3 –î–ù–Ø (${grouped.critical.length}):\\n`;\n      for (const p of grouped.critical) {\n        messageText += `   - ${p.caseNumber}: ${p.columnName} (${p.date}) - —á–µ—Ä–µ–∑ ${p.daysUntil} –¥–Ω.\\n`;\n        messageText += `     –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}\\n\\n`;\n      }\n    }\n\n    // üî• –ù–û–í–û–ï: HTML –≤–µ—Ä—Å–∏—è email\n    const htmlBody = buildHtmlReport(grouped);\n\n    // –û—Ç–ø—Ä–∞–≤–∫–∞ email\n    if (CONFIG.CALENDAR.NOTIFICATION_EMAILS &&\n        CONFIG.CALENDAR.NOTIFICATION_EMAILS.length > 0) {\n\n      const recipients = CONFIG.CALENDAR.NOTIFICATION_EMAILS.join(',');\n\n      try {\n        MailApp.sendEmail({\n          to: recipients,\n          subject: `‚ö†Ô∏è –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –¥–µ–¥–ª–∞–π–Ω—ã: ${problems.length} —à—Ç.`,\n          body: messageText,\n          htmlBody: htmlBody\n        });\n\n        Logger.log(`‚úÖ Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞: ${recipients}`);\n      } catch (e) {\n        Logger.log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email: ${e.message}`);\n        // Fallback - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert\n        UIManager.showInfo(`–ù–∞–π–¥–µ–Ω–æ ${problems.length} –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤.\\n–°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`);\n      }\n    } else {\n      Logger.log('‚ö†Ô∏è Email –∞–¥—Ä–µ—Å–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');\n      UIManager.showInfo(`–ù–∞–π–¥–µ–Ω–æ ${problems.length} –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤.\\n–ù–∞—Å—Ç—Ä–æ–π—Ç–µ email –≤ CONFIG –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.`);\n    }\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ HTML –æ—Ç—á–µ—Ç–∞\n   * @param {Object} grouped - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã\n   * @return {string} HTML –∫–æ–¥\n   */\n  function buildHtmlReport(grouped) {\n    let html = `\n      <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; }\n            h2 { color: #333; }\n            .section { margin-bottom: 20px; }\n            .today { background-color: #ffebee; padding: 10px; border-left: 4px solid #f44336; }\n            .tomorrow { background-color: #fff3e0; padding: 10px; border-left: 4px solid #ff9800; }\n            .critical { background-color: #fff9c4; padding: 10px; border-left: 4px solid #ffeb3b; }\n            .warning { background-color: #e3f2fd; padding: 10px; border-left: 4px solid #2196f3; }\n            .case { margin: 10px 0; padding: 10px; background-color: #fafafa; border-radius: 4px; }\n            .case-number { font-weight: bold; color: #1976d2; }\n            .meta { color: #666; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <h2>‚ö†Ô∏è –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –¥–µ–¥–ª–∞–π–Ω—ã</h2>\n    `;\n\n    if (grouped.today.length > 0) {\n      html += `\n        <div class=\"section today\">\n          <h3>üî¥ –°–ï–ì–û–î–ù–Ø (${grouped.today.length})</h3>\n          ${grouped.today.map(p => `\n            <div class=\"case\">\n              <span class=\"case-number\">${p.caseNumber}</span>: ${p.columnName}<br>\n              <span class=\"meta\">–î–∞—Ç–∞: ${p.date} | –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}</span>\n            </div>\n          `).join('')}\n        </div>\n      `;\n    }\n\n    if (grouped.tomorrow.length > 0) {\n      html += `\n        <div class=\"section tomorrow\">\n          <h3>üü† –ó–ê–í–¢–†–ê (${grouped.tomorrow.length})</h3>\n          ${grouped.tomorrow.map(p => `\n            <div class=\"case\">\n              <span class=\"case-number\">${p.caseNumber}</span>: ${p.columnName}<br>\n              <span class=\"meta\">–î–∞—Ç–∞: ${p.date} | –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}</span>\n            </div>\n          `).join('')}\n        </div>\n      `;\n    }\n\n    if (grouped.critical.length > 0) {\n      html += `\n        <div class=\"section critical\">\n          <h3>üü° 2-3 –î–ù–Ø (${grouped.critical.length})</h3>\n          ${grouped.critical.map(p => `\n            <div class=\"case\">\n              <span class=\"case-number\">${p.caseNumber}</span>: ${p.columnName}<br>\n              <span class=\"meta\">–î–∞—Ç–∞: ${p.date} (—á–µ—Ä–µ–∑ ${p.daysUntil} –¥–Ω.) | –õ–∏—Å—Ç: ${p.sheet}, –°—Ç—Ä–æ–∫–∞: ${p.row}</span>\n            </div>\n          `).join('')}\n        </div>\n      `;\n    }\n\n    html += `\n        </body>\n      </html>\n    `;\n\n    return html;\n  }\n\n  /**\n   * –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞\n   */\n  function dailyCheck() {\n    Logger.log('\\nüïê –ó–∞–ø—É—Å–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤');\n\n    const problems = findUpcomingDeadlines(3);\n\n    if (problems.length > 0) {\n      sendDeadlineReport(problems);\n    } else {\n      Logger.log('‚úÖ –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n    }\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    dailyCheck: dailyCheck,\n    findUpcomingDeadlines: findUpcomingDeadlines,\n    sendDeadlineReport: sendDeadlineReport\n  };\n})();\n"},{"name":"EnhancedDashboard.gs","content":"/**\n * EnhancedDashboard.gs\n *\n * –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π:\n * - KPI –º–µ—Ç—Ä–∏–∫–∏\n * - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º\n * - –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n * - –ü—Ä–æ–≥–Ω–æ–∑ –∑–∞–≥—Ä—É–∑–∫–∏\n * - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–¥–ª–∞–π–Ω–æ–≤\n * - –£—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n */\n\nvar EnhancedDashboard = (function() {\n  'use strict';\n\n  const DASHBOARD_SHEET_NAME = 'üìä –î–∞—à–±–æ—Ä–¥';\n\n  // ============================================\n  // –°–û–ó–î–ê–ù–ò–ï –î–ê–®–ë–û–†–î–ê\n  // ============================================\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥\n   */\n  function createOrUpdateDashboard() {\n    if (!checkPermission('view_cases')) return;\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(DASHBOARD_SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(DASHBOARD_SHEET_NAME, 0);  // –ü–µ—Ä–≤—ã–π –ª–∏—Å—Ç\n    } else {\n      sheet.clear();\n    }\n\n    // –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ\n    const data = collectDashboardData();\n\n    // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥\n    buildDashboard(sheet, data);\n\n    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    applyFormatting(sheet);\n\n    // –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥\n    ss.setActiveSheet(sheet);\n\n    SpreadsheetApp.getUi().alert(\n      '‚úÖ –î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª—ë–Ω!',\n      '–î–∞—à–±–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.',\n      SpreadsheetApp.getUi().ButtonSet.OK\n    );\n\n    AppLogger.info('EnhancedDashboard', '–î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª—ë–Ω');\n  }\n\n  // ============================================\n  // –°–ë–û–† –î–ê–ù–ù–´–•\n  // ============================================\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n   */\n  function collectDashboardData() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const now = new Date();\n\n    const data = {\n      timestamp: now,\n      cases: collectCasesData(),\n      financial: collectFinancialData(),\n      time: collectTimeData(),\n      clients: collectClientsData(),\n      lawyers: collectLawyersData()\n    };\n\n    return data;\n  }\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–µ–ª–∞–º\n   */\n  function collectCasesData() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const casesSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞');\n\n    if (!casesSheet) {\n      return {\n        total: 0,\n        active: 0,\n        completed: 0,\n        byStatus: {},\n        upcoming: 0,\n        overdue: 0\n      };\n    }\n\n    const casesData = casesSheet.getDataRange().getValues();\n    const now = new Date();\n\n    const stats = {\n      total: 0,\n      active: 0,\n      completed: 0,\n      byStatus: {},\n      upcoming: 0,\n      overdue: 0\n    };\n\n    for (let i = 1; i < casesData.length; i++) {\n      const row = casesData[i];\n      if (!row[0]) continue;  // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏\n\n      stats.total++;\n\n      const status = row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n      stats.byStatus[status] = (stats.byStatus[status] || 0) + 1;\n\n      if (status === '–í —Ä–∞–±–æ—Ç–µ') {\n        stats.active++;\n      } else if (status === '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' || status === '–ê—Ä—Ö–∏–≤') {\n        stats.completed++;\n      }\n\n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤\n      const nextHearing = row[8];\n      if (nextHearing && nextHearing instanceof Date) {\n        const daysUntil = Math.floor((nextHearing - now) / (1000 * 60 * 60 * 24));\n\n        if (daysUntil < 0) {\n          stats.overdue++;\n        } else if (daysUntil <= 14) {\n          stats.upcoming++;\n        }\n      }\n    }\n\n    return stats;\n  }\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\n   */\n  function collectFinancialData() {\n    const stats = {\n      totalFees: 0,\n      paidFees: 0,\n      unpaidFees: 0,\n      totalExpenses: 0,\n      refundableExpenses: 0,\n      netProfit: 0\n    };\n\n    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–æ–¥—É–ª—è FinancialManager\n    if (typeof FinancialManager === 'undefined') {\n      return stats;\n    }\n\n    try {\n      const feesSheet = FinancialManager.getOrCreateFeesSheet();\n      const feesData = feesSheet.getDataRange().getValues();\n\n      for (let i = 1; i < feesData.length; i++) {\n        const row = feesData[i];\n        const total = parseFloat(row[9]) || 0;\n        const status = row[10];\n\n        stats.totalFees += total;\n\n        if (status === '–û–ø–ª–∞—á–µ–Ω–æ') {\n          stats.paidFees += total;\n        } else {\n          stats.unpaidFees += total;\n        }\n      }\n\n      const expensesSheet = FinancialManager.getOrCreateExpensesSheet();\n      const expensesData = expensesSheet.getDataRange().getValues();\n\n      for (let i = 1; i < expensesData.length; i++) {\n        const row = expensesData[i];\n        const amount = parseFloat(row[5]) || 0;\n        const refundable = row[6] === true;\n\n        stats.totalExpenses += amount;\n\n        if (refundable) {\n          stats.refundableExpenses += amount;\n        }\n      }\n\n      stats.netProfit = stats.paidFees - stats.totalExpenses;\n    } catch (e) {\n      AppLogger.error('EnhancedDashboard', '–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: ' + e.message);\n    }\n\n    return stats;\n  }\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —É—á—ë—Ç—É –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function collectTimeData() {\n    const stats = {\n      totalHours: 0,\n      totalCost: 0,\n      approvedHours: 0,\n      approvedCost: 0\n    };\n\n    if (typeof TimeTracker === 'undefined') {\n      return stats;\n    }\n\n    try {\n      const timeSheet = TimeTracker.getOrCreateSheet();\n      const timeData = timeSheet.getDataRange().getValues();\n\n      for (let i = 1; i < timeData.length; i++) {\n        const row = timeData[i];\n        const hours = parseFloat(row[5]) || 0;\n        const cost = parseFloat(row[7]) || 0;\n        const status = row[8];\n\n        stats.totalHours += hours;\n        stats.totalCost += cost;\n\n        if (status === '–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ') {\n          stats.approvedHours += hours;\n          stats.approvedCost += cost;\n        }\n      }\n    } catch (e) {\n      AppLogger.error('EnhancedDashboard', '–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–∏: ' + e.message);\n    }\n\n    return stats;\n  }\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º\n   */\n  function collectClientsData() {\n    const stats = {\n      total: 0,\n      active: 0,\n      vip: 0\n    };\n\n    if (typeof ClientDatabase === 'undefined') {\n      return stats;\n    }\n\n    try {\n      const clientSheet = ClientDatabase.getOrCreateSheet();\n      const clientData = clientSheet.getDataRange().getValues();\n\n      for (let i = 1; i < clientData.length; i++) {\n        const row = clientData[i];\n        if (!row[0]) continue;\n\n        stats.total++;\n\n        const status = row[13];\n        if (status === '–ê–∫—Ç–∏–≤–Ω—ã–π') stats.active++;\n        if (status === 'VIP') stats.vip++;\n      }\n    } catch (e) {\n      AppLogger.error('EnhancedDashboard', '–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: ' + e.message);\n    }\n\n    return stats;\n  }\n\n  /**\n   * –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —é—Ä–∏—Å—Ç–∞–º\n   */\n  function collectLawyersData() {\n    const lawyers = [];\n\n    try {\n      const allLawyers = UserManager.getUsersByRole('LAWYER');\n\n      Object.keys(allLawyers).forEach(email => {\n        const lawyer = allLawyers[email];\n        lawyers.push({\n          name: lawyer.name || email,\n          email: email,\n          cases: (lawyer.assigned_cases || []).length\n        });\n      });\n    } catch (e) {\n      AppLogger.error('EnhancedDashboard', '–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —é—Ä–∏—Å—Ç–æ–≤: ' + e.message);\n    }\n\n    return lawyers;\n  }\n\n  // ============================================\n  // –ü–û–°–¢–†–û–ï–ù–ò–ï –î–ê–®–ë–û–†–î–ê\n  // ============================================\n\n  /**\n   * –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥\n   */\n  function buildDashboard(sheet, data) {\n    let currentRow = 1;\n\n    // –ó–∞–≥–æ–ª–æ–≤–æ–∫\n    currentRow = buildHeader(sheet, currentRow, data.timestamp);\n\n    // –ë–ª–æ–∫ KPI\n    currentRow = buildKPIBlock(sheet, currentRow, data);\n\n    currentRow++; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n\n    // –ë–ª–æ–∫ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª\n    currentRow = buildCasesBlock(sheet, currentRow, data.cases);\n\n    currentRow++; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n\n    // –ë–ª–æ–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤\n    currentRow = buildFinanceBlock(sheet, currentRow, data.financial);\n\n    currentRow++; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n\n    // –ë–ª–æ–∫ —é—Ä–∏—Å—Ç–æ–≤\n    currentRow = buildLawyersBlock(sheet, currentRow, data.lawyers);\n\n    currentRow++; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n\n    // –ë–ª–æ–∫ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏\n    currentRow = buildTimeBlock(sheet, currentRow, data.time);\n\n    currentRow++; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n\n    // –ë–ª–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤\n    currentRow = buildClientsBlock(sheet, currentRow, data.clients);\n  }\n\n  /**\n   * –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∞—à–±–æ—Ä–¥–∞\n   */\n  function buildHeader(sheet, row, timestamp) {\n    sheet.getRange(row, 1).setValue('üìä –î–ê–®–ë–û–†–î –°–£–î–ï–ë–ù–´–• –î–ï–õ')\n      .setFontSize(18)\n      .setFontWeight('bold')\n      .setBackground('#4a86e8')\n      .setFontColor('#ffffff');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n\n    row++;\n\n    const dateStr = Utilities.formatDate(timestamp, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n    sheet.getRange(row, 1).setValue(`–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${dateStr}`)\n      .setFontStyle('italic')\n      .setFontColor('#666666');\n\n    return row + 2;\n  }\n\n  /**\n   * –ë–ª–æ–∫ KPI\n   */\n  function buildKPIBlock(sheet, row, data) {\n    // –ó–∞–≥–æ–ª–æ–≤–æ–∫\n    sheet.getRange(row, 1).setValue('üéØ –ö–õ–Æ–ß–ï–í–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò (KPI)')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#f1c232')\n      .setFontColor('#000000');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    // KPI –º–µ—Ç—Ä–∏–∫–∏\n    const kpis = [\n      ['üìÅ –í—Å–µ–≥–æ –¥–µ–ª', data.cases.total, 'üí∞ –î–æ—Ö–æ–¥ (–æ–ø–ª–∞—á–µ–Ω–æ)', formatCurrency(data.financial.paidFees)],\n      ['‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª', data.cases.active, '‚è±Ô∏è –ß–∞—Å–æ–≤ (—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)', data.time.approvedHours.toFixed(1)],\n      ['üî¥ –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –∑–∞—Å–µ–¥–∞–Ω–∏–π', data.cases.upcoming, 'üë• –ö–ª–∏–µ–Ω—Ç–æ–≤', data.clients.total],\n      ['‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö', data.cases.overdue, '‚≠ê VIP –∫–ª–∏–µ–Ω—Ç–æ–≤', data.clients.vip]\n    ];\n\n    kpis.forEach(kpi => {\n      sheet.getRange(row, 1).setValue(kpi[0]).setFontWeight('bold');\n      sheet.getRange(row, 2).setValue(kpi[1]).setHorizontalAlignment('right').setFontSize(12).setFontWeight('bold');\n\n      sheet.getRange(row, 4).setValue(kpi[2]).setFontWeight('bold');\n      sheet.getRange(row, 5).setValue(kpi[3]).setHorizontalAlignment('right').setFontSize(12).setFontWeight('bold');\n\n      row++;\n    });\n\n    return row;\n  }\n\n  /**\n   * –ë–ª–æ–∫ —Å—É–¥–µ–±–Ω—ã—Ö –¥–µ–ª\n   */\n  function buildCasesBlock(sheet, row, casesData) {\n    sheet.getRange(row, 1).setValue('‚öñÔ∏è –°–£–î–ï–ë–ù–´–ï –î–ï–õ–ê')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#6aa84f')\n      .setFontColor('#ffffff');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º\n    sheet.getRange(row, 1).setValue('–°—Ç–∞—Ç—É—Å').setFontWeight('bold');\n    sheet.getRange(row, 2).setValue('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ').setFontWeight('bold');\n    sheet.getRange(row, 3).setValue('–î–æ–ª—è').setFontWeight('bold');\n    row++;\n\n    const statuses = Object.keys(casesData.byStatus);\n    statuses.forEach(status => {\n      const count = casesData.byStatus[status];\n      const percentage = casesData.total > 0 ? ((count / casesData.total) * 100).toFixed(1) : 0;\n\n      sheet.getRange(row, 1).setValue(status);\n      sheet.getRange(row, 2).setValue(count);\n      sheet.getRange(row, 3).setValue(`${percentage}%`);\n\n      row++;\n    });\n\n    return row;\n  }\n\n  /**\n   * –ë–ª–æ–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤\n   */\n  function buildFinanceBlock(sheet, row, financeData) {\n    sheet.getRange(row, 1).setValue('üíµ –§–ò–ù–ê–ù–°–´')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#e06666')\n      .setFontColor('#ffffff');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    const financeRows = [\n      ['üí∞ –í—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ', formatCurrency(financeData.totalFees)],\n      ['‚úÖ –û–ø–ª–∞—á–µ–Ω–æ', formatCurrency(financeData.paidFees)],\n      ['‚ùå –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ', formatCurrency(financeData.unpaidFees)],\n      ['', ''],\n      ['üí∏ –†–∞—Å—Ö–æ–¥—ã', formatCurrency(financeData.totalExpenses)],\n      ['üîÑ –ö –≤–æ–∑–º–µ—â–µ–Ω–∏—é', formatCurrency(financeData.refundableExpenses)],\n      ['', ''],\n      ['üìä –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å', formatCurrency(financeData.netProfit)]\n    ];\n\n    financeRows.forEach(finRow => {\n      if (finRow[0]) {\n        sheet.getRange(row, 1).setValue(finRow[0]).setFontWeight('bold');\n        sheet.getRange(row, 2).setValue(finRow[1]).setHorizontalAlignment('right');\n\n        // –í—ã–¥–µ–ª–∏—Ç—å —á–∏—Å—Ç—É—é –ø—Ä–∏–±—ã–ª—å\n        if (finRow[0].includes('–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å')) {\n          sheet.getRange(row, 1, 1, 2).setBackground('#d9ead3').setFontSize(12).setFontWeight('bold');\n        }\n      }\n      row++;\n    });\n\n    return row;\n  }\n\n  /**\n   * –ë–ª–æ–∫ —é—Ä–∏—Å—Ç–æ–≤\n   */\n  function buildLawyersBlock(sheet, row, lawyersData) {\n    sheet.getRange(row, 1).setValue('üë®‚Äç‚öñÔ∏è –Æ–†–ò–°–¢–´')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#9fc5e8')\n      .setFontColor('#000000');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    if (lawyersData.length === 0) {\n      sheet.getRange(row, 1).setValue('–ù–µ—Ç —é—Ä–∏—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ').setFontStyle('italic');\n      return row + 1;\n    }\n\n    sheet.getRange(row, 1).setValue('–Æ—Ä–∏—Å—Ç').setFontWeight('bold');\n    sheet.getRange(row, 2).setValue('–î–µ–ª').setFontWeight('bold');\n    sheet.getRange(row, 3).setValue('–ó–∞–≥—Ä—É–∑–∫–∞').setFontWeight('bold');\n    row++;\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–µ–ª\n    lawyersData.sort((a, b) => b.cases - a.cases);\n\n    lawyersData.forEach(lawyer => {\n      sheet.getRange(row, 1).setValue(lawyer.name);\n      sheet.getRange(row, 2).setValue(lawyer.cases);\n\n      // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏\n      const load = lawyer.cases;\n      let loadBar = '';\n      let loadColor = '#d9ead3';  // –ó–µ–ª—ë–Ω—ã–π\n\n      if (load <= 3) {\n        loadBar = '‚ñÅ‚ñÅ‚ñÅ';\n        loadColor = '#d9ead3';\n      } else if (load <= 7) {\n        loadBar = '‚ñÉ‚ñÉ‚ñÉ‚ñÉ‚ñÉ';\n        loadColor = '#fff2cc';  // –ñ—ë–ª—Ç—ã–π\n      } else if (load <= 10) {\n        loadBar = '‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÖ‚ñÖ';\n        loadColor = '#fce5cd';  // –û—Ä–∞–Ω–∂–µ–≤—ã–π\n      } else {\n        loadBar = '‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà';\n        loadColor = '#f4cccc';  // –ö—Ä–∞—Å–Ω—ã–π\n      }\n\n      sheet.getRange(row, 3).setValue(loadBar).setBackground(loadColor);\n\n      row++;\n    });\n\n    return row;\n  }\n\n  /**\n   * –ë–ª–æ–∫ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function buildTimeBlock(sheet, row, timeData) {\n    sheet.getRange(row, 1).setValue('‚è±Ô∏è –£–ß–Å–¢ –í–†–ï–ú–ï–ù–ò')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#b4a7d6')\n      .setFontColor('#000000');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    const timeRows = [\n      ['–í—Å–µ–≥–æ —á–∞—Å–æ–≤', timeData.totalHours.toFixed(1)],\n      ['–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–∞—Å–æ–≤', timeData.approvedHours.toFixed(1)],\n      ['', ''],\n      ['–í—Å–µ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å', formatCurrency(timeData.totalCost)],\n      ['–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å', formatCurrency(timeData.approvedCost)]\n    ];\n\n    timeRows.forEach(timeRow => {\n      if (timeRow[0]) {\n        sheet.getRange(row, 1).setValue(timeRow[0]).setFontWeight('bold');\n        sheet.getRange(row, 2).setValue(timeRow[1]).setHorizontalAlignment('right');\n      }\n      row++;\n    });\n\n    return row;\n  }\n\n  /**\n   * –ë–ª–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function buildClientsBlock(sheet, row, clientsData) {\n    sheet.getRange(row, 1).setValue('üë• –ö–õ–ò–ï–ù–¢–´')\n      .setFontSize(14)\n      .setFontWeight('bold')\n      .setBackground('#76a5af')\n      .setFontColor('#ffffff');\n\n    sheet.getRange(row, 1, 1, 6).merge();\n    row++;\n\n    const clientRows = [\n      ['–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤', clientsData.total],\n      ['–ê–∫—Ç–∏–≤–Ω—ã—Ö', clientsData.active],\n      ['VIP', clientsData.vip]\n    ];\n\n    clientRows.forEach(clientRow => {\n      sheet.getRange(row, 1).setValue(clientRow[0]).setFontWeight('bold');\n      sheet.getRange(row, 2).setValue(clientRow[1]).setHorizontalAlignment('right');\n      row++;\n    });\n\n    return row;\n  }\n\n  // ============================================\n  // –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï\n  // ============================================\n\n  /**\n   * –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n   */\n  function applyFormatting(sheet) {\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 250);\n    sheet.setColumnWidth(2, 150);\n    sheet.setColumnWidth(3, 150);\n    sheet.setColumnWidth(4, 250);\n    sheet.setColumnWidth(5, 150);\n    sheet.setColumnWidth(6, 150);\n\n    // –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É\n    sheet.setFrozenRows(1);\n\n    // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ\n    sheet.getRange('A:A').setVerticalAlignment('middle');\n    sheet.getRange('B:F').setVerticalAlignment('middle');\n  }\n\n  // ============================================\n  // –£–¢–ò–õ–ò–¢–´\n  // ============================================\n\n  /**\n   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª—é—Ç—É\n   */\n  function formatCurrency(value) {\n    if (!value || isNaN(value)) return '0 ‚ÇΩ';\n    return value.toFixed(0).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ') + ' ‚ÇΩ';\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    createOrUpdateDashboard: createOrUpdateDashboard,\n    collectDashboardData: collectDashboardData\n  };\n})();\n"},{"name":"ErrorHandler.gs","content":"/**\n * ‚ú® –ù–û–í–´–ô –ú–û–î–£–õ–¨: ErrorHandler.gs\n *\n * –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö API –≤—ã–∑–æ–≤–æ–≤\n *\n * –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:\n * ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π\n * ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–≤–æ—Ç Google API\n * ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫\n * ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö\n * ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n *\n * –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:\n * const result = ErrorHandler.retry(() => {\n *   return calendar.createEvent(...);\n * }, '–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è');\n */\n\nvar ErrorHandler = (function() {\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ retry\n   */\n  const RETRY_CONFIG = {\n    MAX_RETRIES: 3,\n    INITIAL_DELAY: 1000,     // 1 —Å–µ–∫—É–Ω–¥–∞\n    MAX_DELAY: 10000,        // 10 —Å–µ–∫—É–Ω–¥\n    BACKOFF_MULTIPLIER: 2    // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç\n  };\n\n  /**\n   * –¢–∏–ø—ã –æ—à–∏–±–æ–∫ Google API, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å\n   */\n  const RETRIABLE_ERRORS = [\n    'Service invoked too many times',\n    'Rate Limit Exceeded',\n    'User rate limit exceeded',\n    'Too many concurrent invocations',\n    'Backend Error',\n    'Service unavailable',\n    'Internal error',\n    'Temporary failure',\n    'RESOURCE_EXHAUSTED'\n  ];\n\n  /**\n   * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)\n   */\n  const stats = {\n    totalCalls: 0,\n    successfulCalls: 0,\n    failedCalls: 0,\n    retriedCalls: 0,\n    errors: {}\n  };\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #24: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤\n   * üî• –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å retry –ª–æ–≥–∏–∫–æ–π\n   *\n   * @param {Function} fn - –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è\n   * @param {string} description - –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏\n   * @param {Object} options - –û–ø—Ü–∏–∏ retry\n   * @param {number} [options.maxRetries] - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫\n   * @param {number} [options.initialDelay] - –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–º—Å)\n   * @param {Function} [options.onError] - Callback –ø—Ä–∏ –æ—à–∏–±–∫–µ\n   * @param {boolean} [options.throwOnFailure] - –ë—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ\n   * @return {*|null} –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ null –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ\n   */\n  function retry(fn, description, options = {}) {\n    const maxRetries = options.maxRetries || RETRY_CONFIG.MAX_RETRIES;\n    const initialDelay = options.initialDelay || RETRY_CONFIG.INITIAL_DELAY;\n    const onError = options.onError || null;\n    const throwOnFailure = options.throwOnFailure || false;\n\n    stats.totalCalls++;\n\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        const result = fn();\n        stats.successfulCalls++;\n\n        if (attempt > 1) {\n          stats.retriedCalls++;\n          Logger.log(`   ‚úÖ ${description} - —É—Å–ø–µ—à–Ω–æ —Å –ø–æ–ø—ã—Ç–∫–∏ ${attempt}`);\n        }\n\n        return result;\n\n      } catch (error) {\n        const isLastAttempt = (attempt === maxRetries);\n        const isRetriable = isErrorRetriable(error);\n\n        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É\n        logError(error, description, attempt, maxRetries);\n\n        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n        const errorType = getErrorType(error);\n        stats.errors[errorType] = (stats.errors[errorType] || 0) + 1;\n\n        if (isLastAttempt || !isRetriable) {\n          stats.failedCalls++;\n\n          // –í—ã–∑—ã–≤–∞–µ–º callback –ø—Ä–∏ –æ—à–∏–±–∫–µ\n          if (onError) {\n            try {\n              onError(error, attempt);\n            } catch (e) {\n              Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ onError callback: ${e.message}`);\n            }\n          }\n\n          // –ë—Ä–æ—Å–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è\n          if (throwOnFailure) {\n            throw error;\n          }\n\n          Logger.log(`   ‚ùå ${description} - –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å–ª–µ ${maxRetries} –ø–æ–ø—ã—Ç–æ–∫`);\n          return null;\n        }\n\n        // –í—ã—á–∏—Å–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —Ä–æ—Å—Ç–æ–º\n        const delay = Math.min(\n          initialDelay * Math.pow(RETRY_CONFIG.BACKOFF_MULTIPLIER, attempt - 1),\n          RETRY_CONFIG.MAX_DELAY\n        );\n\n        Logger.log(`   ‚è≥ –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${delay}ms...`);\n        Utilities.sleep(delay);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫—É\n   * @param {Error} error - –û—à–∏–±–∫–∞\n   * @return {boolean} true –µ—Å–ª–∏ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å\n   */\n  function isErrorRetriable(error) {\n    const errorMessage = error.message || error.toString();\n\n    return RETRIABLE_ERRORS.some(retriable =>\n      errorMessage.includes(retriable)\n    );\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∞–µ—Ç —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏\n   * @param {Error} error - –û—à–∏–±–∫–∞\n   * @return {string} –¢–∏–ø –æ—à–∏–±–∫–∏\n   */\n  function getErrorType(error) {\n    const message = error.message || error.toString();\n\n    if (message.includes('Rate Limit')) {\n      return 'RateLimit';\n    } else if (message.includes('Service invoked too many times')) {\n      return 'TooManyCalls';\n    } else if (message.includes('Backend Error')) {\n      return 'BackendError';\n    } else if (message.includes('Permission denied')) {\n      return 'PermissionDenied';\n    } else if (message.includes('Not found')) {\n      return 'NotFound';\n    } else {\n      return 'Other';\n    }\n  }\n\n  /**\n   * –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É\n   * @param {Error} error - –û—à–∏–±–∫–∞\n   * @param {string} description - –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏\n   * @param {number} attempt - –ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏\n   * @param {number} maxRetries - –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫\n   */\n  function logError(error, description, attempt, maxRetries) {\n    const errorType = getErrorType(error);\n    const retriable = isErrorRetriable(error);\n\n    Logger.log(`   ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempt}/${maxRetries}: ${description}`);\n    Logger.log(`      –¢–∏–ø: ${errorType}`);\n    Logger.log(`      –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å: ${retriable ? '–î–∞' : '–ù–µ—Ç'}`);\n    Logger.log(`      –°–æ–æ–±—â–µ–Ω–∏–µ: ${error.message}`);\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: Batch retry - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å retry\n   * @param {Array} items - –ú–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏\n   * @param {Function} fn - –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç item)\n   * @param {string} description - –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏\n   * @param {Object} options - –û–ø—Ü–∏–∏\n   * @return {Object} –†–µ–∑—É–ª—å—Ç–∞—Ç—ã {successful, failed, results}\n   */\n  function batchRetry(items, fn, description, options = {}) {\n    Logger.log(`üîÑ Batch –æ–ø–µ—Ä–∞—Ü–∏—è: ${description} (${items.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)`);\n\n    const successful = [];\n    const failed = [];\n    const results = [];\n\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n\n      try {\n        const result = retry(\n          () => fn(item, i),\n          `${description} [${i + 1}/${items.length}]`,\n          options\n        );\n\n        if (result !== null) {\n          successful.push(item);\n          results.push(result);\n        } else {\n          failed.push({item, index: i, error: 'Returned null'});\n        }\n\n      } catch (error) {\n        failed.push({item, index: i, error: error.message});\n      }\n\n      // –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤\n      if ((i + 1) % 10 === 0) {\n        Logger.log(`   üìà –ü—Ä–æ–≥—Ä–µ—Å—Å: ${i + 1}/${items.length}`);\n      }\n    }\n\n    Logger.log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successful.length}`);\n    Logger.log(`   ‚ùå –û—à–∏–±–æ–∫: ${failed.length}`);\n\n    return {\n      successful,\n      failed,\n      results\n    };\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—à–∏–±–æ–∫\n   * @return {Object} –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n   */\n  function getStats() {\n    return {\n      ...stats,\n      successRate: stats.totalCalls > 0 ?\n        ((stats.successfulCalls / stats.totalCalls) * 100).toFixed(2) + '%' :\n        'N/A'\n    };\n  }\n\n  /**\n   * –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n   */\n  function resetStats() {\n    stats.totalCalls = 0;\n    stats.successfulCalls = 0;\n    stats.failedCalls = 0;\n    stats.retriedCalls = 0;\n    stats.errors = {};\n    Logger.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞');\n  }\n\n  /**\n   * –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n   */\n  function logStats() {\n    Logger.log('\\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê ERROR HANDLER:');\n    Logger.log(`   –í—Å–µ–≥–æ –≤—ã–∑–æ–≤–æ–≤: ${stats.totalCalls}`);\n    Logger.log(`   –£—Å–ø–µ—à–Ω—ã—Ö: ${stats.successfulCalls}`);\n    Logger.log(`   –ù–µ—É–¥–∞—á–Ω—ã—Ö: ${stats.failedCalls}`);\n    Logger.log(`   –° retry: ${stats.retriedCalls}`);\n    Logger.log(`   Success Rate: ${getStats().successRate}`);\n\n    if (Object.keys(stats.errors).length > 0) {\n      Logger.log('\\n   –û—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º:');\n      for (const [type, count] of Object.entries(stats.errors)) {\n        Logger.log(`   - ${type}: ${count}`);\n      }\n    }\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: Wrapper –¥–ª—è Google Calendar API\n   */\n  const CalendarAPI = {\n    createEvent: function(calendar, title, startTime, endTime, options) {\n      return retry(\n        () => calendar.createEvent(title, startTime, endTime, options),\n        `–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è: ${title}`,\n        {maxRetries: 3}\n      );\n    },\n\n    deleteEvent: function(event) {\n      return retry(\n        () => event.deleteEvent(),\n        '–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è',\n        {maxRetries: 2}\n      );\n    },\n\n    getEvents: function(calendar, startDate, endDate, options) {\n      return retry(\n        () => calendar.getEvents(startDate, endDate, options),\n        '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π',\n        {maxRetries: 3}\n      );\n    }\n  };\n\n  /**\n   * üî• –ù–û–í–û–ï: Wrapper –¥–ª—è Google Drive API\n   */\n  const DriveAPI = {\n    createFolder: function(parentFolder, name) {\n      return retry(\n        () => parentFolder.createFolder(name),\n        `–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏: ${name}`,\n        {maxRetries: 3}\n      );\n    },\n\n    getFoldersByName: function(parentFolder, name) {\n      return retry(\n        () => parentFolder.getFoldersByName(name),\n        `–ü–æ–∏—Å–∫ –ø–∞–ø–∫–∏: ${name}`,\n        {maxRetries: 2}\n      );\n    }\n  };\n\n  /**\n   * üî• –ù–û–í–û–ï: Wrapper –¥–ª—è Google Sheets API\n   */\n  const SheetsAPI = {\n    getValues: function(range) {\n      return retry(\n        () => range.getValues(),\n        '–ß—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π',\n        {maxRetries: 3}\n      );\n    },\n\n    setValues: function(range, values) {\n      return retry(\n        () => range.setValues(values),\n        '–ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏–π',\n        {maxRetries: 3}\n      );\n    }\n  };\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    retry: retry,\n    batchRetry: batchRetry,\n    isErrorRetriable: isErrorRetriable,\n    getStats: getStats,\n    resetStats: resetStats,\n    logStats: logStats,\n    CalendarAPI: CalendarAPI,\n    DriveAPI: DriveAPI,\n    SheetsAPI: SheetsAPI\n  };\n})();\n"},{"name":"FinancialManager.gs","content":"/**\n * FinancialManager.gs\n *\n * –ú–æ–¥—É–ª—å –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É—á—ë—Ç–∞:\n * - –ì–æ–Ω–æ—Ä–∞—Ä—ã –ø–æ –¥–µ–ª–∞–º\n * - –†–∞—Å—Ö–æ–¥—ã –∏ –∏–∑–¥–µ—Ä–∂–∫–∏\n * - –ê–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç\n * - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤\n * - –°–≤—è–∑—å —Å —É—á—ë—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏\n * - –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n */\n\nvar FinancialManager = (function() {\n  'use strict';\n\n  const FEES_SHEET_NAME = 'üí∞ –ì–æ–Ω–æ—Ä–∞—Ä—ã';\n  const EXPENSES_SHEET_NAME = 'üí∏ –†–∞—Å—Ö–æ–¥—ã';\n  const INVOICES_SHEET_NAME = 'üìÑ –°—á–µ—Ç–∞';\n\n  // ============================================\n  // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –õ–ò–°–¢–û–í\n  // ============================================\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤\n   */\n  function getOrCreateFeesSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(FEES_SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(FEES_SHEET_NAME);\n      initializeFeesSheet(sheet);\n    }\n\n    return sheet;\n  }\n\n  /**\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤\n   */\n  function initializeFeesSheet(sheet) {\n    const headers = [\n      'ID',\n      '–î–∞—Ç–∞',\n      '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n      'ID –∫–ª–∏–µ–Ω—Ç–∞',\n      '–ö–ª–∏–µ–Ω—Ç',\n      '–¢–∏–ø —É—Å–ª—É–≥–∏',\n      '–û–ø–∏—Å–∞–Ω–∏–µ',\n      '–°—É–º–º–∞ (—Ä—É–±)',\n      '–ù–î–° 20%',\n      '–ò—Ç–æ–≥–æ —Å –ù–î–°',\n      '–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã',\n      '–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã',\n      '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length)\n      .setValues([headers])\n      .setFontWeight('bold')\n      .setBackground('#f1c232')\n      .setFontColor('#000000');\n\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 80);   // ID\n    sheet.setColumnWidth(2, 100);  // –î–∞—Ç–∞\n    sheet.setColumnWidth(3, 130);  // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    sheet.setColumnWidth(4, 100);  // ID –∫–ª–∏–µ–Ω—Ç–∞\n    sheet.setColumnWidth(5, 200);  // –ö–ª–∏–µ–Ω—Ç\n    sheet.setColumnWidth(6, 150);  // –¢–∏–ø —É—Å–ª—É–≥–∏\n    sheet.setColumnWidth(7, 300);  // –û–ø–∏—Å–∞–Ω–∏–µ\n    sheet.setColumnWidth(8, 120);  // –°—É–º–º–∞\n    sheet.setColumnWidth(9, 100);  // –ù–î–°\n    sheet.setColumnWidth(10, 120); // –ò—Ç–æ–≥–æ\n    sheet.setColumnWidth(11, 120); // –°—Ç–∞—Ç—É—Å\n    sheet.setColumnWidth(12, 100); // –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã\n    sheet.setColumnWidth(13, 250); // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n\n    sheet.setFrozenRows(1);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    sheet.getRange('B2:B').setNumberFormat('dd.MM.yyyy');\n    sheet.getRange('H2:J').setNumberFormat('#,##0 ‚ÇΩ');\n    sheet.getRange('L2:L').setNumberFormat('dd.MM.yyyy');\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Ç–∏–ø–∞ —É—Å–ª—É–≥–∏\n    const typeRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList([\n        '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',\n        '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤',\n        '–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Å—É–¥–µ',\n        '–ê–±–æ–Ω–µ–Ω—Ç—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',\n        '–ü—Ä–æ—á–µ–µ'\n      ], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('F2:F1000').setDataValidation(typeRule);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã\n    const statusRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ', '–ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ', '–û–ø–ª–∞—á–µ–Ω–æ'], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('K2:K1000').setDataValidation(statusRule);\n  }\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤\n   */\n  function getOrCreateExpensesSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(EXPENSES_SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(EXPENSES_SHEET_NAME);\n      initializeExpensesSheet(sheet);\n    }\n\n    return sheet;\n  }\n\n  /**\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤\n   */\n  function initializeExpensesSheet(sheet) {\n    const headers = [\n      'ID',\n      '–î–∞—Ç–∞',\n      '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n      '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',\n      '–û–ø–∏—Å–∞–Ω–∏–µ',\n      '–°—É–º–º–∞ (—Ä—É–±)',\n      '–í–æ–∑–º–µ—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º',\n      '–°—Ç–∞—Ç—É—Å –≤–æ–∑–º–µ—â–µ–Ω–∏—è',\n      '–î–æ–∫—É–º–µ–Ω—Ç',\n      '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length)\n      .setValues([headers])\n      .setFontWeight('bold')\n      .setBackground('#e06666')\n      .setFontColor('#ffffff');\n\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 80);   // ID\n    sheet.setColumnWidth(2, 100);  // –î–∞—Ç–∞\n    sheet.setColumnWidth(3, 130);  // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    sheet.setColumnWidth(4, 150);  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è\n    sheet.setColumnWidth(5, 300);  // –û–ø–∏—Å–∞–Ω–∏–µ\n    sheet.setColumnWidth(6, 120);  // –°—É–º–º–∞\n    sheet.setColumnWidth(7, 150);  // –í–æ–∑–º–µ—â–∞–µ—Ç—Å—è\n    sheet.setColumnWidth(8, 150);  // –°—Ç–∞—Ç—É—Å\n    sheet.setColumnWidth(9, 150);  // –î–æ–∫—É–º–µ–Ω—Ç\n    sheet.setColumnWidth(10, 250); // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n\n    sheet.setFrozenRows(1);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    sheet.getRange('B2:B').setNumberFormat('dd.MM.yyyy');\n    sheet.getRange('F2:F').setNumberFormat('#,##0 ‚ÇΩ');\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n    const categoryRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList([\n        '–ì–æ—Å–ø–æ—à–ª–∏–Ω–∞',\n        '–ù–æ—Ç–∞—Ä–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',\n        '–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞',\n        '–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω—ã–µ',\n        '–ü–æ—á—Ç–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã',\n        '–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è',\n        '–ü—Ä–æ—á–µ–µ'\n      ], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('D2:D1000').setDataValidation(categoryRule);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –≤–æ–∑–º–µ—â–µ–Ω–∏—è\n    const refundRule = SpreadsheetApp.newDataValidation()\n      .requireCheckbox()\n      .build();\n    sheet.getRange('G2:G1000').setDataValidation(refundRule);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –≤–æ–∑–º–µ—â–µ–Ω–∏—è\n    const statusRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['–ù–µ –≤–æ–∑–º–µ—â–µ–Ω–æ', '–í–æ–∑–º–µ—â–µ–Ω–æ'], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('H2:H1000').setDataValidation(statusRule);\n  }\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç —Å—á–µ—Ç–æ–≤\n   */\n  function getOrCreateInvoicesSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(INVOICES_SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(INVOICES_SHEET_NAME);\n      initializeInvoicesSheet(sheet);\n    }\n\n    return sheet;\n  }\n\n  /**\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç —Å—á–µ—Ç–æ–≤\n   */\n  function initializeInvoicesSheet(sheet) {\n    const headers = [\n      '–ù–æ–º–µ—Ä —Å—á—ë—Ç–∞',\n      '–î–∞—Ç–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è',\n      'ID –∫–ª–∏–µ–Ω—Ç–∞',\n      '–ö–ª–∏–µ–Ω—Ç',\n      '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n      '–°—É–º–º–∞ –±–µ–∑ –ù–î–°',\n      '–ù–î–° 20%',\n      '–ò—Ç–æ–≥–æ',\n      '–°—Ç–∞—Ç—É—Å',\n      '–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã',\n      '–°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã',\n      '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length)\n      .setValues([headers])\n      .setFontWeight('bold')\n      .setBackground('#6d9eeb')\n      .setFontColor('#ffffff');\n\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 120);  // –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞\n    sheet.setColumnWidth(2, 100);  // –î–∞—Ç–∞\n    sheet.setColumnWidth(3, 100);  // ID –∫–ª–∏–µ–Ω—Ç–∞\n    sheet.setColumnWidth(4, 200);  // –ö–ª–∏–µ–Ω—Ç\n    sheet.setColumnWidth(5, 130);  // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    sheet.setColumnWidth(6, 120);  // –°—É–º–º–∞\n    sheet.setColumnWidth(7, 100);  // –ù–î–°\n    sheet.setColumnWidth(8, 120);  // –ò—Ç–æ–≥–æ\n    sheet.setColumnWidth(9, 120);  // –°—Ç–∞—Ç—É—Å\n    sheet.setColumnWidth(10, 100); // –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã\n    sheet.setColumnWidth(11, 100); // –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã\n    sheet.setColumnWidth(12, 250); // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n\n    sheet.setFrozenRows(1);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    sheet.getRange('B2:B').setNumberFormat('dd.MM.yyyy');\n    sheet.getRange('F2:H').setNumberFormat('#,##0 ‚ÇΩ');\n    sheet.getRange('J2:K').setNumberFormat('dd.MM.yyyy');\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞\n    const statusRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['–í—ã—Å—Ç–∞–≤–ª–µ–Ω', '–ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω', '–û–ø–ª–∞—á–µ–Ω', '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω', '–û—Ç–º–µ–Ω—ë–Ω'], true)\n      .setAllowInvalid(false)\n      .build();\n    sheet.getRange('I2:I1000').setDataValidation(statusRule);\n  }\n\n  // ============================================\n  // –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É—á—ë—Ç–∞\n   */\n  function showFinancialReport() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.alert(\n      'üíµ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç',\n      '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?\\n\\n' +\n      '1 - –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä\\n' +\n      '2 - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥\\n' +\n      '3 - –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É\\n' +\n      '4 - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç\\n' +\n      '5 - –ò–º–ø–æ—Ä—Ç –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response !== ui.Button.OK) return;\n\n    const choice = ui.prompt(\n      'üíµ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è (1-5):',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (choice.getSelectedButton() !== ui.Button.OK) return;\n\n    switch (choice.getResponseText().trim()) {\n      case '1':\n        addFee();\n        break;\n      case '2':\n        addExpense();\n        break;\n      case '3':\n        createInvoice();\n        break;\n      case '4':\n        showFinancialSummary();\n        break;\n      case '5':\n        importFromTimeTracking();\n        break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä');\n    }\n  }\n\n  // ============================================\n  // –î–û–ë–ê–í–õ–ï–ù–ò–ï –ì–û–ù–û–†–ê–†–û–í\n  // ============================================\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä\n   */\n  function addFee() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    // –®–∞–≥ 1: –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    const caseResponse = ui.prompt(\n      'üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä - –®–∞–≥ 1/5',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (caseResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const caseNumber = caseResponse.getResponseText().trim();\n\n    if (!caseNumber) {\n      ui.alert('‚ùå –ù–æ–º–µ—Ä –¥–µ–ª–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');\n      return;\n    }\n\n    // –®–∞–≥ 2: –ö–ª–∏–µ–Ω—Ç - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞\n    let clientId = '';\n    let clientName = '';\n\n    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n    let clientsList = [];\n    if (typeof ClientDatabase !== 'undefined') {\n      try {\n        clientsList = ClientDatabase.getAllClients();\n      } catch (e) {\n        Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${e.message}`);\n      }\n    }\n\n    let clientMessage = '–í–≤–µ–¥–∏—Ç–µ ID –∫–ª–∏–µ–Ω—Ç–∞';\n    if (clientsList.length > 0) {\n      clientMessage += ' –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞:\\n\\n';\n      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã—Ö 10 –∫–ª–∏–µ–Ω—Ç–æ–≤\n      const displayClients = clientsList.slice(0, 10);\n      clientMessage += displayClients.map((c, i) =>\n        `${i + 1}. ${c.id} - ${c.name} (${c.type})`\n      ).join('\\n');\n\n      if (clientsList.length > 10) {\n        clientMessage += `\\n\\n...–∏ –µ—â—ë ${clientsList.length - 10} –∫–ª–∏–µ–Ω—Ç–æ–≤`;\n      }\n\n      clientMessage += '\\n\\n–í–≤–µ–¥–∏—Ç–µ ID –∫–ª–∏–µ–Ω—Ç–∞:';\n    } else {\n      clientMessage += ':\\n\\n(–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é \"–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤\")';\n    }\n\n    const clientResponse = ui.prompt(\n      'üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä - –®–∞–≥ 2/5',\n      clientMessage,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (clientResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const inputClientId = clientResponse.getResponseText().trim();\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞\n    if (inputClientId) {\n      if (typeof ClientDatabase !== 'undefined') {\n        const client = ClientDatabase.getClientById(inputClientId);\n        if (client) {\n          clientId = client.id;\n          clientName = client.name;\n        } else {\n          ui.alert(\n            '‚ùå –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω',\n            `–ö–ª–∏–µ–Ω—Ç —Å ID \"${inputClientId}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ.\\n\\n` +\n            '–î–æ–±–∞–≤—å—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é \"–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤\" ‚Üí \"–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞\"',\n            ui.ButtonSet.OK\n          );\n          return;\n        }\n      } else {\n        // –ï—Å–ª–∏ ClientDatabase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π ID\n        clientId = inputClientId;\n        clientName = '–ö–ª–∏–µ–Ω—Ç ' + clientId;\n      }\n    } else {\n      // –ö–ª–∏–µ–Ω—Ç –Ω–µ —É–∫–∞–∑–∞–Ω - –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∫–ª–∏–µ–Ω—Ç–∞\n      clientId = '';\n      clientName = '–ù–µ —É–∫–∞–∑–∞–Ω';\n    }\n\n    // –®–∞–≥ 3: –¢–∏–ø —É—Å–ª—É–≥–∏\n    const typeResponse = ui.prompt(\n      'üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä - –®–∞–≥ 3/5',\n      '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —É—Å–ª—É–≥–∏:\\n\\n' +\n      '1 - –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\\n' +\n      '2 - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\\n' +\n      '3 - –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Å—É–¥–µ\\n' +\n      '4 - –ê–±–æ–Ω–µ–Ω—Ç—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ\\n' +\n      '5 - –ü—Ä–æ—á–µ–µ',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (typeResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const typeChoice = typeResponse.getResponseText().trim();\n    let serviceType;\n\n    switch (typeChoice) {\n      case '1': serviceType = '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'; break;\n      case '2': serviceType = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'; break;\n      case '3': serviceType = '–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Å—É–¥–µ'; break;\n      case '4': serviceType = '–ê–±–æ–Ω–µ–Ω—Ç—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ'; break;\n      case '5': serviceType = '–ü—Ä–æ—á–µ–µ'; break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —É—Å–ª—É–≥–∏');\n        return;\n    }\n\n    // –®–∞–≥ 4: –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—É–º–º–∞\n    const descResponse = ui.prompt(\n      'üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä - –®–∞–≥ 4/5',\n      '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (descResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const description = descResponse.getResponseText().trim() || serviceType;\n\n    // –®–∞–≥ 5: –°—É–º–º–∞\n    const amountResponse = ui.prompt(\n      'üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä - –®–∞–≥ 5/5',\n      '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (–±–µ–∑ –ù–î–°) –≤ —Ä—É–±–ª—è—Ö:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (amountResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const amount = parseFloat(amountResponse.getResponseText().replace(/\\s/g, '').replace(',', '.'));\n\n    if (isNaN(amount) || amount <= 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞');\n      return;\n    }\n\n    // –†–∞—Å—á—ë—Ç –ù–î–°\n    const vat = amount * 0.20;\n    const total = amount + vat;\n\n    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID\n    const sheet = getOrCreateFeesSheet();\n    const lastRow = sheet.getLastRow();\n    const feeId = `FEE-${String(lastRow).padStart(5, '0')}`;\n\n    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏\n    const now = new Date();\n\n    sheet.appendRow([\n      feeId,\n      now,\n      caseNumber,\n      clientId,\n      clientName,\n      serviceType,\n      description,\n      amount,\n      vat,\n      total,\n      '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ',\n      '',\n      ''\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const newRow = sheet.getLastRow();\n    sheet.getRange(newRow, 2).setNumberFormat('dd.MM.yyyy');\n    sheet.getRange(newRow, 8, 1, 3).setNumberFormat('#,##0 ‚ÇΩ');\n\n    ui.alert(\n      '‚úÖ –ì–æ–Ω–æ—Ä–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!',\n      `ID: ${feeId}\\n` +\n      `–î–µ–ª–æ: ${caseNumber}\\n` +\n      `–£—Å–ª—É–≥–∞: ${serviceType}\\n` +\n      `–°—É–º–º–∞: ${amount.toFixed(2)} ‚ÇΩ\\n` +\n      `–ù–î–° 20%: ${vat.toFixed(2)} ‚ÇΩ\\n` +\n      `–ò—Ç–æ–≥–æ: ${total.toFixed(2)} ‚ÇΩ`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('FinancialManager', `–î–æ–±–∞–≤–ª–µ–Ω –≥–æ–Ω–æ—Ä–∞—Ä ${feeId} –Ω–∞ —Å—É–º–º—É ${total.toFixed(2)} ‚ÇΩ`);\n  }\n\n  // ============================================\n  // –î–û–ë–ê–í–õ–ï–ù–ò–ï –†–ê–°–•–û–î–û–í\n  // ============================================\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥\n   */\n  function addExpense() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    // –®–∞–≥ 1: –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    const caseResponse = ui.prompt(\n      'üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ - –®–∞–≥ 1/4',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (caseResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const caseNumber = caseResponse.getResponseText().trim();\n\n    // –®–∞–≥ 2: –ö–∞—Ç–µ–≥–æ—Ä–∏—è\n    const categoryResponse = ui.prompt(\n      'üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ - –®–∞–≥ 2/4',\n      '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:\\n\\n' +\n      '1 - –ì–æ—Å–ø–æ—à–ª–∏–Ω–∞\\n' +\n      '2 - –ù–æ—Ç–∞—Ä–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏\\n' +\n      '3 - –≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞\\n' +\n      '4 - –ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω—ã–µ\\n' +\n      '5 - –ü–æ—á—Ç–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã\\n' +\n      '6 - –ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è\\n' +\n      '7 - –ü—Ä–æ—á–µ–µ',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (categoryResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const categoryChoice = categoryResponse.getResponseText().trim();\n    let category;\n\n    switch (categoryChoice) {\n      case '1': category = '–ì–æ—Å–ø–æ—à–ª–∏–Ω–∞'; break;\n      case '2': category = '–ù–æ—Ç–∞—Ä–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏'; break;\n      case '3': category = '–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞'; break;\n      case '4': category = '–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω—ã–µ'; break;\n      case '5': category = '–ü–æ—á—Ç–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã'; break;\n      case '6': category = '–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è'; break;\n      case '7': category = '–ü—Ä–æ—á–µ–µ'; break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è');\n        return;\n    }\n\n    // –®–∞–≥ 3: –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—É–º–º–∞\n    const descResponse = ui.prompt(\n      'üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ - –®–∞–≥ 3/4',\n      '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (descResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const description = descResponse.getResponseText().trim() || category;\n\n    // –®–∞–≥ 4: –°—É–º–º–∞\n    const amountResponse = ui.prompt(\n      'üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ - –®–∞–≥ 4/4',\n      '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (amountResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const amount = parseFloat(amountResponse.getResponseText().replace(/\\s/g, '').replace(',', '.'));\n\n    if (isNaN(amount) || amount <= 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞');\n      return;\n    }\n\n    // –í–æ–ø—Ä–æ—Å –æ –≤–æ–∑–º–µ—â–µ–Ω–∏–∏\n    const refundResponse = ui.alert(\n      'üí∏ –í–æ–∑–º–µ—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–º',\n      '–≠—Ç–æ—Ç —Ä–∞—Å—Ö–æ–¥ –±—É–¥–µ—Ç –≤–æ–∑–º–µ—â—ë–Ω –∫–ª–∏–µ–Ω—Ç–æ–º?',\n      ui.ButtonSet.YES_NO\n    );\n\n    const refundable = refundResponse === ui.Button.YES;\n\n    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID\n    const sheet = getOrCreateExpensesSheet();\n    const lastRow = sheet.getLastRow();\n    const expenseId = `EXP-${String(lastRow).padStart(5, '0')}`;\n\n    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏\n    const now = new Date();\n\n    sheet.appendRow([\n      expenseId,\n      now,\n      caseNumber,\n      category,\n      description,\n      amount,\n      refundable,\n      refundable ? '–ù–µ –≤–æ–∑–º–µ—â–µ–Ω–æ' : '',\n      '',\n      ''\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const newRow = sheet.getLastRow();\n    sheet.getRange(newRow, 2).setNumberFormat('dd.MM.yyyy');\n    sheet.getRange(newRow, 6).setNumberFormat('#,##0 ‚ÇΩ');\n\n    ui.alert(\n      '‚úÖ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!',\n      `ID: ${expenseId}\\n` +\n      `–î–µ–ª–æ: ${caseNumber}\\n` +\n      `–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}\\n` +\n      `–°—É–º–º–∞: ${amount.toFixed(2)} ‚ÇΩ\\n` +\n      `–í–æ–∑–º–µ—â–∞–µ—Ç—Å—è: ${refundable ? '–î–∞' : '–ù–µ—Ç'}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('FinancialManager', `–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—Ö–æ–¥ ${expenseId} –Ω–∞ —Å—É–º–º—É ${amount.toFixed(2)} ‚ÇΩ`);\n  }\n\n  // ============================================\n  // –°–û–ó–î–ê–ù–ò–ï –°–ß–ï–¢–û–í\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #2: –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É\n   */\n  function createInvoice() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateInvoicesSheet();\n\n    // –®–∞–≥ 1: –í—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞\n    let clientId = '';\n    let clientName = '';\n    let clientsList = [];\n\n    if (typeof ClientDatabase !== 'undefined') {\n      try {\n        clientsList = ClientDatabase.getAllClients();\n      } catch (e) {\n        Logger.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${e.message}`);\n      }\n    }\n\n    let clientMessage = '–í–≤–µ–¥–∏—Ç–µ ID –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Å—á–µ—Ç–∞';\n    if (clientsList.length > 0) {\n      clientMessage += ':\\n\\n';\n      const displayClients = clientsList.slice(0, 10);\n      clientMessage += displayClients.map((c, i) =>\n        `${i + 1}. ${c.id} - ${c.name}`\n      ).join('\\n');\n      if (clientsList.length > 10) {\n        clientMessage += `\\n\\n...–∏ –µ—â—ë ${clientsList.length - 10} –∫–ª–∏–µ–Ω—Ç–æ–≤`;\n      }\n      clientMessage += '\\n\\n–í–≤–µ–¥–∏—Ç–µ ID:';\n    }\n\n    const clientResponse = ui.prompt(\n      'üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞ - –®–∞–≥ 1/4',\n      clientMessage,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (clientResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const inputClientId = clientResponse.getResponseText().trim();\n    if (!inputClientId) {\n      ui.alert('‚ùå ID –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');\n      return;\n    }\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞\n    if (typeof ClientDatabase !== 'undefined') {\n      const client = ClientDatabase.getClientById(inputClientId);\n      if (client) {\n        clientId = client.id;\n        clientName = client.name;\n      } else {\n        ui.alert('‚ùå –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', `–ö–ª–∏–µ–Ω—Ç —Å ID \"${inputClientId}\" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ.`, ui.ButtonSet.OK);\n        return;\n      }\n    } else {\n      clientId = inputClientId;\n      clientName = '–ö–ª–∏–µ–Ω—Ç ' + clientId;\n    }\n\n    // –®–∞–≥ 2: –ù–æ–º–µ—Ä –¥–µ–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n    const caseResponse = ui.prompt(\n      'üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞ - –®–∞–≥ 2/4',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞ (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º):',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (caseResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const caseNumber = caseResponse.getResponseText().trim();\n\n    // –®–∞–≥ 3: –°—É–º–º–∞\n    const amountResponse = ui.prompt(\n      'üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞ - –®–∞–≥ 3/4',\n      '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —Å—á–µ—Ç–∞ (–±–µ–∑ –ù–î–°) –≤ —Ä—É–±–ª—è—Ö:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (amountResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const amount = parseFloat(amountResponse.getResponseText().replace(/\\s/g, '').replace(',', '.'));\n\n    if (isNaN(amount) || amount <= 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞');\n      return;\n    }\n\n    // –®–∞–≥ 4: –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥\n    const descResponse = ui.prompt(\n      'üìÑ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞ - –®–∞–≥ 4/4',\n      '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (descResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const description = descResponse.getResponseText().trim() || '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏';\n\n    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–∞\n    const lastRow = sheet.getLastRow();\n    const invoiceNumber = `–°–ß-${new Date().getFullYear()}-${String(lastRow).padStart(4, '0')}`;\n\n    // –†–∞—Å—á–µ—Ç –ù–î–° –∏ –∏—Ç–æ–≥–æ\n    const vat = amount * 0.20;\n    const totalWithVat = amount + vat;\n\n    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏\n    const now = new Date();\n\n    sheet.appendRow([\n      invoiceNumber,\n      now,\n      clientId,\n      clientName,\n      caseNumber,\n      description,\n      amount,\n      vat,\n      totalWithVat,\n      '–ù–µ –æ–ø–ª–∞—á–µ–Ω',\n      '',\n      ''\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const newRow = sheet.getLastRow();\n    sheet.getRange(newRow, 2).setNumberFormat('dd.MM.yyyy');\n    sheet.getRange(newRow, 7, 1, 3).setNumberFormat('#,##0 ‚ÇΩ');\n\n    ui.alert(\n      '‚úÖ –°—á—ë—Ç —Å–æ–∑–¥–∞–Ω!',\n      `–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞: ${invoiceNumber}\\n` +\n      `–ö–ª–∏–µ–Ω—Ç: ${clientName}\\n` +\n      `–°—É–º–º–∞ –±–µ–∑ –ù–î–°: ${amount.toFixed(2)} ‚ÇΩ\\n` +\n      `–ù–î–° 20%: ${vat.toFixed(2)} ‚ÇΩ\\n` +\n      `–ò—Ç–æ–≥–æ: ${totalWithVat.toFixed(2)} ‚ÇΩ\\n\\n` +\n      `–°—á–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ª–∏—Å—Ç \"${INVOICES_SHEET_NAME}\"`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('FinancialManager', `–°–æ–∑–¥–∞–Ω —Å—á–µ—Ç ${invoiceNumber} –Ω–∞ —Å—É–º–º—É ${totalWithVat.toFixed(2)} ‚ÇΩ`);\n  }\n\n  // ============================================\n  // –§–ò–ù–ê–ù–°–û–í–´–ï –û–¢–ß–Å–¢–´\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é —Å–≤–æ–¥–∫—É\n   */\n  function showFinancialSummary() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤\n    const feesSheet = getOrCreateFeesSheet();\n    const expensesSheet = getOrCreateExpensesSheet();\n\n    const feesData = feesSheet.getDataRange().getValues();\n    const expensesData = expensesSheet.getDataRange().getValues();\n\n    let totalFees = 0;\n    let paidFees = 0;\n    let unpaidFees = 0;\n\n    let totalExpenses = 0;\n    let refundableExpenses = 0;\n    let refundedExpenses = 0;\n\n    // –ê–Ω–∞–ª–∏–∑ –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤\n    for (let i = 1; i < feesData.length; i++) {\n      const row = feesData[i];\n      const amount = parseFloat(row[9]) || 0;  // –ò—Ç–æ–≥–æ —Å –ù–î–°\n      const status = row[10];\n\n      totalFees += amount;\n\n      if (status === '–û–ø–ª–∞—á–µ–Ω–æ') {\n        paidFees += amount;\n      } else {\n        unpaidFees += amount;\n      }\n    }\n\n    // –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–¥–æ–≤\n    for (let i = 1; i < expensesData.length; i++) {\n      const row = expensesData[i];\n      const amount = parseFloat(row[5]) || 0;\n      const refundable = row[6] === true;\n      const refundStatus = row[7];\n\n      totalExpenses += amount;\n\n      if (refundable) {\n        refundableExpenses += amount;\n        if (refundStatus === '–í–æ–∑–º–µ—â–µ–Ω–æ') {\n          refundedExpenses += amount;\n        }\n      }\n    }\n\n    // –†–∞—Å—á—ë—Ç —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏\n    const netProfit = paidFees - totalExpenses + refundedExpenses;\n\n    const message =\n      `üí∞ –ì–û–ù–û–†–ê–†–´:\\n` +\n      `–í—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ: ${totalFees.toFixed(2)} ‚ÇΩ\\n` +\n      `‚Ä¢ –û–ø–ª–∞—á–µ–Ω–æ: ${paidFees.toFixed(2)} ‚ÇΩ\\n` +\n      `‚Ä¢ –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ: ${unpaidFees.toFixed(2)} ‚ÇΩ\\n\\n` +\n      `üí∏ –†–ê–°–•–û–î–´:\\n` +\n      `–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–æ–≤: ${totalExpenses.toFixed(2)} ‚ÇΩ\\n` +\n      `‚Ä¢ –í–æ–∑–º–µ—â–∞–µ–º—ã–µ: ${refundableExpenses.toFixed(2)} ‚ÇΩ\\n` +\n      `‚Ä¢ –í–æ–∑–º–µ—â–µ–Ω–æ: ${refundedExpenses.toFixed(2)} ‚ÇΩ\\n\\n` +\n      `üìä –ò–¢–û–ì–û:\\n` +\n      `–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${netProfit.toFixed(2)} ‚ÇΩ\\n` +\n      `–î–µ–±–∏—Ç–æ—Ä–∫–∞: ${unpaidFees.toFixed(2)} ‚ÇΩ\\n` +\n      `–ö –≤–æ–∑–º–µ—â–µ–Ω–∏—é: ${(refundableExpenses - refundedExpenses).toFixed(2)} ‚ÇΩ`;\n\n    ui.alert('üíµ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞', message, ui.ButtonSet.OK);\n  }\n\n  // ============================================\n  // –ò–ú–ü–û–†–¢ –ò–ó –£–ß–Å–¢–ê –í–†–ï–ú–ï–ù–ò\n  // ============================================\n\n  /**\n   * –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function importFromTimeTracking() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    if (typeof TimeTracker === 'undefined') {\n      ui.alert('‚ùå –ú–æ–¥—É–ª—å —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    const timeSheet = TimeTracker.getOrCreateSheet();\n    const timeData = timeSheet.getDataRange().getValues();\n\n    const feesSheet = getOrCreateFeesSheet();\n    let importedCount = 0;\n\n    // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–µ–ª–∞–º\n    const byCases = {};\n\n    for (let i = 1; i < timeData.length; i++) {\n      const row = timeData[i];\n      const caseNumber = row[3];\n      const status = row[8];\n      const cost = parseFloat(row[7]) || 0;\n\n      // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏\n      if (status === '–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ' && cost > 0) {\n        if (!byCases[caseNumber]) {\n          byCases[caseNumber] = {\n            totalCost: 0,\n            hours: 0,\n            descriptions: []\n          };\n        }\n\n        byCases[caseNumber].totalCost += cost;\n        byCases[caseNumber].hours += parseFloat(row[5]) || 0;\n        byCases[caseNumber].descriptions.push(row[4]);\n      }\n    }\n\n    // –°–æ–∑–¥–∞–Ω–∏–µ –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤\n    const now = new Date();\n\n    Object.keys(byCases).forEach(caseNumber => {\n      const caseData = byCases[caseNumber];\n      const amount = caseData.totalCost / 1.20;  // –£–±—Ä–∞—Ç—å –ù–î–°\n      const vat = amount * 0.20;\n      const total = amount + vat;\n\n      const feeId = `FEE-${String(feesSheet.getLastRow()).padStart(5, '0')}`;\n      const description = `–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏ (${caseData.hours.toFixed(2)} —á)`;\n\n      feesSheet.appendRow([\n        feeId,\n        now,\n        caseNumber,\n        '',  // ID –∫–ª–∏–µ–Ω—Ç–∞\n        '',  // –ö–ª–∏–µ–Ω—Ç\n        '–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ –≤ —Å—É–¥–µ',\n        description,\n        amount,\n        vat,\n        total,\n        '–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ',\n        '',\n        `–ò–º–ø–æ—Ä—Ç –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏`\n      ]);\n\n      const newRow = feesSheet.getLastRow();\n      feesSheet.getRange(newRow, 2).setNumberFormat('dd.MM.yyyy');\n      feesSheet.getRange(newRow, 8, 1, 3).setNumberFormat('#,##0 ‚ÇΩ');\n\n      importedCount++;\n    });\n\n    ui.alert(\n      '‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!',\n      `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤: ${importedCount}\\n\\n` +\n      `–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ª–∏—Å—Ç \"${FEES_SHEET_NAME}\"`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('FinancialManager', `–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${importedCount} –≥–æ–Ω–æ—Ä–∞—Ä–æ–≤ –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏`);\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    showFinancialReport: showFinancialReport,\n    addFee: addFee,\n    addExpense: addExpense,\n    createInvoice: createInvoice,\n    showFinancialSummary: showFinancialSummary,\n    importFromTimeTracking: importFromTimeTracking,\n    getOrCreateFeesSheet: getOrCreateFeesSheet,\n    getOrCreateExpensesSheet: getOrCreateExpensesSheet,\n    getOrCreateInvoicesSheet: getOrCreateInvoicesSheet\n  };\n})();\n"},{"name":"HearingNotifier.gs","content":"/**\n * HearingNotifier.gs\n *\n * –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö\n * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –≥—Ä–∞—Ñ–∏–∫—É\n * - –†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n * - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞\n */\n\nvar HearingNotifier = (function() {\n  'use strict';\n\n  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n  const DEFAULT_SCHEDULE = {\n    days: [7, 3, 1],        // –ó–∞ 7, 3 –∏ 1 –¥–µ–Ω—å\n    hours: [4, 2, 1]        // –ó–∞ 4, 2 –∏ 1 —á–∞—Å\n  };\n\n  // ============================================\n  // –ü–û–õ–£–ß–ï–ù–ò–ï –ò –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ö\n  // ============================================\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function getNotificationSchedule() {\n    const props = PropertiesService.getScriptProperties();\n    const saved = props.getProperty('HEARING_NOTIFICATION_SCHEDULE');\n\n    if (saved) {\n      try {\n        return JSON.parse(saved);\n      } catch (e) {\n        AppLogger.warn('HearingNotifier', '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ');\n      }\n    }\n\n    return DEFAULT_SCHEDULE;\n  }\n\n  /**\n   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function saveNotificationSchedule(schedule) {\n    const props = PropertiesService.getScriptProperties();\n    props.setProperty('HEARING_NOTIFICATION_SCHEDULE', JSON.stringify(schedule));\n    AppLogger.info('HearingNotifier', '–ì—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—ë–Ω', schedule);\n  }\n\n  // ============================================\n  // –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô\n  // ============================================\n\n  /**\n   * –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è —Ç—Ä–µ–±—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function findUpcomingHearings() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const schedule = getNotificationSchedule();\n    const hearings = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[0];\n      const hearingDate = row[16]; // –°—Ç–æ–ª–±–µ—Ü Q\n\n      if (hearingDate && hearingDate instanceof Date && hearingDate >= now) {\n        const hoursUntil = (hearingDate - now) / (1000 * 60 * 60);\n        const daysUntil = Math.floor(hoursUntil / 24);\n\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n        const needsNotification = checkIfNeedsNotification(daysUntil, hoursUntil, schedule);\n\n        if (needsNotification) {\n          hearings.push({\n            caseNumber: caseNumber,\n            date: hearingDate,\n            court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n            plaintiff: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n            defendant: row[7] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n            priority: row[5] || '',            // –°—Ç–æ–ª–±–µ—Ü F - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n            columnR: row[17] || '',            // –°—Ç–æ–ª–±–µ—Ü R\n            columnS: row[18] || '',            // –°—Ç–æ–ª–±–µ—Ü S\n            columnT: row[19] || '',            // –°—Ç–æ–ª–±–µ—Ü T\n            columnU: row[20] || '',            // –°—Ç–æ–ª–±–µ—Ü U\n            columnV: row[21] || '',            // –°—Ç–æ–ª–±–µ—Ü V\n            columnW: row[22] || '',            // –°—Ç–æ–ª–±–µ—Ü W\n            columnX: row[23] || '',            // –°—Ç–æ–ª–±–µ—Ü X\n            daysUntil: daysUntil,\n            hoursUntil: hoursUntil,\n            notificationType: needsNotification\n          });\n        }\n      }\n    }\n\n    return hearings;\n  }\n\n  /**\n   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n   */\n  function checkIfNeedsNotification(daysUntil, hoursUntil, schedule) {\n    const now = new Date();\n    const currentHour = now.getHours();\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–Ω–µ–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ 9:00)\n    if (currentHour === 9) {\n      for (const days of schedule.days) {\n        if (Math.abs(daysUntil - days) < 0.5) { // –í –ø—Ä–µ–¥–µ–ª–∞—Ö 12 —á–∞—Å–æ–≤\n          return `${days}_days`;\n        }\n      }\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—á–∞—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n    for (const hours of schedule.hours) {\n      if (hoursUntil >= hours - 0.5 && hoursUntil <= hours + 0.5) {\n        return `${hours}_hours`;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞)\n   */\n  function sendScheduledNotifications() {\n    try {\n      const hearings = findUpcomingHearings();\n\n      if (hearings.length === 0) {\n        AppLogger.info('HearingNotifier', '–ù–µ—Ç –∑–∞—Å–µ–¥–∞–Ω–∏–π —Ç—Ä–µ–±—É—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');\n        return;\n      }\n\n      const users = UserManager.getAllUsers();\n      let sentCount = 0;\n\n      for (const hearing of hearings) {\n        // –ù–∞–π—Ç–∏ –≤—Å–µ—Ö –∫–æ–º—É –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å\n        for (const email in users) {\n          const user = users[email];\n\n          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ—Å–ª–∏:\n          // 1. –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–∫–ª—é—á–µ–Ω—ã Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n          // 2. –≠—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç –ò–õ–ò —ç—Ç–æ admin/manager\n          if (user.telegram_chat_id && user.notification_preferences?.telegram) {\n            const shouldSend =\n              user.role === 'ADMIN' ||\n              user.role === 'MANAGER' ||\n              (user.assigned_cases && user.assigned_cases.includes(hearing.caseNumber));\n\n            if (shouldSend) {\n              sendHearingNotification(user, hearing);\n              sentCount++;\n            }\n          }\n        }\n      }\n\n      AppLogger.info('HearingNotifier', `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${sentCount} —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ ${hearings.length} –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö`);\n\n    } catch (error) {\n      AppLogger.error('HearingNotifier', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', {\n        error: error.message,\n        stack: error.stack\n      });\n    }\n  }\n\n  /**\n   * –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n   * —Å —É—á–µ—Ç–æ–º —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏\n   */\n  function formatAdditionalInfo(hearing) {\n    let additionalInfo = '';\n\n    // 1. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (F) - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω\n    if (hearing.priority) {\n      additionalInfo += `\\nüî• –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${hearing.priority}`;\n    }\n\n    // 2. –°—Ç–æ–ª–±–µ—Ü R - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω\n    if (hearing.columnR) {\n      additionalInfo += `\\nüìå –°—Ç–æ–ª–±–µ—Ü R: ${hearing.columnR}`;\n    }\n\n    // 3. –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è T, V, X\n    const hasS = !!hearing.columnS;\n    const hasU = !!hearing.columnU;\n    const hasW = !!hearing.columnW;\n\n    if (hasS && !hasU && !hasW && hearing.columnT) {\n      // –ï—Å–ª–∏ S –∑–∞–ø–æ–ª–Ω–µ–Ω, U –∏ W –ø—É—Å—Ç—ã ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ T\n      additionalInfo += `\\nüìÑ –°—Ç–æ–ª–±–µ—Ü T: ${hearing.columnT}`;\n    } else if (hasS && hasU && !hasW && hearing.columnV) {\n      // –ï—Å–ª–∏ S –∏ U –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, W –ø—É—Å—Ç–æ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ V\n      additionalInfo += `\\nüìÑ –°—Ç–æ–ª–±–µ—Ü V: ${hearing.columnV}`;\n    } else if (hasS && hasU && hasW && hearing.columnX) {\n      // –ï—Å–ª–∏ S, U –∏ W –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ X\n      additionalInfo += `\\nüìÑ –°—Ç–æ–ª–±–µ—Ü X: ${hearing.columnX}`;\n    }\n\n    return additionalInfo;\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞—Å–µ–¥–∞–Ω–∏–∏\n   */\n  function sendHearingNotification(user, hearing) {\n    const dateStr = Utilities.formatDate(hearing.date, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n\n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n    let timeInfo = '';\n    if (hearing.notificationType.includes('days')) {\n      const days = parseInt(hearing.notificationType);\n      timeInfo = `—á–µ—Ä–µ–∑ ${days} ${getDaysWord(days)}`;\n    } else if (hearing.notificationType.includes('hours')) {\n      const hours = parseInt(hearing.notificationType);\n      timeInfo = `—á–µ—Ä–µ–∑ ${hours} ${getHoursWord(hours)}`;\n    }\n\n    // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n    const additionalInfo = formatAdditionalInfo(hearing);\n\n    const message =\n      `‚öñÔ∏è *–ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –û –ó–ê–°–ï–î–ê–ù–ò–ò*\\n\\n` +\n      `üìÖ –î–∞—Ç–∞: ${dateStr}\\n` +\n      `‚è∞ ${timeInfo}\\n\\n` +\n      `üìã –î–µ–ª–æ: ${hearing.caseNumber}\\n` +\n      `üèõÔ∏è –°—É–¥: ${hearing.court}\\n\\n` +\n      `üë§ –ò—Å—Ç–µ—Ü: ${hearing.plaintiff}\\n` +\n      `üë§ –û—Ç–≤–µ—Ç—á–∏–∫: ${hearing.defendant}` +\n      additionalInfo;\n\n    TelegramNotifier.sendToUser(user, message, 'Markdown');\n  }\n\n  /**\n   * –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ \"–¥–µ–Ω—å\"\n   */\n  function getDaysWord(days) {\n    if (days === 1) return '–¥–µ–Ω—å';\n    if (days >= 2 && days <= 4) return '–¥–Ω—è';\n    return '–¥–Ω–µ–π';\n  }\n\n  /**\n   * –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ \"—á–∞—Å\"\n   */\n  function getHoursWord(hours) {\n    if (hours === 1) return '—á–∞—Å';\n    if (hours >= 2 && hours <= 4) return '—á–∞—Å–∞';\n    return '—á–∞—Å–æ–≤';\n  }\n\n  // ============================================\n  // –†–£–ß–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô\n  // ============================================\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ –º–µ–Ω—é)\n   */\n  function sendManualNotifications() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    const confirm = ui.alert(\n      'üì± –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',\n      '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö?\\n\\n' +\n      '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º Telegram.',\n      ui.ButtonSet.YES_NO\n    );\n\n    if (confirm !== ui.Button.YES) return;\n\n    try {\n      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è\n      const ss = SpreadsheetApp.getActiveSpreadsheet();\n      const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n      const data = sheet.getDataRange().getValues();\n\n      const now = new Date();\n      const hearings = [];\n\n      for (let i = 1; i < data.length; i++) {\n        const row = data[i];\n        const hearingDate = row[16];\n\n        if (hearingDate && hearingDate instanceof Date && hearingDate >= now) {\n          const daysUntil = Math.floor((hearingDate - now) / (1000 * 60 * 60 * 24));\n\n          if (daysUntil <= 30) { // –¢–æ–ª—å–∫–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π\n            hearings.push({\n              caseNumber: row[0],\n              date: hearingDate,\n              court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n              plaintiff: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n              defendant: row[7] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n              priority: row[5] || '',            // –°—Ç–æ–ª–±–µ—Ü F - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n              columnR: row[17] || '',            // –°—Ç–æ–ª–±–µ—Ü R\n              columnS: row[18] || '',            // –°—Ç–æ–ª–±–µ—Ü S\n              columnT: row[19] || '',            // –°—Ç–æ–ª–±–µ—Ü T\n              columnU: row[20] || '',            // –°—Ç–æ–ª–±–µ—Ü U\n              columnV: row[21] || '',            // –°—Ç–æ–ª–±–µ—Ü V\n              columnW: row[22] || '',            // –°—Ç–æ–ª–±–µ—Ü W\n              columnX: row[23] || '',            // –°—Ç–æ–ª–±–µ—Ü X\n              daysUntil: daysUntil,\n              notificationType: 'manual'\n            });\n          }\n        }\n      }\n\n      if (hearings.length === 0) {\n        ui.alert('‚ÑπÔ∏è –ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π');\n        return;\n      }\n\n      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n      const users = UserManager.getAllUsers();\n      let sentCount = 0;\n\n      for (const hearing of hearings) {\n        for (const email in users) {\n          const user = users[email];\n\n          if (user.telegram_chat_id && user.notification_preferences?.telegram) {\n            const shouldSend =\n              user.role === 'ADMIN' ||\n              user.role === 'MANAGER' ||\n              (user.assigned_cases && user.assigned_cases.includes(hearing.caseNumber));\n\n            if (shouldSend) {\n              sendHearingNotification(user, hearing);\n              sentCount++;\n            }\n          }\n        }\n      }\n\n      ui.alert(\n        '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!',\n        `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${sentCount} —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\\n` +\n        `–û –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö: ${hearings.length}\\n` +\n        `–í —Ç–µ—á–µ–Ω–∏–µ: 30 –¥–Ω–µ–π`,\n        ui.ButtonSet.OK\n      );\n\n      AppLogger.info('HearingNotifier', `–†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: ${sentCount} —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`);\n\n    } catch (error) {\n      AppLogger.error('HearingNotifier', '–û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏', { error: error.message });\n      ui.alert('‚ùå –û—à–∏–±–∫–∞', `–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n${error.message}`, ui.ButtonSet.OK);\n    }\n  }\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ê –ì–†–ê–§–ò–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô\n  // ============================================\n\n  /**\n   * –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function configureNotificationSchedule() {\n    if (!checkPermission('all')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    while (true) {\n      const schedule = getNotificationSchedule();\n\n      const response = ui.alert(\n        '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',\n        `üìÖ –î–Ω–µ–≤–Ω—ã–µ: –∑–∞ ${schedule.days.join(', ')} –¥–Ω.\\n` +\n        `‚è∞ –ü–æ—á–∞—Å–æ–≤—ã–µ: –∑–∞ ${schedule.hours.join(', ')} —á.\\n\\n` +\n        `–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?\\n\\n` +\n        `‚Ä¢ –î–ê - –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\\n` +\n        `‚Ä¢ –ù–ï–¢ - –í—ã—Ö–æ–¥\\n` +\n        `‚Ä¢ –û–¢–ú–ï–ù–ê - –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ`,\n        ui.ButtonSet.YES_NO_CANCEL\n      );\n\n      if (response === ui.Button.YES) {\n        showInteractiveScheduleMenu(ui);\n      } else if (response === ui.Button.CANCEL) {\n        saveNotificationSchedule(DEFAULT_SCHEDULE);\n        ui.alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ!');\n        return;\n      } else {\n        return;\n      }\n    }\n  }\n\n  /**\n   * –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞\n   */\n  function showInteractiveScheduleMenu(ui) {\n    while (true) {\n      const schedule = getNotificationSchedule();\n\n      const choice = ui.prompt(\n        '‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞',\n        `–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:\\n` +\n        `üìÖ –î–Ω–∏: ${schedule.days.join(', ')}\\n` +\n        `‚è∞ –ß–∞—Å—ã: ${schedule.hours.join(', ')}\\n\\n` +\n        `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\\n` +\n        `1 - –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å\\n` +\n        `2 - –£–¥–∞–ª–∏—Ç—å –¥–µ–Ω—å\\n` +\n        `3 - –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å\\n` +\n        `4 - –£–¥–∞–ª–∏—Ç—å —á–∞—Å\\n` +\n        `5 - –†—É—á–Ω–æ–π –≤–≤–æ–¥ (–¥–Ω–∏)\\n` +\n        `6 - –†—É—á–Ω–æ–π –≤–≤–æ–¥ (—á–∞—Å—ã)\\n` +\n        `0 - –ù–∞–∑–∞–¥\\n\\n` +\n        `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:`,\n        ui.ButtonSet.OK_CANCEL\n      );\n\n      if (choice.getSelectedButton() !== ui.Button.OK) return;\n\n      const action = choice.getResponseText().trim();\n\n      switch (action) {\n        case '1':\n          addDay(ui, schedule);\n          break;\n        case '2':\n          removeDay(ui, schedule);\n          break;\n        case '3':\n          addHour(ui, schedule);\n          break;\n        case '4':\n          removeHour(ui, schedule);\n          break;\n        case '5':\n          manualInputDays(ui, schedule);\n          break;\n        case '6':\n          manualInputHours(ui, schedule);\n          break;\n        case '0':\n          return;\n        default:\n          ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!');\n      }\n    }\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å –≤ –≥—Ä–∞—Ñ–∏–∫\n   */\n  function addDay(ui, schedule) {\n    const response = ui.prompt(\n      '‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å',\n      `–¢–µ–∫—É—â–∏–µ –¥–Ω–∏: ${schedule.days.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: 14):`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const day = parseInt(response.getResponseText().trim());\n\n    if (isNaN(day) || day <= 0) {\n      ui.alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ!');\n      return;\n    }\n\n    if (schedule.days.includes(day)) {\n      ui.alert(`‚ö†Ô∏è –î–µ–Ω—å ${day} —É–∂–µ –µ—Å—Ç—å –≤ –≥—Ä–∞—Ñ–∏–∫–µ!`);\n      return;\n    }\n\n    schedule.days.push(day);\n    schedule.days.sort((a, b) => b - a);\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!', `–î–µ–Ω—å ${day} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä–∞—Ñ–∏–∫`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –£–¥–∞–ª–∏—Ç—å –¥–µ–Ω—å –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞\n   */\n  function removeDay(ui, schedule) {\n    if (schedule.days.length === 0) {\n      ui.alert('‚ÑπÔ∏è –°–ø–∏—Å–æ–∫ –¥–Ω–µ–π –ø—É—Å—Ç!');\n      return;\n    }\n\n    const response = ui.prompt(\n      '‚ûñ –£–¥–∞–ª–∏—Ç—å –¥–µ–Ω—å',\n      `–¢–µ–∫—É—â–∏–µ –¥–Ω–∏: ${schedule.days.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –¥–µ–Ω—å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const day = parseInt(response.getResponseText().trim());\n    const index = schedule.days.indexOf(day);\n\n    if (index === -1) {\n      ui.alert(`‚ùå –î–µ–Ω—å ${day} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≥—Ä–∞—Ñ–∏–∫–µ!`);\n      return;\n    }\n\n    schedule.days.splice(index, 1);\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –£–¥–∞–ª–µ–Ω–æ!', `–î–µ–Ω—å ${day} —É–¥–∞–ª—ë–Ω –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å –≤ –≥—Ä–∞—Ñ–∏–∫\n   */\n  function addHour(ui, schedule) {\n    const response = ui.prompt(\n      '‚ûï –î–æ–±–∞–≤–∏—Ç—å —á–∞—Å',\n      `–¢–µ–∫—É—â–∏–µ —á–∞—Å—ã: ${schedule.hours.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 6):`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const hour = parseInt(response.getResponseText().trim());\n\n    if (isNaN(hour) || hour <= 0) {\n      ui.alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ!');\n      return;\n    }\n\n    if (schedule.hours.includes(hour)) {\n      ui.alert(`‚ö†Ô∏è –ß–∞—Å ${hour} —É–∂–µ –µ—Å—Ç—å –≤ –≥—Ä–∞—Ñ–∏–∫–µ!`);\n      return;\n    }\n\n    schedule.hours.push(hour);\n    schedule.hours.sort((a, b) => b - a);\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ!', `–ß–∞—Å ${hour} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä–∞—Ñ–∏–∫`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –£–¥–∞–ª–∏—Ç—å —á–∞—Å –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞\n   */\n  function removeHour(ui, schedule) {\n    if (schedule.hours.length === 0) {\n      ui.alert('‚ÑπÔ∏è –°–ø–∏—Å–æ–∫ —á–∞—Å–æ–≤ –ø—É—Å—Ç!');\n      return;\n    }\n\n    const response = ui.prompt(\n      '‚ûñ –£–¥–∞–ª–∏—Ç—å —á–∞—Å',\n      `–¢–µ–∫—É—â–∏–µ —á–∞—Å—ã: ${schedule.hours.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ —á–∞—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const hour = parseInt(response.getResponseText().trim());\n    const index = schedule.hours.indexOf(hour);\n\n    if (index === -1) {\n      ui.alert(`‚ùå –ß–∞—Å ${hour} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –≥—Ä–∞—Ñ–∏–∫–µ!`);\n      return;\n    }\n\n    schedule.hours.splice(index, 1);\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –£–¥–∞–ª–µ–Ω–æ!', `–ß–∞—Å ${hour} —É–¥–∞–ª—ë–Ω –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –†—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–Ω–µ–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)\n   */\n  function manualInputDays(ui, schedule) {\n    const response = ui.prompt(\n      '‚úçÔ∏è –†—É—á–Ω–æ–π –≤–≤–æ–¥ –¥–Ω–µ–π',\n      `–¢–µ–∫—É—â–∏–µ: ${schedule.days.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –¥–Ω–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 14,7,3,1):`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const input = response.getResponseText().trim();\n    const days = input.split(',').map(d => parseInt(d.trim())).filter(d => !isNaN(d) && d > 0);\n\n    if (days.length === 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.');\n      return;\n    }\n\n    schedule.days = [...new Set(days)].sort((a, b) => b - a); // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', `–î–Ω–∏: ${schedule.days.join(', ')}`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –†—É—á–Ω–æ–π –≤–≤–æ–¥ —á–∞—Å–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)\n   */\n  function manualInputHours(ui, schedule) {\n    const response = ui.prompt(\n      '‚úçÔ∏è –†—É—á–Ω–æ–π –≤–≤–æ–¥ —á–∞—Å–æ–≤',\n      `–¢–µ–∫—É—â–∏–µ: ${schedule.hours.join(', ')}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ —á–∞—Å—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 12,6,4,2,1):`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const input = response.getResponseText().trim();\n    const hours = input.split(',').map(h => parseInt(h.trim())).filter(h => !isNaN(h) && h > 0);\n\n    if (hours.length === 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.');\n      return;\n    }\n\n    schedule.hours = [...new Set(hours)].sort((a, b) => b - a); // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã\n    saveNotificationSchedule(schedule);\n\n    ui.alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', `–ß–∞—Å—ã: ${schedule.hours.join(', ')}`, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function showCurrentSchedule() {\n    const ui = SpreadsheetApp.getUi();\n    const schedule = getNotificationSchedule();\n\n    ui.alert(\n      '‚ÑπÔ∏è –¢–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π',\n      `üìÖ –î–Ω–µ–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n` +\n      `   –ó–∞ ${schedule.days.join(', ')} –¥–Ω. (–≤ 9:00)\\n\\n` +\n      `‚è∞ –ü–æ—á–∞—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n` +\n      `   –ó–∞ ${schedule.hours.join(', ')} —á.\\n\\n` +\n      `–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\\n` +\n      `–ú–µ–Ω—é ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`,\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ê –¢–†–ò–ì–ì–ï–†–û–í\n  // ============================================\n\n  /**\n   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function setupHearingNotificationTrigger() {\n    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã\n    const triggers = ScriptApp.getProjectTriggers();\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === 'sendScheduledNotifications') {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä - –∫–∞–∂–¥—ã–π —á–∞—Å\n    ScriptApp.newTrigger('sendScheduledNotifications')\n      .timeBased()\n      .everyHours(1)\n      .create();\n\n    AppLogger.info('HearingNotifier', '–¢—Ä–∏–≥–≥–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–∫–∞–∂–¥—ã–π —á–∞—Å)');\n  }\n\n  // ============================================\n  // –ö–ê–°–¢–û–ú–ù–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ü–û –ö–û–ù–ö–†–ï–¢–ù–û–ú–£ –î–ï–õ–£\n  // ============================================\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –¥–µ–ª—É\n   */\n  function setupCustomCaseNotification() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    // –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const upcomingHearings = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const hearingDate = row[16]; // –°—Ç–æ–ª–±–µ—Ü Q\n\n      if (hearingDate && hearingDate instanceof Date && hearingDate >= now) {\n        upcomingHearings.push({\n          caseNumber: row[0],\n          date: hearingDate,\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          plaintiff: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          defendant: row[7] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          priority: row[5] || '',            // –°—Ç–æ–ª–±–µ—Ü F - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n          columnR: row[17] || '',            // –°—Ç–æ–ª–±–µ—Ü R\n          columnS: row[18] || '',            // –°—Ç–æ–ª–±–µ—Ü S\n          columnT: row[19] || '',            // –°—Ç–æ–ª–±–µ—Ü T\n          columnU: row[20] || '',            // –°—Ç–æ–ª–±–µ—Ü U\n          columnV: row[21] || '',            // –°—Ç–æ–ª–±–µ—Ü V\n          columnW: row[22] || '',            // –°—Ç–æ–ª–±–µ—Ü W\n          columnX: row[23] || '',            // –°—Ç–æ–ª–±–µ—Ü X\n          rowIndex: i + 1\n        });\n      }\n    }\n\n    if (upcomingHearings.length === 0) {\n      ui.alert('‚ÑπÔ∏è –ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');\n      return;\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ\n    upcomingHearings.sort((a, b) => a.date - b.date);\n\n    // –®–∞–≥ 2: –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª –¥–ª—è –≤—ã–±–æ—Ä–∞\n    const casesList = upcomingHearings.slice(0, 20).map((h, i) => {\n      const dateStr = Utilities.formatDate(h.date, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n      return `${i + 1}. ${h.caseNumber} - ${dateStr}\\n   ${h.plaintiff} vs ${h.defendant}`;\n    }).join('\\n\\n');\n\n    const caseResp = ui.prompt(\n      'üîî –ö–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –®–∞–≥ 1/3',\n      `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ª–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n\\n${casesList}\\n\\n` +\n      (upcomingHearings.length > 20 ? `...–∏ –µ—â—ë ${upcomingHearings.length - 20} –¥–µ–ª\\n\\n` : '') +\n      `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞:`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (caseResp.getSelectedButton() !== ui.Button.OK) return;\n\n    const caseIndex = parseInt(caseResp.getResponseText().trim()) - 1;\n\n    if (isNaN(caseIndex) || caseIndex < 0 || caseIndex >= upcomingHearings.length) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä!');\n      return;\n    }\n\n    const selectedCase = upcomingHearings[caseIndex];\n\n    // –®–∞–≥ 3: –í—ã–±–æ—Ä —Ç–∏–ø–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n    const typeResp = ui.prompt(\n      'üîî –ö–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –®–∞–≥ 2/3',\n      `–î–µ–ª–æ: ${selectedCase.caseNumber}\\n` +\n      `–ó–∞—Å–µ–¥–∞–Ω–∏–µ: ${Utilities.formatDate(selectedCase.date, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm')}\\n\\n` +\n      `–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n\\n` +\n      `1 - –ó–∞ N –¥–Ω–µ–π –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è\\n` +\n      `2 - –ó–∞ N —á–∞—Å–æ–≤ –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è\\n` +\n      `3 - –í –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (typeResp.getSelectedButton() !== ui.Button.OK) return;\n\n    const notificationType = typeResp.getResponseText().trim();\n    let notificationDate = null;\n\n    switch (notificationType) {\n      case '1': // –ó–∞ N –¥–Ω–µ–π\n        notificationDate = setupDaysBeforeNotification(ui, selectedCase);\n        break;\n      case '2': // –ó–∞ N —á–∞—Å–æ–≤\n        notificationDate = setupHoursBeforeNotification(ui, selectedCase);\n        break;\n      case '3': // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞\n        notificationDate = setupSpecificDateNotification(ui, selectedCase);\n        break;\n      default:\n        ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!');\n        return;\n    }\n\n    if (!notificationDate) return;\n\n    // –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n    saveCustomNotification(selectedCase, notificationDate);\n\n    // –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä\n    createCustomNotificationTrigger(selectedCase, notificationDate);\n\n    const notifDateStr = Utilities.formatDate(notificationDate, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n\n    ui.alert(\n      '‚úÖ –ö–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!',\n      `–î–µ–ª–æ: ${selectedCase.caseNumber}\\n` +\n      `–ó–∞—Å–µ–¥–∞–Ω–∏–µ: ${Utilities.formatDate(selectedCase.date, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm')}\\n\\n` +\n      `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:\\n${notifDateStr}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('HearingNotifier', `–ö–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –¥–µ–ª–∞ ${selectedCase.caseNumber}`, {\n      notificationDate: notifDateStr\n    });\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ N –¥–Ω–µ–π\n   */\n  function setupDaysBeforeNotification(ui, selectedCase) {\n    const response = ui.prompt(\n      'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ N –¥–Ω–µ–π',\n      `–ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?\\n\\n` +\n      `–ù–∞–ø—Ä–∏–º–µ—Ä: 10 (–∑–∞ 10 –¥–Ω–µ–π)\\n` +\n      `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ 9:00`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return null;\n\n    const days = parseInt(response.getResponseText().trim());\n\n    if (isNaN(days) || days <= 0) {\n      ui.alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ!');\n      return null;\n    }\n\n    const notificationDate = new Date(selectedCase.date);\n    notificationDate.setDate(notificationDate.getDate() - days);\n    notificationDate.setHours(9, 0, 0, 0); // 9:00\n\n    if (notificationDate <= new Date()) {\n      ui.alert('‚ùå –î–∞—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–∂–µ –ø—Ä–æ—à–ª–∞! –í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à–µ –¥–Ω–µ–π.');\n      return null;\n    }\n\n    return notificationDate;\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ N —á–∞—Å–æ–≤\n   */\n  function setupHoursBeforeNotification(ui, selectedCase) {\n    const response = ui.prompt(\n      'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ N —á–∞—Å–æ–≤',\n      `–ó–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?\\n\\n` +\n      `–ù–∞–ø—Ä–∏–º–µ—Ä: 12 (–∑–∞ 12 —á–∞—Å–æ–≤)`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return null;\n\n    const hours = parseInt(response.getResponseText().trim());\n\n    if (isNaN(hours) || hours <= 0) {\n      ui.alert('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ!');\n      return null;\n    }\n\n    const notificationDate = new Date(selectedCase.date);\n    notificationDate.setHours(notificationDate.getHours() - hours);\n\n    if (notificationDate <= new Date()) {\n      ui.alert('‚ùå –î–∞—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–∂–µ –ø—Ä–æ—à–ª–∞! –í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à–µ —á–∞—Å–æ–≤.');\n      return null;\n    }\n\n    return notificationDate;\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É\n   */\n  function setupSpecificDateNotification(ui, selectedCase) {\n    const response = ui.prompt(\n      'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è',\n      `–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\\n\\n` +\n      `–§–æ—Ä–º–∞—Ç: –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\\n` +\n      `–ù–∞–ø—Ä–∏–º–µ—Ä: 15.12.2024 14:30`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return null;\n\n    const input = response.getResponseText().trim();\n\n    try {\n      // –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞ \"–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\"\n      const parts = input.split(' ');\n      if (parts.length !== 2) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');\n\n      const dateParts = parts[0].split('.');\n      const timeParts = parts[1].split(':');\n\n      if (dateParts.length !== 3 || timeParts.length !== 2) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');\n\n      const day = parseInt(dateParts[0]);\n      const month = parseInt(dateParts[1]) - 1; // –ú–µ—Å—è—Ü—ã —Å 0\n      const year = parseInt(dateParts[2]);\n      const hour = parseInt(timeParts[0]);\n      const minute = parseInt(timeParts[1]);\n\n      const notificationDate = new Date(year, month, day, hour, minute, 0);\n\n      if (isNaN(notificationDate.getTime())) {\n        throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞');\n      }\n\n      if (notificationDate <= new Date()) {\n        ui.alert('‚ùå –î–∞—Ç–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞! –í—ã–±–µ—Ä–∏—Ç–µ –±—É–¥—É—â—É—é –¥–∞—Ç—É.');\n        return null;\n      }\n\n      if (notificationDate >= selectedCase.date) {\n        ui.alert('‚ùå –î–∞—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –∑–∞—Å–µ–¥–∞–Ω–∏—è!');\n        return null;\n      }\n\n      return notificationDate;\n\n    } catch (e) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!\\n\\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\\n–ù–∞–ø—Ä–∏–º–µ—Ä: 15.12.2024 14:30');\n      return null;\n    }\n  }\n\n  /**\n   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ\n   */\n  function saveCustomNotification(caseData, notificationDate) {\n    const props = PropertiesService.getScriptProperties();\n    const customKey = `CUSTOM_NOTIFICATION_${caseData.caseNumber}`;\n\n    const data = {\n      caseNumber: caseData.caseNumber,\n      court: caseData.court,\n      plaintiff: caseData.plaintiff,\n      defendant: caseData.defendant,\n      priority: caseData.priority || '',\n      columnR: caseData.columnR || '',\n      columnS: caseData.columnS || '',\n      columnT: caseData.columnT || '',\n      columnU: caseData.columnU || '',\n      columnV: caseData.columnV || '',\n      columnW: caseData.columnW || '',\n      columnX: caseData.columnX || '',\n      hearingDate: caseData.date.toISOString(),\n      notificationDate: notificationDate.toISOString(),\n      created: new Date().toISOString()\n    };\n\n    props.setProperty(customKey, JSON.stringify(data));\n  }\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n   */\n  function createCustomNotificationTrigger(caseData, notificationDate) {\n    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–ª–∞, –µ—Å–ª–∏ –µ—Å—Ç—å\n    const triggers = ScriptApp.getProjectTriggers();\n    const triggerName = `sendCustomNotification_${caseData.caseNumber}`;\n\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === triggerName) {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä\n    ScriptApp.newTrigger('sendCustomCaseNotification')\n      .timeBased()\n      .at(notificationDate)\n      .create();\n\n    AppLogger.info('HearingNotifier', `–°–æ–∑–¥–∞–Ω —Ç—Ä–∏–≥–≥–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è ${caseData.caseNumber}`);\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–º)\n   */\n  function sendCustomCaseNotification() {\n    const props = PropertiesService.getScriptProperties();\n    const allProps = props.getProperties();\n\n    const now = new Date();\n\n    for (const key in allProps) {\n      if (key.startsWith('CUSTOM_NOTIFICATION_')) {\n        try {\n          const data = JSON.parse(allProps[key]);\n          const notifDate = new Date(data.notificationDate);\n\n          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—Ä–∞ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å (–≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞—Å–∞)\n          const timeDiff = now - notifDate;\n          if (timeDiff >= 0 && timeDiff <= 3600000) { // 1 —á–∞—Å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö\n\n            const hearingDate = new Date(data.hearingDate);\n            const dateStr = Utilities.formatDate(hearingDate, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n\n            // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n            const additionalInfo = formatAdditionalInfo({\n              priority: data.priority || '',\n              columnR: data.columnR || '',\n              columnS: data.columnS || '',\n              columnT: data.columnT || '',\n              columnU: data.columnU || '',\n              columnV: data.columnV || '',\n              columnW: data.columnW || '',\n              columnX: data.columnX || ''\n            });\n\n            const message =\n              `üîî *–ö–ê–°–¢–û–ú–ù–û–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï –û –ó–ê–°–ï–î–ê–ù–ò–ò*\\n\\n` +\n              `üìÖ –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è: ${dateStr}\\n\\n` +\n              `üìã –î–µ–ª–æ: ${data.caseNumber}\\n` +\n              `üèõÔ∏è –°—É–¥: ${data.court}\\n\\n` +\n              `üë§ –ò—Å—Ç–µ—Ü: ${data.plaintiff}\\n` +\n              `üë§ –û—Ç–≤–µ—Ç—á–∏–∫: ${data.defendant}` +\n              additionalInfo +\n              `\\n\\n–≠—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –¥–µ–ª–∞.`;\n\n            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å Telegram\n            const users = UserManager.getAllUsers();\n            for (const email in users) {\n              const user = users[email];\n              if (user.telegram_chat_id && user.notification_preferences?.telegram) {\n                const shouldSend =\n                  user.role === 'ADMIN' ||\n                  user.role === 'MANAGER' ||\n                  (user.assigned_cases && user.assigned_cases.includes(data.caseNumber));\n\n                if (shouldSend) {\n                  TelegramNotifier.sendToUser(user, message, 'Markdown');\n                }\n              }\n            }\n\n            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏\n            props.deleteProperty(key);\n            AppLogger.info('HearingNotifier', `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è ${data.caseNumber}`);\n          }\n        } catch (e) {\n          AppLogger.error('HearingNotifier', `–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${e.message}`);\n        }\n      }\n    }\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   */\n  function showCustomNotifications() {\n    const ui = SpreadsheetApp.getUi();\n    const props = PropertiesService.getScriptProperties();\n    const allProps = props.getProperties();\n\n    const customNotifications = [];\n\n    for (const key in allProps) {\n      if (key.startsWith('CUSTOM_NOTIFICATION_')) {\n        try {\n          const data = JSON.parse(allProps[key]);\n          customNotifications.push(data);\n        } catch (e) {\n          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n        }\n      }\n    }\n\n    if (customNotifications.length === 0) {\n      ui.alert('‚ÑπÔ∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');\n      return;\n    }\n\n    const list = customNotifications.map((n, i) => {\n      const hearingDateStr = Utilities.formatDate(new Date(n.hearingDate), Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n      const notifDateStr = Utilities.formatDate(new Date(n.notificationDate), Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n      return `${i + 1}. ${n.caseNumber}\\n   –ó–∞—Å–µ–¥–∞–Ω–∏–µ: ${hearingDateStr}\\n   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ${notifDateStr}`;\n    }).join('\\n\\n');\n\n    ui.alert(\n      'üîî –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',\n      `–í—Å–µ–≥–æ: ${customNotifications.length}\\n\\n${list}`,\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    sendScheduledNotifications: sendScheduledNotifications,\n    sendManualNotifications: sendManualNotifications,\n    configureNotificationSchedule: configureNotificationSchedule,\n    showCurrentSchedule: showCurrentSchedule,\n    setupHearingNotificationTrigger: setupHearingNotificationTrigger,\n    getNotificationSchedule: getNotificationSchedule,\n    setupCustomCaseNotification: setupCustomCaseNotification,\n    sendCustomCaseNotification: sendCustomCaseNotification,\n    showCustomNotifications: showCustomNotifications\n  };\n\n})();\n\n// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤\nfunction sendScheduledNotifications() {\n  HearingNotifier.sendScheduledNotifications();\n}\n\nfunction sendCustomCaseNotification() {\n  HearingNotifier.sendCustomCaseNotification();\n}\n"},{"name":"LegalWorkflowManager.gs","content":"/**\n * LegalWorkflowManager.gs\n *\n * –ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏:\n * - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª —é—Ä–∏—Å—Ç–∞–º\n * - –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏\n * - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞–º–∏\n * - –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤\n * - –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç\n * - –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã\n */\n\nvar LegalWorkflowManager = (function() {\n  'use strict';\n\n  // ============================================\n  // –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –î–ï–õ –Æ–†–ò–°–¢–ê–ú\n  // ============================================\n\n  /**\n   * –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —é—Ä–∏—Å—Ç—É\n   */\n  function assignCaseToLawyer() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getActiveSheet();\n    const activeRow = sheet.getActiveRange().getRow();\n\n    if (activeRow < 2) {\n      ui.alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å –¥–µ–ª–æ–º');\n      return;\n    }\n\n    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —é—Ä–∏—Å—Ç–æ–≤\n    const lawyers = UserManager.getUsersByRole('LAWYER');\n    const lawyerEmails = Object.keys(lawyers);\n\n    if (lawyerEmails.length === 0) {\n      ui.alert('‚ùå –í —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç —é—Ä–∏—Å—Ç–æ–≤!\\n\\n–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é LAWYER.');\n      return;\n    }\n\n    // –°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞\n    const lawyerNames = lawyerEmails.map(email => {\n      const name = lawyers[email].name || email;\n      return `${name} (${email})`;\n    });\n\n    const response = ui.prompt(\n      'üë§ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª–∞ —é—Ä–∏—Å—Ç—É',\n      '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä —é—Ä–∏—Å—Ç–∞:\\n\\n' +\n      lawyerNames.map((name, i) => `${i + 1}. ${name}`).join('\\n') +\n      '\\n\\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const selectedIndex = parseInt(response.getResponseText()) - 1;\n\n    if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= lawyerEmails.length) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä!');\n      return;\n    }\n\n    const selectedEmail = lawyerEmails[selectedIndex];\n    const caseNumber = sheet.getRange(activeRow, 1).getValue();\n\n    // –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ\n    UserManager.assignCase(selectedEmail, caseNumber);\n\n    // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü \"–Æ—Ä–∏—Å—Ç\" (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —ç—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ 3)\n    const lawyerName = lawyers[selectedEmail].name || selectedEmail;\n    sheet.getRange(activeRow, 3).setValue(lawyerName);\n\n    ui.alert(\n      '‚úÖ –î–µ–ª–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ!',\n      `–î–µ–ª–æ \"${caseNumber}\" –Ω–∞–∑–Ω–∞—á–µ–Ω–æ —é—Ä–∏—Å—Ç—É:\\n${lawyerName} (${selectedEmail})`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('LegalWorkflow', `–î–µ–ª–æ ${caseNumber} –Ω–∞–∑–Ω–∞—á–µ–Ω–æ —é—Ä–∏—Å—Ç—É ${selectedEmail}`);\n  }\n\n  /**\n   * –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª —é—Ä–∏—Å—Ç–∞–º\n   */\n  function bulkAssignCases() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getActiveSheet();\n\n    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —é—Ä–∏—Å—Ç–æ–≤\n    const lawyers = UserManager.getUsersByRole('LAWYER');\n    const lawyerEmails = Object.keys(lawyers);\n\n    if (lawyerEmails.length === 0) {\n      ui.alert('‚ùå –í —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç —é—Ä–∏—Å—Ç–æ–≤!');\n      return;\n    }\n\n    const lawyerNames = lawyerEmails.map(email => {\n      const name = lawyers[email].name || email;\n      return `${name} (${email})`;\n    });\n\n    const response = ui.prompt(\n      'üìã –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª',\n      '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä —é—Ä–∏—Å—Ç–∞:\\n\\n' +\n      lawyerNames.map((name, i) => `${i + 1}. ${name}`).join('\\n') +\n      '\\n\\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const selectedIndex = parseInt(response.getResponseText()) - 1;\n\n    if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= lawyerEmails.length) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä!');\n      return;\n    }\n\n    const selectedEmail = lawyerEmails[selectedIndex];\n    const lawyerName = lawyers[selectedEmail].name || selectedEmail;\n\n    // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏\n    const range = sheet.getActiveRange();\n    const startRow = range.getRow();\n    const numRows = range.getNumRows();\n\n    if (startRow < 2) {\n      ui.alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å –¥–µ–ª–∞–º–∏ (–Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 2)');\n      return;\n    }\n\n    let assignedCount = 0;\n\n    for (let i = 0; i < numRows; i++) {\n      const row = startRow + i;\n      const caseNumber = sheet.getRange(row, 1).getValue();\n\n      if (caseNumber) {\n        UserManager.assignCase(selectedEmail, caseNumber);\n        sheet.getRange(row, 3).setValue(lawyerName);\n        assignedCount++;\n      }\n    }\n\n    ui.alert(\n      '‚úÖ –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!',\n      `–ù–∞–∑–Ω–∞—á–µ–Ω–æ –¥–µ–ª: ${assignedCount}\\n–Æ—Ä–∏—Å—Ç: ${lawyerName}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('LegalWorkflow', `–ú–∞—Å—Å–æ–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ ${assignedCount} –¥–µ–ª —é—Ä–∏—Å—Ç—É ${selectedEmail}`);\n  }\n\n  // ============================================\n  // –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –î–ï–õ\n  // ============================================\n\n  /**\n   * –ù–∞–π—Ç–∏ –¥–µ–ª–æ\n   */\n  function searchCase() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.prompt(\n      'üîç –ü–æ–∏—Å–∫ –¥–µ–ª–∞',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞ –∏–ª–∏ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const searchText = response.getResponseText().trim();\n    if (!searchText) {\n      ui.alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞');\n      return;\n    }\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const results = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const rowText = row.join(' ').toLowerCase();\n\n      if (rowText.includes(searchText.toLowerCase())) {\n        results.push({\n          row: i + 1,\n          caseNumber: row[0],\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          status: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω'\n        });\n      }\n    }\n\n    if (results.length === 0) {\n      ui.alert('‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n      return;\n    }\n\n    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã\n    const message = results.slice(0, 20).map((r, i) =>\n      `${i + 1}. –°—Ç—Ä–æ–∫–∞ ${r.row}: ${r.caseNumber} (${r.court})`\n    ).join('\\n');\n\n    const finalMessage = `–ù–∞–π–¥–µ–Ω–æ –¥–µ–ª: ${results.length}\\n\\n${message}` +\n      (results.length > 20 ? `\\n\\n...–∏ –µ—â—ë ${results.length - 20} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤` : '');\n\n    ui.alert('üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞', finalMessage, ui.ButtonSet.OK);\n\n    // –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–µ—Ä–≤–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É\n    if (results.length > 0) {\n      sheet.setActiveRange(sheet.getRange(results[0].row, 1));\n    }\n  }\n\n  /**\n   * –§–∏–ª—å—Ç—Ä –¥–µ–ª –ø–æ —Å—Ç–∞—Ç—É—Å—É\n   */\n  function filterCasesByStatus() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.prompt(\n      'üóÇÔ∏è –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É',\n      '–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:\\n' +\n      '1 - –í —Ä–∞–±–æ—Ç–µ\\n' +\n      '2 - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\\n' +\n      '3 - –ó–∞–≤–µ—Ä—à–µ–Ω–æ\\n' +\n      '4 - –ê—Ä—Ö–∏–≤\\n\\n' +\n      '–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const input = response.getResponseText().trim();\n    let status;\n\n    switch (input) {\n      case '1': status = '–í —Ä–∞–±–æ—Ç–µ'; break;\n      case '2': status = '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'; break;\n      case '3': status = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'; break;\n      case '4': status = '–ê—Ä—Ö–∏–≤'; break;\n      default: status = input;\n    }\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const results = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseStatus = row[6]; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –≤ –∫–æ–ª–æ–Ω–∫–µ 7\n\n      if (caseStatus && caseStatus.toString().toLowerCase() === status.toLowerCase()) {\n        results.push({\n          row: i + 1,\n          caseNumber: row[0],\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω'\n        });\n      }\n    }\n\n    if (results.length === 0) {\n      ui.alert(`‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ –¥–µ–ª —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º \"${status}\"`);\n      return;\n    }\n\n    const message = results.slice(0, 20).map((r, i) =>\n      `${i + 1}. –°—Ç—Ä–æ–∫–∞ ${r.row}: ${r.caseNumber} (${r.court})`\n    ).join('\\n');\n\n    ui.alert(\n      `üóÇÔ∏è –î–µ–ª–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º \"${status}\"`,\n      `–ù–∞–π–¥–µ–Ω–æ: ${results.length}\\n\\n${message}` +\n      (results.length > 20 ? `\\n\\n...–∏ –µ—â—ë ${results.length - 20} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤` : ''),\n      ui.ButtonSet.OK\n    );\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–ª–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞\n   */\n  function showLawyerCases() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const lawyers = UserManager.getUsersByRole('LAWYER');\n    const lawyerEmails = Object.keys(lawyers);\n\n    if (lawyerEmails.length === 0) {\n      ui.alert('‚ùå –í —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç —é—Ä–∏—Å—Ç–æ–≤!');\n      return;\n    }\n\n    const lawyerNames = lawyerEmails.map(email => {\n      const name = lawyers[email].name || email;\n      const casesCount = lawyers[email].assigned_cases ? lawyers[email].assigned_cases.length : 0;\n      return `${name} (${casesCount} –¥–µ–ª)`;\n    });\n\n    const response = ui.prompt(\n      'üë• –î–µ–ª–∞ —é—Ä–∏—Å—Ç–∞',\n      '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä —é—Ä–∏—Å—Ç–∞:\\n\\n' +\n      lawyerNames.map((name, i) => `${i + 1}. ${name}`).join('\\n') +\n      '\\n\\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const selectedIndex = parseInt(response.getResponseText()) - 1;\n\n    if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= lawyerEmails.length) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä!');\n      return;\n    }\n\n    const selectedEmail = lawyerEmails[selectedIndex];\n    const lawyer = lawyers[selectedEmail];\n    const assignedCases = lawyer.assigned_cases || [];\n\n    if (assignedCases.length === 0) {\n      ui.alert(`‚ÑπÔ∏è –£ —é—Ä–∏—Å—Ç–∞ ${lawyer.name} –Ω–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª`);\n      return;\n    }\n\n    const message = assignedCases.slice(0, 20).map((caseNum, i) =>\n      `${i + 1}. ${caseNum}`\n    ).join('\\n');\n\n    ui.alert(\n      `üë§ –î–µ–ª–∞ —é—Ä–∏—Å—Ç–∞ ${lawyer.name}`,\n      `–í—Å–µ–≥–æ –¥–µ–ª: ${assignedCases.length}\\n\\n${message}` +\n      (assignedCases.length > 20 ? `\\n\\n...–∏ –µ—â—ë ${assignedCases.length - 20} –¥–µ–ª` : ''),\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –ê–†–•–ò–í–ò–†–û–í–ê–ù–ò–ï –î–ï–õ\n  // ============================================\n\n  /**\n   * –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–ª–∞\n   */\n  function archiveCompletedCases() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    const confirm = ui.alert(\n      'üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ª',\n      '–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–µ–ª–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º \"–ó–∞–≤–µ—Ä—à–µ–Ω–æ\"?\\n\\n' +\n      '–î–µ–ª–∞ –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –Ω–∞ –ª–∏—Å—Ç \"–ê—Ä—Ö–∏–≤\".',\n      ui.ButtonSet.YES_NO\n    );\n\n    if (confirm !== ui.Button.YES) return;\n\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    let archiveSheet = ss.getSheetByName('–ê—Ä—Ö–∏–≤');\n\n    if (!archiveSheet) {\n      archiveSheet = ss.insertSheet('–ê—Ä—Ö–∏–≤');\n      // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏\n      const headers = mainSheet.getRange(1, 1, 1, mainSheet.getLastColumn()).getValues();\n      archiveSheet.getRange(1, 1, 1, headers[0].length).setValues(headers);\n    }\n\n    const data = mainSheet.getDataRange().getValues();\n    let archivedCount = 0;\n    const rowsToArchive = [];\n    const rowsToDelete = [];\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏\n    for (let i = data.length - 1; i >= 1; i--) {\n      const row = data[i];\n      const status = row[6]; // –°—Ç–∞—Ç—É—Å –≤ –∫–æ–ª–æ–Ω–∫–µ 7\n\n      if (status && status.toString().toLowerCase() === '–∑–∞–≤–µ—Ä—à–µ–Ω–æ') {\n        rowsToArchive.push(row);\n        rowsToDelete.push(i + 1);\n      }\n    }\n\n    if (rowsToArchive.length === 0) {\n      ui.alert('‚ÑπÔ∏è –ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–ª –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏');\n      return;\n    }\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —Å–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –≤—Å–µ\n    try {\n      // –ü–∞–∫–µ—Ç–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∞—Ä—Ö–∏–≤\n      if (rowsToArchive.length > 0) {\n        const lastArchiveRow = archiveSheet.getLastRow();\n        archiveSheet.getRange(lastArchiveRow + 1, 1, rowsToArchive.length, rowsToArchive[0].length)\n          .setValues(rowsToArchive);\n\n        archivedCount = rowsToArchive.length;\n\n        // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è - —É–¥–∞–ª—è–µ–º –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞\n        // –£–¥–∞–ª—è–µ–º —Å –∫–æ–Ω—Ü–∞ —á—Ç–æ–±—ã –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫ –Ω–µ —Å–±–∏–≤–∞–ª–∏—Å—å\n        for (const rowNum of rowsToDelete) {\n          mainSheet.deleteRow(rowNum);\n        }\n      }\n    } catch (error) {\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ - –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è\n      ui.alert(\n        '‚ùå –û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏!',\n        `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –¥–µ–ª:\\n${error.message}\\n\\n` +\n        '–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞. –î–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã.',\n        ui.ButtonSet.OK\n      );\n\n      AppLogger.error('LegalWorkflow', `–û—à–∏–±–∫–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏: ${error.message}`);\n      return;\n    }\n\n    ui.alert(\n      '‚úÖ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!',\n      `–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–µ–ª: ${archivedCount}\\n\\n` +\n      '–î–µ–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –Ω–∞ –ª–∏—Å—Ç \"–ê—Ä—Ö–∏–≤\".',\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('LegalWorkflow', `–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ ${archivedCount} –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–ª`);\n  }\n\n  // ============================================\n  // –ö–û–ù–¢–†–û–õ–¨ –°–†–û–ö–û–í –ò–°–ö–û–í–û–ô –î–ê–í–ù–û–°–¢–ò\n  // ============================================\n\n  /**\n   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫–∏ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏\n   */\n  function checkStatuteOfLimitations() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const warnings = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[0];\n      const incidentDate = row[10]; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –¥–∞—Ç—É –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ 11\n\n      if (incidentDate && incidentDate instanceof Date) {\n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –≤ –º–µ—Å—è—Ü–∞—Ö\n        const monthsPassed = (now.getFullYear() - incidentDate.getFullYear()) * 12 +\n                            (now.getMonth() - incidentDate.getMonth());\n\n        // –û–±—â–∏–π —Å—Ä–æ–∫ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏ - 3 –≥–æ–¥–∞ (36 –º–µ—Å—è—Ü–µ–≤)\n        const monthsLeft = 36 - monthsPassed;\n\n        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞\n        const expiryDate = new Date(incidentDate);\n        expiryDate.setFullYear(expiryDate.getFullYear() + 3); // –î–æ–±–∞–≤–ª—è–µ–º 3 –≥–æ–¥–∞\n        const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));\n\n        if (monthsLeft < 6 && monthsLeft > 0) {\n          warnings.push({\n            caseNumber: caseNumber,\n            monthsLeft: monthsLeft,\n            daysLeft: daysLeft,\n            expiryDate: expiryDate.toLocaleDateString('ru-RU'),\n            row: i + 1\n          });\n        } else if (monthsLeft <= 0) {\n          warnings.push({\n            caseNumber: caseNumber,\n            monthsLeft: 0,\n            daysLeft: daysLeft,\n            expired: true,\n            expiryDate: expiryDate.toLocaleDateString('ru-RU'),\n            row: i + 1\n          });\n        }\n      }\n    }\n\n    if (warnings.length === 0) {\n      ui.alert(\n        '‚úÖ –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ!',\n        '–ù–µ—Ç –¥–µ–ª —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º —Å—Ä–æ–∫–æ–º –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏',\n        ui.ButtonSet.OK\n      );\n      return;\n    }\n\n    const expiredCases = warnings.filter(w => w.expired);\n    const soonExpiring = warnings.filter(w => !w.expired);\n\n    let message = '';\n\n    if (expiredCases.length > 0) {\n      message += `‚õî –°–†–û–ö –ò–°–¢–Å–ö (${expiredCases.length} –¥–µ–ª):\\n`;\n      expiredCases.slice(0, 10).forEach(w => {\n        message += `  ‚Ä¢ ${w.caseNumber} (—Å—Ç—Ä–æ–∫–∞ ${w.row})\\n`;\n      });\n      message += '\\n';\n    }\n\n    if (soonExpiring.length > 0) {\n      message += `‚ö†Ô∏è –ò–°–¢–ï–ö–ê–ï–¢ –í –¢–ï–ß–ï–ù–ò–ï 6 –ú–ï–°–Ø–¶–ï–í (${soonExpiring.length} –¥–µ–ª):\\n`;\n      soonExpiring.slice(0, 10).forEach(w => {\n        message += `  ‚Ä¢ ${w.caseNumber} - –æ—Å—Ç–∞–ª–æ—Å—å ${w.monthsLeft} –º–µ—Å. (${w.daysLeft} –¥–Ω.)\\n`;\n      });\n    }\n\n    ui.alert(\n      '‚è∞ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏',\n      message,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.warn('StatuteOfLimitations', `–ù–∞–π–¥–µ–Ω–æ ${warnings.length} –¥–µ–ª —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ —Å—Ä–æ–∫–∞–º–∏`);\n  }\n\n  // ============================================\n  // –†–ê–°–ü–ò–°–ê–ù–ò–ï –ó–ê–°–ï–î–ê–ù–ò–ô\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π\n   */\n  function showCourtSchedule() {\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const upcoming = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[0];\n      const hearingDate = row[16]; // –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ Q (—Å—Ç–æ–ª–±–µ—Ü 17)\n\n      if (hearingDate && hearingDate instanceof Date && hearingDate >= now) {\n        const daysUntil = Math.floor((hearingDate - now) / (1000 * 60 * 60 * 24));\n\n        upcoming.push({\n          caseNumber: caseNumber,\n          date: hearingDate,\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          plaintiff: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω',      // –°—Ç–æ–ª–±–µ—Ü G - –ò—Å—Ç–µ—Ü\n          defendant: row[7] || '–ù–µ —É–∫–∞–∑–∞–Ω',      // –°—Ç–æ–ª–±–µ—Ü H - –û—Ç–≤–µ—Ç—á–∏–∫\n          daysUntil: daysUntil,\n          row: i + 1\n        });\n      }\n    }\n\n    if (upcoming.length === 0) {\n      ui.alert('‚ÑπÔ∏è –ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π');\n      return;\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ\n    upcoming.sort((a, b) => a.date - b.date);\n\n    const message = upcoming.slice(0, 15).map((h, i) => {\n      const dateStr = Utilities.formatDate(h.date, Session.getScriptTimeZone(), 'dd.MM.yyyy');\n      const urgency = h.daysUntil <= 7 ? 'üî¥' : h.daysUntil <= 14 ? 'üü°' : 'üü¢';\n      return `${urgency} ${dateStr} (—á–µ—Ä–µ–∑ ${h.daysUntil} –¥–Ω.)\\n    –î–µ–ª–æ: ${h.caseNumber}\\n    ${h.plaintiff} vs ${h.defendant}`;\n    }).join('\\n\\n');\n\n    ui.alert(\n      'üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π',\n      `–í—Å–µ–≥–æ –∑–∞—Å–µ–¥–∞–Ω–∏–π: ${upcoming.length}\\n\\n${message}` +\n      (upcoming.length > 15 ? `\\n\\n...–∏ –µ—â—ë ${upcoming.length - 15} –∑–∞—Å–µ–¥–∞–Ω–∏–π` : ''),\n      ui.ButtonSet.OK\n    );\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π (–¥–ª—è —é—Ä–∏—Å—Ç–∞)\n   */\n  function showMyCourtSchedule() {\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user || user.role !== 'LAWYER') {\n      SpreadsheetApp.getUi().alert('‚õî –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —é—Ä–∏—Å—Ç–∞–º');\n      return;\n    }\n\n    const assignedCases = user.assigned_cases || [];\n\n    if (assignedCases.length === 0) {\n      SpreadsheetApp.getUi().alert('‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª');\n      return;\n    }\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const myHearings = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[0];\n      const hearingDate = row[16]; // –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ Q (—Å—Ç–æ–ª–±–µ—Ü 17)\n\n      if (assignedCases.includes(caseNumber) && hearingDate && hearingDate instanceof Date && hearingDate >= now) {\n        const daysUntil = Math.floor((hearingDate - now) / (1000 * 60 * 60 * 24));\n\n        myHearings.push({\n          caseNumber: caseNumber,\n          date: hearingDate,\n          court: row[4] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n          plaintiff: row[6] || '–ù–µ —É–∫–∞–∑–∞–Ω',      // –°—Ç–æ–ª–±–µ—Ü G - –ò—Å—Ç–µ—Ü\n          defendant: row[7] || '–ù–µ —É–∫–∞–∑–∞–Ω',      // –°—Ç–æ–ª–±–µ—Ü H - –û—Ç–≤–µ—Ç—á–∏–∫\n          daysUntil: daysUntil\n        });\n      }\n    }\n\n    if (myHearings.length === 0) {\n      ui.alert('‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π');\n      return;\n    }\n\n    myHearings.sort((a, b) => a.date - b.date);\n\n    const message = myHearings.slice(0, 15).map(h => {\n      const dateStr = Utilities.formatDate(h.date, Session.getScriptTimeZone(), 'dd.MM.yyyy');\n      const urgency = h.daysUntil <= 7 ? 'üî¥' : h.daysUntil <= 14 ? 'üü°' : 'üü¢';\n      return `${urgency} ${dateStr} (—á–µ—Ä–µ–∑ ${h.daysUntil} –¥–Ω.)\\n    –î–µ–ª–æ: ${h.caseNumber}\\n    ${h.plaintiff} vs ${h.defendant}\\n    –°—É–¥: ${h.court}`;\n    }).join('\\n\\n');\n\n    ui.alert(\n      'üìÖ –ú–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π',\n      `–í—Å–µ–≥–æ: ${myHearings.length}\\n\\n${message}`,\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ò–ó–í–û–î–°–¢–í–ê\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞–º–∏\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: –î–æ–±–∞–≤–ª–µ–Ω–∞ JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –°–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—Å—Ç–æ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤.\n   * –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ò–ü –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö —Å—Ç–∞—Ç—É—Å—ã.\n   *\n   * @return {void}\n   */\n  function manageEnforcementProceedings() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n\n    // –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤\n    let epSheet = ss.getSheetByName('‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞');\n\n    if (!epSheet) {\n      // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ª–∏—Å—Ç\n      epSheet = ss.insertSheet('‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞');\n\n      // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n      const headers = [\n        '–ù–æ–º–µ—Ä –ò–ü',\n        '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n        '–î–∞—Ç–∞ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è',\n        '–°—É–¥–µ–±–Ω—ã–π –∞–∫—Ç',\n        '–í–∑—ã—Å–∫–∞—Ç–µ–ª—å',\n        '–î–æ–ª–∂–Ω–∏–∫',\n        '–°—É–º–º–∞ –≤–∑—ã—Å–∫–∞–Ω–∏—è (—Ä—É–±)',\n        '–°—Ç–∞—Ç—É—Å',\n        '–§–°–°–ü –æ—Ç–¥–µ–ª',\n        '–ü—Ä–∏—Å—Ç–∞–≤',\n        '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è',\n        '–ü—Ä–∏–º–µ—á–∞–Ω–∏—è'\n      ];\n\n      epSheet.getRange(1, 1, 1, headers.length)\n        .setValues([headers])\n        .setFontWeight('bold')\n        .setBackground('#4a86e8')\n        .setFontColor('#ffffff');\n\n      epSheet.setFrozenRows(1);\n\n      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫\n      epSheet.setColumnWidth(1, 120); // –ù–æ–º–µ—Ä –ò–ü\n      epSheet.setColumnWidth(2, 120); // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n      epSheet.setColumnWidth(3, 100); // –î–∞—Ç–∞ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è\n      epSheet.setColumnWidth(4, 150); // –°—É–¥–µ–±–Ω—ã–π –∞–∫—Ç\n      epSheet.setColumnWidth(5, 200); // –í–∑—ã—Å–∫–∞—Ç–µ–ª—å\n      epSheet.setColumnWidth(6, 200); // –î–æ–ª–∂–Ω–∏–∫\n      epSheet.setColumnWidth(7, 120); // –°—É–º–º–∞\n      epSheet.setColumnWidth(8, 120); // –°—Ç–∞—Ç—É—Å\n      epSheet.setColumnWidth(9, 150); // –§–°–°–ü –æ—Ç–¥–µ–ª\n      epSheet.setColumnWidth(10, 150); // –ü—Ä–∏—Å—Ç–∞–≤\n      epSheet.setColumnWidth(11, 100); // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è\n      epSheet.setColumnWidth(12, 250); // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n\n      AppLogger.info('EnforcementProceedings', '–°–æ–∑–¥–∞–Ω –ª–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤');\n    }\n\n    // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π\n    const response = ui.alert(\n      '‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞',\n      `–í—Å–µ–≥–æ –ò–ü –≤ –±–∞–∑–µ: ${Math.max(0, epSheet.getLastRow() - 1)}\\n\\n` +\n      '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?\\n\\n' +\n      '‚Ä¢ –î–ê - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ò–ü\\n' +\n      '‚Ä¢ –ù–ï–¢ - –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫\\n' +\n      '‚Ä¢ –û–¢–ú–ï–ù–ê - –ó–∞–∫—Ä—ã—Ç—å',\n      ui.ButtonSet.YES_NO_CANCEL\n    );\n\n    if (response === ui.Button.YES) {\n      // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ò–ü\n      addEnforcementProceeding(epSheet, ui);\n    } else if (response === ui.Button.NO) {\n      // –ü—Ä–æ—Å—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç\n      epSheet.activate();\n      ui.alert(\n        '‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',\n        '–õ–∏—Å—Ç \"‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞\" –æ—Ç–∫—Ä—ã—Ç.\\n\\n' +\n        '–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.',\n        ui.ButtonSet.OK\n      );\n    }\n  }\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: –î–æ–±–∞–≤–ª–µ–Ω–∞ JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —á–µ—Ä–µ–∑ –ø–æ—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä.\n   *\n   * @param {Sheet} epSheet - –õ–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤\n   * @param {Ui} ui - –û–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n   * @return {void}\n   */\n  function addEnforcementProceeding(epSheet, ui) {\n    // –®–∞–≥ 1: –ù–æ–º–µ—Ä –ò–ü\n    const ipNumberResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 1/7',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (ipNumberResp.getSelectedButton() !== ui.Button.OK) return;\n    const ipNumber = ipNumberResp.getResponseText().trim();\n    if (!ipNumber) {\n      ui.alert('‚ùå –ù–æ–º–µ—Ä –ò–ü –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω');\n      return;\n    }\n\n    // –®–∞–≥ 2: –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    const caseResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 2/7',\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—É–¥–µ–±–Ω–æ–≥–æ –¥–µ–ª–∞:',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (caseResp.getSelectedButton() !== ui.Button.OK) return;\n    const caseNumber = caseResp.getResponseText().trim();\n\n    // –®–∞–≥ 3: –í–∑—ã—Å–∫–∞—Ç–µ–ª—å\n    const creditorResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 3/7',\n      '–í–≤–µ–¥–∏—Ç–µ –≤–∑—ã—Å–∫–∞—Ç–µ–ª—è (–§–ò–û/–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ):',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (creditorResp.getSelectedButton() !== ui.Button.OK) return;\n    const creditor = creditorResp.getResponseText().trim();\n\n    // –®–∞–≥ 4: –î–æ–ª–∂–Ω–∏–∫\n    const debtorResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 4/7',\n      '–í–≤–µ–¥–∏—Ç–µ –¥–æ–ª–∂–Ω–∏–∫–∞ (–§–ò–û/–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ):',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (debtorResp.getSelectedButton() !== ui.Button.OK) return;\n    const debtor = debtorResp.getResponseText().trim();\n\n    // –®–∞–≥ 5: –°—É–º–º–∞ –≤–∑—ã—Å–∫–∞–Ω–∏—è\n    const amountResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 5/7',\n      '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤–∑—ã—Å–∫–∞–Ω–∏—è (—Ä—É–±):',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (amountResp.getSelectedButton() !== ui.Button.OK) return;\n    const amount = parseFloat(amountResp.getResponseText().replace(/\\s/g, '').replace(',', '.')) || 0;\n\n    // –®–∞–≥ 6: –§–°–°–ü –æ—Ç–¥–µ–ª\n    const fsspResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 6/7',\n      '–í–≤–µ–¥–∏—Ç–µ –æ—Ç–¥–µ–ª –§–°–°–ü:',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (fsspResp.getSelectedButton() !== ui.Button.OK) return;\n    const fssp = fsspResp.getResponseText().trim();\n\n    // –®–∞–≥ 7: –°—Ç–∞—Ç—É—Å\n    const statusResp = ui.prompt(\n      '‚öñÔ∏è –ù–æ–≤–æ–µ –ò–ü - –®–∞–≥ 7/7',\n      '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å:\\n\\n' +\n      '1 - –í–æ–∑–±—É–∂–¥–µ–Ω–æ\\n' +\n      '2 - –í —Ä–∞–±–æ—Ç–µ\\n' +\n      '3 - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ\\n' +\n      '4 - –û–∫–æ–Ω—á–µ–Ω–æ\\n' +\n      '5 - –ü—Ä–µ–∫—Ä–∞—â–µ–Ω–æ\\n\\n' +\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:',\n      ui.ButtonSet.OK_CANCEL\n    );\n    if (statusResp.getSelectedButton() !== ui.Button.OK) return;\n\n    const statusMap = {\n      '1': '–í–æ–∑–±—É–∂–¥–µ–Ω–æ',\n      '2': '–í —Ä–∞–±–æ—Ç–µ',\n      '3': '–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',\n      '4': '–û–∫–æ–Ω—á–µ–Ω–æ',\n      '5': '–ü—Ä–µ–∫—Ä–∞—â–µ–Ω–æ'\n    };\n    const status = statusMap[statusResp.getResponseText().trim()] || '–í–æ–∑–±—É–∂–¥–µ–Ω–æ';\n\n    // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å\n    const now = new Date();\n    epSheet.appendRow([\n      ipNumber,\n      caseNumber,\n      now,\n      '', // –°—É–¥–µ–±–Ω—ã–π –∞–∫—Ç\n      creditor,\n      debtor,\n      amount,\n      status,\n      fssp,\n      '', // –ü—Ä–∏—Å—Ç–∞–≤\n      '', // –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è\n      '' // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    const lastRow = epSheet.getLastRow();\n    epSheet.getRange(lastRow, 3).setNumberFormat('dd.MM.yyyy');\n    epSheet.getRange(lastRow, 7).setNumberFormat('#,##0 ‚ÇΩ');\n    epSheet.getRange(lastRow, 11).setNumberFormat('dd.MM.yyyy');\n\n    ui.alert(\n      '‚úÖ –ò–ü –¥–æ–±–∞–≤–ª–µ–Ω–æ!',\n      `–ù–æ–º–µ—Ä –ò–ü: ${ipNumber}\\n` +\n      `–î–µ–ª–æ: ${caseNumber}\\n` +\n      `–í–∑—ã—Å–∫–∞—Ç–µ–ª—å: ${creditor}\\n` +\n      `–î–æ–ª–∂–Ω–∏–∫: ${debtor}\\n` +\n      `–°—É–º–º–∞: ${amount.toLocaleString('ru-RU')} ‚ÇΩ\\n` +\n      `–°—Ç–∞—Ç—É—Å: ${status}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('EnforcementProceedings', `–î–æ–±–∞–≤–ª–µ–Ω–æ –ò–ü ${ipNumber} –ø–æ –¥–µ–ª—É ${caseNumber}`);\n  }\n\n  // ============================================\n  // –ë–ê–ó–ê –ö–õ–ò–ï–ù–¢–û–í\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–∑—É –∫–ª–∏–µ–Ω—Ç–æ–≤\n   */\n  function showClientsDatabase() {\n    return ClientDatabase.showClientsDatabase();\n  }\n\n  // ============================================\n  // –§–ò–ù–ê–ù–°–û–í–´–ô –£–ß–Å–¢\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç\n   */\n  function showFinancialReport() {\n    return FinancialManager.showFinancialReport();\n  }\n\n  // ============================================\n  // –£–ß–Å–¢ –í–†–ï–ú–ï–ù–ò\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã\n   */\n  function showTimeTracking() {\n    return TimeTracker.showTimeTracking();\n  }\n\n  /**\n   * –ú–æ–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ (–¥–ª—è —é—Ä–∏—Å—Ç–∞)\n   */\n  function showMyTimeTracking() {\n    return TimeTracker.showMyTimeTracking();\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ –¥–µ–ª—É\n   */\n  function addTimeEntry() {\n    return TimeTracker.addTimeEntry();\n  }\n\n  // ============================================\n  // –û–¢–ß–Å–¢–´\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞\n   */\n  function generateReport() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n\n    // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ç—á—ë—Ç–∞\n    const response = ui.prompt(\n      'üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞',\n      '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á—ë—Ç–∞:\\n\\n' +\n      '1 - –°–≤–æ–¥–∫–∞ –ø–æ –≤—Å–µ–º –¥–µ–ª–∞–º\\n' +\n      '2 - –û—Ç—á—ë—Ç –ø–æ —é—Ä–∏—Å—Ç–∞–º\\n' +\n      '3 - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º\\n' +\n      '4 - –î–µ–ª–∞ —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ —Å—Ä–æ–∫–∞–º–∏\\n\\n' +\n      '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä:',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const reportType = response.getResponseText().trim();\n\n    try {\n      switch (reportType) {\n        case '1':\n          generateCasesSummaryReport(ss, ui);\n          break;\n        case '2':\n          generateLawyersReport(ss, ui);\n          break;\n        case '3':\n          generateStatusReport(ss, ui);\n          break;\n        case '4':\n          generateDeadlinesReport(ss, ui);\n          break;\n        default:\n          ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä');\n      }\n    } catch (error) {\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #6: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞: ${error.message}`);\n      AppLogger.error('LegalWorkflow', '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞', {\n        reportType: reportType,\n        error: error.message,\n        stack: error.stack\n      });\n\n      ui.alert(\n        '‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–∞',\n        `–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç:\\n${error.message}\\n\\n` +\n        '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.',\n        ui.ButtonSet.OK\n      );\n    }\n  }\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: –î–æ–±–∞–≤–ª–µ–Ω–∞ JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º –¥–µ–ª–∞–º —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º, —Å—É–¥–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.\n   *\n   * @param {Spreadsheet} ss - –û–±—ä–µ–∫—Ç —Ç–∞–±–ª–∏—Ü—ã\n   * @param {Ui} ui - –û–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞\n   * @return {void}\n   */\n  function generateCasesSummaryReport(ss, ui) {\n    const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = mainSheet.getDataRange().getValues();\n\n    const reportName = `–û—Ç—á—ë—Ç –ø–æ –¥–µ–ª–∞–º ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd')}`;\n    const reportSheet = ss.insertSheet(reportName);\n\n    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á—ë—Ç–∞\n    reportSheet.getRange('A1').setValue('–°–í–û–î–ù–´–ô –û–¢–ß–Å–¢ –ü–û –î–ï–õ–ê–ú');\n    reportSheet.getRange('A1').setFontSize(14).setFontWeight('bold');\n    reportSheet.getRange('A2').setValue(`–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date().toLocaleString('ru-RU')}`);\n\n    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n    let row = 4;\n    reportSheet.getRange(`A${row}`).setValue('–û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:').setFontWeight('bold');\n    row++;\n\n    const totalCases = data.length - 1;\n    const statusCounts = {};\n    const courtCounts = {};\n    const categoryCounts = {};\n\n    for (let i = 1; i < data.length; i++) {\n      const rowData = data[i];\n      const status = rowData[6] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n      const court = rowData[1] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n      const category = rowData[2] || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';\n\n      statusCounts[status] = (statusCounts[status] || 0) + 1;\n      courtCounts[court] = (courtCounts[court] || 0) + 1;\n      categoryCounts[category] = (categoryCounts[category] || 0) + 1;\n    }\n\n    reportSheet.getRange(`A${row}`).setValue(`–í—Å–µ–≥–æ –¥–µ–ª: ${totalCases}`);\n    row++;\n\n    reportSheet.getRange(`A${row}`).setValue('–ü–æ —Å—Ç–∞—Ç—É—Å–∞–º:').setFontWeight('bold');\n    row++;\n    for (const status in statusCounts) {\n      reportSheet.getRange(`A${row}`).setValue(`  ${status}: ${statusCounts[status]}`);\n      row++;\n    }\n\n    row++;\n    reportSheet.getRange(`A${row}`).setValue('–ü–æ —Å—É–¥–∞–º (—Ç–æ–ø-5):').setFontWeight('bold');\n    row++;\n    const topCourts = Object.entries(courtCounts)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5);\n    for (const [court, count] of topCourts) {\n      reportSheet.getRange(`A${row}`).setValue(`  ${court}: ${count}`);\n      row++;\n    }\n\n    row++;\n    reportSheet.getRange(`A${row}`).setValue('–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (—Ç–æ–ø-5):').setFontWeight('bold');\n    row++;\n    const topCategories = Object.entries(categoryCounts)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5);\n    for (const [category, count] of topCategories) {\n      reportSheet.getRange(`A${row}`).setValue(`  ${category}: ${count}`);\n      row++;\n    }\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    reportSheet.setColumnWidth(1, 400);\n    reportSheet.autoResizeColumn(1);\n\n    ui.alert(\n      '‚úÖ –û—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω!',\n      `–û—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –ª–∏—Å—Ç–µ:\\n\"${reportName}\"\\n\\n` +\n      `–í—Å–µ–≥–æ –¥–µ–ª: ${totalCases}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('Reports', `–°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç –ø–æ –¥–µ–ª–∞–º: ${reportName}`);\n  }\n\n  /**\n   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º\n   */\n  function generateLawyersReport(ss, ui) {\n    const lawyers = UserManager.getUsersByRole('LAWYER');\n    const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n\n    const reportName = `–û—Ç—á—ë—Ç –ø–æ —é—Ä–∏—Å—Ç–∞–º ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd')}`;\n    const reportSheet = ss.insertSheet(reportName);\n\n    reportSheet.getRange('A1').setValue('–û–¢–ß–Å–¢ –ü–û –Æ–†–ò–°–¢–ê–ú');\n    reportSheet.getRange('A1').setFontSize(14).setFontWeight('bold');\n    reportSheet.getRange('A2').setValue(`–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`);\n\n    let row = 4;\n    reportSheet.getRange(`A${row}:C${row}`)\n      .setValues([['–Æ—Ä–∏—Å—Ç', 'Email', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–ª']])\n      .setFontWeight('bold')\n      .setBackground('#4a86e8')\n      .setFontColor('#ffffff');\n    row++;\n\n    for (const email in lawyers) {\n      const lawyer = lawyers[email];\n      const casesCount = (lawyer.assigned_cases || []).length;\n      reportSheet.getRange(`A${row}:C${row}`).setValues([[\n        lawyer.name || email,\n        email,\n        casesCount\n      ]]);\n      row++;\n    }\n\n    reportSheet.setColumnWidth(1, 200);\n    reportSheet.setColumnWidth(2, 250);\n    reportSheet.setColumnWidth(3, 150);\n\n    ui.alert('‚úÖ –û—Ç—á—ë—Ç –ø–æ —é—Ä–∏—Å—Ç–∞–º —Å–æ–∑–¥–∞–Ω!', `–õ–∏—Å—Ç: \"${reportName}\"`, ui.ButtonSet.OK);\n    AppLogger.info('Reports', `–°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç –ø–æ —é—Ä–∏—Å—Ç–∞–º: ${reportName}`);\n  }\n\n  /**\n   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º\n   */\n  function generateStatusReport(ss, ui) {\n    const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = mainSheet.getDataRange().getValues();\n\n    const reportName = `–û—Ç—á—ë—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd')}`;\n    const reportSheet = ss.insertSheet(reportName);\n\n    reportSheet.getRange('A1').setValue('–û–¢–ß–Å–¢ –ü–û –°–¢–ê–¢–£–°–ê–ú –î–ï–õ');\n    reportSheet.getRange('A1').setFontSize(14).setFontWeight('bold');\n\n    const statusData = {};\n    for (let i = 1; i < data.length; i++) {\n      const status = data[i][6] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n      if (!statusData[status]) {\n        statusData[status] = [];\n      }\n      statusData[status].push(data[i][0]); // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    }\n\n    let row = 3;\n    for (const status in statusData) {\n      reportSheet.getRange(`A${row}`).setValue(status).setFontWeight('bold');\n      reportSheet.getRange(`B${row}`).setValue(`(${statusData[status].length} –¥–µ–ª)`);\n      row++;\n\n      statusData[status].slice(0, 20).forEach(caseNum => {\n        reportSheet.getRange(`A${row}`).setValue(`  ‚Ä¢ ${caseNum}`);\n        row++;\n      });\n\n      if (statusData[status].length > 20) {\n        reportSheet.getRange(`A${row}`).setValue(`  ... –∏ –µ—â—ë ${statusData[status].length - 20} –¥–µ–ª`);\n        row++;\n      }\n      row++;\n    }\n\n    reportSheet.setColumnWidth(1, 300);\n    reportSheet.setColumnWidth(2, 150);\n\n    ui.alert('‚úÖ –û—Ç—á—ë—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º —Å–æ–∑–¥–∞–Ω!', `–õ–∏—Å—Ç: \"${reportName}\"`, ui.ButtonSet.OK);\n    AppLogger.info('Reports', `–°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º: ${reportName}`);\n  }\n\n  /**\n   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ –¥–µ–¥–ª–∞–π–Ω–∞–º\n   */\n  function generateDeadlinesReport(ss, ui) {\n    const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = mainSheet.getDataRange().getValues();\n\n    const reportName = `–û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd')}`;\n    const reportSheet = ss.insertSheet(reportName);\n\n    reportSheet.getRange('A1').setValue('–û–¢–ß–Å–¢ –ü–û –ò–°–¢–ï–ö–ê–Æ–©–ò–ú –°–†–û–ö–ê–ú');\n    reportSheet.getRange('A1').setFontSize(14).setFontWeight('bold');\n\n    const now = new Date();\n    const urgentCases = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const rowData = data[i];\n      const caseNumber = rowData[0];\n\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\n      for (const dateCol of CONFIG.DATE_COLUMNS) {\n        const dateValue = rowData[dateCol.column - 1];\n\n        if (dateValue instanceof Date && dateValue > now) {\n          const daysUntil = Math.ceil((dateValue - now) / (1000 * 60 * 60 * 24));\n\n          if (daysUntil <= 30) { // –°—Ä–æ–∫ –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π\n            urgentCases.push({\n              caseNumber: caseNumber,\n              deadline: dateCol.name,\n              date: dateValue,\n              daysUntil: daysUntil\n            });\n          }\n        }\n      }\n    }\n\n    urgentCases.sort((a, b) => a.daysUntil - b.daysUntil);\n\n    let row = 3;\n    reportSheet.getRange(`A${row}:D${row}`)\n      .setValues([['–ù–æ–º–µ—Ä –¥–µ–ª–∞', '–°—Ä–æ–∫', '–î–∞—Ç–∞', '–î–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å']])\n      .setFontWeight('bold')\n      .setBackground('#4a86e8')\n      .setFontColor('#ffffff');\n    row++;\n\n    urgentCases.forEach(item => {\n      const urgency = item.daysUntil <= 7 ? 'üî¥' : item.daysUntil <= 14 ? 'üü°' : 'üü¢';\n      reportSheet.getRange(`A${row}:D${row}`).setValues([[\n        `${urgency} ${item.caseNumber}`,\n        item.deadline,\n        Utilities.formatDate(item.date, Session.getScriptTimeZone(), 'dd.MM.yyyy'),\n        item.daysUntil\n      ]]);\n      row++;\n    });\n\n    if (urgentCases.length === 0) {\n      reportSheet.getRange('A4').setValue('‚úÖ –ù–µ—Ç –¥–µ–ª —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ —Å—Ä–æ–∫–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π');\n    }\n\n    reportSheet.setColumnWidths(1, 4, 150);\n\n    ui.alert(\n      '‚úÖ –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º —Å–æ–∑–¥–∞–Ω!',\n      `–õ–∏—Å—Ç: \"${reportName}\"\\n\\n–î–µ–ª —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ —Å—Ä–æ–∫–∞–º–∏: ${urgentCases.length}`,\n      ui.ButtonSet.OK\n    );\n    AppLogger.info('Reports', `–°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º: ${reportName}`);\n  }\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #5: –ú–æ–π –æ—Ç—á—ë—Ç (–¥–ª—è —é—Ä–∏—Å—Ç–∞)\n   */\n  function generateMyReport() {\n    const ui = SpreadsheetApp.getUi();\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user) {\n      ui.alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    const assignedCases = user.assigned_cases || [];\n\n    if (assignedCases.length === 0) {\n      ui.alert('‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª');\n      return;\n    }\n\n    try {\n      const ss = SpreadsheetApp.getActiveSpreadsheet();\n      const mainSheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n      const data = mainSheet.getDataRange().getValues();\n\n      const reportName = `–ú–æ–π –æ—Ç—á—ë—Ç ${user.name || userEmail} ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd')}`;\n      const reportSheet = ss.insertSheet(reportName);\n\n      // –ó–∞–≥–æ–ª–æ–≤–æ–∫\n      reportSheet.getRange('A1').setValue(`–ú–û–ô –û–¢–ß–Å–¢ - ${user.name || userEmail}`);\n      reportSheet.getRange('A1').setFontSize(14).setFontWeight('bold');\n      reportSheet.getRange('A2').setValue(`–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`);\n      reportSheet.getRange('A3').setValue(`–ù–∞–∑–Ω–∞—á–µ–Ω–æ –¥–µ–ª: ${assignedCases.length}`);\n\n      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º\n      let row = 5;\n      reportSheet.getRange(`A${row}`).setValue('–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –°–¢–ê–¢–£–°–ê–ú:').setFontWeight('bold');\n      row++;\n\n      const statusCounts = {};\n      const myCases = [];\n\n      for (let i = 1; i < data.length; i++) {\n        const rowData = data[i];\n        const caseNumber = rowData[0];\n\n        if (assignedCases.includes(caseNumber)) {\n          const status = rowData[6] || '–ù–µ —É–∫–∞–∑–∞–Ω';\n          statusCounts[status] = (statusCounts[status] || 0) + 1;\n          myCases.push(rowData);\n        }\n      }\n\n      for (const status in statusCounts) {\n        reportSheet.getRange(`A${row}`).setValue(`  ${status}: ${statusCounts[status]}`);\n        row++;\n      }\n\n      // –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ª–∞\n      row += 2;\n      reportSheet.getRange(`A${row}`).setValue('–ú–û–ò –ê–ö–¢–ò–í–ù–´–ï –î–ï–õ–ê:').setFontWeight('bold');\n      row++;\n\n      reportSheet.getRange(`A${row}:E${row}`)\n        .setValues([['–ù–æ–º–µ—Ä –¥–µ–ª–∞', '–°—É–¥', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–°—Ç–∞—Ç—É—Å', '–°–ª–µ–¥. –∑–∞—Å–µ–¥–∞–Ω–∏–µ']])\n        .setFontWeight('bold')\n        .setBackground('#4a86e8')\n        .setFontColor('#ffffff');\n      row++;\n\n      const activeCases = myCases.filter(c => {\n        const status = c[6] || '';\n        return status !== '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' && status !== '–ê—Ä—Ö–∏–≤';\n      });\n\n      activeCases.forEach(caseData => {\n        const nextHearing = caseData[11] instanceof Date ?\n          Utilities.formatDate(caseData[11], Session.getScriptTimeZone(), 'dd.MM.yyyy') :\n          '';\n\n        reportSheet.getRange(`A${row}:E${row}`).setValues([[\n          caseData[0],  // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n          caseData[1],  // –°—É–¥\n          caseData[2],  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è\n          caseData[6],  // –°—Ç–∞—Ç—É—Å\n          nextHearing\n        ]]);\n        row++;\n      });\n\n      if (activeCases.length === 0) {\n        reportSheet.getRange(`A${row}`).setValue('  –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª');\n        row++;\n      }\n\n      // –ë–ª–∏–∂–∞–π—à–∏–µ —Å—Ä–æ–∫–∏\n      row += 2;\n      reportSheet.getRange(`A${row}`).setValue('–ë–õ–ò–ñ–ê–ô–®–ò–ï –°–†–û–ö–ò (30 –¥–Ω–µ–π):').setFontWeight('bold');\n      row++;\n\n      const now = new Date();\n      const upcomingDeadlines = [];\n\n      for (const caseData of myCases) {\n        const caseNumber = caseData[0];\n\n        for (const dateCol of CONFIG.DATE_COLUMNS) {\n          const dateValue = caseData[dateCol.column - 1];\n\n          if (dateValue instanceof Date && dateValue > now) {\n            const daysUntil = Math.ceil((dateValue - now) / (1000 * 60 * 60 * 24));\n\n            if (daysUntil <= 30) {\n              upcomingDeadlines.push({\n                caseNumber: caseNumber,\n                deadline: dateCol.name,\n                date: dateValue,\n                daysUntil: daysUntil\n              });\n            }\n          }\n        }\n      }\n\n      upcomingDeadlines.sort((a, b) => a.daysUntil - b.daysUntil);\n\n      if (upcomingDeadlines.length > 0) {\n        reportSheet.getRange(`A${row}:D${row}`)\n          .setValues([['–î–µ–ª–æ', '–°—Ä–æ–∫', '–î–∞—Ç–∞', '–î–Ω–µ–π']])\n          .setFontWeight('bold');\n        row++;\n\n        upcomingDeadlines.forEach(item => {\n          const urgency = item.daysUntil <= 7 ? 'üî¥' : item.daysUntil <= 14 ? 'üü°' : 'üü¢';\n          reportSheet.getRange(`A${row}:D${row}`).setValues([[\n            `${urgency} ${item.caseNumber}`,\n            item.deadline,\n            Utilities.formatDate(item.date, Session.getScriptTimeZone(), 'dd.MM.yyyy'),\n            item.daysUntil\n          ]]);\n          row++;\n        });\n      } else {\n        reportSheet.getRange(`A${row}`).setValue('  ‚úÖ –ù–µ—Ç –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö —Å—Ä–æ–∫–æ–≤');\n      }\n\n      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n      reportSheet.setColumnWidths(1, 5, 150);\n      reportSheet.autoResizeColumns(1, 5);\n\n      ui.alert(\n        '‚úÖ –í–∞—à –æ—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω!',\n        `–õ–∏—Å—Ç: \"${reportName}\"\\n\\n` +\n        `–ù–∞–∑–Ω–∞—á–µ–Ω–æ –¥–µ–ª: ${assignedCases.length}\\n` +\n        `–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activeCases.length}\\n` +\n        `–ë–ª–∏–∂–∞–π—à–∏—Ö —Å—Ä–æ–∫–æ–≤: ${upcomingDeadlines.length}`,\n        ui.ButtonSet.OK\n      );\n\n      AppLogger.info('Reports', `–°–æ–∑–¥–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –¥–ª—è ${userEmail}: ${reportName}`);\n\n    } catch (error) {\n      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #6: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞: ${error.message}`);\n      AppLogger.error('Reports', '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞', {\n        user: userEmail,\n        error: error.message,\n        stack: error.stack\n      });\n\n      ui.alert(\n        '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞',\n        `–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç:\\n${error.message}`,\n        ui.ButtonSet.OK\n      );\n    }\n  }\n\n  /**\n   * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º\n   */\n  function showLawyersStatistics() {\n    if (!checkPermission('view_cases')) return;\n\n    const lawyers = UserManager.getUsersByRole('LAWYER');\n    const stats = {};\n\n    Object.keys(lawyers).forEach(email => {\n      const lawyer = lawyers[email];\n      stats[email] = {\n        name: lawyer.name || email,\n        casesCount: (lawyer.assigned_cases || []).length\n      };\n    });\n\n    const message = Object.keys(stats).map(email => {\n      const s = stats[email];\n      return `‚Ä¢ ${s.name}: ${s.casesCount} –¥–µ–ª`;\n    }).join('\\n');\n\n    SpreadsheetApp.getUi().alert(\n      'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º',\n      message || '–ù–µ—Ç —é—Ä–∏—Å—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ',\n      SpreadsheetApp.getUi().ButtonSet.OK\n    );\n  }\n\n  /**\n   * –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n   */\n  function showMyStatistics() {\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user) {\n      SpreadsheetApp.getUi().alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    const casesCount = (user.assigned_cases || []).length;\n\n    SpreadsheetApp.getUi().alert(\n      'üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',\n      `–í–∞—à–µ –∏–º—è: ${user.name || userEmail}\\n` +\n      `–†–æ–ª—å: ${UserManager.ROLES[user.role].name}\\n` +\n      `–ù–∞–∑–Ω–∞—á–µ–Ω–æ –¥–µ–ª: ${casesCount}`,\n      SpreadsheetApp.getUi().ButtonSet.OK\n    );\n  }\n\n  /**\n   * –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º\n   */\n  function showDeadlinesReport() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n\n    ui.alert(\n      '‚è±Ô∏è –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º',\n      '–§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π DeadlineChecker.\\n\\n' +\n      '–ó–∞–ø—É—Å—Ç–∏—Ç–µ: ‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã',\n      ui.ButtonSet.OK\n    );\n  }\n\n  /**\n   * –ú–æ–π –æ—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º\n   */\n  function showMyDeadlinesReport() {\n    const ui = SpreadsheetApp.getUi();\n\n    ui.alert(\n      '‚è±Ô∏è –ú–æ–π –æ—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º',\n      '–§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π DeadlineChecker.\\n\\n' +\n      '–ó–∞–ø—É—Å—Ç–∏—Ç–µ: ‚è∞ –î–µ–¥–ª–∞–π–Ω—ã ‚Üí üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã',\n      ui.ButtonSet.OK\n    );\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢ –ü–£–ë–õ–ò–ß–ù–´–• –ú–ï–¢–û–î–û–í\n  // ============================================\n\n  return {\n    assignCaseToLawyer: assignCaseToLawyer,\n    bulkAssignCases: bulkAssignCases,\n    searchCase: searchCase,\n    filterCasesByStatus: filterCasesByStatus,\n    showLawyerCases: showLawyerCases,\n    archiveCompletedCases: archiveCompletedCases,\n    checkStatuteOfLimitations: checkStatuteOfLimitations,\n    showCourtSchedule: showCourtSchedule,\n    showMyCourtSchedule: showMyCourtSchedule,\n    manageEnforcementProceedings: manageEnforcementProceedings,\n    showClientsDatabase: showClientsDatabase,\n    showFinancialReport: showFinancialReport,\n    showTimeTracking: showTimeTracking,\n    showMyTimeTracking: showMyTimeTracking,\n    addTimeEntry: addTimeEntry,\n    generateReport: generateReport,\n    generateMyReport: generateMyReport,\n    showLawyersStatistics: showLawyersStatistics,\n    showMyStatistics: showMyStatistics,\n    showDeadlinesReport: showDeadlinesReport,\n    showMyDeadlinesReport: showMyDeadlinesReport\n  };\n})();\n"},{"name":"Main.gs","content":"/**\n * ‚ú® Main.gs - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é\n *\n * –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã Law Table v2.1\n * –ú–µ–Ω—é –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n */\n\n/**\n * –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ç–∞–±–ª–∏—Ü—ã - –ê–î–ê–ü–¢–ò–í–ù–û–ï!\n */\nfunction onOpen() {\n  const ui = SpreadsheetApp.getUi();\n\n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ\n  initializeSystem();\n\n  // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ —Ä–æ–ª—å\n  const userEmail = Session.getActiveUser().getEmail();\n  const currentUser = UserManager.getUser(userEmail);\n\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #20: –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null/undefined\n  const userRole = (currentUser && currentUser.role) ? currentUser.role : 'OBSERVER'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Observer\n\n  AppLogger.info('Main', `–ú–µ–Ω—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userEmail} (—Ä–æ–ª—å: ${userRole})`);\n\n  // –°–æ–∑–¥–∞—Ç—å –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–∏\n  createMenuForRole(ui, userRole);\n}\n\n/**\n * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ\n */\nfunction initializeSystem() {\n  try {\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #27: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å spreadsheet\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    if (!ss) {\n      Logger.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É');\n      return;\n    }\n\n    const owner = ss.getOwner();\n    const ownerEmail = owner ? owner.getEmail() : Session.getActiveUser().getEmail();\n\n    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\n    const users = UserManager.getAllUsers();\n\n    if (Object.keys(users).length === 0) {\n      // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - —Å–æ–∑–¥–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞–∫ Admin\n      UserManager.addUser(ownerEmail, 'ADMIN', {\n        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–≤–ª–∞–¥–µ–ª–µ—Ü)',\n        notification_preferences: {\n          email: true,\n          telegram: false,\n          sms: false\n        }\n      });\n\n      AppLogger.info('Main', `–°–æ–∑–¥–∞–Ω Admin: ${ownerEmail}`);\n\n      // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n      const ui = SpreadsheetApp.getUi();\n      ui.alert(\n        'üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Law Table v2.1!\\n\\n' +\n        `–í—ã –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º: ${ownerEmail}\\n\\n` +\n        '–í—ã –º–æ–∂–µ—Ç–µ:\\n' +\n        '‚Ä¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é \"‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏\" ‚Üí \"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\"\\n' +\n        '‚Ä¢ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\\n' +\n        '‚Ä¢ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã\\n\\n' +\n        '–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:\\n' +\n        '1. –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\\n' +\n        '2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é\\n' +\n        '3. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ USER_GUIDE.md –Ω–∞ GitHub'\n      );\n    }\n  } catch (e) {\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #6: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º\n    Logger.log('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);\n    AppLogger.error('Main', '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', {\n      error: e.message,\n      stack: e.stack\n    });\n\n    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ —Å–µ—Ä—å–µ–∑–Ω–∞—è –æ—à–∏–±–∫–∞\n    try {\n      const ui = SpreadsheetApp.getUi();\n      ui.alert(\n        '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏',\n        `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã:\\n${e.message}\\n\\n` +\n        '–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.\\n' +\n        '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.',\n        ui.ButtonSet.OK\n      );\n    } catch (uiError) {\n      // –ï—Å–ª–∏ –¥–∞–∂–µ UI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º\n      Logger.log('‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ' + uiError.message);\n    }\n  }\n}\n\n/**\n * –°–æ–∑–¥–∞—Ç—å –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n */\nfunction createMenuForRole(ui, role) {\n  const menu = ui.createMenu('‚öñÔ∏è –°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞');\n\n  // ==============================================\n  // ADMIN - –ü–û–õ–ù–´–ô –î–û–°–¢–£–ü –ö–û –í–°–ï–ú–£\n  // ==============================================\n  if (role === 'ADMIN') {\n    menu\n      .addSubMenu(ui.createMenu('üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞–º–∏')\n        .addItem('üë§ –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ —é—Ä–∏—Å—Ç—É', 'assignCaseToLawyer')\n        .addItem('üìã –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª', 'bulkAssignCases')\n        .addSeparator()\n        .addItem('üîç –ù–∞–π—Ç–∏ –¥–µ–ª–æ', 'searchCase')\n        .addItem('üóÇÔ∏è –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É', 'filterCasesByStatus')\n        .addItem('üë• –î–µ–ª–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞', 'showLawyerCases')\n        .addSeparator()\n        .addItem('üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–ª–∞', 'archiveCompletedCases')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å')\n        .addItem('‚è∞ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏', 'checkStatuteOfLimitations')\n        .addItem('‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', 'manageEnforcementProceedings')\n        .addSeparator()\n        .addItem('üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π', 'showCourtSchedule')\n        .addItem('üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ–π—á–∞—Å', 'sendManualHearingNotifications')\n        .addSeparator()\n        .addItem('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'configureHearingNotifications')\n        .addItem('‚ÑπÔ∏è –¢–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'showHearingNotificationSchedule')\n        .addSeparator()\n        .addItem('üîî –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –¥–µ–ª—É', 'setupCaseCustomNotification')\n        .addItem('üìã –°–ø–∏—Å–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'showCaseCustomNotifications')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üíº –§–∏–Ω–∞–Ω—Å—ã –∏ –∫–ª–∏–µ–Ω—Ç—ã')\n        .addSubMenu(ui.createMenu('üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤')\n          .addItem('‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞', 'addNewClient')\n          .addItem('üîç –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞', 'searchClient')\n          .addItem('üìã –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã', 'showAllClients')\n          .addSeparator()\n          .addItem('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º', 'showClientStatistics')\n          .addItem('üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ–ª', 'updateAllClientStatistics')\n        )\n        .addSeparator()\n        .addSubMenu(ui.createMenu('üíµ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç')\n          .addItem('üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä', 'addFee')\n          .addItem('üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥', 'addExpense')\n          .addItem('üìÑ –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç', 'createInvoice')\n          .addSeparator()\n          .addItem('üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞', 'showFinancialSummary')\n          .addItem('‚¨áÔ∏è –ò–º–ø–æ—Ä—Ç –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏', 'importFromTimeTracking')\n        )\n        .addSeparator()\n        .addSubMenu(ui.createMenu('‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏')\n          .addItem('üìä –û–±—â–∏–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏', 'showTimeTracking')\n          .addItem('üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'showDetailedTimeStatistics')\n          .addSeparator()\n          .addItem('‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å–∏', 'approveTimeEntries')\n          .addItem('üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å', 'recalculateTimeCosts')\n          .addSeparator()\n          .addItem('üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV', 'exportTimeToCSV')\n        )\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è')\n        .addItem('üìä –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –¥–µ–ª–∞', 'processAllCases')\n        .addItem('üìÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å', 'syncAllToCalendar')\n        .addItem('üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã', 'checkDeadlines')\n        .addItem('‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 'validateAllData')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üìä –û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞')\n        .addItem('üìà –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥', 'updateDashboard')\n        .addItem('üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞', 'generateReport')\n        .addSeparator()\n        .addItem('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º', 'showLawyersStatistics')\n        .addItem('‚è±Ô∏è –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º', 'showDeadlinesReport')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏')\n        .addItem('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã', 'showConfigDialog')\n        .addItem('üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏', 'showUsersDialog')\n        .addItem('üíæ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'syncUsers')\n        .addSeparator()\n        .addSubMenu(ui.createMenu('üì± Telegram')\n          .addItem('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bot Token', 'setupTelegram')\n          .addItem('üåê –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook', 'setupTelegramWebhook')\n          .addItem('‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Webhook', 'showWebhookInfo')\n        )\n        .addSeparator()\n        .addItem('‚è∞ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã', 'setupAllTriggers')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üìã –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥')\n        .addItem('–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–æ–≥–æ–≤', 'showLogStats')\n        .addItem('–ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö', 'searchLogs')\n        .addItem('–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏', 'clearOldLogs')\n        .addSeparator()\n        .addItem('üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã', 'runAllTests')\n      )\n      .addSeparator()\n      .addItem('‚ùì –û —Å–∏—Å—Ç–µ–º–µ', 'showAbout');\n  }\n\n  // ==============================================\n  // MANAGER - –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ï–õ–ê–ú–ò + –ü–†–û–°–ú–û–¢–†\n  // ==============================================\n  else if (role === 'MANAGER') {\n    menu\n      .addSubMenu(ui.createMenu('üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞–º–∏')\n        .addItem('üë§ –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ —é—Ä–∏—Å—Ç—É', 'assignCaseToLawyer')\n        .addItem('üìã –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–ª', 'bulkAssignCases')\n        .addSeparator()\n        .addItem('üîç –ù–∞–π—Ç–∏ –¥–µ–ª–æ', 'searchCase')\n        .addItem('üóÇÔ∏è –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É', 'filterCasesByStatus')\n        .addItem('üë• –î–µ–ª–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞', 'showLawyerCases')\n        .addSeparator()\n        .addItem('üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–ª–∞', 'archiveCompletedCases')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å')\n        .addItem('‚è∞ –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏', 'checkStatuteOfLimitations')\n        .addItem('‚öñÔ∏è –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', 'manageEnforcementProceedings')\n        .addSeparator()\n        .addItem('üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π', 'showCourtSchedule')\n        .addItem('üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–µ–π—á–∞—Å', 'sendManualHearingNotifications')\n        .addSeparator()\n        .addItem('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'configureHearingNotifications')\n        .addItem('‚ÑπÔ∏è –¢–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'showHearingNotificationSchedule')\n        .addSeparator()\n        .addItem('üîî –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –¥–µ–ª—É', 'setupCaseCustomNotification')\n        .addItem('üìã –°–ø–∏—Å–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'showCaseCustomNotifications')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üíº –§–∏–Ω–∞–Ω—Å—ã –∏ –∫–ª–∏–µ–Ω—Ç—ã')\n        .addSubMenu(ui.createMenu('üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤')\n          .addItem('‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞', 'addNewClient')\n          .addItem('üîç –ù–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞', 'searchClient')\n          .addItem('üìã –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã', 'showAllClients')\n          .addSeparator()\n          .addItem('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º', 'showClientStatistics')\n          .addItem('üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ–ª', 'updateAllClientStatistics')\n        )\n        .addSeparator()\n        .addSubMenu(ui.createMenu('üíµ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —É—á—ë—Ç')\n          .addItem('üí∞ –î–æ–±–∞–≤–∏—Ç—å –≥–æ–Ω–æ—Ä–∞—Ä', 'addFee')\n          .addItem('üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥', 'addExpense')\n          .addItem('üìÑ –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç', 'createInvoice')\n          .addSeparator()\n          .addItem('üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞', 'showFinancialSummary')\n          .addItem('‚¨áÔ∏è –ò–º–ø–æ—Ä—Ç –∏–∑ —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏', 'importFromTimeTracking')\n        )\n        .addSeparator()\n        .addSubMenu(ui.createMenu('‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏')\n          .addItem('üìä –û–±—â–∏–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏', 'showTimeTracking')\n          .addItem('üìà –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'showDetailedTimeStatistics')\n          .addSeparator()\n          .addItem('‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å–∏', 'approveTimeEntries')\n          .addItem('üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å', 'recalculateTimeCosts')\n          .addSeparator()\n          .addItem('üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV', 'exportTimeToCSV')\n        )\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è')\n        .addItem('üìä –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–ª–∞', 'processAllCases')\n        .addItem('üìÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å', 'syncAllToCalendar')\n        .addItem('üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã', 'checkDeadlines')\n        .addItem('‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 'validateAllData')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üìä –û—Ç—á—ë—Ç—ã')\n        .addItem('üìà –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—à–±–æ—Ä–¥', 'updateDashboard')\n        .addItem('üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞', 'generateReport')\n        .addItem('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º', 'showLawyersStatistics')\n        .addItem('‚è±Ô∏è –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º', 'showDeadlinesReport')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üìã –õ–æ–≥–∏')\n        .addItem('–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É', 'showLogStats')\n        .addItem('–ü–æ–∏—Å–∫ –≤ –ª–æ–≥–∞—Ö', 'searchLogs')\n      )\n      .addSeparator()\n      .addItem('‚ùì –û —Å–∏—Å—Ç–µ–º–µ', 'showAbout');\n  }\n\n  // ==============================================\n  // LAWYER - –†–ê–ë–û–¢–ê –° –î–ï–õ–ê–ú–ò\n  // ==============================================\n  else if (role === 'LAWYER') {\n    menu\n      .addSubMenu(ui.createMenu('üìÅ –ú–æ–∏ –¥–µ–ª–∞')\n        .addItem('üìä –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–∏ –¥–µ–ª–∞', 'processMyCases')\n        .addItem('üîç –ù–∞–π—Ç–∏ –¥–µ–ª–æ', 'searchCase')\n        .addSeparator()\n        .addItem('üìÖ –ú–æ—ë —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π', 'showMyCourtSchedule')\n        .addItem('üìß –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∏ –¥–µ–¥–ª–∞–π–Ω—ã', 'checkMyDeadlines')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏')\n        .addItem('‚è±Ô∏è –ú–æ–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã', 'showMyTimeTracking')\n        .addItem('‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è –ø–æ –¥–µ–ª—É', 'addTimeEntry')\n      )\n      .addSeparator()\n      .addSubMenu(ui.createMenu('üìä –ú–æ–∏ –æ—Ç—á—ë—Ç—ã')\n        .addItem('üìà –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π –¥–∞—à–±–æ—Ä–¥', 'updateDashboard')\n        .addItem('üìÑ –ú–æ–π –æ—Ç—á—ë—Ç –ø–æ –¥–µ–ª–∞–º', 'generateMyReport')\n        .addItem('üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'showMyStatistics')\n        .addItem('‚è±Ô∏è –û—Ç—á—ë—Ç –ø–æ —Å—Ä–æ–∫–∞–º', 'showMyDeadlinesReport')\n      )\n      .addSeparator()\n      .addItem('üìÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å', 'syncAllToCalendar')\n      .addItem('‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 'validateAllData')\n      .addSeparator()\n      .addItem('‚ùì –û —Å–∏—Å—Ç–µ–º–µ', 'showAbout');\n  }\n\n  // ==============================================\n  // ASSISTANT - –ë–ê–ó–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò\n  // ==============================================\n  else if (role === 'ASSISTANT') {\n    menu\n      .addItem('üîç –ù–∞–π—Ç–∏ –¥–µ–ª–æ', 'searchCase')\n      .addItem('üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏–π', 'showCourtSchedule')\n      .addSeparator()\n      .addItem('üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤', 'showClientsDatabase')\n      .addSeparator()\n      .addItem('üìà –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥', 'updateDashboard')\n      .addItem('‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ', 'validateAllData')\n      .addSeparator()\n      .addItem('‚ùì –û —Å–∏—Å—Ç–µ–º–µ', 'showAbout');\n  }\n\n  // ==============================================\n  // OBSERVER - –¢–û–õ–¨–ö–û –ü–†–û–°–ú–û–¢–†\n  // ==============================================\n  else {\n    menu\n      .addItem('üìà –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥', 'updateDashboard')\n      .addSeparator()\n      .addItem('‚ùì –û —Å–∏—Å—Ç–µ–º–µ', 'showAbout');\n  }\n\n  menu.addToUi();\n}\n\n/**\n * –¢—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n */\nfunction onEdit(e) {\n  try {\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ - —Ç–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user) {\n      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —Å–∏—Å—Ç–µ–º–µ - –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n      e.range.setValue(e.oldValue || '');\n      SpreadsheetApp.getUi().alert(\n        '‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!\\n\\n' +\n        '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞.'\n      );\n      return;\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    if (!UserManager.hasPermission(userEmail, 'edit')) {\n      e.range.setValue(e.oldValue || '');\n      SpreadsheetApp.getUi().alert(\n        '‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!\\n\\n' +\n        `–í–∞—à–∞ —Ä–æ–ª—å: ${UserManager.ROLES[user.role].name}`\n      );\n      return;\n    }\n\n    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ\n    if (ConfigManager.get('SYSTEM.AUTO_VALIDATE')) {\n      DataValidator.onEditValidation(e);\n    }\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –≤ onEdit', { error: error.message });\n  }\n}\n\n// ============================================\n// –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò\n// ============================================\n\nfunction processAllCases() {\n  if (!checkPermission('manage_cases')) return;\n\n  try {\n    AppLogger.info('Main', '–ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –¥–µ–ª');\n    PerformanceMonitor.start('processAllCases');\n\n    CaseManager.processAllCases();\n\n    PerformanceMonitor.end('processAllCases');\n    PerformanceMonitor.logStats();\n\n    SpreadsheetApp.getUi().alert('‚úÖ –î–µ–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!');\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ª', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction processMyCases() {\n  const userEmail = Session.getActiveUser().getEmail();\n  const user = UserManager.getUser(userEmail);\n\n  if (!user) {\n    SpreadsheetApp.getUi().alert('‚õî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ!');\n    return;\n  }\n\n  try {\n    AppLogger.info('Main', `–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª –¥–ª—è ${userEmail}`);\n\n    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–µ–ª–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n    const assignedCases = user.assigned_cases || [];\n\n    if (assignedCases.length === 0) {\n      SpreadsheetApp.getUi().alert('‚ÑπÔ∏è –£ –≤–∞—Å –Ω–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª');\n      return;\n    }\n\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–µ–ª–∞–º (RBAC)\n    CaseManager.processAllCases(assignedCases);\n\n    SpreadsheetApp.getUi().alert(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤–∞—à–∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª!`);\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ª', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction syncAllToCalendar() {\n  if (!checkPermission('manage_cases')) return;\n\n  try {\n    AppLogger.info('Main', '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º');\n    CalendarManager.syncAllToCalendar();\n    SpreadsheetApp.getUi().alert('‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω!');\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction checkDeadlines() {\n  if (!checkPermission('view')) return;\n\n  try {\n    AppLogger.info('Main', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤');\n\n    const warningDays = ConfigManager.get('NOTIFICATIONS.DEADLINE_WARNING_DAYS');\n    const problems = DeadlineChecker.findUpcomingDeadlines(warningDays);\n\n    if (problems.length > 0) {\n      DeadlineChecker.sendDeadlineReport(problems);\n\n      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram\n      if (ConfigManager.get('NOTIFICATIONS.TELEGRAM_ENABLED')) {\n        problems.forEach(p => {\n          TelegramNotifier.notifyDeadline(\n            p.caseNumber,\n            p.columnName,\n            p.date,\n            p.daysUntil\n          );\n        });\n      }\n\n      SpreadsheetApp.getUi().alert(`‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${problems.length} –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤!\\n\\n–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.`);\n    } else {\n      SpreadsheetApp.getUi().alert('‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤!');\n    }\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction checkMyDeadlines() {\n  const userEmail = Session.getActiveUser().getEmail();\n  const user = UserManager.getUser(userEmail);\n\n  if (!user) {\n    SpreadsheetApp.getUi().alert('‚õî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ!');\n    return;\n  }\n\n  try {\n    const warningDays = ConfigManager.get('NOTIFICATIONS.DEADLINE_WARNING_DAYS');\n    const allProblems = DeadlineChecker.findUpcomingDeadlines(warningDays);\n\n    // –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–µ–ª–∞\n    const assignedCases = user.assigned_cases || [];\n    const myProblems = allProblems.filter(p => assignedCases.includes(p.caseNumber));\n\n    if (myProblems.length > 0) {\n      let message = `‚ö†Ô∏è –ù–∞–π–¥–µ–Ω–æ ${myProblems.length} –≤–∞—à–∏—Ö –¥–µ–¥–ª–∞–π–Ω–æ–≤:\\n\\n`;\n      myProblems.forEach((p, i) => {\n        message += `${i + 1}. ${p.caseNumber} - ${p.columnName} (—á–µ—Ä–µ–∑ ${p.daysUntil} –¥–Ω.)\\n`;\n      });\n\n      SpreadsheetApp.getUi().alert(message);\n    } else {\n      SpreadsheetApp.getUi().alert('‚úÖ –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤!');\n    }\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥–ª–∞–π–Ω–æ–≤', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction updateDashboard() {\n  if (!checkPermission('view')) return;\n\n  try {\n    EnhancedDashboard.createOrUpdateDashboard();\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\nfunction validateAllData() {\n  if (!checkPermission('view')) return;\n\n  try {\n    const isValid = DataValidator.validateSheet();\n    if (isValid) {\n      AppLogger.info('Main', '–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞');\n    }\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\n// ============================================\n// –ù–ê–°–¢–†–û–ô–ö–ò (—Ç–æ–ª—å–∫–æ Admin)\n// ============================================\n\nfunction showConfigDialog() {\n  if (!checkPermission('all')) return;\n  ConfigManager.showConfigDialog();\n}\n\nfunction showUsersDialog() {\n  if (!checkPermission('all')) return;\n  UserManager.showManageUsersDialog();\n}\n\nfunction setupTelegram() {\n  if (!checkPermission('all')) return;\n  TelegramNotifier.setup();\n}\n\nfunction setupTelegramWebhook() {\n  if (!checkPermission('all')) return;\n  TelegramBot.setupWebhook();\n}\n\nfunction showWebhookInfo() {\n  if (!checkPermission('all')) return;\n  const info = TelegramBot.getWebhookInfo();\n\n  if (info && info.result) {\n    const result = info.result;\n    const ui = SpreadsheetApp.getUi();\n\n    let message = 'üì± *–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram Webhook*\\n\\n';\n    message += `URL: ${result.url || '–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω'}\\n`;\n    message += `–û–∂–∏–¥–∞—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: ${result.pending_update_count || 0}\\n`;\n\n    if (result.last_error_date) {\n      const errorDate = new Date(result.last_error_date * 1000);\n      message += `\\n‚ö†Ô∏è –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞:\\n`;\n      message += `–î–∞—Ç–∞: ${errorDate.toLocaleString('ru-RU')}\\n`;\n      message += `–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.last_error_message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;\n    }\n\n    ui.alert('üì± Webhook –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', message, ui.ButtonSet.OK);\n  } else {\n    SpreadsheetApp.getUi().alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ webhook');\n  }\n}\n\nfunction syncUsers() {\n  if (!checkPermission('all')) return;\n  UserManager.syncUsersFromSheet();\n}\n\nfunction setupAllTriggers() {\n  if (!checkPermission('all')) return;\n\n  try {\n    AppLogger.setupAutoCleanup();\n    Dashboard.setupAutoUpdate();\n    TelegramNotifier.setupDailyDigest();\n    ReminderManager.setupDailyCheck();\n    HearingNotifier.setupHearingNotificationTrigger();\n\n    SpreadsheetApp.getUi().alert(\n      '‚úÖ –í—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:\\n\\n' +\n      '- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00)\\n' +\n      '- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ (–∫–∞–∂–¥—ã–π —á–∞—Å)\\n' +\n      '- Telegram –¥–∞–π–¥–∂–µ—Å—Ç (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 9:00)\\n' +\n      '- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 8:00)\\n' +\n      '- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö (–∫–∞–∂–¥—ã–π —á–∞—Å)'\n    );\n\n    AppLogger.info('Main', '–í—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');\n  } catch (error) {\n    AppLogger.error('Main', '–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤', { error: error.message });\n    SpreadsheetApp.getUi().alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);\n  }\n}\n\n// ============================================\n// –õ–û–ì–ò –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì\n// ============================================\n\nfunction showLogStats() {\n  if (!checkPermission('view')) return;\n  AppLogger.showStats();\n}\n\nfunction searchLogs() {\n  if (!checkPermission('view')) return;\n  AppLogger.showSearchDialog();\n}\n\nfunction clearOldLogs() {\n  if (!checkPermission('all')) return;\n\n  const ui = SpreadsheetApp.getUi();\n  const response = ui.alert(\n    '–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤',\n    '–£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π?',\n    ui.ButtonSet.YES_NO\n  );\n\n  if (response === ui.Button.YES) {\n    AppLogger.clearOldLogs(30);\n    ui.alert('‚úÖ –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã!');\n  }\n}\n\nfunction runAllTests() {\n  if (!checkPermission('all')) return;\n  runTests();\n  SpreadsheetApp.getUi().alert('‚úÖ –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!\\n\\n–°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Execution Log.');\n}\n\n// ============================================\n// –°–ü–†–ê–í–ö–ê\n// ============================================\n\nfunction showAbout() {\n  const userEmail = Session.getActiveUser().getEmail();\n  const user = UserManager.getUser(userEmail);\n  const roleName = user ? UserManager.ROLES[user.role].name : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞';\n\n  const message =\n    '‚öñÔ∏è –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–£–î–ï–ë–ù–´–ú–ò –î–ï–õ–ê–ú–ò\\n\\n' +\n    '–í–µ—Ä—Å–∏—è: 2.1.0\\n\\n' +\n    `–í–∞—à email: ${userEmail}\\n` +\n    `–í–∞—à–∞ —Ä–æ–ª—å: ${roleName}\\n\\n` +\n    '–í–û–ó–ú–û–ñ–ù–û–°–¢–ò:\\n' +\n    '‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ª\\n' +\n    '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Calendar\\n' +\n    '‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤\\n' +\n    '‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º —Ä–æ–ª–µ–π\\n' +\n    '‚úÖ –í–∏–∑—É–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥\\n' +\n    '‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö\\n' +\n    '‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\\n' +\n    '‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\\n\\n' +\n    '–ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:\\n' +\n    '‚ö° 6.5x –±—ã—Å—Ç—Ä–µ–µ (v2.0)\\n' +\n    'üìâ 10x –º–µ–Ω—å—à–µ API –≤—ã–∑–æ–≤–æ–≤\\n' +\n    'üõ°Ô∏è 100% –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å (retry –ª–æ–≥–∏–∫–∞)\\n\\n' +\n    'GitHub: https://github.com/Andrew821667/Law_table\\n' +\n    '–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: USER_GUIDE.md, TELEGRAM_SETUP.md';\n\n  SpreadsheetApp.getUi().alert(message);\n}\n\n// ============================================\n// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò\n// ============================================\n\n/**\n * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞\n */\nfunction checkPermission(permission) {\n  const userEmail = Session.getActiveUser().getEmail();\n\n  if (!UserManager.hasPermission(userEmail, permission)) {\n    const user = UserManager.getUser(userEmail);\n    const roleName = user ? UserManager.ROLES[user.role].name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';\n\n    SpreadsheetApp.getUi().alert(\n      '‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏!\\n\\n' +\n      `–í–∞—à–∞ —Ä–æ–ª—å: ${roleName}\\n` +\n      `–¢—Ä–µ–±—É–µ–º–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: ${permission}\\n\\n` +\n      '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.'\n    );\n    return false;\n  }\n\n  return true;\n}\n\n// ============================================\n// –û–ë–Å–†–¢–ö–ò –î–õ–Ø LEGALWORKFLOWMANAGER\n// ============================================\n\n/**\n * –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ - –æ–±—ë—Ä—Ç–∫–∏ –¥–ª—è LegalWorkflowManager\n */\n\nfunction assignCaseToLawyer() {\n  return LegalWorkflowManager.assignCaseToLawyer();\n}\n\nfunction bulkAssignCases() {\n  return LegalWorkflowManager.bulkAssignCases();\n}\n\nfunction searchCase() {\n  return LegalWorkflowManager.searchCase();\n}\n\nfunction filterCasesByStatus() {\n  return LegalWorkflowManager.filterCasesByStatus();\n}\n\nfunction showLawyerCases() {\n  return LegalWorkflowManager.showLawyerCases();\n}\n\nfunction archiveCompletedCases() {\n  return LegalWorkflowManager.archiveCompletedCases();\n}\n\nfunction checkStatuteOfLimitations() {\n  return LegalWorkflowManager.checkStatuteOfLimitations();\n}\n\nfunction showCourtSchedule() {\n  return LegalWorkflowManager.showCourtSchedule();\n}\n\nfunction showMyCourtSchedule() {\n  return LegalWorkflowManager.showMyCourtSchedule();\n}\n\nfunction manageEnforcementProceedings() {\n  return LegalWorkflowManager.manageEnforcementProceedings();\n}\n\nfunction showClientsDatabase() {\n  return LegalWorkflowManager.showClientsDatabase();\n}\n\nfunction showFinancialReport() {\n  return LegalWorkflowManager.showFinancialReport();\n}\n\nfunction showTimeTracking() {\n  return LegalWorkflowManager.showTimeTracking();\n}\n\nfunction showMyTimeTracking() {\n  return LegalWorkflowManager.showMyTimeTracking();\n}\n\nfunction addTimeEntry() {\n  return LegalWorkflowManager.addTimeEntry();\n}\n\nfunction generateReport() {\n  return LegalWorkflowManager.generateReport();\n}\n\nfunction generateMyReport() {\n  return LegalWorkflowManager.generateMyReport();\n}\n\nfunction showLawyersStatistics() {\n  return LegalWorkflowManager.showLawyersStatistics();\n}\n\nfunction showMyStatistics() {\n  return LegalWorkflowManager.showMyStatistics();\n}\n\nfunction showDeadlinesReport() {\n  return LegalWorkflowManager.showDeadlinesReport();\n}\n\nfunction showMyDeadlinesReport() {\n  return LegalWorkflowManager.showMyDeadlinesReport();\n}\n\n// ============================================\n// –û–ë–Å–†–¢–ö–ò –î–õ–Ø TIMETRACKER\n// ============================================\n\nfunction showDetailedTimeStatistics() {\n  return TimeTracker.showDetailedStatistics();\n}\n\nfunction approveTimeEntries() {\n  return TimeTracker.approveTimeEntries();\n}\n\nfunction recalculateTimeCosts() {\n  return TimeTracker.recalculateCosts();\n}\n\nfunction exportTimeToCSV() {\n  return TimeTracker.exportTimeToCSV();\n}\n\n// ============================================\n// –û–ë–Å–†–¢–ö–ò –î–õ–Ø CLIENTDATABASE\n// ============================================\n\nfunction addNewClient() {\n  return ClientDatabase.addNewClient();\n}\n\nfunction searchClient() {\n  return ClientDatabase.searchClient();\n}\n\nfunction showAllClients() {\n  return ClientDatabase.showAllClients();\n}\n\nfunction showClientStatistics() {\n  return ClientDatabase.showClientStatistics();\n}\n\nfunction updateAllClientStatistics() {\n  return ClientDatabase.updateAllClientStatistics();\n}\n\nfunction showClientCases(clientId) {\n  return ClientDatabase.showClientCases(clientId);\n}\n\n// ============================================\n// –û–ë–Å–†–¢–ö–ò –î–õ–Ø FINANCIALMANAGER\n// ============================================\n\nfunction addFee() {\n  return FinancialManager.addFee();\n}\n\nfunction addExpense() {\n  return FinancialManager.addExpense();\n}\n\nfunction createInvoice() {\n  return FinancialManager.createInvoice();\n}\n\nfunction showFinancialSummary() {\n  return FinancialManager.showFinancialSummary();\n}\n\nfunction importFromTimeTracking() {\n  return FinancialManager.importFromTimeTracking();\n}\n\n// ============================================\n// –û–ë–Å–†–¢–ö–ò –î–õ–Ø HEARINGNOTIFIER\n// ============================================\n\nfunction sendManualHearingNotifications() {\n  return HearingNotifier.sendManualNotifications();\n}\n\nfunction configureHearingNotifications() {\n  return HearingNotifier.configureNotificationSchedule();\n}\n\nfunction showHearingNotificationSchedule() {\n  return HearingNotifier.showCurrentSchedule();\n}\n\nfunction setupCaseCustomNotification() {\n  return HearingNotifier.setupCustomCaseNotification();\n}\n\nfunction showCaseCustomNotifications() {\n  return HearingNotifier.showCustomNotifications();\n}\n"},{"name":"PerformanceMonitor.gs","content":"/**\n * ‚ú® PerformanceMonitor.gs - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n */\n\nvar PerformanceMonitor = (function() {\n\n  const metrics = {};\n\n  function start(label) {\n    metrics[label] = {\n      startTime: new Date().getTime(),\n      endTime: null,\n      duration: null\n    };\n  }\n\n  function end(label) {\n    if (!metrics[label]) {\n      AppLogger.warn('PerformanceMonitor', `–ú–µ—Ç—Ä–∏–∫–∞ ${label} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);\n      return;\n    }\n\n    metrics[label].endTime = new Date().getTime();\n    metrics[label].duration = metrics[label].endTime - metrics[label].startTime;\n\n    if (metrics[label].duration > 1000) {\n      AppLogger.warn(\n        'PerformanceMonitor',\n        `–ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: ${label} (${metrics[label].duration}ms)`\n      );\n    }\n  }\n\n  function measure(label, fn) {\n    start(label);\n    try {\n      const result = fn();\n      end(label);\n      return result;\n    } catch (e) {\n      end(label);\n      throw e;\n    }\n  }\n\n  function getStats() {\n    const stats = {};\n    Object.keys(metrics).forEach(label => {\n      if (metrics[label].duration !== null) {\n        stats[label] = metrics[label].duration;\n      }\n    });\n    return stats;\n  }\n\n  function logStats() {\n    const stats = getStats();\n    const total = Object.values(stats).reduce((sum, dur) => sum + dur, 0);\n\n    AppLogger.info('PerformanceMonitor', `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${total}ms`);\n\n    Object.keys(stats).forEach(label => {\n      const percent = ((stats[label] / total) * 100).toFixed(1);\n      AppLogger.info('PerformanceMonitor', `  ${label}: ${stats[label]}ms (${percent}%)`);\n    });\n  }\n\n  return {\n    start: start,\n    end: end,\n    measure: measure,\n    getStats: getStats,\n    logStats: logStats\n  };\n})();\n"},{"name":"ReminderManager.gs","content":"/**\n * ‚ú® ReminderManager.gs - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n */\n\nvar ReminderManager = (function() {\n\n  function createReminders(caseNumber, eventDate, eventName) {\n    const remindBefore = [7, 3, 1];\n\n    remindBefore.forEach(days => {\n      const reminderDate = new Date(eventDate);\n      reminderDate.setDate(reminderDate.getDate() - days);\n\n      if (reminderDate > new Date()) {\n        const props = PropertiesService.getScriptProperties();\n        const key = `reminder_${caseNumber}_${eventName}_${days}`;\n        props.setProperty(key, JSON.stringify({\n          caseNumber: caseNumber,\n          eventName: eventName,\n          eventDate: eventDate.toISOString(),\n          daysBefore: days,\n          reminderDate: reminderDate.toISOString()\n        }));\n      }\n    });\n\n    AppLogger.info('ReminderManager', `–°–æ–∑–¥–∞–Ω–æ ${remindBefore.length} –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥–ª—è ${caseNumber}`);\n  }\n\n  function sendReminder() {\n    const props = PropertiesService.getScriptProperties();\n    const allProps = props.getProperties();\n    const today = new Date().toDateString();\n\n    Object.keys(allProps).forEach(key => {\n      if (!key.startsWith('reminder_')) return;\n\n      try {\n        const data = JSON.parse(allProps[key]);\n        const reminderDate = new Date(data.reminderDate);\n\n        if (reminderDate.toDateString() === today) {\n          const message =\n            `‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á–µ—Ä–µ–∑ ${data.daysBefore} –¥–Ω. - ` +\n            `${data.eventName} –ø–æ –¥–µ–ª—É ${data.caseNumber}`;\n\n          TelegramNotifier.sendImportant('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ', message, data.caseNumber);\n          props.deleteProperty(key);\n        }\n      } catch (e) {\n        AppLogger.error('ReminderManager', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è', { error: e.message });\n      }\n    });\n  }\n\n  function setupDailyCheck() {\n    const triggers = ScriptApp.getProjectTriggers();\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === 'ReminderManager.sendReminder') {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    ScriptApp.newTrigger('ReminderManager.sendReminder')\n      .timeBased()\n      .atHour(8)\n      .everyDays(1)\n      .create();\n\n    AppLogger.info('ReminderManager', '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');\n  }\n\n  return {\n    createReminders: createReminders,\n    sendReminder: sendReminder,\n    setupDailyCheck: setupDailyCheck\n  };\n})();\n"},{"name":"TelegramBot.gs","content":"/**\n * TelegramBot.gs\n *\n * –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π Telegram –±–æ—Ç - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è TelegramNotifier.gs\n *\n * TelegramNotifier.gs - –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n * TelegramBot.gs - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n *\n * –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:\n * - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ webhook\n * - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é —Å inline –∫–Ω–æ–ø–∫–∞–º–∏\n * - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ–ª –∏ –∑–∞—Å–µ–¥–∞–Ω–∏–π\n * - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ç—É—Å, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –¥–∞—Ç—ã)\n * - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–µ–ª\n * - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –¥–∏–∞–ª–æ–≥–∞\n */\n\nvar TelegramBot = (function() {\n  'use strict';\n\n  const BOT_TOKEN_KEY = 'TELEGRAM_BOT_TOKEN';\n\n  // –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü—ã (0-based –¥–ª—è JavaScript)\n  const COLUMNS = {\n    CASE_NUMBER: 0,        // A - –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    CLIENT_NAME: 1,        // B - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞\n    CASE_TYPE: 2,          // C - –¢–∏–ø –¥–µ–ª–∞\n    STATUS: 3,             // D - –°—Ç–∞—Ç—É—Å\n    COURT: 4,              // E - –°—É–¥\n    PRIORITY: 5,           // F - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n    PLAINTIFF: 6,          // G - –ò—Å—Ç–µ—Ü\n    DEFENDANT: 7,          // H - –û—Ç–≤–µ—Ç—á–∏–∫\n    CLAIM_AMOUNT: 8,       // I - –°—É–º–º–∞ –∏—Å–∫–∞\n    FILING_DATE: 9,        // J - –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏\n    INCIDENT_DATE: 10,     // K - –î–∞—Ç–∞ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\n    CASE_CATEGORY: 11,     // L - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–µ–ª–∞\n    ASSIGNED_LAWYER: 12,   // M - –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç\n    DESCRIPTION: 13,       // N - –û–ø–∏—Å–∞–Ω–∏–µ\n    NOTES: 14,             // O - –ó–∞–º–µ—Ç–∫–∏\n    DOCUMENTS_LINK: 15,    // P - –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n    HEARING_DATE: 16,      // Q - –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è\n    COLUMN_R: 17,          // R\n    COLUMN_S: 18,          // S\n    COLUMN_T: 19,          // T\n    COLUMN_U: 20,          // U\n    COLUMN_V: 21,          // V\n    COLUMN_W: 22,          // W\n    COLUMN_X: 23           // X\n  };\n\n  // –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º\n  const COLUMN_NAMES = {\n    0: '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n    1: '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞',\n    2: '–¢–∏–ø –¥–µ–ª–∞',\n    3: '–°—Ç–∞—Ç—É—Å',\n    4: '–°—É–¥',\n    5: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',\n    6: '–ò—Å—Ç–µ—Ü',\n    7: '–û—Ç–≤–µ—Ç—á–∏–∫',\n    8: '–°—É–º–º–∞ –∏—Å–∫–∞',\n    9: '–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏',\n    10: '–î–∞—Ç–∞ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è',\n    11: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–µ–ª–∞',\n    12: '–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç',\n    13: '–û–ø–∏—Å–∞–Ω–∏–µ',\n    14: '–ó–∞–º–µ—Ç–∫–∏',\n    15: '–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã',\n    16: '–î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è',\n    17: '–°—Ç–æ–ª–±–µ—Ü R',\n    18: '–°—Ç–æ–ª–±–µ—Ü S',\n    19: '–°—Ç–æ–ª–±–µ—Ü T',\n    20: '–°—Ç–æ–ª–±–µ—Ü U',\n    21: '–°—Ç–æ–ª–±–µ—Ü V',\n    22: '–°—Ç–æ–ª–±–µ—Ü W',\n    23: '–°—Ç–æ–ª–±–µ—Ü X'\n  };\n\n  // ============================================\n  // WEBHOOK –û–ë–†–ê–ë–û–¢–ß–ò–ö\n  // ============================================\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö webhook –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram\n   */\n  function doPost(e) {\n    try {\n      const update = JSON.parse(e.postData.contents);\n\n      AppLogger.info('TelegramBot', '–ü–æ–ª—É—á–µ–Ω update', {\n        update_id: update.update_id\n      });\n\n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n      if (update.message) {\n        handleMessage(update.message);\n      }\n\n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ callback query (–Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–æ–∫)\n      if (update.callback_query) {\n        handleCallbackQuery(update.callback_query);\n      }\n\n      return ContentService.createTextOutput(JSON.stringify({ ok: true }))\n        .setMimeType(ContentService.MimeType.JSON);\n\n    } catch (error) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook', {\n        error: error.message,\n        stack: error.stack\n      });\n\n      return ContentService.createTextOutput(JSON.stringify({ ok: false }))\n        .setMimeType(ContentService.MimeType.JSON);\n    }\n  }\n\n  // ============================================\n  // –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–ô\n  // ============================================\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n   */\n  function handleMessage(message) {\n    const chatId = message.chat.id;\n    const text = message.text || '';\n    const user = getUserByChatId(chatId);\n\n    if (!user) {\n      sendMessage(chatId,\n        '‚ùå –í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.\\n\\n' +\n        '–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—à Telegram Chat ID —á–µ—Ä–µ–∑ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.'\n      );\n      return;\n    }\n\n    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥\n    if (text.startsWith('/')) {\n      handleCommand(chatId, text, user);\n      return;\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞\n    const state = getUserState(chatId);\n    if (state) {\n      handleStateInput(chatId, text, state, user);\n      return;\n    }\n\n    // –ï—Å–ª–∏ –Ω–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é\n    sendMainMenu(chatId, user);\n  }\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥\n   */\n  function handleCommand(chatId, command, user) {\n    const cmd = command.split(' ')[0].toLowerCase();\n\n    switch (cmd) {\n      case '/start':\n      case '/menu':\n        sendMainMenu(chatId, user);\n        break;\n\n      case '/help':\n        sendHelpMessage(chatId);\n        break;\n\n      case '/mycases':\n        showMyCases(chatId, user);\n        break;\n\n      case '/hearings':\n        showUpcomingHearings(chatId, user);\n        break;\n\n      case '/cancel':\n        clearUserState(chatId);\n        sendMessage(chatId, '‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞');\n        sendMainMenu(chatId, user);\n        break;\n\n      default:\n        sendMessage(chatId, '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /menu –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é');\n    }\n  }\n\n  // ============================================\n  // –û–ë–†–ê–ë–û–¢–ö–ê CALLBACK QUERIES (–ö–ù–û–ü–ö–ò)\n  // ============================================\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline –∫–Ω–æ–ø–∫–∏\n   */\n  function handleCallbackQuery(callbackQuery) {\n    const chatId = callbackQuery.message.chat.id;\n    const messageId = callbackQuery.message.message_id;\n    const data = callbackQuery.data;\n    const user = getUserByChatId(chatId);\n\n    if (!user) {\n      answerCallbackQuery(callbackQuery.id, '–í—ã –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã');\n      return;\n    }\n\n    AppLogger.info('TelegramBot', 'Callback query', {\n      user: user.email,\n      data: data\n    });\n\n    // –ü–∞—Ä—Å–∏–º callback data\n    const parts = data.split(':');\n    const action = parts[0];\n\n    try {\n      switch (action) {\n        case 'menu_view':\n          handleViewMenu(chatId, messageId, parts[1], user);\n          break;\n\n        case 'menu_edit':\n          handleEditMenu(chatId, messageId, parts[1], user);\n          break;\n\n        case 'menu_add':\n          handleAddMenu(chatId, messageId, parts[1], user);\n          break;\n\n        case 'view_cases':\n          showCases(chatId, messageId, user);\n          break;\n\n        case 'view_hearings':\n          showUpcomingHearingsInline(chatId, messageId, user);\n          break;\n\n        case 'view_case':\n          showCaseDetails(chatId, messageId, parts[1], user);\n          break;\n\n        case 'edit_case':\n          startEditCase(chatId, parts[1], user);\n          break;\n\n        case 'edit_field':\n          startEditField(chatId, parts[1], parts[2], user);\n          break;\n\n        case 'reschedule_hearing':\n          startRescheduleHearing(chatId, parts[1], user);\n          break;\n\n        case 'add_case':\n          startAddCase(chatId, user);\n          break;\n\n        case 'back_main':\n          editMainMenu(chatId, messageId, user);\n          break;\n\n        case 'back_view':\n          handleViewMenu(chatId, messageId, 'main', user);\n          break;\n\n        case 'back_edit':\n          handleEditMenu(chatId, messageId, 'main', user);\n          break;\n\n        default:\n          answerCallbackQuery(callbackQuery.id, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞');\n      }\n\n      answerCallbackQuery(callbackQuery.id);\n\n    } catch (error) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback', {\n        error: error.message,\n        data: data\n      });\n      answerCallbackQuery(callbackQuery.id, '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');\n    }\n  }\n\n  // ============================================\n  // –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ\n  // ============================================\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n   */\n  function sendMainMenu(chatId, user) {\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: 'üìã –ü—Ä–æ—Å–º–æ—Ç—Ä', callback_data: 'menu_view:main' },\n          { text: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', callback_data: 'menu_edit:main' }\n        ],\n        [\n          { text: '‚ûï –î–æ–±–∞–≤–∏—Ç—å', callback_data: 'menu_add:main' }\n        ],\n        [\n          { text: 'üìÖ –ú–æ–∏ –∑–∞—Å–µ–¥–∞–Ω–∏—è', callback_data: 'view_hearings' }\n        ]\n      ]\n    };\n\n    const roleText = getRoleText(user.role);\n    const message =\n      `üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name || user.email}!\\n\\n` +\n      `–†–æ–ª—å: ${roleText}\\n\\n` +\n      `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`;\n\n    sendMessage(chatId, message, keyboard);\n  }\n\n  /**\n   * –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n   */\n  function editMainMenu(chatId, messageId, user) {\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: 'üìã –ü—Ä–æ—Å–º–æ—Ç—Ä', callback_data: 'menu_view:main' },\n          { text: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ', callback_data: 'menu_edit:main' }\n        ],\n        [\n          { text: '‚ûï –î–æ–±–∞–≤–∏—Ç—å', callback_data: 'menu_add:main' }\n        ],\n        [\n          { text: 'üìÖ –ú–æ–∏ –∑–∞—Å–µ–¥–∞–Ω–∏—è', callback_data: 'view_hearings' }\n        ]\n      ]\n    };\n\n    const roleText = getRoleText(user.role);\n    const message =\n      `üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name || user.email}!\\n\\n` +\n      `–†–æ–ª—å: ${roleText}\\n\\n` +\n      `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`;\n\n    editMessage(chatId, messageId, message, keyboard);\n  }\n\n  /**\n   * –ú–µ–Ω—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞\n   */\n  function handleViewMenu(chatId, messageId, submenu, user) {\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: 'üìÅ –í—Å–µ –¥–µ–ª–∞', callback_data: 'view_cases' }\n        ],\n        [\n          { text: 'üìÖ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è', callback_data: 'view_hearings' }\n        ],\n        [\n          { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back_main' }\n        ]\n      ]\n    };\n\n    editMessage(chatId, messageId, 'üìã *–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö*\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:', keyboard);\n  }\n\n  /**\n   * –ú–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n   */\n  function handleEditMenu(chatId, messageId, submenu, user) {\n    if (!checkPermission(user, 'edit_cases')) {\n      editMessage(chatId, messageId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');\n      return;\n    }\n\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: 'üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–ª–æ', callback_data: 'view_cases' }\n        ],\n        [\n          { text: 'üìÖ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞—Å–µ–¥–∞–Ω–∏–µ', callback_data: 'view_hearings' }\n        ],\n        [\n          { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back_main' }\n        ]\n      ]\n    };\n\n    editMessage(chatId, messageId, '‚úèÔ∏è *–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ*\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', keyboard);\n  }\n\n  /**\n   * –ú–µ–Ω—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è\n   */\n  function handleAddMenu(chatId, messageId, submenu, user) {\n    if (!checkPermission(user, 'add_cases')) {\n      editMessage(chatId, messageId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ');\n      return;\n    }\n\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: '‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–µ–ª–æ', callback_data: 'add_case' }\n        ],\n        [\n          { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back_main' }\n        ]\n      ]\n    };\n\n    editMessage(chatId, messageId, '‚ûï *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ*\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ —á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:', keyboard);\n  }\n\n  // ============================================\n  // –ü–†–û–°–ú–û–¢–† –î–ê–ù–ù–´–•\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–µ–ª\n   */\n  function showCases(chatId, messageId, user) {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const cases = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[COLUMNS.CASE_NUMBER];\n\n      if (!caseNumber) continue;\n\n      // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–µ–ª–∞–º –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤\n      if (user.role === 'LAWYER') {\n        if (user.assigned_cases && !user.assigned_cases.includes(caseNumber)) {\n          continue;\n        }\n      }\n\n      cases.push({\n        number: caseNumber,\n        client: row[COLUMNS.CLIENT_NAME] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n        status: row[COLUMNS.STATUS] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n        rowIndex: i + 1\n      });\n    }\n\n    if (cases.length === 0) {\n      editMessage(chatId, messageId, 'üìÅ –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–ª');\n      return;\n    }\n\n    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 –¥–µ–ª\n    const displayCases = cases.slice(0, 10);\n    let message = `üìÅ *–°–ø–∏—Å–æ–∫ –¥–µ–ª* (${cases.length} —à—Ç.)\\n\\n`;\n\n    displayCases.forEach((c, i) => {\n      message += `${i + 1}. ${c.number}\\n`;\n      message += `   –ö–ª–∏–µ–Ω—Ç: ${c.client}\\n`;\n      message += `   –°—Ç–∞—Ç—É—Å: ${c.status}\\n\\n`;\n    });\n\n    if (cases.length > 10) {\n      message += `...–∏ –µ—â—ë ${cases.length - 10} –¥–µ–ª\\n\\n`;\n    }\n\n    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 5 –¥–µ–ª\n    const keyboard = {\n      inline_keyboard: []\n    };\n\n    displayCases.slice(0, 5).forEach(c => {\n      keyboard.inline_keyboard.push([\n        { text: `üìã ${c.number}`, callback_data: `view_case:${c.number}` }\n      ]);\n    });\n\n    keyboard.inline_keyboard.push([\n      { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back_view' }\n    ]);\n\n    editMessage(chatId, messageId, message, keyboard);\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–µ–ª–∞\n   */\n  function showCaseDetails(chatId, messageId, caseNumber, user) {\n    const caseData = findCaseByCaseNumber(caseNumber);\n\n    if (!caseData) {\n      editMessage(chatId, messageId, '‚ùå –î–µ–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n      return;\n    }\n\n    const row = caseData.row;\n    let message = `üìã *–î–µ–ª–æ: ${caseNumber}*\\n\\n`;\n\n    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n    message += `üë§ –ö–ª–∏–µ–Ω—Ç: ${row[COLUMNS.CLIENT_NAME] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n`;\n    message += `üìÇ –¢–∏–ø: ${row[COLUMNS.CASE_TYPE] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n`;\n    message += `üìä –°—Ç–∞—Ç—É—Å: ${row[COLUMNS.STATUS] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n`;\n    message += `üèõÔ∏è –°—É–¥: ${row[COLUMNS.COURT] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n`;\n    message += `üî• –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${row[COLUMNS.PRIORITY] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n\\n`;\n\n    // –°—Ç–æ—Ä–æ–Ω—ã\n    message += `‚öñÔ∏è –ò—Å—Ç–µ—Ü: ${row[COLUMNS.PLAINTIFF] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n`;\n    message += `‚öñÔ∏è –û—Ç–≤–µ—Ç—á–∏–∫: ${row[COLUMNS.DEFENDANT] || '–ù–µ —É–∫–∞–∑–∞–Ω'}\\n\\n`;\n\n    // –î–∞—Ç—ã\n    if (row[COLUMNS.HEARING_DATE]) {\n      const dateStr = formatDate(row[COLUMNS.HEARING_DATE]);\n      message += `üìÖ –ó–∞—Å–µ–¥–∞–Ω–∏–µ: ${dateStr}\\n`;\n    }\n\n    if (row[COLUMNS.FILING_DATE]) {\n      const dateStr = formatDate(row[COLUMNS.FILING_DATE]);\n      message += `üìù –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: ${dateStr}\\n`;\n    }\n\n    // –Æ—Ä–∏—Å—Ç\n    message += `\\nüë®‚Äç‚öñÔ∏è –Æ—Ä–∏—Å—Ç: ${row[COLUMNS.ASSIGNED_LAWYER] || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}\\n`;\n\n    // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å', callback_data: `edit_case:${caseNumber}` }\n        ],\n        [\n          { text: '‚¨ÖÔ∏è –ö —Å–ø–∏—Å–∫—É –¥–µ–ª', callback_data: 'view_cases' }\n        ]\n      ]\n    };\n\n    editMessage(chatId, messageId, message, keyboard);\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è\n   */\n  function showUpcomingHearingsInline(chatId, messageId, user) {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const hearings = [];\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const caseNumber = row[COLUMNS.CASE_NUMBER];\n      const hearingDate = row[COLUMNS.HEARING_DATE];\n\n      if (!caseNumber || !hearingDate || !(hearingDate instanceof Date)) continue;\n      if (hearingDate < now) continue;\n\n      // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –¥–µ–ª–∞–º –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤\n      if (user.role === 'LAWYER') {\n        if (user.assigned_cases && !user.assigned_cases.includes(caseNumber)) {\n          continue;\n        }\n      }\n\n      const daysUntil = Math.floor((hearingDate - now) / (1000 * 60 * 60 * 24));\n\n      hearings.push({\n        caseNumber: caseNumber,\n        date: hearingDate,\n        court: row[COLUMNS.COURT] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n        plaintiff: row[COLUMNS.PLAINTIFF] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n        defendant: row[COLUMNS.DEFENDANT] || '–ù–µ —É–∫–∞–∑–∞–Ω',\n        daysUntil: daysUntil\n      });\n    }\n\n    hearings.sort((a, b) => a.date - b.date);\n\n    if (hearings.length === 0) {\n      editMessage(chatId, messageId, 'üìÖ –ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏–π');\n      return;\n    }\n\n    let message = `üìÖ *–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è* (${hearings.length} —à—Ç.)\\n\\n`;\n\n    hearings.slice(0, 10).forEach((h, i) => {\n      const dateStr = formatDate(h.date);\n      const urgency = h.daysUntil === 0 ? 'üî¥ –°–ï–ì–û–î–ù–Ø' :\n                      h.daysUntil === 1 ? 'üü° –ó–ê–í–¢–†–ê' :\n                      h.daysUntil <= 3 ? 'üü† ' + h.daysUntil + ' –¥–Ω.' :\n                      'üü¢ ' + h.daysUntil + ' –¥–Ω.';\n\n      message += `${i + 1}. ${urgency}\\n`;\n      message += `   üìã –î–µ–ª–æ: ${h.caseNumber}\\n`;\n      message += `   üìÖ –î–∞—Ç–∞: ${dateStr}\\n`;\n      message += `   üèõÔ∏è –°—É–¥: ${h.court}\\n`;\n      message += `   ‚öñÔ∏è ${h.plaintiff} vs ${h.defendant}\\n\\n`;\n    });\n\n    if (hearings.length > 10) {\n      message += `...–∏ –µ—â—ë ${hearings.length - 10} –∑–∞—Å–µ–¥–∞–Ω–∏–π\\n`;\n    }\n\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: 'back_main' }\n        ]\n      ]\n    };\n\n    editMessage(chatId, messageId, message, keyboard);\n  }\n\n  // ============================================\n  // –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –î–ê–ù–ù–´–•\n  // ============================================\n\n  /**\n   * –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ª–∞\n   */\n  function startEditCase(chatId, caseNumber, user) {\n    if (!checkPermission(user, 'edit_cases')) {\n      sendMessage(chatId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');\n      return;\n    }\n\n    const caseData = findCaseByCaseNumber(caseNumber);\n    if (!caseData) {\n      sendMessage(chatId, '‚ùå –î–µ–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n      return;\n    }\n\n    const keyboard = {\n      inline_keyboard: [\n        [\n          { text: 'üìä –°—Ç–∞—Ç—É—Å', callback_data: `edit_field:${caseNumber}:${COLUMNS.STATUS}` },\n          { text: 'üî• –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç', callback_data: `edit_field:${caseNumber}:${COLUMNS.PRIORITY}` }\n        ],\n        [\n          { text: 'üìÖ –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è', callback_data: `edit_field:${caseNumber}:${COLUMNS.HEARING_DATE}` }\n        ],\n        [\n          { text: 'üë®‚Äç‚öñÔ∏è –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç', callback_data: `edit_field:${caseNumber}:${COLUMNS.ASSIGNED_LAWYER}` }\n        ],\n        [\n          { text: 'üìù –ó–∞–º–µ—Ç–∫–∏', callback_data: `edit_field:${caseNumber}:${COLUMNS.NOTES}` }\n        ],\n        [\n          { text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: `view_case:${caseNumber}` }\n        ]\n      ]\n    };\n\n    sendMessage(chatId, `‚úèÔ∏è *–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ª–∞ ${caseNumber}*\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:`, keyboard);\n  }\n\n  /**\n   * –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è\n   */\n  function startEditField(chatId, caseNumber, columnIndex, user) {\n    const fieldName = COLUMN_NAMES[parseInt(columnIndex)] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –ø–æ–ª–µ';\n\n    setUserState(chatId, {\n      action: 'edit_field',\n      caseNumber: caseNumber,\n      columnIndex: parseInt(columnIndex),\n      fieldName: fieldName\n    });\n\n    sendMessage(chatId,\n      `‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è: *${fieldName}*\\n` +\n      `–î–µ–ª–æ: ${caseNumber}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã:`\n    );\n  }\n\n  /**\n   * –ù–∞—á–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∑–∞—Å–µ–¥–∞–Ω–∏—è\n   */\n  function startRescheduleHearing(chatId, caseNumber, user) {\n    if (!checkPermission(user, 'edit_cases')) {\n      sendMessage(chatId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');\n      return;\n    }\n\n    setUserState(chatId, {\n      action: 'reschedule_hearing',\n      caseNumber: caseNumber\n    });\n\n    sendMessage(chatId,\n      `üìÖ *–ü–µ—Ä–µ–Ω–æ—Å –∑–∞—Å–µ–¥–∞–Ω–∏—è*\\n` +\n      `–î–µ–ª–æ: ${caseNumber}\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\\n` +\n      `–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\\n\\n` +\n      `–ù–∞–ø—Ä–∏–º–µ—Ä: 15.12.2024 14:30\\n` +\n      `–ò–ª–∏ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã`\n    );\n  }\n\n  // ============================================\n  // –î–û–ë–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•\n  // ============================================\n\n  /**\n   * –ù–∞—á–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–µ–ª–∞\n   */\n  function startAddCase(chatId, user) {\n    if (!checkPermission(user, 'add_cases')) {\n      sendMessage(chatId, '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª');\n      return;\n    }\n\n    setUserState(chatId, {\n      action: 'add_case',\n      step: 'case_number',\n      data: {}\n    });\n\n    sendMessage(chatId,\n      `‚ûï *–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–µ–ª–∞*\\n\\n` +\n      `–®–∞–≥ 1/5: –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞\\n` +\n      `–ò–ª–∏ /cancel –¥–ª—è –æ—Ç–º–µ–Ω—ã`\n    );\n  }\n\n  // ============================================\n  // –û–ë–†–ê–ë–û–¢–ö–ê –í–í–û–î–ê –í –°–û–°–¢–û–Ø–ù–ò–Ø–•\n  // ============================================\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è\n   */\n  function handleStateInput(chatId, text, state, user) {\n    switch (state.action) {\n      case 'edit_field':\n        handleEditFieldInput(chatId, text, state, user);\n        break;\n\n      case 'reschedule_hearing':\n        handleRescheduleHearingInput(chatId, text, state, user);\n        break;\n\n      case 'add_case':\n        handleAddCaseInput(chatId, text, state, user);\n        break;\n\n      default:\n        clearUserState(chatId);\n        sendMessage(chatId, '‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞.');\n    }\n  }\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—è\n   */\n  function handleEditFieldInput(chatId, text, state, user) {\n    const { caseNumber, columnIndex, fieldName } = state;\n\n    try {\n      const caseData = findCaseByCaseNumber(caseNumber);\n      if (!caseData) {\n        clearUserState(chatId);\n        sendMessage(chatId, '‚ùå –î–µ–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n        return;\n      }\n\n      const ss = SpreadsheetApp.getActiveSpreadsheet();\n      const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n\n      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ\n      const row = caseData.rowIndex;\n      const col = columnIndex + 1; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ 1-based\n\n      // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ–ª–µ –¥–∞—Ç—ã, –ø–∞—Ä—Å–∏–º –¥–∞—Ç—É\n      let value = text;\n      if (columnIndex === COLUMNS.HEARING_DATE ||\n          columnIndex === COLUMNS.FILING_DATE ||\n          columnIndex === COLUMNS.INCIDENT_DATE) {\n        value = parseDate(text);\n        if (!value) {\n          sendMessage(chatId, '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú');\n          return;\n        }\n      }\n\n      sheet.getRange(row, col).setValue(value);\n\n      clearUserState(chatId);\n      sendMessage(chatId, `‚úÖ –ü–æ–ª–µ \"${fieldName}\" –æ–±–Ω–æ–≤–ª–µ–Ω–æ!\\n\\n–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${text}`);\n\n      AppLogger.info('TelegramBot', '–ü–æ–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', {\n        user: user.email,\n        caseNumber: caseNumber,\n        field: fieldName,\n        value: text\n      });\n\n    } catch (error) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—è', {\n        error: error.message\n      });\n      sendMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è');\n    }\n  }\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è\n   */\n  function handleRescheduleHearingInput(chatId, text, state, user) {\n    const { caseNumber } = state;\n\n    try {\n      const newDate = parseDate(text);\n      if (!newDate) {\n        sendMessage(chatId, '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú\\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ /cancel');\n        return;\n      }\n\n      const caseData = findCaseByCaseNumber(caseNumber);\n      if (!caseData) {\n        clearUserState(chatId);\n        sendMessage(chatId, '‚ùå –î–µ–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');\n        return;\n      }\n\n      const ss = SpreadsheetApp.getActiveSpreadsheet();\n      const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n      const row = caseData.rowIndex;\n      const col = COLUMNS.HEARING_DATE + 1;\n\n      sheet.getRange(row, col).setValue(newDate);\n\n      clearUserState(chatId);\n      sendMessage(chatId,\n        `‚úÖ –ó–∞—Å–µ–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ!\\n\\n` +\n        `–î–µ–ª–æ: ${caseNumber}\\n` +\n        `–ù–æ–≤–∞—è –¥–∞—Ç–∞: ${formatDate(newDate)}`\n      );\n\n      AppLogger.info('TelegramBot', '–ó–∞—Å–µ–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ', {\n        user: user.email,\n        caseNumber: caseNumber,\n        newDate: newDate\n      });\n\n    } catch (error) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è', {\n        error: error.message\n      });\n      sendMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è');\n    }\n  }\n\n  /**\n   * –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–≤–æ–¥ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –¥–µ–ª–∞\n   */\n  function handleAddCaseInput(chatId, text, state, user) {\n    const { step, data } = state;\n\n    switch (step) {\n      case 'case_number':\n        data.caseNumber = text;\n        state.step = 'client_name';\n        state.data = data;\n        setUserState(chatId, state);\n        sendMessage(chatId, `–®–∞–≥ 2/5: –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞`);\n        break;\n\n      case 'client_name':\n        data.clientName = text;\n        state.step = 'case_type';\n        state.data = data;\n        setUserState(chatId, state);\n        sendMessage(chatId, `–®–∞–≥ 3/5: –í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø –¥–µ–ª–∞`);\n        break;\n\n      case 'case_type':\n        data.caseType = text;\n        state.step = 'court';\n        state.data = data;\n        setUserState(chatId, state);\n        sendMessage(chatId, `–®–∞–≥ 4/5: –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–∞`);\n        break;\n\n      case 'court':\n        data.court = text;\n        state.step = 'plaintiff';\n        state.data = data;\n        setUserState(chatId, state);\n        sendMessage(chatId, `–®–∞–≥ 5/5: –í–≤–µ–¥–∏—Ç–µ –∏—Å—Ç—Ü–∞`);\n        break;\n\n      case 'plaintiff':\n        data.plaintiff = text;\n\n        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –¥–µ–ª–æ\n        try {\n          const ss = SpreadsheetApp.getActiveSpreadsheet();\n          const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n\n          const newRow = [\n            data.caseNumber,\n            data.clientName,\n            data.caseType,\n            '–ù–æ–≤–æ–µ',  // –°—Ç–∞—Ç—É—Å\n            data.court,\n            '',  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç\n            data.plaintiff,\n            '',  // –û—Ç–≤–µ—Ç—á–∏–∫\n            '',  // –°—É–º–º–∞ –∏—Å–∫–∞\n            new Date(),  // –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏\n            '',  // –î–∞—Ç–∞ –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏—è\n            '',  // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–µ–ª–∞\n            user.email,  // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —é—Ä–∏—Å—Ç\n            '',  // –û–ø–∏—Å–∞–Ω–∏–µ\n            '',  // –ó–∞–º–µ—Ç–∫–∏\n            ''   // –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n          ];\n\n          sheet.appendRow(newRow);\n\n          clearUserState(chatId);\n          sendMessage(chatId,\n            `‚úÖ –î–µ–ª–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!\\n\\n` +\n            `–ù–æ–º–µ—Ä: ${data.caseNumber}\\n` +\n            `–ö–ª–∏–µ–Ω—Ç: ${data.clientName}\\n` +\n            `–¢–∏–ø: ${data.caseType}\\n` +\n            `–°—É–¥: ${data.court}\\n` +\n            `–ò—Å—Ç–µ—Ü: ${data.plaintiff}`\n          );\n\n          AppLogger.info('TelegramBot', '–î–µ–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ', {\n            user: user.email,\n            caseNumber: data.caseNumber\n          });\n\n        } catch (error) {\n          AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ–ª–∞', {\n            error: error.message\n          });\n          sendMessage(chatId, '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–µ–ª–∞');\n        }\n        break;\n    }\n  }\n\n  // ============================================\n  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò\n  // ============================================\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç TelegramNotifier –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏)\n   */\n  function sendMessage(chatId, text, keyboard = null) {\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) {\n      AppLogger.warn('TelegramBot', 'Bot token –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');\n      return false;\n    }\n\n    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;\n\n    const payload = {\n      chat_id: chatId,\n      text: text,\n      parse_mode: 'Markdown'\n    };\n\n    if (keyboard) {\n      payload.reply_markup = keyboard;\n    }\n\n    const options = {\n      method: 'post',\n      contentType: 'application/json',\n      payload: JSON.stringify(payload),\n      muteHttpExceptions: true\n    };\n\n    try {\n      const response = UrlFetchApp.fetch(url, options);\n      const result = JSON.parse(response.getContentText());\n      return result.ok;\n    } catch (e) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', {\n        error: e.message\n      });\n      return false;\n    }\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π TelegramNotifier)\n   */\n  function sendMessageToUser(user, text, keyboard = null) {\n    if (keyboard) {\n      // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–∫—É\n      return sendMessage(user.telegram_chat_id, text, keyboard);\n    } else {\n      // –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º TelegramNotifier\n      return TelegramNotifier.sendToUser(user, text, 'Markdown');\n    }\n  }\n\n  /**\n   * –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ\n   */\n  function editMessage(chatId, messageId, text, keyboard = null) {\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) return false;\n\n    const url = `https://api.telegram.org/bot${botToken}/editMessageText`;\n\n    const payload = {\n      chat_id: chatId,\n      message_id: messageId,\n      text: text,\n      parse_mode: 'Markdown'\n    };\n\n    if (keyboard) {\n      payload.reply_markup = keyboard;\n    }\n\n    const options = {\n      method: 'post',\n      contentType: 'application/json',\n      payload: JSON.stringify(payload),\n      muteHttpExceptions: true\n    };\n\n    try {\n      const response = UrlFetchApp.fetch(url, options);\n      const result = JSON.parse(response.getContentText());\n      return result.ok;\n    } catch (e) {\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è', {\n        error: e.message\n      });\n      return false;\n    }\n  }\n\n  /**\n   * –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ callback query\n   */\n  function answerCallbackQuery(callbackQueryId, text = null) {\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) return false;\n\n    const url = `https://api.telegram.org/bot${botToken}/answerCallbackQuery`;\n\n    const payload = {\n      callback_query_id: callbackQueryId\n    };\n\n    if (text) {\n      payload.text = text;\n    }\n\n    const options = {\n      method: 'post',\n      contentType: 'application/json',\n      payload: JSON.stringify(payload),\n      muteHttpExceptions: true\n    };\n\n    try {\n      UrlFetchApp.fetch(url, options);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ chat_id\n   */\n  function getUserByChatId(chatId) {\n    const users = UserManager.getAllUsers();\n\n    for (const email in users) {\n      if (users[email].telegram_chat_id === chatId.toString()) {\n        return users[email];\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * –ù–∞–π—Ç–∏ –¥–µ–ª–æ –ø–æ –Ω–æ–º–µ—Ä—É\n   */\n  function findCaseByCaseNumber(caseNumber) {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const sheet = ss.getSheetByName('–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞') || ss.getActiveSheet();\n    const data = sheet.getDataRange().getValues();\n\n    for (let i = 1; i < data.length; i++) {\n      if (data[i][COLUMNS.CASE_NUMBER] === caseNumber) {\n        return {\n          row: data[i],\n          rowIndex: i + 1\n        };\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   */\n  function checkPermission(user, permission) {\n    if (user.role === 'ADMIN') return true;\n    if (user.role === 'MANAGER') return true;\n\n    if (permission === 'edit_cases' || permission === 'add_cases') {\n      return user.role === 'LAWYER';\n    }\n\n    return false;\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç —Ä–æ–ª–∏\n   */\n  function getRoleText(role) {\n    const roles = {\n      'ADMIN': 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',\n      'MANAGER': 'üëî –ú–µ–Ω–µ–¥–∂–µ—Ä',\n      'LAWYER': 'üë®‚Äç‚öñÔ∏è –Æ—Ä–∏—Å—Ç',\n      'ASSISTANT': 'üë§ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç',\n      'OBSERVER': 'üëÅÔ∏è –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å'\n    };\n    return roles[role] || role;\n  }\n\n  /**\n   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É\n   */\n  function formatDate(date) {\n    if (!(date instanceof Date)) return '–ù–µ —É–∫–∞–∑–∞–Ω–∞';\n    return Utilities.formatDate(date, Session.getScriptTimeZone(), 'dd.MM.yyyy HH:mm');\n  }\n\n  /**\n   * –ü–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É –∏–∑ —Å—Ç—Ä–æ–∫–∏\n   */\n  function parseDate(text) {\n    try {\n      const parts = text.split(' ');\n      if (parts.length !== 2) return null;\n\n      const dateParts = parts[0].split('.');\n      const timeParts = parts[1].split(':');\n\n      if (dateParts.length !== 3 || timeParts.length !== 2) return null;\n\n      const day = parseInt(dateParts[0]);\n      const month = parseInt(dateParts[1]) - 1;\n      const year = parseInt(dateParts[2]);\n      const hour = parseInt(timeParts[0]);\n      const minute = parseInt(timeParts[1]);\n\n      const date = new Date(year, month, day, hour, minute, 0);\n\n      if (isNaN(date.getTime())) return null;\n\n      return date;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   */\n  function setUserState(chatId, state) {\n    const props = PropertiesService.getUserProperties();\n    props.setProperty(`bot_state_${chatId}`, JSON.stringify(state));\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   */\n  function getUserState(chatId) {\n    const props = PropertiesService.getUserProperties();\n    const stateJson = props.getProperty(`bot_state_${chatId}`);\n\n    if (!stateJson) return null;\n\n    try {\n      return JSON.parse(stateJson);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   */\n  function clearUserState(chatId) {\n    const props = PropertiesService.getUserProperties();\n    props.deleteProperty(`bot_state_${chatId}`);\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–æ—â–∏\n   */\n  function sendHelpMessage(chatId) {\n    const message =\n      `üìñ *–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É*\\n\\n` +\n      `*–ö–æ–º–∞–Ω–¥—ã:*\\n` +\n      `/start –∏–ª–∏ /menu - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\n` +\n      `/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\\n` +\n      `/mycases - –ú–æ–∏ –¥–µ–ª–∞\\n` +\n      `/hearings - –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è\\n` +\n      `/cancel - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é\\n\\n` +\n      `*–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:*\\n` +\n      `‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ–ª –∏ –∑–∞—Å–µ–¥–∞–Ω–∏–π\\n` +\n      `‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö\\n` +\n      `‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–µ–ª\\n` +\n      `‚Ä¢ –ü–µ—Ä–µ–Ω–æ—Å –∑–∞—Å–µ–¥–∞–Ω–∏–π\\n\\n` +\n      `–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏!`;\n\n    sendMessage(chatId, message);\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏ –¥–µ–ª–∞\n   */\n  function showMyCases(chatId, user) {\n    if (user.role === 'LAWYER' && user.assigned_cases) {\n      const cases = user.assigned_cases.join(', ');\n      sendMessage(chatId, `üìÅ *–ú–æ–∏ –¥–µ–ª–∞:*\\n\\n${cases}`);\n    } else {\n      sendMessage(chatId, 'üìÅ –£ –≤–∞—Å –Ω–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–ª');\n    }\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞—Å–µ–¥–∞–Ω–∏—è\n   */\n  function showUpcomingHearings(chatId, user) {\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º inline –≤–µ—Ä—Å–∏—é\n    const keyboard = {\n      inline_keyboard: [[{ text: 'üìÖ –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞—Å–µ–¥–∞–Ω–∏—è', callback_data: 'view_hearings' }]]\n    };\n    sendMessage(chatId, 'üìÖ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞—Å–µ–¥–∞–Ω–∏–π:', keyboard);\n  }\n\n  // ============================================\n  // –ù–ê–°–¢–†–û–ô–ö–ê WEBHOOK\n  // ============================================\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook\n   */\n  function setupWebhook() {\n    const ui = SpreadsheetApp.getUi();\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) {\n      ui.alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Bot Token —á–µ—Ä–µ–∑ TelegramNotifier.setup()');\n      return;\n    }\n\n    // –ü–æ–ª—É—á–∞–µ–º URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\n    const scriptUrl = ScriptApp.getService().getUrl();\n\n    const webhookUrl = `https://api.telegram.org/bot${botToken}/setWebhook?url=${encodeURIComponent(scriptUrl)}`;\n\n    try {\n      const response = UrlFetchApp.fetch(webhookUrl);\n      const result = JSON.parse(response.getContentText());\n\n      if (result.ok) {\n        ui.alert(\n          '‚úÖ Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω!\\n\\n' +\n          `URL: ${scriptUrl}\\n\\n` +\n          '–¢–µ–ø–µ—Ä—å –±–æ—Ç –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.'\n        );\n        AppLogger.info('TelegramBot', 'Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω', { url: scriptUrl });\n      } else {\n        ui.alert(`‚ùå –û—à–∏–±–∫–∞: ${result.description}`);\n      }\n    } catch (error) {\n      ui.alert(`‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook: ${error.message}`);\n      AppLogger.error('TelegramBot', '–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook', {\n        error: error.message\n      });\n    }\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ webhook\n   */\n  function getWebhookInfo() {\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) {\n      Logger.log('Bot token –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');\n      return;\n    }\n\n    const url = `https://api.telegram.org/bot${botToken}/getWebhookInfo`;\n\n    try {\n      const response = UrlFetchApp.fetch(url);\n      const result = JSON.parse(response.getContentText());\n      Logger.log(result);\n      return result;\n    } catch (error) {\n      Logger.log(`–û—à–∏–±–∫–∞: ${error.message}`);\n    }\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    doPost: doPost,\n    setupWebhook: setupWebhook,\n    getWebhookInfo: getWebhookInfo,\n    sendMessage: sendMessage\n  };\n\n})();\n\n// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è webhook\nfunction doPost(e) {\n  return TelegramBot.doPost(e);\n}\n"},{"name":"TelegramCleanup.gs","content":"/**\n * üßπ TelegramCleanup.gs - –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Telegram –±–æ—Ç–∞\n *\n * –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –≠–¢–û–¢ –°–ö–†–ò–ü–¢ –î–õ–Ø –ü–û–õ–ù–û–ô –û–ß–ò–°–¢–ö–ò –°–¢–ê–†–´–• –ù–ê–°–¢–†–û–ï–ö\n */\n\nvar TelegramCleanup = (function() {\n\n  /**\n   * –®–ê–ì 1: –£–¥–∞–ª–∏—Ç—å Bot Token –∏–∑ Properties\n   */\n  function removeBotToken() {\n    try {\n      const props = PropertiesService.getScriptProperties();\n      props.deleteProperty('TELEGRAM_BOT_TOKEN');\n      Logger.log('‚úÖ Bot Token —É–¥–∞–ª—ë–Ω –∏–∑ Properties');\n      return true;\n    } catch (e) {\n      Logger.log('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è Bot Token: ' + e.message);\n      return false;\n    }\n  }\n\n  /**\n   * –®–ê–ì 2: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ Telegram —Ç—Ä–∏–≥–≥–µ—Ä—ã\n   */\n  function removeTelegramTriggers() {\n    try {\n      const triggers = ScriptApp.getProjectTriggers();\n      let deletedCount = 0;\n\n      triggers.forEach(trigger => {\n        const funcName = trigger.getHandlerFunction();\n\n        // –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Telegram\n        if (funcName.includes('Telegram') ||\n            funcName.includes('telegram') ||\n            funcName.includes('sendDailyDigest')) {\n          ScriptApp.deleteTrigger(trigger);\n          deletedCount++;\n          Logger.log(`‚úÖ –£–¥–∞–ª—ë–Ω —Ç—Ä–∏–≥–≥–µ—Ä: ${funcName}`);\n        }\n      });\n\n      Logger.log(`‚úÖ –£–¥–∞–ª–µ–Ω–æ ${deletedCount} Telegram —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤`);\n      return deletedCount;\n    } catch (e) {\n      Logger.log('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤: ' + e.message);\n      return 0;\n    }\n  }\n\n  /**\n   * –®–ê–ì 3: –û—á–∏—Å—Ç–∏—Ç—å Telegram Chat ID —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n   */\n  function clearUsersChatIds() {\n    try {\n      const users = UserManager.getAllUsers();\n      let clearedCount = 0;\n\n      for (const email in users) {\n        const user = users[email];\n\n        if (user.telegram_chat_id) {\n          // –û—á–∏—Å—Ç–∏—Ç—å telegram_chat_id\n          user.telegram_chat_id = '';\n\n          // –û—Ç–∫–ª—é—á–∏—Ç—å telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n          if (user.notification_preferences) {\n            user.notification_preferences.telegram = false;\n          }\n\n          // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n          UserManager.updateUser(email, user);\n          clearedCount++;\n        }\n      }\n\n      Logger.log(`‚úÖ –û—á–∏—â–µ–Ω–æ ${clearedCount} Telegram Chat ID`);\n      return clearedCount;\n    } catch (e) {\n      Logger.log('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ Chat ID: ' + e.message);\n      return 0;\n    }\n  }\n\n  /**\n   * –®–ê–ì 4: –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Telegram –∏–∑ CONFIG (–µ—Å–ª–∏ –µ—Å—Ç—å)\n   */\n  function clearTelegramConfig() {\n    try {\n      // –ï—Å–ª–∏ –≤ –≤–∞—à–µ–º CONFIG –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è TELEGRAM, –æ—á–∏—Å—Ç–∏—Ç–µ –µ—ë\n      // –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ CONFIG –≤ src/Config.gs\n      Logger.log('‚ÑπÔ∏è –ü—Ä–æ–≤–µ—Ä—å—Ç–µ src/Config.gs –≤—Ä—É—á–Ω—É—é –Ω–∞ –Ω–∞–ª–∏—á–∏–µ TELEGRAM —Å–µ–∫—Ü–∏–∏');\n      return true;\n    } catch (e) {\n      Logger.log('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + e.message);\n      return false;\n    }\n  }\n\n  /**\n   * üî• –ü–û–õ–ù–ê–Ø –û–ß–ò–°–¢–ö–ê - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —à–∞–≥–∏ —Å—Ä–∞–∑—É\n   */\n  function fullCleanup() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.alert(\n      'üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Telegram –Ω–∞—Å—Ç—Ä–æ–µ–∫',\n      '–≠—Ç–æ —É–¥–∞–ª–∏—Ç:\\n\\n' +\n      '‚Ä¢ Bot Token –∏–∑ —Å–∏—Å—Ç–µ–º—ã\\n' +\n      '‚Ä¢ –í—Å–µ Telegram —Ç—Ä–∏–≥–≥–µ—Ä—ã\\n' +\n      '‚Ä¢ Telegram Chat ID –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\\n' +\n      '‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\\n\\n' +\n      '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?',\n      ui.ButtonSet.YES_NO\n    );\n\n    if (response !== ui.Button.YES) {\n      ui.alert('–û—Ç–º–µ–Ω–µ–Ω–æ');\n      return;\n    }\n\n    Logger.log('=== –ù–ê–ß–ê–õ–û –ü–û–õ–ù–û–ô –û–ß–ò–°–¢–ö–ò TELEGRAM ===');\n\n    // –®–∞–≥ 1: –£–¥–∞–ª–∏—Ç—å Bot Token\n    const step1 = removeBotToken();\n\n    // –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã\n    const step2 = removeTelegramTriggers();\n\n    // –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å Chat ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    const step3 = clearUsersChatIds();\n\n    // –®–∞–≥ 4: –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é\n    const step4 = clearTelegramConfig();\n\n    Logger.log('=== –ö–û–ù–ï–¶ –ü–û–õ–ù–û–ô –û–ß–ò–°–¢–ö–ò TELEGRAM ===');\n\n    // –û—Ç—á—ë—Ç\n    const report =\n      '‚úÖ –û–ß–ò–°–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!\\n\\n' +\n      `‚Ä¢ Bot Token: ${step1 ? '—É–¥–∞–ª—ë–Ω' : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}\\n` +\n      `‚Ä¢ –¢—Ä–∏–≥–≥–µ—Ä—ã: —É–¥–∞–ª–µ–Ω–æ ${step2} —à—Ç.\\n` +\n      `‚Ä¢ Chat ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –æ—á–∏—â–µ–Ω–æ ${step3} —à—Ç.\\n` +\n      `‚Ä¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é\\n\\n` +\n      '–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –±–æ—Ç–∞ –∑–∞–Ω–æ–≤–æ!';\n\n    ui.alert('üßπ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', report, ui.ButtonSet.OK);\n\n    AppLogger.info('TelegramCleanup', '–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', {\n      botToken: step1,\n      triggers: step2,\n      chatIds: step3,\n      config: step4\n    });\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å Telegram –Ω–∞—Å—Ç—Ä–æ–µ–∫\n   */\n  function showStatus() {\n    const ui = SpreadsheetApp.getUi();\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ Bot Token\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty('TELEGRAM_BOT_TOKEN');\n    const hasToken = botToken ? `–î–∞ (${botToken.substring(0, 10)}...)` : '–ù–µ—Ç';\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤\n    const triggers = ScriptApp.getProjectTriggers();\n    const telegramTriggers = triggers.filter(t => {\n      const name = t.getHandlerFunction();\n      return name.includes('Telegram') || name.includes('telegram');\n    });\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    const users = UserManager.getAllUsers();\n    let usersWithChatId = 0;\n    for (const email in users) {\n      if (users[email].telegram_chat_id) {\n        usersWithChatId++;\n      }\n    }\n\n    const status =\n      'üìä –°–¢–ê–¢–£–° TELEGRAM –ù–ê–°–¢–†–û–ï–ö\\n\\n' +\n      `‚Ä¢ Bot Token: ${hasToken}\\n` +\n      `‚Ä¢ Telegram —Ç—Ä–∏–≥–≥–µ—Ä—ã: ${telegramTriggers.length} —à—Ç.\\n` +\n      `‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å Chat ID: ${usersWithChatId} —á–µ–ª.\\n\\n` +\n      (botToken || telegramTriggers.length > 0 || usersWithChatId > 0\n        ? '‚ö†Ô∏è –ï—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—á–∏—Å—Ç–∫–∞'\n        : '‚úÖ –ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ - –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ');\n\n    ui.alert('üìä –°—Ç–∞—Ç—É—Å Telegram', status, ui.ButtonSet.OK);\n  }\n\n  return {\n    removeBotToken: removeBotToken,\n    removeTelegramTriggers: removeTelegramTriggers,\n    clearUsersChatIds: clearUsersChatIds,\n    clearTelegramConfig: clearTelegramConfig,\n    fullCleanup: fullCleanup,\n    showStatus: showStatus\n  };\n\n})();\n\n/**\n * –ë–´–°–¢–†–´–ô –ó–ê–ü–£–°–ö:\n *\n * 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:\n *    TelegramCleanup.showStatus();\n *\n * 2. –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):\n *    TelegramCleanup.fullCleanup();\n *\n * 3. –û—Ç–¥–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):\n *    TelegramCleanup.removeBotToken();\n *    TelegramCleanup.removeTelegramTriggers();\n *    TelegramCleanup.clearUsersChatIds();\n */\n"},{"name":"TelegramNotifier.gs","content":"/**\n * ‚ú® TelegramNotifier.gs - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–æ–ª–µ–π\n *\n * –§–£–ù–ö–¶–ò–ò:\n * ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram\n * ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n * ‚úÖ –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (critical, important, info, digest)\n * ‚úÖ HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n * ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç\n */\n\nvar TelegramNotifier = (function() {\n\n  const BOT_TOKEN_KEY = 'TELEGRAM_BOT_TOKEN';\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n   */\n  function sendToUser(user, text, parseMode = 'HTML') {\n    if (!user.telegram_chat_id) return false;\n    if (!user.notification_preferences.telegram) return false;\n\n    const props = PropertiesService.getScriptProperties();\n    const botToken = props.getProperty(BOT_TOKEN_KEY);\n\n    if (!botToken) {\n      AppLogger.warn('TelegramNotifier', 'Bot token –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');\n      return false;\n    }\n\n    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;\n\n    const payload = {\n      chat_id: user.telegram_chat_id,\n      text: text,\n      parse_mode: parseMode\n    };\n\n    const options = {\n      method: 'post',\n      contentType: 'application/json',\n      payload: JSON.stringify(payload),\n      muteHttpExceptions: true\n    };\n\n    try {\n      const response = UrlFetchApp.fetch(url, options);\n      const result = JSON.parse(response.getContentText());\n\n      if (!result.ok) {\n        throw new Error(result.description);\n      }\n\n      AppLogger.info('TelegramNotifier', `–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${user.email}`);\n      return true;\n    } catch (e) {\n      AppLogger.error('TelegramNotifier', '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏', {\n        user: user.email,\n        error: e.message\n      });\n      return false;\n    }\n  }\n\n  /**\n   * –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø—É –∏ —Ä–æ–ª—è–º\n   */\n  function sendNotification(notificationType, text, caseNumber = null) {\n    const users = UserManager.getUsersForNotification(notificationType, caseNumber);\n\n    let sent = 0;\n    users.forEach(user => {\n      if (sendToUser(user, text)) {\n        sent++;\n      }\n    });\n\n    AppLogger.info('TelegramNotifier', `–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${sent} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º`, {\n      type: notificationType,\n      case: caseNumber\n    });\n\n    return sent;\n  }\n\n  /**\n   * –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Admin, Manager)\n   */\n  function sendCritical(title, message, caseNumber = null) {\n    const text = `üî¥ <b>${title}</b>\\n\\n${message}`;\n    return sendNotification('critical', text, caseNumber);\n  }\n\n  /**\n   * –í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Admin, Manager, Lawyer)\n   */\n  function sendImportant(title, message, caseNumber = null) {\n    const text = `üü° <b>${title}</b>\\n\\n${message}`;\n    return sendNotification('important', text, caseNumber);\n  }\n\n  /**\n   * –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Admin)\n   */\n  function sendInfo(title, message) {\n    const text = `üîµ <b>${title}</b>\\n\\n${message}`;\n    return sendNotification('info', text);\n  }\n\n  /**\n   * –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–¥–ª–∞–π–Ω–µ\n   */\n  function notifyDeadline(caseNumber, eventName, date, daysUntil) {\n    const emoji = daysUntil === 0 ? 'üî¥' : daysUntil === 1 ? 'üü°' : 'üü¢';\n    const urgency = daysUntil === 0 ? '–°–ï–ì–û–î–ù–Ø!' : daysUntil === 1 ? '–ó–ê–í–¢–†–ê' : `—á–µ—Ä–µ–∑ ${daysUntil} –¥–Ω.`;\n\n    const message =\n      `${emoji} <b>–ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–π—Å—è –¥–µ–¥–ª–∞–π–Ω</b>\\n\\n` +\n      `üìã –î–µ–ª–æ: <code>${caseNumber}</code>\\n` +\n      `üìÖ –°–æ–±—ã—Ç–∏–µ: ${eventName}\\n` +\n      `üïê –î–∞—Ç–∞: ${date}\\n` +\n      `‚è∞ ${urgency}`;\n\n    const type = daysUntil <= 1 ? 'critical' : 'important';\n    return sendNotification(type, message, caseNumber);\n  }\n\n  /**\n   * –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç\n   */\n  function sendDailyDigest() {\n    const problems = DeadlineChecker.findUpcomingDeadlines(7);\n\n    const users = UserManager.getUsersForNotification('digest');\n\n    if (users.length === 0) {\n      AppLogger.info('TelegramNotifier', '–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–∞');\n      return 0;\n    }\n\n    let message = `üìä <b>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç</b>\\n`;\n    message += `<i>${new Date().toLocaleDateString('ru-RU')}</i>\\n\\n`;\n\n    if (problems.length === 0) {\n      message += '‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤!';\n    } else {\n      message += `–ù–∞–π–¥–µ–Ω–æ <b>${problems.length}</b> –¥–µ–¥–ª–∞–π–Ω–æ–≤:\\n\\n`;\n\n      problems.slice(0, 15).forEach((p, i) => {\n        const emoji = p.severity === '–°–µ–≥–æ–¥–Ω—è!' ? 'üî¥' :\n                      p.severity === '–ó–∞–≤—Ç—Ä–∞' ? 'üü°' : 'üü¢';\n        message += `${emoji} ${p.caseNumber} - ${p.columnName} (${p.daysUntil} –¥–Ω.)\\n`;\n      });\n\n      if (problems.length > 15) {\n        message += `\\n... –∏ –µ—â—ë ${problems.length - 15} –¥–µ–¥–ª–∞–π–Ω–æ–≤`;\n      }\n    }\n\n    let sent = 0;\n    users.forEach(user => {\n      if (sendToUser(user, message)) {\n        sent++;\n      }\n    });\n\n    AppLogger.info('TelegramNotifier', `–î–∞–π–¥–∂–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ${sent} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º`);\n    return sent;\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞\n   */\n  function setup() {\n    const ui = SpreadsheetApp.getUi();\n\n    const response = ui.prompt(\n      '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Bot',\n      '–í–≤–µ–¥–∏—Ç–µ Bot Token (–ø–æ–ª—É—á–∏—Ç–µ —É @BotFather):',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (response.getSelectedButton() !== ui.Button.OK) return;\n\n    const botToken = response.getResponseText();\n    const props = PropertiesService.getScriptProperties();\n    props.setProperty(BOT_TOKEN_KEY, botToken);\n\n    ui.alert(\n      '‚úÖ Bot Token —Å–æ—Ö—Ä–∞–Ω—ë–Ω!\\n\\n' +\n      '–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏—Ö Telegram Chat ID —á–µ—Ä–µ–∑ UserManager.'\n    );\n\n    AppLogger.info('TelegramNotifier', 'Bot Token –Ω–∞—Å—Ç—Ä–æ–µ–Ω');\n  }\n\n  /**\n   * –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç\n   */\n  function setupDailyDigest() {\n    const triggers = ScriptApp.getProjectTriggers();\n    triggers.forEach(trigger => {\n      if (trigger.getHandlerFunction() === 'TelegramNotifier.sendDailyDigest') {\n        ScriptApp.deleteTrigger(trigger);\n      }\n    });\n\n    const digestTime = ConfigManager.get('NOTIFICATIONS.DIGEST_TIME') || '09:00';\n    const hour = parseInt(digestTime.split(':')[0]);\n\n    ScriptApp.newTrigger('TelegramNotifier.sendDailyDigest')\n      .timeBased()\n      .atHour(hour)\n      .everyDays(1)\n      .create();\n\n    AppLogger.info('TelegramNotifier', `–î–∞–π–¥–∂–µ—Å—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ ${digestTime}`);\n  }\n\n  return {\n    sendToUser: sendToUser,\n    sendNotification: sendNotification,\n    sendCritical: sendCritical,\n    sendImportant: sendImportant,\n    sendInfo: sendInfo,\n    notifyDeadline: notifyDeadline,\n    sendDailyDigest: sendDailyDigest,\n    setup: setup,\n    setupDailyDigest: setupDailyDigest\n  };\n})();\n"},{"name":"TestRunner.gs","content":"/**\n * ‚ú® TestRunner.gs - –ü—Ä–æ—Å—Ç–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤\n */\n\nvar TestRunner = (function() {\n\n  const tests = [];\n  let passedCount = 0;\n  let failedCount = 0;\n\n  function test(name, fn) {\n    tests.push({ name: name, fn: fn });\n  }\n\n  const assert = {\n    equals: (actual, expected, message) => {\n      if (actual !== expected) {\n        throw new Error(\n          `${message || 'Assertion failed'}: expected ${expected}, got ${actual}`\n        );\n      }\n    },\n\n    notNull: (value, message) => {\n      if (value === null || value === undefined) {\n        throw new Error(message || 'Value is null/undefined');\n      }\n    },\n\n    isTrue: (value, message) => {\n      if (value !== true) {\n        throw new Error(message || 'Value is not true');\n      }\n    }\n  };\n\n  function runAll() {\n    Logger.log('=== –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í ===\\n');\n\n    passedCount = 0;\n    failedCount = 0;\n\n    tests.forEach(testCase => {\n      try {\n        testCase.fn(assert);\n        Logger.log(`‚úÖ ${testCase.name}`);\n        passedCount++;\n      } catch (e) {\n        Logger.log(`‚ùå ${testCase.name}: ${e.message}`);\n        failedCount++;\n      }\n    });\n\n    Logger.log(`\\n=== –†–ï–ó–£–õ–¨–¢–ê–¢–´ ===`);\n    Logger.log(`–ü—Ä–æ–π–¥–µ–Ω–æ: ${passedCount}`);\n    Logger.log(`–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: ${failedCount}`);\n    Logger.log(`–í—Å–µ–≥–æ: ${tests.length}`);\n\n    AppLogger.info('TestRunner', `–¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã: ${passedCount}/${tests.length} –ø—Ä–æ–π–¥–µ–Ω–æ`);\n\n    return { passed: passedCount, failed: failedCount };\n  }\n\n  return {\n    test: test,\n    runAll: runAll\n  };\n})();\n\n// –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤\nfunction setupTests() {\n  TestRunner.test('Utils.parseDate - –≤–∞–ª–∏–¥–Ω–∞—è –¥–∞—Ç–∞', (assert) => {\n    const date = Utils.parseDate('15.11.2024');\n    assert.notNull(date, '–î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–∞');\n    assert.equals(date.getDate(), 15);\n  });\n\n  TestRunner.test('ConfigManager.get - default –∑–Ω–∞—á–µ–Ω–∏–µ', (assert) => {\n    const value = ConfigManager.get('PERFORMANCE.BATCH_SIZE');\n    assert.equals(value, 50);\n  });\n}\n\nfunction runTests() {\n  setupTests();\n  TestRunner.runAll();\n}\n"},{"name":"TimeTracker.gs","content":"/**\n * TimeTracker.gs\n *\n * –ú–æ–¥—É–ª—å –¥–ª—è —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —é—Ä–∏—Å—Ç–æ–≤:\n * - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –¥–µ–ª–∞–º\n * - –û—Ç—á—ë—Ç—ã –ø–æ –±–∏–ª–ª–∏–Ω–≥—É\n * - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —é—Ä–∏—Å—Ç–∞–º\n * - –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å–ª—É–≥\n */\n\nvar TimeTracker = (function() {\n  'use strict';\n\n  const SHEET_NAME = '‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏';\n\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #11: –¢–∞—Ä–∏—Ñ—ã —Ç–µ–ø–µ—Ä—å –±–µ—Ä—É—Ç—Å—è –∏–∑ CONFIG\n  // (—Å–º. Config.gs)\n\n  // ============================================\n  // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –õ–ò–°–¢–ê\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—Å—Ç —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —é—Ä–∏—Å—Ç–æ–≤.\n   * –ï—Å–ª–∏ –ª–∏—Å—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞—ë—Ç –µ–≥–æ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.\n   *\n   * @return {Sheet} –û–±—ä–µ–∫—Ç –ª–∏—Å—Ç–∞ \"‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏\"\n   */\n  function getOrCreateSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName(SHEET_NAME);\n\n    if (!sheet) {\n      sheet = ss.insertSheet(SHEET_NAME);\n      initializeSheet(sheet);\n    }\n\n    return sheet;\n  }\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–∏—Å—Ç —É—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —à–∏—Ä–∏–Ω–æ–π –∫–æ–ª–æ–Ω–æ–∫.\n   *\n   * @param {Sheet} sheet - –õ–∏—Å—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏\n   * @return {void}\n   */\n  function initializeSheet(sheet) {\n    // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n    const headers = [\n      '–î–∞—Ç–∞',\n      '–Æ—Ä–∏—Å—Ç',\n      'Email',\n      '–ù–æ–º–µ—Ä –¥–µ–ª–∞',\n      '–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã',\n      '–ß–∞—Å—ã',\n      '–°—Ç–∞–≤–∫–∞ (—Ä—É–±/—á)',\n      '–°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±)',\n      '–°—Ç–∞—Ç—É—Å'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length)\n      .setValues([headers])\n      .setFontWeight('bold')\n      .setBackground('#4a86e8')\n      .setFontColor('#ffffff');\n\n    // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫\n    sheet.setColumnWidth(1, 100);  // –î–∞—Ç–∞\n    sheet.setColumnWidth(2, 150);  // –Æ—Ä–∏—Å—Ç\n    sheet.setColumnWidth(3, 200);  // Email\n    sheet.setColumnWidth(4, 120);  // –ù–æ–º–µ—Ä –¥–µ–ª–∞\n    sheet.setColumnWidth(5, 300);  // –û–ø–∏—Å–∞–Ω–∏–µ\n    sheet.setColumnWidth(6, 70);   // –ß–∞—Å—ã\n    sheet.setColumnWidth(7, 100);  // –°—Ç–∞–≤–∫–∞\n    sheet.setColumnWidth(8, 120);  // –°—Ç–æ–∏–º–æ—Å—Ç—å\n    sheet.setColumnWidth(9, 100);  // –°—Ç–∞—Ç—É—Å\n\n    // –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫\n    sheet.setFrozenRows(1);\n\n    // –§–æ—Ä–º–∞—Ç –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫\n    sheet.getRange('A2:A').setNumberFormat('dd.MM.yyyy HH:mm');\n    sheet.getRange('F2:F').setNumberFormat('0.00'); // –ß–∞—Å—ã\n    sheet.getRange('G2:G').setNumberFormat('#,##0 ‚ÇΩ'); // –°—Ç–∞–≤–∫–∞\n    sheet.getRange('H2:H').setNumberFormat('#,##0 ‚ÇΩ'); // –°—Ç–æ–∏–º–æ—Å—Ç—å\n\n    // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è\n    sheet.getRange('A2').setValue('–î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ —Ç–∞–±–ª–∏—Ü—É');\n    sheet.getRange('A2').setFontStyle('italic').setFontColor('#666666');\n  }\n\n  // ============================================\n  // –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ü–ò–°–ï–ô\n  // ============================================\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #31: JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è\n   *\n   * –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ 4-—à–∞–≥–æ–≤—ã–π –º–∞—Å—Ç–µ—Ä:\n   * 1. –í—ã–±–æ—Ä –¥–µ–ª–∞ (–∏–∑ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∏–ª–∏ –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é)\n   * 2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤\n   * 3. –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã\n   * 4. –°—Ç–∞–≤–∫–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª—è —Ä–æ–ª–∏ –∏–ª–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è)\n   *\n   * @return {void}\n   */\n  function addTimeEntry() {\n    const ui = SpreadsheetApp.getUi();\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user) {\n      ui.alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ');\n      return;\n    }\n\n    const userName = user.name || userEmail;\n    const assignedCases = user.assigned_cases || [];\n\n    // –®–∞–≥ 1: –í—ã–±—Ä–∞—Ç—å –¥–µ–ª–æ\n    let caseNumber;\n\n    if (assignedCases.length > 0) {\n      const caseList = assignedCases.slice(0, 10).map((c, i) => `${i + 1}. ${c}`).join('\\n');\n\n      const caseResponse = ui.prompt(\n        '‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã - –®–∞–≥ 1/4',\n        '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞:\\n\\n' + caseList +\n        '\\n\\n–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞ –≤—Ä—É—á–Ω—É—é:',\n        ui.ButtonSet.OK_CANCEL\n      );\n\n      if (caseResponse.getSelectedButton() !== ui.Button.OK) return;\n\n      const input = caseResponse.getResponseText().trim();\n      const selectedIndex = parseInt(input) - 1;\n\n      if (!isNaN(selectedIndex) && selectedIndex >= 0 && selectedIndex < assignedCases.length) {\n        caseNumber = assignedCases[selectedIndex];\n      } else {\n        caseNumber = input;\n      }\n    } else {\n      const caseResponse = ui.prompt(\n        '‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã - –®–∞–≥ 1/4',\n        '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–ª–∞:',\n        ui.ButtonSet.OK_CANCEL\n      );\n\n      if (caseResponse.getSelectedButton() !== ui.Button.OK) return;\n      caseNumber = caseResponse.getResponseText().trim();\n    }\n\n    if (!caseNumber) {\n      ui.alert('‚ùå –ù–æ–º–µ—Ä –¥–µ–ª–∞ –Ω–µ —É–∫–∞–∑–∞–Ω');\n      return;\n    }\n\n    // –®–∞–≥ 2: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤\n    const hoursResponse = ui.prompt(\n      '‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã - –®–∞–≥ 2/4',\n      '–°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –≤—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏?\\n\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: 2.5 –∏–ª–∏ 1.25)',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (hoursResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const hours = parseFloat(hoursResponse.getResponseText().replace(',', '.'));\n\n    if (isNaN(hours) || hours <= 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤');\n      return;\n    }\n\n    // –®–∞–≥ 3: –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã\n    const descResponse = ui.prompt(\n      '‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã - –®–∞–≥ 3/4',\n      '–û–ø–∏—à–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É:\\n\\n(–ù–∞–ø—Ä–∏–º–µ—Ä: \"–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏—Å–∫–æ–≤–æ–≥–æ –∑–∞—è–≤–ª–µ–Ω–∏—è\")',\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (descResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const description = descResponse.getResponseText().trim() || '–†–∞–±–æ—Ç–∞ –ø–æ –¥–µ–ª—É';\n\n    // –®–∞–≥ 4: –°—Ç–∞–≤–∫–∞\n    const defaultRate = CONFIG.DEFAULT_RATES[user.role] || 3000;\n\n    const rateResponse = ui.prompt(\n      '‚è±Ô∏è –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã - –®–∞–≥ 4/4',\n      `–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (—Ä—É–±/—á–∞—Å):\\n\\n` +\n      `–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª—è —Ä–æ–ª–∏ ${UserManager.ROLES[user.role].name}: ${defaultRate} ‚ÇΩ\\n\\n` +\n      `–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –û–ö –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π:`,\n      ui.ButtonSet.OK_CANCEL\n    );\n\n    if (rateResponse.getSelectedButton() !== ui.Button.OK) return;\n\n    const rateInput = rateResponse.getResponseText().trim();\n    const rate = rateInput ? parseFloat(rateInput) : defaultRate;\n\n    if (isNaN(rate) || rate <= 0) {\n      ui.alert('‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞');\n      return;\n    }\n\n    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å\n    const cost = hours * rate;\n\n    // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å\n    const sheet = getOrCreateSheet();\n    const now = new Date();\n\n    sheet.appendRow([\n      now,\n      userName,\n      userEmail,\n      caseNumber,\n      description,\n      hours,\n      rate,\n      cost,\n      '–ß–µ—Ä–Ω–æ–≤–∏–∫'\n    ]);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏\n    const lastRow = sheet.getLastRow();\n    sheet.getRange(lastRow, 1).setNumberFormat('dd.MM.yyyy HH:mm');\n    sheet.getRange(lastRow, 6).setNumberFormat('0.00');\n    sheet.getRange(lastRow, 7).setNumberFormat('#,##0 ‚ÇΩ');\n    sheet.getRange(lastRow, 8).setNumberFormat('#,##0 ‚ÇΩ');\n\n    ui.alert(\n      '‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!',\n      `–î–µ–ª–æ: ${caseNumber}\\n` +\n      `–í—Ä–µ–º—è: ${hours} —á\\n` +\n      `–°—Ç–∞–≤–∫–∞: ${rate} ‚ÇΩ/—á\\n` +\n      `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${cost} ‚ÇΩ\\n\\n` +\n      `–ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ª–∏—Å—Ç \"${SHEET_NAME}\"`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('TimeTracker', `${userName} –¥–æ–±–∞–≤–∏–ª ${hours} —á –ø–æ –¥–µ–ª—É ${caseNumber}`);\n  }\n\n  // ============================================\n  // –û–¢–ß–Å–¢–´\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function showMyTimeTracking() {\n    const ui = SpreadsheetApp.getUi();\n    const userEmail = Session.getActiveUser().getEmail();\n    const user = UserManager.getUser(userEmail);\n\n    if (!user) {\n      ui.alert('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');\n      return;\n    }\n\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    let totalHours = 0;\n    let totalCost = 0;\n    const byCases = {};\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const email = row[2];\n\n      if (email === userEmail) {\n        const caseNumber = row[3];\n        const hours = parseFloat(row[5]) || 0;\n        const cost = parseFloat(row[7]) || 0;\n\n        totalHours += hours;\n        totalCost += cost;\n\n        if (!byCases[caseNumber]) {\n          byCases[caseNumber] = { hours: 0, cost: 0 };\n        }\n        byCases[caseNumber].hours += hours;\n        byCases[caseNumber].cost += cost;\n      }\n    }\n\n    if (totalHours === 0) {\n      ui.alert('‚ÑπÔ∏è –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã');\n      return;\n    }\n\n    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞\n    let message = `–í—Å–µ–≥–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ: ${totalHours.toFixed(2)} —á\\n`;\n    message += `–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalCost.toFixed(0)} ‚ÇΩ\\n\\n`;\n    message += '–†–∞–∑–±–∏–≤–∫–∞ –ø–æ –¥–µ–ª–∞–º:\\n';\n\n    const casesList = Object.keys(byCases).slice(0, 10);\n    casesList.forEach(caseNum => {\n      const stats = byCases[caseNum];\n      message += `‚Ä¢ ${caseNum}: ${stats.hours.toFixed(2)} —á (${stats.cost.toFixed(0)} ‚ÇΩ)\\n`;\n    });\n\n    if (Object.keys(byCases).length > 10) {\n      message += `\\n...–∏ –µ—â—ë ${Object.keys(byCases).length - 10} –¥–µ–ª`;\n    }\n\n    ui.alert('‚è±Ô∏è –ú–æ–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏', message, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—â–∏–π —É—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∞/–º–µ–Ω–µ–¥–∂–µ—Ä–∞)\n   */\n  function showTimeTracking() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const byLawyers = {};\n    let grandTotalHours = 0;\n    let grandTotalCost = 0;\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const lawyerName = row[1];\n      const hours = parseFloat(row[5]) || 0;\n      const cost = parseFloat(row[7]) || 0;\n\n      if (!lawyerName) continue;\n\n      if (!byLawyers[lawyerName]) {\n        byLawyers[lawyerName] = { hours: 0, cost: 0, entries: 0 };\n      }\n\n      byLawyers[lawyerName].hours += hours;\n      byLawyers[lawyerName].cost += cost;\n      byLawyers[lawyerName].entries++;\n\n      grandTotalHours += hours;\n      grandTotalCost += cost;\n    }\n\n    if (grandTotalHours === 0) {\n      ui.alert('‚ÑπÔ∏è –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã');\n      return;\n    }\n\n    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞\n    let message = `–í—Å–µ–≥–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ: ${grandTotalHours.toFixed(2)} —á\\n`;\n    message += `–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${grandTotalCost.toFixed(0)} ‚ÇΩ\\n\\n`;\n    message += '–ü–æ —é—Ä–∏—Å—Ç–∞–º:\\n';\n\n    Object.keys(byLawyers).forEach(name => {\n      const stats = byLawyers[name];\n      message += `‚Ä¢ ${name}: ${stats.hours.toFixed(2)} —á (${stats.cost.toFixed(0)} ‚ÇΩ)\\n`;\n      message += `  –ó–∞–ø–∏—Å–µ–π: ${stats.entries}\\n`;\n    });\n\n    ui.alert('‚è±Ô∏è –£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã', message, ui.ButtonSet.OK);\n  }\n\n  /**\n   * –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –¥–ª—è –±–∏–ª–ª–∏–Ω–≥–∞\n   */\n  function exportTimeToCSV() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ª–∏—Å—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    const exportSheetName = `–≠–∫—Å–ø–æ—Ä—Ç ${Utilities.formatDate(new Date(), Session.getScriptTimeZone(), 'yyyy-MM-dd HH-mm')}`;\n    const exportSheet = ss.insertSheet(exportSheetName);\n\n    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ\n    exportSheet.getRange(1, 1, data.length, data[0].length).setValues(data);\n\n    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n    exportSheet.getRange(1, 1, 1, data[0].length)\n      .setFontWeight('bold')\n      .setBackground('#4a86e8')\n      .setFontColor('#ffffff');\n\n    ui.alert(\n      '‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–Ω!',\n      `–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –ª–∏—Å—Ç:\\n\"${exportSheetName}\"\\n\\n` +\n      '–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –µ–≥–æ –∫–∞–∫ CSV —á–µ—Ä–µ–∑:\\n' +\n      '–§–∞–π–ª ‚Üí –°–∫–∞—á–∞—Ç—å ‚Üí –ó–Ω–∞—á–µ–Ω–∏—è, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ –∑–∞–ø—è—Ç–æ–π (.csv)',\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('TimeTracker', `–≠–∫—Å–ø–æ—Ä—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω: ${exportSheetName}`);\n  }\n\n  // ============================================\n  // –°–¢–ê–¢–ò–°–¢–ò–ö–ê\n  // ============================================\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function showDetailedStatistics() {\n    if (!checkPermission('view_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n\n    const now = new Date();\n    const thisMonth = now.getMonth();\n    const thisYear = now.getFullYear();\n\n    let monthHours = 0;\n    let monthCost = 0;\n    const topCases = {};\n\n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      const date = row[0];\n      const caseNumber = row[3];\n      const hours = parseFloat(row[5]) || 0;\n      const cost = parseFloat(row[7]) || 0;\n\n      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü\n      if (date instanceof Date &&\n          date.getMonth() === thisMonth &&\n          date.getFullYear() === thisYear) {\n        monthHours += hours;\n        monthCost += cost;\n      }\n\n      // –¢–æ–ø –¥–µ–ª –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n      if (!topCases[caseNumber]) {\n        topCases[caseNumber] = { hours: 0, cost: 0 };\n      }\n      topCases[caseNumber].hours += hours;\n      topCases[caseNumber].cost += cost;\n    }\n\n    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø –¥–µ–ª\n    const sortedCases = Object.keys(topCases)\n      .map(caseNum => ({ caseNum, ...topCases[caseNum] }))\n      .sort((a, b) => b.hours - a.hours)\n      .slice(0, 5);\n\n    let message = `üìÖ –ó–ê –¢–ï–ö–£–©–ò–ô –ú–ï–°–Ø–¶:\\n`;\n    message += `–ß–∞—Å–æ–≤: ${monthHours.toFixed(2)} —á\\n`;\n    message += `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${monthCost.toFixed(0)} ‚ÇΩ\\n\\n`;\n\n    message += `üèÜ –¢–û–ü-5 –î–ï–õ –ü–û –í–†–ï–ú–ï–ù–ò:\\n`;\n    sortedCases.forEach((c, i) => {\n      message += `${i + 1}. ${c.caseNum}: ${c.hours.toFixed(2)} —á (${c.cost.toFixed(0)} ‚ÇΩ)\\n`;\n    });\n\n    ui.alert('üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', message, ui.ButtonSet.OK);\n  }\n\n  // ============================================\n  // –£–¢–ò–õ–ò–¢–´\n  // ============================================\n\n  /**\n   * –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–æ—Ä–º—É–ª—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏\n   */\n  function recalculateCosts() {\n    if (!checkPermission('manage_cases')) return;\n\n    const sheet = getOrCreateSheet();\n    const data = sheet.getDataRange().getValues();\n    let updatedCount = 0;\n\n    for (let i = 1; i < data.length; i++) {\n      const hours = parseFloat(data[i][5]) || 0;\n      const rate = parseFloat(data[i][6]) || 0;\n      const currentCost = parseFloat(data[i][7]) || 0;\n      const calculatedCost = hours * rate;\n\n      if (Math.abs(currentCost - calculatedCost) > 0.01) {\n        sheet.getRange(i + 1, 8).setValue(calculatedCost);\n        updatedCount++;\n      }\n    }\n\n    SpreadsheetApp.getUi().alert(\n      '‚úÖ –ü–µ—Ä–µ—Å—á—ë—Ç –∑–∞–≤–µ—Ä—à—ë–Ω',\n      `–û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${updatedCount}`,\n      SpreadsheetApp.getUi().ButtonSet.OK\n    );\n\n    AppLogger.info('TimeTracker', `–ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–æ ${updatedCount} –∑–∞–ø–∏—Å–µ–π`);\n  }\n\n  /**\n   * –û–¥–æ–±—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–∏\n   */\n  function approveTimeEntries() {\n    if (!checkPermission('manage_cases')) return;\n\n    const ui = SpreadsheetApp.getUi();\n    const sheet = getOrCreateSheet();\n    const selection = sheet.getActiveRange();\n    const startRow = selection.getRow();\n    const numRows = selection.getNumRows();\n\n    if (startRow === 1) {\n      ui.alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–ø–∏—Å—è–º–∏ (–Ω–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫)');\n      return;\n    }\n\n    let approvedCount = 0;\n\n    for (let i = 0; i < numRows; i++) {\n      const row = startRow + i;\n      const status = sheet.getRange(row, 9).getValue();\n\n      if (status !== '–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ') {\n        sheet.getRange(row, 9).setValue('–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ');\n        // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –∑–µ–ª—ë–Ω—ã–º\n        sheet.getRange(row, 1, 1, 9).setBackground('#d9ead3');\n        approvedCount++;\n      }\n    }\n\n    ui.alert(\n      '‚úÖ –ó–∞–ø–∏—Å–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã!',\n      `–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${approvedCount}`,\n      ui.ButtonSet.OK\n    );\n\n    AppLogger.info('TimeTracker', `–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ ${approvedCount} –∑–∞–ø–∏—Å–µ–π –≤—Ä–µ–º–µ–Ω–∏`);\n  }\n\n  // ============================================\n  // –≠–ö–°–ü–û–†–¢\n  // ============================================\n\n  return {\n    addTimeEntry: addTimeEntry,\n    showMyTimeTracking: showMyTimeTracking,\n    showTimeTracking: showTimeTracking,\n    exportTimeToCSV: exportTimeToCSV,\n    showDetailedStatistics: showDetailedStatistics,\n    recalculateCosts: recalculateCosts,\n    approveTimeEntries: approveTimeEntries,\n    getOrCreateSheet: getOrCreateSheet\n  };\n})();\n"},{"name":"UserManager.gs","content":"/**\n * ‚ú® UserManager.gs - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏\n *\n * –§–£–ù–ö–¶–ò–ò:\n * ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n * ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π (Admin, Manager, Lawyer, Assistant, Observer)\n * ‚úÖ –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞\n * ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —Ä–æ–ª—è–º\n * ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Properties Service\n *\n * –†–û–õ–ò:\n * - Admin: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n * - Manager: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞–º–∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n * - Lawyer: –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –¥–µ–ª–∞, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ —Å–≤–æ–∏–º –¥–µ–ª–∞–º\n * - Assistant: –ü–æ–º–æ—â–Ω–∏–∫, –±–∞–∑–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n * - Observer: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä, –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç\n */\n\nvar UserManager = (function() {\n\n  /**\n   * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –∏—Ö –ø—Ä–∞–≤\n   */\n  const ROLES = {\n    ADMIN: {\n      name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',\n      permissions: ['all'],\n      notifications: ['critical', 'important', 'info', 'digest']\n    },\n    MANAGER: {\n      name: '–ú–µ–Ω–µ–¥–∂–µ—Ä',\n      permissions: ['view', 'edit', 'manage_cases'],\n      notifications: ['critical', 'important', 'digest']\n    },\n    LAWYER: {\n      name: '–Æ—Ä–∏—Å—Ç',\n      permissions: ['view', 'edit', 'manage_own_cases'],\n      notifications: ['critical', 'important', 'own_cases']\n    },\n    ASSISTANT: {\n      name: '–ü–æ–º–æ—â–Ω–∏–∫',\n      permissions: ['view', 'edit'],\n      notifications: ['critical', 'digest']\n    },\n    OBSERVER: {\n      name: '–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å',\n      permissions: ['view'],\n      notifications: ['digest']\n    }\n  };\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n   * @return {Object} –û–±—ä–µ–∫—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n   */\n  function getAllUsers() {\n    const props = PropertiesService.getScriptProperties();\n    const usersJson = props.getProperty('USERS');\n\n    if (!usersJson) {\n      return {};\n    }\n\n    try {\n      return JSON.parse(usersJson);\n    } catch (e) {\n      AppLogger.error('UserManager', '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', { error: e.message });\n      return {};\n    }\n  }\n\n  /**\n   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n   * @param {Object} users - –û–±—ä–µ–∫—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n   */\n  function saveUsers(users) {\n    const props = PropertiesService.getScriptProperties();\n    props.setProperty('USERS', JSON.stringify(users));\n    AppLogger.info('UserManager', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email\n   * @param {string} email - Email –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏\n   * @return {boolean} true –µ—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π\n   */\n  function isValidEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\n   * –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} role - –†–æ–ª—å (ADMIN, MANAGER, LAWYER, ASSISTANT, OBSERVER)\n   * @param {Object} options - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏\n   */\n  function addUser(email, role, options = {}) {\n    // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ email\n    if (!isValidEmail(email)) {\n      throw new Error(`–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email: ${email}`);\n    }\n\n    if (!ROLES[role]) {\n      throw new Error(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å: ${role}`);\n    }\n\n    const users = getAllUsers();\n\n    users[email] = {\n      email: email,\n      role: role,\n      name: options.name || email.split('@')[0],\n      phone: options.phone || '',\n      telegram_chat_id: options.telegram_chat_id || '',\n      notification_preferences: options.notification_preferences || {\n        email: true,\n        telegram: false,\n        sms: false\n      },\n      assigned_cases: options.assigned_cases || [], // –î–µ–ª–∞, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–µ—á–∞–µ—Ç\n      created_at: new Date().toISOString(),\n      active: true\n    };\n\n    saveUsers(users);\n    AppLogger.info('UserManager', `–î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} —Å —Ä–æ–ª—å—é ${role}`);\n  }\n\n  /**\n   * –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   */\n  function removeUser(email) {\n    const users = getAllUsers();\n\n    if (!users[email]) {\n      throw new Error(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n    }\n\n    delete users[email];\n    saveUsers(users);\n    AppLogger.info('UserManager', `–£–¥–∞–ª—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email}`);\n  }\n\n  /**\n   * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {Object} updates - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è\n   */\n  function updateUser(email, updates) {\n    const users = getAllUsers();\n\n    if (!users[email]) {\n      throw new Error(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n    }\n\n    // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è\n    Object.keys(updates).forEach(key => {\n      users[email][key] = updates[key];\n    });\n\n    saveUsers(users);\n    AppLogger.info('UserManager', `–û–±–Ω–æ–≤–ª—ë–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email}`, updates);\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @return {Object|null} –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ null\n   */\n  function getUser(email) {\n    const users = getAllUsers();\n    return users[email] || null;\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª–∏\n   * @param {string} role - –†–æ–ª—å\n   * @return {Array} –ú–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n   */\n  function getUsersByRole(role) {\n    const users = getAllUsers();\n    const result = [];\n\n    Object.values(users).forEach(user => {\n      if (user.role === role && user.active) {\n        result.push(user);\n      }\n    });\n\n    return result;\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n   * @param {string} notificationType - –¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (critical, important, info, digest, own_cases)\n   * @param {string} caseNumber - –ù–æ–º–µ—Ä –¥–µ–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è own_cases)\n   * @return {Array} –ú–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n   */\n  function getUsersForNotification(notificationType, caseNumber = null) {\n    const users = getAllUsers();\n    const result = [];\n\n    Object.values(users).forEach(user => {\n      if (!user.active) return;\n\n      const roleConfig = ROLES[user.role];\n      if (!roleConfig) return;\n\n      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\n      if (!roleConfig.notifications.includes(notificationType)) return;\n\n      // –î–ª—è own_cases - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–µ–ª–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n      if (notificationType === 'own_cases') {\n        if (!caseNumber) return;\n        if (!user.assigned_cases.includes(caseNumber)) return;\n      }\n\n      result.push(user);\n    });\n\n    return result;\n  }\n\n  /**\n   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} permission - –¢—Ä–µ–±—É–µ–º–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ\n   * @return {boolean} true –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø\n   */\n  function hasPermission(email, permission) {\n    const user = getUser(email);\n    if (!user) return false;\n\n    const roleConfig = ROLES[user.role];\n    if (!roleConfig) return false;\n\n    return roleConfig.permissions.includes('all') ||\n           roleConfig.permissions.includes(permission);\n  }\n\n  /**\n   * –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} caseNumber - –ù–æ–º–µ—Ä –¥–µ–ª–∞\n   */\n  function assignCase(email, caseNumber) {\n    const user = getUser(email);\n    if (!user) {\n      throw new Error(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n    }\n\n    if (!user.assigned_cases.includes(caseNumber)) {\n      user.assigned_cases.push(caseNumber);\n      updateUser(email, { assigned_cases: user.assigned_cases });\n      AppLogger.info('UserManager', `–î–µ–ª–æ ${caseNumber} –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${email}`);\n    }\n  }\n\n  /**\n   * –°–Ω—è—Ç—å –¥–µ–ª–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} email - Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n   * @param {string} caseNumber - –ù–æ–º–µ—Ä –¥–µ–ª–∞\n   */\n  function unassignCase(email, caseNumber) {\n    const user = getUser(email);\n    if (!user) {\n      throw new Error(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} –Ω–µ –Ω–∞–π–¥–µ–Ω`);\n    }\n\n    const index = user.assigned_cases.indexOf(caseNumber);\n    if (index !== -1) {\n      user.assigned_cases.splice(index, 1);\n      updateUser(email, { assigned_cases: user.assigned_cases });\n      AppLogger.info('UserManager', `–î–µ–ª–æ ${caseNumber} —Å–Ω—è—Ç–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${email}`);\n    }\n  }\n\n  /**\n   * –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n   */\n  function createUsersSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName('üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');\n\n    if (!sheet) {\n      sheet = ss.insertSheet('üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');\n      AppLogger.info('UserManager', '–°–æ–∑–¥–∞–Ω –ª–∏—Å—Ç \"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\"');\n    }\n\n    // –û—á–∏—Å—Ç–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏\n    sheet.clear();\n\n    // –ó–∞–≥–æ–ª–æ–≤–∫–∏\n    const headers = [\n      'Email',\n      '–†–æ–ª—å',\n      '–ò–º—è',\n      'Telegram Chat ID',\n      '‚úâÔ∏è Email',\n      'üì± Telegram',\n      'üìû SMS',\n      '–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–µ–ª–∞'\n    ];\n\n    sheet.getRange(1, 1, 1, headers.length).setValues([headers]);\n    sheet.getRange(1, 1, 1, headers.length)\n      .setBackground('#4285f4')\n      .setFontColor('#ffffff')\n      .setFontWeight('bold')\n      .setHorizontalAlignment('center');\n\n    // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è\n    sheet.getRange('A2').setValue('üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø:');\n    sheet.getRange('A3').setValue('1. –í–≤–µ–¥–∏—Ç–µ Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å—Ç–æ–ª–±–µ—Ü A');\n    sheet.getRange('A4').setValue('2. –í—ã–±–µ—Ä–∏—Ç–µ –†–æ–ª—å –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –≤ —Å—Ç–æ–ª–±–µ—Ü B');\n    sheet.getRange('A5').setValue('3. –í–≤–µ–¥–∏—Ç–µ –ò–º—è –≤ —Å—Ç–æ–ª–±–µ—Ü C');\n    sheet.getRange('A6').setValue('4. –í–≤–µ–¥–∏—Ç–µ Telegram Chat ID –≤ —Å—Ç–æ–ª–±–µ—Ü D (–µ—Å–ª–∏ –µ—Å—Ç—å)');\n    sheet.getRange('A7').setValue('5. –ü–æ—Å—Ç–∞–≤—å—Ç–µ ‚úì –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö E, F, G –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');\n    sheet.getRange('A8').setValue('6. –í —Å—Ç–æ–ª–±–µ—Ü H –º–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ –¥–µ–ª —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–¥–ª—è —Ä–æ–ª–∏ LAWYER)');\n    sheet.getRange('A9').setValue('7. –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ: –ú–µ–Ω—é ‚Üí ‚öñÔ∏è –°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞ ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üíæ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');\n    sheet.getRange('A2:A9').setFontSize(10).setFontColor('#666666');\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ \"–†–æ–ª—å\"\n    const roleRule = SpreadsheetApp.newDataValidation()\n      .requireValueInList(['ADMIN', 'MANAGER', 'LAWYER', 'ASSISTANT', 'OBSERVER'], true)\n      .setAllowInvalid(false)\n      .setHelpText('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞')\n      .build();\n\n    sheet.getRange('B11:B1000').setDataValidation(roleRule);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n    const checkboxRule = SpreadsheetApp.newDataValidation()\n      .requireCheckbox()\n      .build();\n\n    sheet.getRange('E11:G1000').setDataValidation(checkboxRule);\n\n    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∞–Ω–Ω—ã—Ö\n    sheet.getRange('A10').setValue('=== –î–ê–ù–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô (–Ω–∞—á–Ω–∏—Ç–µ —Å —Å—Ç—Ä–æ–∫–∏ 11) ===');\n    sheet.getRange('A10').setFontWeight('bold').setBackground('#fff3cd');\n\n    // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n    const users = getAllUsers();\n    const usersList = Object.values(users);\n\n    if (usersList.length > 0) {\n      const data = usersList.map(user => [\n        user.email,\n        user.role,\n        user.name || '',\n        user.telegram_chat_id || '',\n        user.notification_preferences.email || false,\n        user.notification_preferences.telegram || false,\n        user.notification_preferences.sms || false,\n        (user.assigned_cases || []).join(', ')\n      ]);\n\n      sheet.getRange(11, 1, data.length, headers.length).setValues(data);\n    }\n\n    // –®–∏—Ä–∏–Ω–∞ —Å—Ç–æ–ª–±—Ü–æ–≤\n    sheet.setColumnWidth(1, 200); // Email\n    sheet.setColumnWidth(2, 100); // –†–æ–ª—å\n    sheet.setColumnWidth(3, 150); // –ò–º—è\n    sheet.setColumnWidth(4, 120); // Chat ID\n    sheet.setColumnWidth(5, 70);  // Email checkbox\n    sheet.setColumnWidth(6, 90);  // Telegram checkbox\n    sheet.setColumnWidth(7, 70);  // SMS checkbox\n    sheet.setColumnWidth(8, 250); // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–µ–ª–∞\n\n    // –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫\n    sheet.setFrozenRows(1);\n\n    AppLogger.info('UserManager', '–õ–∏—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª—ë–Ω');\n\n    return sheet;\n  }\n\n  /**\n   * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ª–∏—Å—Ç–∞ –≤ Properties Service\n   */\n  function syncUsersFromSheet() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName('üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');\n\n    if (!sheet) {\n      SpreadsheetApp.getUi().alert(\n        '‚ùå –õ–∏—Å—Ç \"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\" –Ω–µ –Ω–∞–π–¥–µ–Ω!\\n\\n' +\n        '–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –º–µ–Ω—é: ‚öñÔ∏è –°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞ ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏'\n      );\n      return;\n    }\n\n    // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–Ω–∞—á–∏–Ω–∞—è —Å —Å—Ç—Ä–æ–∫–∏ 11)\n    const lastRow = sheet.getLastRow();\n\n    if (lastRow < 11) {\n      SpreadsheetApp.getUi().alert('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏!');\n      return;\n    }\n\n    const data = sheet.getRange(11, 1, lastRow - 10, 8).getValues();\n    const users = {};\n    let addedCount = 0;\n    let errorCount = 0;\n    const errors = [];\n\n    data.forEach((row, index) => {\n      const [email, role, name, chatId, emailNotif, telegramNotif, smsNotif, assignedCases] = row;\n\n      // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏\n      if (!email || email.toString().trim() === '') return;\n\n      // –í–∞–ª–∏–¥–∞—Ü–∏—è\n      if (!ROLES[role]) {\n        errors.push(`–°—Ç—Ä–æ–∫–∞ ${index + 11}: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å \"${role}\"`);\n        errorCount++;\n        return;\n      }\n\n      // –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n      users[email] = {\n        email: email,\n        role: role,\n        name: name || email.split('@')[0],\n        phone: '',\n        telegram_chat_id: chatId ? chatId.toString() : '',\n        notification_preferences: {\n          email: emailNotif === true,\n          telegram: telegramNotif === true,\n          sms: smsNotif === true\n        },\n        assigned_cases: assignedCases ?\n          assignedCases.toString().split(',').map(c => c.trim()).filter(c => c) :\n          [],\n        created_at: new Date().toISOString(),\n        active: true\n      };\n\n      addedCount++;\n    });\n\n    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n    if (Object.keys(users).length > 0) {\n      saveUsers(users);\n\n      let message = `‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\\n\\n`;\n      message += `–î–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ: ${addedCount} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\\n`;\n\n      if (errorCount > 0) {\n        message += `\\n‚ö†Ô∏è –û—à–∏–±–æ–∫: ${errorCount}\\n\\n`;\n        message += errors.slice(0, 5).join('\\n');\n        if (errors.length > 5) {\n          message += `\\n... –∏ –µ—â—ë ${errors.length - 5} –æ—à–∏–±–æ–∫`;\n        }\n      }\n\n      SpreadsheetApp.getUi().alert('üíæ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', message, SpreadsheetApp.getUi().ButtonSet.OK);\n      AppLogger.info('UserManager', `–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${addedCount} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);\n    }\n  }\n\n  /**\n   * –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏\n   */\n  function showManageUsersDialog() {\n    const ss = SpreadsheetApp.getActiveSpreadsheet();\n    let sheet = ss.getSheetByName('üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');\n\n    if (!sheet) {\n      createUsersSheet();\n      sheet = ss.getSheetByName('üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');\n    }\n\n    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç\n    sheet.activate();\n\n    SpreadsheetApp.getUi().alert(\n      'üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',\n      'üìã –õ–∏—Å—Ç \"üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏\" –æ—Ç–∫—Ä—ã—Ç!\\n\\n' +\n      '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∏ –Ω–∞–∂–º–∏—Ç–µ:\\n' +\n      '‚öñÔ∏è –°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞ ‚Üí ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí üíæ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\\n\\n' +\n      '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö 2-9 –ª–∏—Å—Ç–∞.',\n      SpreadsheetApp.getUi().ButtonSet.OK\n    );\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    ROLES: ROLES,\n    getAllUsers: getAllUsers,\n    addUser: addUser,\n    removeUser: removeUser,\n    updateUser: updateUser,\n    getUser: getUser,\n    getUsersByRole: getUsersByRole,\n    getUsersForNotification: getUsersForNotification,\n    hasPermission: hasPermission,\n    assignCase: assignCase,\n    unassignCase: unassignCase,\n    createUsersSheet: createUsersSheet,\n    syncUsersFromSheet: syncUsersFromSheet,\n    showManageUsersDialog: showManageUsersDialog\n  };\n})();\n\n/**\n * –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:\n *\n * // –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * UserManager.addUser('lawyer@example.com', 'LAWYER', {\n *   name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',\n *   phone: '+79001234567',\n *   telegram_chat_id: '123456789'\n * });\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n * const user = UserManager.getUser('lawyer@example.com');\n *\n * // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n * const users = UserManager.getUsersForNotification('critical');\n *\n * // –ù–∞–∑–Ω–∞—á–∏—Ç—å –¥–µ–ª–æ\n * UserManager.assignCase('lawyer@example.com', '–ê40-123456/2024');\n *\n * // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞\n * const canManage = UserManager.hasPermission('lawyer@example.com', 'manage_cases');\n *\n * // –ü–æ–∫–∞–∑–∞—Ç—å UI\n * UserManager.showManageUsersDialog();\n */\n"},{"name":"Utils.gs","content":"/**\n * ‚ú® –£–õ–£–ß–®–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø Utils.gs\n *\n * –ò–ó–ú–ï–ù–ï–ù–ò–Ø:\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è parseDate –∏ formatDate\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞\n * ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–∞—Ö\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–∞—Ç\n * ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\n *\n * –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:\n * - –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã: ~10x –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö\n * - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ~5x –±—ã—Å—Ç—Ä–µ–µ —Å –∫—ç—à–µ–º\n */\n\nvar Utils = (function() {\n\n  // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û Issue #15: TTL-based –∫—ç—à\n  const dateCache = {\n    parsed: {},      // –ö—ç—à —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö –¥–∞—Ç: { key: { value, timestamp } }\n    formatted: {},   // –ö—ç—à –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç: { key: { value, timestamp } }\n    maxSize: 1000,   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞\n    ttl: 5 * 60 * 1000  // TTL: 5 –º–∏–Ω—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö\n  };\n\n  /**\n   * ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞\n   * –í—ã–∑—ã–≤–∞–π—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–ª–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö\n   */\n  function clearCache() {\n    dateCache.parsed = {};\n    dateCache.formatted = {};\n    Logger.log('‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω');\n  }\n\n  /**\n   * ‚úÖ –ù–û–í–û–ï: –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ TTL\n   */\n  function cleanExpiredCache() {\n    const now = Date.now();\n    let cleanedCount = 0;\n\n    // –û—á–∏—Å—Ç–∫–∞ parsed –∫—ç—à–∞\n    for (const key in dateCache.parsed) {\n      if (dateCache.parsed.hasOwnProperty(key)) {\n        const entry = dateCache.parsed[key];\n        if (entry.timestamp && (now - entry.timestamp) > dateCache.ttl) {\n          delete dateCache.parsed[key];\n          cleanedCount++;\n        }\n      }\n    }\n\n    // –û—á–∏—Å—Ç–∫–∞ formatted –∫—ç—à–∞\n    for (const key in dateCache.formatted) {\n      if (dateCache.formatted.hasOwnProperty(key)) {\n        const entry = dateCache.formatted[key];\n        if (entry.timestamp && (now - entry.timestamp) > dateCache.ttl) {\n          delete dateCache.formatted[key];\n          cleanedCount++;\n        }\n      }\n    }\n\n    if (cleanedCount > 0) {\n      Logger.log(`üßπ –û—á–∏—â–µ–Ω–æ ${cleanedCount} —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ –∫—ç—à–∞`);\n    }\n\n    return cleanedCount;\n  }\n\n  /**\n   * ‚úÖ –£–õ–£–ß–®–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞ —Å TTL-–æ—á–∏—Å—Ç–∫–æ–π\n   */\n  function checkCacheSize() {\n    // –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ\n    cleanExpiredCache();\n\n    const totalSize = Object.keys(dateCache.parsed).length +\n                     Object.keys(dateCache.formatted).length;\n\n    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤—Å–µ –µ—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω - –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞\n    if (totalSize > dateCache.maxSize) {\n      Logger.log('‚ö†Ô∏è –ö—ç—à –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω –¥–∞–∂–µ –ø–æ—Å–ª–µ TTL-–æ—á–∏—Å—Ç–∫–∏, –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞...');\n      clearCache();\n    }\n  }\n\n  /**\n   * –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏\n   * @param {Sheet} sheet - –õ–∏—Å—Ç Google Sheets\n   * @param {number} row - –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏\n   * @param {number} col - –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞\n   * @return {string} –ó–Ω–∞—á–µ–Ω–∏–µ —è—á–µ–π–∫–∏ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞\n   */\n  function getValueSafely(sheet, row, col) {\n    try {\n      const value = sheet.getRange(row, col).getValue();\n      return value !== null && value !== undefined ? String(value).trim() : '';\n    } catch (e) {\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è [${row}, ${col}]: ${e.message}`);\n      return '';\n    }\n  }\n\n  /**\n   * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –Ω–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞ –≤ –±—É–∫–≤—É (1 ‚Üí A, 27 ‚Üí AA)\n   * @param {number} column - –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞\n   * @return {string} –ë—É–∫–≤–µ–Ω–Ω–æ–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞\n   */\n  function getColumnLetter(column) {\n    let temp;\n    let letter = '';\n    while (column > 0) {\n      temp = (column - 1) % 26;\n      letter = String.fromCharCode(temp + 65) + letter;\n      column = (column - temp - 1) / 26;\n    }\n    return letter;\n  }\n\n  /**\n   * ‚úÖ –£–õ–£–ß–®–ï–ù–û: –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É —Å TTL-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n   * @param {Date} date - –û–±—ä–µ–∫—Ç –¥–∞—Ç—ã\n   * @return {string} –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ dd.MM.yyyy\n   */\n  function formatDate(date) {\n    if (!date || !(date instanceof Date) || isNaN(date)) {\n      return '';\n    }\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à —Å TTL\n    const cacheKey = String(date.getTime());\n    const now = Date.now();\n\n    if (dateCache.formatted[cacheKey]) {\n      const entry = dateCache.formatted[cacheKey];\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ TTL\n      if (entry.timestamp && (now - entry.timestamp) < dateCache.ttl) {\n        return entry.value;\n      } else {\n        // TTL –∏—Å—Ç–µ–∫ - —É–¥–∞–ª—è–µ–º –∏–∑ –∫—ç—à–∞\n        delete dateCache.formatted[cacheKey];\n      }\n    }\n\n    const day = String(date.getDate()).padStart(2, '0');\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const year = date.getFullYear();\n    const formatted = `${day}.${month}.${year}`;\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à —Å timestamp\n    dateCache.formatted[cacheKey] = {\n      value: formatted,\n      timestamp: now\n    };\n    checkCacheSize();\n\n    return formatted;\n  }\n\n  /**\n   * ‚úÖ –£–õ–£–ß–®–ï–ù–û: –ü–∞—Ä—Å–∏—Ç –¥–∞—Ç—É —Å TTL-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π\n   * @param {string} dateString - –°—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ dd.MM.yyyy\n   * @return {Date|null} –û–±—ä–µ–∫—Ç Date –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞\n   */\n  function parseDate(dateString) {\n    if (!dateString || typeof dateString !== 'string') {\n      return null;\n    }\n\n    const trimmed = dateString.trim();\n    const now = Date.now();\n\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à —Å TTL\n    if (dateCache.parsed[trimmed]) {\n      const entry = dateCache.parsed[trimmed];\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ TTL\n      if (entry.timestamp && (now - entry.timestamp) < dateCache.ttl) {\n        return new Date(entry.value); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ø–∏—é\n      } else {\n        // TTL –∏—Å—Ç–µ–∫ - —É–¥–∞–ª—è–µ–º –∏–∑ –∫—ç—à–∞\n        delete dateCache.parsed[trimmed];\n      }\n    }\n\n    const parts = trimmed.split('.');\n    if (parts.length !== 3) {\n      Logger.log(`‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: ${dateString}`);\n      return null;\n    }\n\n    const day = parseInt(parts[0], 10);\n    const month = parseInt(parts[1], 10) - 1;\n    const year = parseInt(parts[2], 10);\n\n    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã\n    if (isNaN(day) || isNaN(month) || isNaN(year)) {\n      Logger.log(`‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞ –≤ –¥–∞—Ç–µ: ${dateString}`);\n      return null;\n    }\n\n    if (day < 1 || day > 31 || month < 0 || month > 11 || year < 1900 || year > 2100) {\n      Logger.log(`‚ö†Ô∏è –î–∞—Ç–∞ –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: ${dateString}`);\n      return null;\n    }\n\n    const date = new Date(year, month, day);\n\n    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–∞—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 31 —Ñ–µ–≤—Ä–∞–ª—è)\n    if (date.getDate() !== day || date.getMonth() !== month || date.getFullYear() !== year) {\n      Logger.log(`‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞: ${dateString}`);\n      return null;\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à —Å timestamp\n    dateCache.parsed[trimmed] = {\n      value: date.getTime(),\n      timestamp: now\n    };\n    checkCacheSize();\n\n    return date;\n  }\n\n  /**\n   * üî• –£–õ–£–ß–®–ï–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –ø—Ä–æ—à–µ–¥—à–µ–π\n   * @param {string} dateString - –°—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã\n   * @return {boolean} true –µ—Å–ª–∏ –¥–∞—Ç–∞ –≤ –ø—Ä–æ—à–ª–æ–º\n   */\n  function isPastDate(dateString) {\n    const date = parseDate(dateString);\n    if (!date) {\n      return false;\n    }\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    return date < today;\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: –í—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –¥–∞—Ç—ã\n   * @param {string} dateString - –°—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã\n   * @return {number|null} –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –µ—Å–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º) –∏–ª–∏ null\n   */\n  function daysUntil(dateString) {\n    const date = parseDate(dateString);\n    if (!date) {\n      return null;\n    }\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    date.setHours(0, 0, 0, 0);\n\n    const diffTime = date.getTime() - today.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\n    return diffDays;\n  }\n\n  /**\n   * –°–æ–∫—Ä–∞—â–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏\n   * @param {string} fullName - –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ\n   * @return {string} –°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–º–∞–∫—Å 25 —Å–∏–º–≤–æ–ª–æ–≤)\n   */\n  function shortenName(fullName) {\n    if (!fullName || typeof fullName !== 'string') {\n      return '';\n    }\n\n    let shortened = fullName\n      .replace(/–û–û–û\\s*[\"¬´¬ª]?/gi, '')\n      .replace(/–ê–û\\s*[\"¬´¬ª]?/gi, '')\n      .replace(/–ó–ê–û\\s*[\"¬´¬ª]?/gi, '')\n      .replace(/–û–ê–û\\s*[\"¬´¬ª]?/gi, '')\n      .replace(/–ü–ê–û\\s*[\"¬´¬ª]?/gi, '')\n      .replace(/–ò–ü\\s*/gi, '')\n      .replace(/[\"¬´¬ª]/g, '')\n      .trim();\n\n    if (shortened.length > 25) {\n      shortened = shortened.substring(0, 22) + '...';\n    }\n\n    return shortened;\n  }\n\n  /**\n   * –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ –µ–≥–æ –Ω–æ–º–µ—Ä—É\n   * @param {number} columnNumber - –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞\n   * @return {string} –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞\n   */\n  function getColumnName(columnNumber) {\n    const names = {\n      15: '–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ (O)',\n      16: '–î–∞—Ç–∞ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ (P)',\n      17: '–î–∞—Ç–∞ —Å–ª—É—à–∞–Ω–∏—è (Q)',\n      18: '–î–∞—Ç–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏ (R)',\n      19: '–î–∞—Ç–∞ –∫–∞—Å—Å–∞—Ü–∏–∏ (S)',\n      20: '–î–µ–¥–ª–∞–π–Ω –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (T)'\n    };\n    return names[columnNumber] || `–°—Ç–æ–ª–±–µ—Ü ${columnNumber}`;\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: Batch –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {number} startRow - –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞\n   * @param {number} startCol - –ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü\n   * @param {number} numRows - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫\n   * @param {number} numCols - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤\n   * @return {Array<Array>} –ú–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π\n   */\n  function getValuesBatch(sheet, startRow, startCol, numRows, numCols) {\n    try {\n      return sheet.getRange(startRow, startCol, numRows, numCols).getValues();\n    } catch (e) {\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ batch –ø–æ–ª—É—á–µ–Ω–∏—è: ${e.message}`);\n      return Array(numRows).fill(Array(numCols).fill(''));\n    }\n  }\n\n  /**\n   * üî• –ù–û–í–û–ï: Batch –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n   * @param {Sheet} sheet - –õ–∏—Å—Ç\n   * @param {number} startRow - –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞\n   * @param {number} startCol - –ù–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü\n   * @param {Array<Array>} values - –ú–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π\n   */\n  function setValuesBatch(sheet, startRow, startCol, values) {\n    try {\n      if (!values || values.length === 0) {\n        return;\n      }\n      const numRows = values.length;\n      const numCols = values[0].length;\n      sheet.getRange(startRow, startCol, numRows, numCols).setValues(values);\n      Logger.log(`‚úÖ Batch —É—Å—Ç–∞–Ω–æ–≤–∫–∞: ${numRows}x${numCols} —è—á–µ–µ–∫`);\n    } catch (e) {\n      Logger.log(`‚ùå –û—à–∏–±–∫–∞ batch —É—Å—Ç–∞–Ω–æ–≤–∫–∏: ${e.message}`);\n    }\n  }\n\n  // –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤\n  return {\n    getValueSafely: getValueSafely,\n    getColumnLetter: getColumnLetter,\n    formatDate: formatDate,\n    parseDate: parseDate,\n    isPastDate: isPastDate,\n    daysUntil: daysUntil,\n    shortenName: shortenName,\n    getColumnName: getColumnName,\n    getValuesBatch: getValuesBatch,\n    setValuesBatch: setValuesBatch,\n    clearCache: clearCache\n  };\n})();\n"},{"name":"appsscript.json","content":"{\n  \"timeZone\": \"Europe/Moscow\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"oauthScopes\": [\n    \"https://www.googleapis.com/auth/spreadsheets\",\n    \"https://www.googleapis.com/auth/script.external_request\",\n    \"https://www.googleapis.com/auth/drive\",\n    \"https://www.googleapis.com/auth/gmail.send\",\n    \"https://www.googleapis.com/auth/userinfo.email\"\n  ]\n}\n"}];

        let copiedCount = 0;
        const totalFiles = files.length;

        function updateProgress() {
            const percent = Math.round((copiedCount / totalFiles) * 100);
            document.getElementById('progress-text').textContent = `${copiedCount}/${totalFiles}`;
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('progress-fill').textContent = `${percent}%`;
        }

        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                button.classList.add('copied');

                copiedCount++;
                updateProgress();

                setTimeout(() => {
                    button.textContent = 'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err);
            });
        }

        function createFileCard(file) {
            const card = document.createElement('div');
            card.className = 'file-card';

            const preview = file.content.substring(0, 500).replace(/</g, '&lt;').replace(/>/g, '&gt;');
            const lines = file.content.split('\n').length;

            card.innerHTML = `
                <div class="file-header">
                    <div class="file-name">
                        <span class="icon">üìÑ</span>
                        ${file.name}
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard(\`${file.content.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`, this)">
                        üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
                    </button>
                </div>
                <div class="file-info">
                    ${lines} —Å—Ç—Ä–æ–∫ | ${(file.content.length / 1024).toFixed(2)} KB
                </div>
                <div class="code-preview">${preview}...</div>
            `;

            return card;
        }

        // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
        const container = document.getElementById('files-container');
        files.forEach(file => {
            container.appendChild(createFileCard(file));
        });

        updateProgress();
    </script>
</body>
</html>
