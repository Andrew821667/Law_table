# üîî –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞—Å–µ–¥–∞–Ω–∏—è—Ö.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç –∑–∞—Å–µ–¥–∞–Ω–∏–π
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 1 –¥–µ–Ω—å –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –¥–Ω—è –¥–æ –∑–∞—Å–µ–¥–∞–Ω–∏—è
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç
- ‚úÖ –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Google Sheets

### 1. –õ–∏—Å—Ç "–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–ª–∞"

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –¥–∞—Ç–∞–º–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:
- "–¥–∞—Ç–∞"
- "–∑–∞—Å–µ–¥–∞–Ω"
- "—Å–ª—É—à–∞–Ω"

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç:**
- `DD.MM.YYYY` (–Ω–∞–ø—Ä–∏–º–µ—Ä: 25.12.2024)
- `DD/MM/YYYY` (–Ω–∞–ø—Ä–∏–º–µ—Ä: 25/12/2024)
- `YYYY-MM-DD` (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2024-12-25)

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- –ö–æ–ª–æ–Ω–∫–∞ B: –ù–æ–º–µ—Ä –¥–µ–ª–∞
- –ö–æ–ª–æ–Ω–∫–∞ D: –°—Ç–∞—Ç—É—Å
- –ö–æ–ª–æ–Ω–∫–∞ F: –Æ—Ä–∏—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ö–æ–ª–æ–Ω–∫–∞ G: –ò—Å—Ç–µ—Ü
- –ö–æ–ª–æ–Ω–∫–∞ H: –û—Ç–≤–µ—Ç—á–∏–∫

### 2. –õ–∏—Å—Ç "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

–í –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ —É–∂–µ –µ—Å—Ç—å –ª–∏—Å—Ç **"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"** —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| Email | –†–æ–ª—å | –ò–º—è | Telegram Chat ID | ‚úâÔ∏è Email | üì± Telegram | üìû SMS | –î–µ–ª–∞ |

**–í–∞–∂–Ω–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
- **–ö–æ–ª–æ–Ω–∫–∞ D:** Telegram Chat ID - —á–∏—Å–ª–æ–≤–æ–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot)
- **–ö–æ–ª–æ–Ω–∫–∞ F:** üì± Telegram - —Ñ–ª–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å TRUE –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü–µ—Ä–≤—ã–µ 9 —Å—Ç—Ä–æ–∫ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 10-–π —Å—Ç—Ä–æ–∫–∏

**–ü—Ä–∏–º–µ—Ä:**

| Email | –†–æ–ª—å | –ò–º—è | Telegram Chat ID | ‚úâÔ∏è Email | üì± Telegram | üìû SMS |
|-------|------|-----|------------------|----------|-------------|---------|
| user@example.com | LAWYER | –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤ | 123456789 | TRUE | **TRUE** | FALSE |
| user2@example.com | SECRETARY | –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞ | 987654321 | FALSE | **TRUE** | FALSE |

**–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ñ–ª–∞–≥–æ–º "üì± Telegram = TRUE" –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è!**

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ VPS

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /root/Law_table
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å PM2

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
pm2 stop all
pm2 delete all

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
pm2 start ecosystem.config.js

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
pm2 save

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 status

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
pm2 logs law-table-scheduler

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
pm2 logs law-table-server
```

## –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è:
- **09:00** - —É—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- **18:00** - –≤–µ—á–µ—Ä–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–í—Ä–µ–º—è —É–∫–∞–∑–∞–Ω–æ –¥–ª—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ **Europe/Moscow**.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `scheduler.js`:

```javascript
// –§–æ—Ä–º–∞—Ç: –º–∏–Ω—É—Ç–∞ —á–∞—Å –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏
cron.schedule('0 9 * * *', runNotificationCheck);  // 09:00
cron.schedule('0 18 * * *', runNotificationCheck); // 18:00
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–¥–∏–Ω —Ä–∞–∑
node scheduler.js
```

### API endpoint –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å POST –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
curl -X POST https://legalaipro.ru/api/notifications
```

### –í–∫–ª—é—á–∏—Ç—å —á–∞—Å—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–í —Ñ–∞–π–ª–µ `scheduler.js` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏:

```javascript
// –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
cron.schedule('*/10 * * * *', runNotificationCheck, {
  scheduled: true,
  timezone: 'Europe/Moscow'
});
```

## –§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–∞:

```
üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ó–ê–°–ï–î–ê–ù–ò–ò

‚öñÔ∏è –î–µ–ª–æ: –ê40-123456/2024
üë§ –ò—Å—Ç–µ—Ü: –û–û–û "–ö–æ–º–ø–∞–Ω–∏—è"
üë• –û—Ç–≤–µ—Ç—á–∏–∫: –ò–ü –ò–≤–∞–Ω–æ–≤ –ò.–ò.

üìÖ –î–∞—Ç–∞ –∑–∞—Å–µ–¥–∞–Ω–∏—è: 25.12.2024
‚è∞ –ó–∞—Å–µ–¥–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞!

‚öñÔ∏è –Æ—Ä–∏—Å—Ç: –ü–µ—Ç—Ä–æ–≤ –ü.–ü.

_–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã_
```

## –õ–æ–≥–∏

–õ–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `logs/`:
- `scheduler-out.log` - –æ–±—â–∏–µ –ª–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- `scheduler-error.log` - –æ—à–∏–±–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- `server-out.log` - –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- `server-error.log` - –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ª–æ–≥–æ–≤
tail -f logs/scheduler-out.log

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pm2 flush
```

## Troubleshooting

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:**
   ```bash
   pm2 status
   # law-table-scheduler –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å online
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   pm2 logs law-table-scheduler --lines 100
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ:**
   - –î–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
   - –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å "–¥–∞—Ç–∞", "–∑–∞—Å–µ–¥–∞–Ω" –∏–ª–∏ "—Å–ª—É—à–∞–Ω"

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏—Å—Ç "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏":**
   - Telegram ID –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏
   - –õ–∏—Å—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ

### –û—à–∏–±–∫–∞ "TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env`:
```bash
cat /root/Law_table/.env
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞: TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
```

### –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Google Sheets

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- GOOGLE_API_KEY –≤ `.env`
- SPREADSHEET_ID –≤ –∫–æ–¥–µ
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í —Ñ–∞–π–ª–µ `api/notifications.js` –∏–∑–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `isTomorrow()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 1 –¥–µ–Ω—å
- `isInThreeDays()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ 3 –¥–Ω—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `isInOneWeek()` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é.

### –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í —Ñ–∞–π–ª–µ `api/notifications.js` —Ñ—É–Ω–∫—Ü–∏—è `sendNotification()`:

```javascript
const message = `
üîî *–£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ó–ê–°–ï–î–ê–ù–ò–ò*
// ... –≤–∞—à —Ç–µ–∫—Å—Ç
`;
```
